<?xml version="1.0" encoding="UTF-8"?>
<section id="modell-elbepolte" vendor="sachsen">
  <title>Modellintegration Elbe</title>

  <indexterm>
    <primary>Modellintegration</primary>

    <secondary>Elbe</secondary>
  </indexterm>

  <para>Das Hochwasservorhersagemodell der Elbe beruht auf dem Programm
  HWObereElbe, dessen Grundlagen vom damaligen Institut für Waserwirtschaft
  gemeinsam mit dem HMU der damaligen CSSR entwickelt wurden. Weiterentwickelt
  wird die Software durch das Ingenieurbüro Polte (IB Polte) aus
  Potsdam.</para>

  <para>Zur Integration der Modelle in KALYPSO-Enterprise wurde das bestehende
  Programm durch das IB Polte so angepasst, dass ein oberflächenloser Betrieb
  des Rechenkerns möglich ist.</para>

  <para>Dieser Rechenkern ist serverseitig als Modell-Plugin in KALYPSO
  integriert. Zur clientseitigen Integration wurde eine GML-basierte
  Modellspezifikation erstellt.</para>

  <para>Die zur Integration des Modells nötige Programmierung ist innerhalb
  der Programmquellen vollständig im Projekt
  <filename>KalypsoModelElbePolte</filename> zusammengefasst. Neben der
  Implementierung des Rechendienstes befindet sich dort die für die Berechnung
  benötigte ausführbare Datei <filename>HWObereElbe.exe</filename>.</para>

  <para>Alle Daten zur clientseitigen Modellierung, also Modellspezifikation,
  Modelldaten usw., befinden sich im Datenprojekt
  <filename>KalypsoElbePolte</filename> der Programmquellen. Das gleiche
  Projekt dient als Modellprojekt unter dem Namen <quote>ElbePolte</quote> als
  Vorhersagemodell der eigentlichen Installation.</para>

  <section id="sec_modelSpecElbePolte">
    <title>Modellspezifikation und Grunddaten</title>

    <indexterm>
      <primary>Modellspezifikation und Grunddaten</primary>

      <secondary>Elbe</secondary>
    </indexterm>

    <para>Die Verzeichnisstruktur des Modellprojekts
    <filename>KalypsoElbePolte</filename> ist gemäß <xref
    linkend="abschn_5_1" /> aufgebaut. Über die Standard-Struktur hinaus wurde
    das Verzeichnis <filename>.Rechenvarianten_Test</filename> angelegt,
    welches Testdatensätze als fertige Rechenvarianten enthält.</para>

    <para>Die GML-Applikationsschemata wurden wie empfohlen in den
    Programmquellen des Modell-Plugins im Paket
    <filename>org/kalypso/lhwzsachsen/elbepolte/schemata</filename>
    abgelegt.</para>

    <para>Das Grundmodell wurde unter dem Namen
    <filename>modell.gml</filename> im Hauptverzeichnis des Modellprojektes
    gespeichert. Durch Doppelklick auf die GML-Datei kann man sich einen
    Überblick über die Struktur der Modelldaten in Form einer Baumansicht
    verschaffen. Nach dem Öffnen der Ansicht erscheint eine (Baum-)
    Strukturansicht des Modells, welche unter anderem auch das Bearbeiten der
    einzelnen Modellelemente erlaubt (siehe <xref
    linkend="fig_modellintegration_elbepolte_ueberblick" />).</para>

    <figure id="fig_modellintegration_elbepolte_ueberblick">
      <title>Überblick Modelldaten Elbe</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/modellintegration/sachsen/elbepolte/modellbaum.png"
                     scale="60" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Zusätzlich zu den allgemeinen Modellparametern besteht das
    Elbe-Modell aus vier Listen (Collections), welche unterhalb des
    Wurzelelements (root) angeordnet sind:</para>

    <itemizedlist>
      <listitem>
        <para>Die Liste der Strecken (streckeMember) enthält alle Strecken und
        deren Parameter.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Pegel (pegelMember) enthält die im Modell
        abgebildeten Start- und Elbepegel und deren Parameter.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Zwischengebietszuflüsse (zwgZuflussMember) enthält
        die Zwischengebietszuflüsse des Modells einschließlich Pegel
        Löben.</para>
      </listitem>

      <listitem>
        <para>Die Liste der internen Hilfspegel (internerHPegelMember) enthält
        die internen Hilfspegel für Litomerice.</para>
      </listitem>
    </itemizedlist>

    <para>Im Folgenden werden die einzelnen Modellparameter und Spalten der
    Modelltabellen erläutert. Die Eingabe der Parameter erfolgt über die
    entsprechenden Ansichten im KALYPSO-Modeler (Expertenmodus) oder im
    Vorhersage-Assistenten. Die Bedeutung der rechenkernbezogenen Parameter
    ist der Modell-Dokumentation zu entnehmen.</para>

    <table>
      <title>Allgemeine Modellparameter</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>-</entry>

            <entry>Name des Modells</entry>
          </row>

          <row>
            <entry>Beschreibung</entry>

            <entry>-</entry>

            <entry>Beschreibung des Modells</entry>
          </row>

          <row>
            <entry>HW-Typ</entry>

            <entry>-</entry>

            <entry>Hochwassertyp, für den das Modell berechnet werden soll
            (1..3)</entry>
          </row>

          <row>
            <entry>Nachführung RIDO</entry>

            <entry>-</entry>

            <entry>Soll bei der Vorhersagerechnung eine Nachführung nach RIDO
            vorgenommen werden?</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>Parameter der Strecken für die Elbe</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Strecke</entry>

            <entry>-</entry>

            <entry>Name der Strecke</entry>
          </row>

          <row>
            <entry>Beschreibung der Strecke</entry>

            <entry>-</entry>

            <entry>Beschreibung der Strecke</entry>
          </row>

          <row>
            <entry>Oberwasser-Pegel</entry>

            <entry>Link auf Pegel</entry>

            <entry>Verweis auf Oberwasser-Pegel</entry>
          </row>

          <row>
            <entry>Oberwasser-Pegel (2)</entry>

            <entry>Link auf Pegel</entry>

            <entry>ggf. Verweis auf zweiten Oberwasser-Pegel</entry>
          </row>

          <row>
            <entry>Unterwasser-Pegel</entry>

            <entry>Link auf Pegel</entry>

            <entry>Verweis auf Unterwasser-Pegel</entry>
          </row>

          <row>
            <entry>Gewässer</entry>

            <entry>-</entry>

            <entry>Gewässer zu dem die Strecke gehört</entry>
          </row>

          <row>
            <entry>Zwischengebietszuschlag</entry>

            <entry>[%]</entry>

            <entry>Zwischengebietszuschlag (ZZG)</entry>
          </row>

          <row>
            <entry>Nr.</entry>

            <entry>-</entry>

            <entry>Nummer der Strecke</entry>
          </row>

          <row>
            <entry>Änderung des Basisdurchflusses</entry>

            <entry>[m<superscript>3</superscript>/s]</entry>

            <entry>Änderung des Basisdurchflusses (DB)</entry>
          </row>

          <row>
            <entry>Änderung der Totzeit</entry>

            <entry>[Anzahl Zeitschritte]</entry>

            <entry>Änderung der Totzeit (LT)</entry>
          </row>

          <row>
            <entry>Ersetzen der Mess- durch Modellwerte</entry>

            <entry>-</entry>

            <entry>Sollen bei der Vorhersagerechnung die Messwerte durch die
            (berechneten) Modellwerte ersetzt werden?</entry>
          </row>

          <row>
            <entry>Nachführung FEKO</entry>

            <entry>[Anzahl Zeitschritte]</entry>

            <entry>Anzahl der Zeitschritte für die eine Nachführung FEKO
            erfolgen soll (0..4)</entry>
          </row>

          <row>
            <entry>Parameter-Sätze</entry>

            <entry>-</entry>

            <entry>Liste von Parameter-Sätzen (pro HW-Typ ein Parameter-Satz),
            Beschreibung der Parameter siehe <xref
            linkend="tbl_elbe_param_set" /></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table id="tbl_elbe_param_set">
      <title>Parameter der Parameter-Sätze (für eine Strecke)</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>HW-Typ</entry>

            <entry>-</entry>

            <entry>Hochwassertyp, für den der Parameter-Satz gültig ist
            (1..3)</entry>
          </row>

          <row>
            <entry>max. Durchfluss der ersten Gewässerstufe</entry>

            <entry>[m<superscript>3</superscript>/s]</entry>

            <entry>max. Durchfluss der ersten Gewässerstufe</entry>
          </row>

          <row>
            <entry>max. Durchfluss der zweiten Gewässerstufe</entry>

            <entry>[m<superscript>3</superscript>/s]</entry>

            <entry>max. Durchfluss der zweiten Gewässerstufe</entry>
          </row>

          <row>
            <entry>Entfernung zwischen Eingangs- und Ausgangspegel</entry>

            <entry>[km]</entry>

            <entry>Entfernung zwischen Eingangs- und Ausgangspegel</entry>
          </row>

          <row>
            <entry>Specherkonstante</entry>

            <entry>-</entry>

            <entry>Speicherkonstante</entry>
          </row>

          <row>
            <entry>Indexverschiebung für den Ausuferungsspeicher</entry>

            <entry>-</entry>

            <entry>Indexverschiebung für den Ausuferungsspeicher</entry>
          </row>

          <row>
            <entry>Stufen-Parameter-Sätze</entry>

            <entry>-</entry>

            <entry>Liste von (bis zu drei) Stufen-Parameter-Sätzen,
            Beschreibung der Parameter siehe <xref
            linkend="tbl_elbe_stufen_param_set" /></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table id="tbl_elbe_stufen_param_set">
      <title>Parameter der Stufen-Parameter-Sätze (für einen Parameter-Satz
      einer Strecke)</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Systemlaufzeit in der Strecke</entry>

            <entry>-</entry>

            <entry>Systemlaufzeit in der Strecke</entry>
          </row>

          <row>
            <entry>Regressionsfaktor zum Wert (n-1)</entry>

            <entry>-</entry>

            <entry>Regressionsfaktor zum Wert (n-1)</entry>
          </row>

          <row>
            <entry>Regressionsfaktor zum Wert (n-2)</entry>

            <entry>-</entry>

            <entry>Regressionsfaktor zum Wert (n-2)</entry>
          </row>

          <row>
            <entry>Translationsfaktoren für die Werte des
            Eingangspegels</entry>

            <entry>-</entry>

            <entry>Liste von (1 bis neun) Translationsfaktoren für die Werte
            des Eingangspegels</entry>
          </row>

          <row>
            <entry>Anteil Gesamtdurchfluss, der in den Speicher fließt</entry>

            <entry>[%]</entry>

            <entry>Anteil des Gesamtdurchflusses, der in den Speicher
            fließt</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>allgemeine Parameter der Pegel für die Elbe</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="5*" />

        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="5*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Lage</entry>

            <entry>-</entry>

            <entry>Lage des Pegels</entry>
          </row>

          <row>
            <entry>Pegelname</entry>

            <entry>-</entry>

            <entry>(Anzeige-) Name des Pegels</entry>
          </row>

          <row>
            <entry>Pegelname (deutsch)</entry>

            <entry>-</entry>

            <entry>deutscher Pegelname</entry>
          </row>

          <row>
            <entry>Pegelname (tschechisch)</entry>

            <entry>-</entry>

            <entry>tschechischer Pegelname</entry>
          </row>

          <row>
            <entry>Beschreibung des Pegels</entry>

            <entry>-</entry>

            <entry>Beschreibung des Pegels</entry>
          </row>

          <row>
            <entry>Pegel-ID</entry>

            <entry>-</entry>

            <entry>Pegel-ID, Messstellennummer</entry>
          </row>

          <row>
            <entry>interne Pegel-Nr.</entry>

            <entry>-</entry>

            <entry>Pegel-Nr., die für die Generierung der Eingangsdaten des
            Rechenkerns verwendet wird (Dateiendung)</entry>
          </row>

          <row>
            <entry>Gewässer</entry>

            <entry>-</entry>

            <entry>Gewässer, an dem der Pegel liegt</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>zusätzliche Parameter der Startpegel für die Elbe</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="5*" />

        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="5*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Mess- und Vorgabewerte</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit Gesamtganglinie (Messung kombiniert mit
            tschechischer Vorhersage)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>zusätzliche Parameter der Elbepegel für die Elbe</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="4*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Messwerte</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit Ganglinie der Messwerte</entry>
          </row>

          <row>
            <entry>Modellwerte</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit Ganglinie der Modellwerte (berechnete
            Vorhersage)</entry>
          </row>

          <row>
            <entry>Modellwerte (Untere Umhüllende)</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit unterer Umhüllenden der Modellwerte</entry>
          </row>

          <row>
            <entry>Modellwerte (Obere Umhüllende)</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit oberer Umhüllenden der Modellwerte</entry>
          </row>

          <row>
            <entry>(tschechische) Vorhersagewerte</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit Gangline der tschechischen Vorhersage
            (Pegel Usti)</entry>
          </row>

          <row>
            <entry>Vorhersagegenauigkeit</entry>

            <entry>[%/60h]</entry>

            <entry>Parameter zur Ermittlung der umhüllenden
            Vorhersageganglinien (bezogen auf Abfluss)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>zusätzliche Parameter der Zwischengebietszuflüsse für die
      Elbe</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="6*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Abfluss-Ganglinie</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit Abfluss-Ganglinie (Zwischengebietszuflüsse
            wurden ermittelt als Summe einzelner Abflüsse; Zeitreihe für Pegel
            Löben ist Gesamtganglinie)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>zusätzliche Parameter der internen Hilfspegel für die
      Elbe</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="1*" />

        <colspec align="left" colwidth="1*" />

        <colspec align="left" colwidth="4*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Modellwerte</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit (berechneten) Modellwerten</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>

  <section>
    <title>Spezifikation der Rechenvarianten</title>

    <indexterm>
      <primary>Spezifikation der Rechenvarianten</primary>

      <secondary>Elbe</secondary>
    </indexterm>

    <para>Die Rechenvarianten wurden gemäß <xref
    linkend="sec-modellintegration-allgemein" /> angelegt und konfiguriert.
    <xref linkend="tab-modellintegration-elbepolte-rechenvariante" /> zeigt
    den konkreten Aufbau für die Elbe.</para>

    <table id="tab-modellintegration-elbepolte-rechenvariante">
      <title>Aufbau einer Rechenvariante des Elbe-Modells</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="5*" />

        <colspec align="left" colwidth="5*" />

        <thead>
          <row>
            <entry align="center">Pfade relativ zur Rechenvariante</entry>

            <entry align="center">Beschreibung</entry>

            <entry align="center">Entstehung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><filename>Steuerparameter.gft</filename></entry>

            <entry>Ansichtsvorlage für die Steuerparameter</entry>

            <entry>Kopie aus
            <filename>/KalypsoElbePolte/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Modellparameter.gft</filename></entry>

            <entry>Ansichtsvorlage für die allgemeinen Modellparameter</entry>

            <entry>Kopie aus
            <filename>/KalypsoElbePolte/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Gesamtansicht.gmt</filename></entry>

            <entry>Karte des Gesamtgebiets mit allen Modellelementen</entry>

            <entry>Kopie aus
            <filename>/KalypsoElbePolte/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Streckenparameter.gtt</filename></entry>

            <entry>Tabelle der Strecken zur Editierung der
            Streckenparameter</entry>

            <entry>Kopie aus
            <filename>/KalypsoElbePolte/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>calcCase.log</filename></entry>

            <entry>Log-Datei zur Erstellung der Rechenvariante, insbesondere
            Meldungen zur Gültigkeit der Zeitreihenwerte</entry>

            <entry>KALYPSO-Rechendienst</entry>
          </row>

          <row>
            <entry><filename>.calculation</filename></entry>

            <entry>Steuerparameter der Berechnung</entry>

            <entry>Kopie der Datei
            <filename>/KalypsoElbePolte/.model/.calculation.template</filename>
            unter Ersetzung/Bearbeitung der Parameter.</entry>
          </row>

          <row>
            <entry><filename>calcCase.gml</filename></entry>

            <entry>GML-Datei der Modelldaten der Rechenvariante</entry>

            <entry>Kopie der Grunddaten des Modells
            (<filename>/KalypsoElbePolte/modell.gml</filename>)</entry>
          </row>

          <row>
            <entry><filename>Zeitreihen/*.zml</filename></entry>

            <entry>Eingangszeitreihen der Berechnung</entry>

            <entry>KALYPSO-Zeitreihendienst</entry>
          </row>

          <row>
            <entry><filename>Zeitreihen/*.ott</filename></entry>

            <entry>tabellarische Übersichten über Eingangszeitreihen</entry>

            <entry>Kopien von
            <filename>/KalypsoElbePolte/.templates/Zeitreihen/*.ott</filename></entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/*</filename></entry>

            <entry>Ergebnisse einer Berechnung</entry>

            <entry>KALYPSO-Rechendienst</entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/.native/out/Modell/Fehler.txt</filename></entry>

            <entry>Log-Datei der Berechnung</entry>

            <entry>KALYPSO-Rechendienst</entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/.native</filename></entry>

            <entry>Modelldaten im Format des Rechenkerns zu Prüfzwecken hier
            abgelegt</entry>

            <entry>KALYPSO-Rechendienst</entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/Zeitreihen/*.zml</filename></entry>

            <entry>Eigentliche Berechnungsergebnisse in Form von
            Zeitreihen</entry>

            <entry>KALYPSO-Rechendienst</entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/Zeitreihen/*.ott</filename></entry>

            <entry>tabellarische Übersichten über Ergebniszeitreihen</entry>

            <entry>Kopien von
            <filename>/KalypsoElbePolte/.templates/Ergebnisse/Zeitreihen/*.ott</filename></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <section>
      <title>Launches und ANT-Skripte</title>

      <para>Der Modellablauf wird mit Hilfe der in der Datei
      <filename>/KalypsoElbePolte/.model/launch/build.xml</filename>
      enthaltenen ANT-Targets gesteuert.</para>

      <para>Die bereitgestellten ANT-Targets umfassen die in <xref
      linkend="sec-modellintegration-allgemein" /> beschriebenen vier Launches
      (Erstellen einer neuen Rechenvariante, Aktualisieren einer
      Rechenvariante, Berechnung einer Rechenvariante und Ablage der
      Prognosezeitreihen).</para>

      <section>
        <title>Erstellen einer Rechenvariante
        (<filename>createCalcCase.launch</filename>)</title>

        <para>Es werden alle (Grund-)Daten der Rechenvariante erstellt
        (kopiert), d.h. alle Daten außer den Zeitreihendaten. Die Datei der
        Steuerparameter <filename>.calculation</filename> (siehe <xref
        linkend="sec_modellintegration_elbePolte_pktCalculation" />) wird mit
        Standardwerten belegt. Die eigentlichen Modelldaten befinden sich in
        der Datei <filename>calcCase.gml</filename> und stellen eine reine
        Kopie der Grunddaten
        (<filename>/KalypsoElbePolte/modell.gml</filename>) dar.</para>
      </section>

      <section>
        <title>Aktualisieren einer Rechenvariante
        (<filename>updateCalcCase.launch</filename>)</title>

        <para>Es werden alle Zeitreihendaten der Rechenvariante wie folgt
        zusammengestellt:</para>

        <informaltable>
          <tgroup cols="2">
            <colspec align="left" colwidth="4*" />

            <colspec align="left" colwidth="6*" />

            <thead>
              <row>
                <entry align="center">Datenart</entry>

                <entry align="center">Herkunft</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>Wasserstände an den Startpegeln</entry>

                <entry>PSICompact (Kombination aus Messwerten und
                tschechischen Vorhersagen)</entry>
              </row>

              <row>
                <entry>Wasserstände an den Elbepegeln</entry>

                <entry>PSICompact (Messwerte)</entry>
              </row>

              <row>
                <entry>tschechische Vorhersage für Usti</entry>

                <entry>PSICompact</entry>
              </row>

              <row>
                <entry>Zwischengebietsabflüsse</entry>

                <entry>PSICompact</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>

        <para>Die Zuordnung zwischen Zeitreihen der Rechenvariante und
        Zeitreihen in PSICompact bzw. Zeitreihen in Dateien auf dem Server
        befindet sich in den Zuordnungsdateien
        <filename>/KalypsoElbePolte/.model/observationConf/*.gml</filename>.</para>
      </section>

      <section>
        <title>Berechnung einer Rechenvariante
        (<filename>runCalculation.launch</filename>)</title>

        <para>Die vom Rechenkern benötigten Daten werden zusammengestellt und
        an den Berechnungsdienst gesandt. Die zurückgebenen Ergebnisse werden
        in die Rechenvariante übernommen, vorher werden ggf. bereits
        bestehende Ergebnisse gelöscht.</para>
      </section>

      <section>
        <title>Ablage der Prognosezeitreihen
        (<filename>exportVorhersagen.launch</filename>)</title>

        <para>Entsprechend der Zuordnungen in den Dateien
        <filename>/KalypsoElbePolte/.model/observationConf/VorhersageMapping*.gml</filename>
        werden Prognosezeitreihen nach PSICompact geschrieben.</para>
      </section>
    </section>

    <section id="sec_modellintegration_elbePolte_pktCalculation">
      <title>Die Datei <filename>.calculation</filename></title>

      <para>Die Steuerdatei <filename>.calculation</filename> wird durch das
      serverseitig abgelegte GML-Schema <filename>control.xsd</filename>
      (Speicherort siehe <xref linkend="sec_modelSpecElbePolte" />)
      spezifiziert und enthält neben dem Simulationszeitraum (Start der
      Simulation, Start der Vorhersage, Ende der Simulation) noch weitere
      Metadaten, um eine Rechenvariante ausführlich beschreiben zu können.
      Diese sind:</para>

      <itemizedlist>
        <listitem>
          <para>der Ersteller der Rechenvariante (Default-Wert ist der
          Login-Name)</para>
        </listitem>

        <listitem>
          <para>das Erstellungsdatum der Rechenvariante (Default-Wert ist die
          Systemzeit bei Anlegen der Rechenvariante)</para>
        </listitem>

        <listitem>
          <para>eine Kurzbeschreibung der Rechenvariante</para>
        </listitem>

        <listitem>
          <para>eine Langbeschreibung der Rechenvariante</para>
        </listitem>
      </itemizedlist>

      <para>Um eine ansprechende Darstellung der Steuerparameter und Metadaten
      im Dialog <menuchoice>
          <guilabel>Rechenvariante</guilabel>

          <guimenuitem>Neu</guimenuitem>
        </menuchoice> sowie im Vorhersage-Assistenten zu erhalten, wurde eine
      Ansichtsvorlage für die Steuerdatei unter
      <filename>/KalypsoElbePolte/.model/.calculation.view</filename>
      abgelegt. Sie hat den gleichen Aufbau wie die Vorlagendatei
      <filename>Steuerparameter.gft</filename> im Verzeichnis der
      Rechenvariante.</para>

      <tip>
        <para>Zum Erstellen der Kopiervorlagen für die Ansichten der
        Rechenvariante (<abbrev>z. B.</abbrev>
        <filename>Steuerparameter.gft</filename> oder
        <filename>Streckenparameter.gtt</filename>) wurde im Verzeichnis
        <filename>/KalypsoElbePolte/.templates/calcCase/</filename> die Daten
        einer konkreten Rechenvariante abgelegt. Dadurch konnten die Vorlagen
        mit relativem Pfad auf diese Daten komfortabel erstellt werden und
        können ohne Anpassung in jede neue Rechenvariante kopiert
        werden.</para>
      </tip>
    </section>
  </section>

  <section>
    <title>Modell-Plugin</title>

    <indexterm>
      <primary>Modell-Plugin</primary>

      <secondary>Elbe</secondary>
    </indexterm>

    <para>Das Anstoßen der serverseitigen Berechnung wird wie oben beschrieben
    über ein ANT-Skript (<filename>runCalculation.launch</filename>)
    bewerkstelligt. Es werden alle Dateien der Rechenvariante bis auf die
    Vorlagen übertragen.</para>

    <para>Zur Berechnung wird der KALYPSO-Berechnungsdienst mit der Typ-ID des
    Modells (hier <quote>elbepolte</quote>) angestoßen. Der Dienst aktiviert
    anhand der ID die entsprechende Implementierung des Interface
    <interfacename>org.Kalypso.services.calculation.job.ICalcJob</interfacename>.
    Für die Elbe
    <interfacename>org.kalypso.lhwzsachsen.elbepolte.ElbePolteCalcJob</interfacename>.</para>

    <para>Diese Klasse liegt im Projekt
    <filename>KalypsoModelElbePolte</filename> der Programmquellen. Wie oben
    bereits beschrieben wurde, sind alle für die Elbe spezifischen
    Programmierungen und die für das Anstoßen des jeweiligen Rechenkerns
    benötigten Daten in diesem Projekt zusammengefasst.</para>

    <para>Der implementierte Berechnungsdienst geht für jede Berechnung wie
    folgt vor:</para>

    <itemizedlist>
      <listitem>
        <para>Es wird ein temporäres Verzeichnis <quote>native</quote>
        angelegt.</para>
      </listitem>

      <listitem>
        <para>Es wird das ausführbare Programm in das temporäre Verzeichnis
        kopiert. Dieses findet sich im Paket
        <filename>/KalypsoModelElbePolte/src/org/Kalypso/lhwzsachsen/elbepolte/resources</filename>.</para>
      </listitem>

      <listitem>
        <para>Die vom Client übergebenen Daten der Rechenvariante werden in
        die Formate des Rechenkerns konvertiert und im temporären Verzeichnis
        abgelegt.</para>
      </listitem>

      <listitem>
        <para>Die ausführbare Datei (<filename>HWObereElbe.exe</filename>)
        wird gestartet.</para>
      </listitem>

      <listitem>
        <para>Die Ergebnisdaten der Berechnung, welche sich jetzt ebenfalls im
        temporären Verzeichnis befinden, werden in die vom Client benötigten
        Formate übertragen und können jetzt vom Client abgerufen
        werden.</para>
      </listitem>
    </itemizedlist>

    <para>Neben den konvertierten Daten (Zeitreihendaten) werden auch die
    nativen, vom Rechenkern verarbeiteten Daten zurück zum Client übertragen,
    was eine eventuelle Fehlersuche erleichtert. Insbesondere können diese
    direkt von der ursprünglichen Version des Rechenprogramms (mit Oberfläche)
    clientseitig verarbeitet und kontrolliert werden.</para>
  </section>

  <section>
    <title>Konfiguration des Vorhersage-Assistenten</title>

    <indexterm>
      <primary>Vorhersage-Assistent</primary>

      <secondary>Konfiguration</secondary>

      <tertiary>Elbe</tertiary>
    </indexterm>

    <para>Die Konfiguration des jeweiligen Vorhersage-Assistenten befindet
    sich wie in <xref linkend="sec_konfigAssi" /> gefordert in der Datei
    <filename>/KalypsoElbePolte/.model/calcWizard.xml</filename>. Der Ablauf
    der Assistenten ist im Benutzerhandbuch beschrieben und in der
    Konfigurationsdatei kommentiert.</para>

    <para>Die Konfigurationsdatei <filename>calcWizard.xml</filename> verweist
    ihrerseits auf eine Reihe von Ansichtsvorlagen zur Darstellung der
    Modelldaten innerhalb des Assistenten. Diese sind sämtlich im Verzeichnis
    <filename>/KalypsoElbePolte/.templates/calcCase</filename>
    abgelegt.</para>
  </section>
</section>