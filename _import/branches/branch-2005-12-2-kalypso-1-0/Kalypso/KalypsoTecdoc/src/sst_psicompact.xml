<?xml version="1.0" encoding="UTF-8"?>
<section id="psicompact" vendor="sachsen">
    <title>Schnittstelle zu PSICompact</title>

    <para>Die Schnittstelle zwischen Kalypso und PSICompact wird im Projekt
    KalypsoPSICompactAdapter implementiert, welches den Entwicklern den
    Zugriff auf das PSICompact-System ermöglicht: der Rechner muss der
    PSICompact-Umgebung bekannt sein (<emphasis>Im Leitstand aufgenommen</emphasis>). Der Zugriff
    ist lediglich innerhalb des Intranets möglich, ein Fernzugriff über
    Internet ist nicht möglich.</para>

    <section>
      <title>Überblick</title>

      <para>Die Schnittstelle wird in drei Bereichen von Kalypso
      benutzt:</para>

      <informaltable>
        <tgroup cols="3">
          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="2*" />

          <thead>
            <row>
              <entry align="center">PSICompact (Methode)</entry>

              <entry align="center">Einsatz in Kalypso</entry>

              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

			<tbody>
				<row>
					<entry>getInfo, getArchiveData, setArchiveData, getWQParams,
						 getObjectMetaData, getMeasureType
					</entry>
					<entry>Zeitreihen</entry>
					<entry>Zeitreihen inkl. Metadaten abfragen. Daten
						zurückschreiben (Vorhersage-Zeitreihe)</entry>
				</row>
				<row>
					<entry>getUserClasses, getUserRights, getUser</entry>
					<entry>Benutzerrechte</entry>
					<entry>Benutzerrechte abfragen</entry>
				</row>
				<row>
					<entry>copyanddistributeFile</entry>
					<entry>Dokumentenablage</entry>
					<entry>Dateiverteilung</entry>
				</row>
			</tbody>
        </tgroup>
      </informaltable>
    </section>

    <section>
      <title>Quellcode</title>

		<para>Die Implementierung in Kalypso basiert auf dem IRepository-Framework
			(siehe Java-Interface
			<filename>org.kalypso.repository.IRepository</filename>). Die
			Schnittstelle wird nur serverseitig benutzt. Die Server müssen wie oben
			beschrieben in der PSICompact Umgebung integriert sein, sonst ist kein Zugriff
			möglich.</para>

		<para>PSI hat das Java-Interface
			<filename>PSICompact.java</filename> (siehe
			<filename>de.psi.go.lhwz.PSICompact</filename>) zur Verfügung gestellt. Die
			Implementierungsklasse dieses Interface wird über Java-Reflection
			instantiiert. Diese Flexibilität wurde geschaffen, um andere mögliche
			Implementierungen des PSICompact-Interface integrieren zu können, wie dies
			z.B. mit der PSICompactImpl.java im KalypsoPSICompactImpl Projekt der Fall
			ist.</para>

		<para>In der Datei
			<filename>org/kalypso/psiadapter/resources/config.ini</filename> sind
			manche Einstellungen konfigurierbar, u.a. die Implementierungsklasse des
			PSICompact.java Interface - die Eigenschaft PSI_CLASS definiert, welche
			Klasse geladen werden soll:
			<programlisting>
PSI_CLASS=de.psi.go.lhwz.PSICompactImpl</programlisting>
		</para>

      <para>Die Einstellungen sind direkt in der Konfigurationsdatei
      beschrieben.</para>
    </section>

    <section>
      <title>Laufzeit</title>

      <para>Zur Laufzeit werden folgende Jars benötigt:</para>

      <itemizedlist>
        <listitem>
          <para>PSICompact.jar in der Version 041119</para>
        </listitem>
        <listitem>
          <para>OB.jar in der Version 040928</para>
        </listitem>
      </itemizedlist>

      <para>Diese Jars sind im Projekt KalypsoPSICompactAdapter abgelegt. Da
      Tomcat im Sicherheitsmodus gestartet wird, sind entsprechende Einträge
      für die PSICompact-Codebase notwendig. Die Datei catalina.policy
      beinhaltet einen speziellen Bereich für PSICompact (siehe
      catalina.policy im `conf’-Verzeichnis von Tomcat).</para>
    </section>

    <section>
      <title>Zeitreihen</title>

		<para>Zeitreihen werden aus unterschiedlichen Archiven je nach Datentyp (z.B.
			Wasserstand, Niederschlag) gelesen. Die Klasse
			<filename>PSICompactRepositoryFactory</filename> im Package
			<filename>org.kalypso.psiadapter.repository</filename> hat eine
			Methode, welche das richtige PSICompact-Archiv zu einem Datentyp
			liefert.</para>

      <para>PSICompact liefert definierte Statuswerte zu den Werten einer
      Zeitreihe. Diese müssen auf die innerhalb von Kalypso benutzten Stati
      abgebildet werden. Die Umwandlung der Status-Information erfolgt beim
      Abruf der Daten aus PSICompact in folgender Weise:</para>

      <table>
        <title>Status-Tabelle</title>

        <tgroup align="left" cols="5" colsep="1" rowsep="1">
          <colspec colname="c1" colwidth="3*" />

          <colspec colname="c2" colwidth="5*" />

          <colspec colname="c3" colwidth="1*" />

          <colspec colname="c4" colwidth="1*" />

          <colspec colname="c5" colwidth="1*" />

          <thead>
            <row>
              <entry align="center" nameend="c2" namest="c1"></entry>

              <entry>Status <emphasis>OK</emphasis></entry>

              <entry>Status <emphasis>Wert auf Gültigkeit prüfen</emphasis></entry>

              <entry>Status <emphasis>Vom Benutzer geändert</emphasis></entry>
            </row>
          </thead>

          <tbody>
			<row>
				<entry>STATUS_AUTO</entry>
				<entry>Der Archivwert wurde durch eine automatische Nachberechnung
					gebildet. Der Wert kann für die Prognose verwendet werden</entry>
				<entry align="center">X</entry>
				<entry></entry>
				<entry></entry>
			</row>

            <row>
              <entry>STATUS_ERSALLG</entry>
              <entry>Mindestens ein Ersatzwert ist in die automatische Wertbildung eingeflossen, d.h. der Wert ist für die Prognose u.U. nicht verwendbar</entry>
              <entry></entry>
              <entry align="center">X</entry>
              <entry></entry>
            </row>

			<row>
				<entry>STATUS_MANKOR</entry>
				<entry>Der Archivwert ist manuell korrigiert worden, d.h. das Ergebnis
					der automatischen Verdichtung ist überschrieben worden. Der Wert
					kann für die Prognose verwendet werden</entry>
				<entry></entry>
				<entry></entry>
				<entry align="center">X</entry>
			</row>

			<row>
				<entry>STATUS_NACH</entry>
				<entry>Der Archivwert wurde automatisch nachgeführt. Die automatische
					Nachführung sorgt beim Start des Archivdienstes automatisch dafür,
					dass nicht vorhandene Archivwerte erzeugt werden. Wie die
					Archivwerte erzeugt werden, richtet sich nach der parametrierten
					Nachführstrategie dieses Objektes. Der Wert kann für die Prognose
					u.U. nicht verwendet werden</entry>
				<entry></entry>
				<entry align="center">X</entry>
				<entry></entry>
			</row>

			<row>
				<entry>STATUS_NORM</entry>
				<entry>Ein Archivwert wird als normiert bezeichnet, wenn er nicht
					existiert, d.h. nicht oder noch nicht geschrieben wurde. Der Wert kann
					für die Prognose nicht verwendet werden</entry>
				<entry></entry>
				<entry align="center">X</entry>
				<entry></entry>
			</row>

			<row>
				<entry>STATUS_NORMALLG</entry>
				<entry>Mindestens ein normierter Archivwert ist in die Wertbildung
					während der Verdichtung eingeflossen. Der Wert kann für die Prognose
					u.U. nicht verwendet werden</entry>
				<entry></entry>
				<entry align="center">X</entry>
				<entry></entry>
			</row>

			<row>
				<entry>STATUS_OK</entry>
				<entry>Status OK</entry>
				<entry align="center">X</entry>
				<entry></entry>
				<entry></entry>
			</row>

			<row>
				<entry>STATUS_UNDEF</entry>
				<entry>Status nicht definiert</entry>
				<entry></entry>
				<entry align="center">X</entry>
				<entry></entry>
			</row>
          </tbody>
        </tgroup>
      </table>

      <para>Wenn Prognose-Zeitreihen von Kalypso nach PSICompact
      zurückgeschrieben werden bekommen sie automatisch den Status
      PSICompact.STATUS_REKO.</para>
    </section>

    <section>
      <title>Benutzerrechte</title>

      <para>Es werden nur die Benutzerklassen eines Benutzers abgerufen.
      Kalypso unterstützt folgende Zeichenketten von Benutzerklassen (siehe
      org.kalypso.services.user.UserServiceConstants.java):</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>Vorhersage</emphasis></para>
        </listitem>
        <listitem>
          <para><emphasis>Experte</emphasis></para>
        </listitem>
        <listitem>
          <para><emphasis>Administration</emphasis></para>
        </listitem>
      </itemizedlist>

      <para>Weitere feingranulierte Benutzerrechte werden nicht benötigt. Die
      Client-Anwendung passt die Oberfläche automatisch an die Benutzerklassen
      eines Benutzers an.</para>

		<para>Die Konfiguration des KalypsoUserService bestimmt, welche Klasse aus dem
			KalypsoPSICompactAdapter-Projekt die Implementierung übernimmt:
			<programlisting>
PROVIDER=org.kalypso.psiadapter.users.PSICompactRightsProvider
			</programlisting></para>
    </section>

    <section>
      <title>Dokumentablage</title>

      <para>Dokumente werden durch eine XML-Metadata-Datei ergänzt und in das
      Verteilungsverzeichnis von PSICompact kopiert. Der Aufbau dieser
      XML-Datei ist von PSI vorgegeben. Es gibt dazu ein Schema im xdr-Format
      (siehe Anlage anlage_sst_LHWZDokRepImport.xdr).</para>

      <para>Die Konfiguration des KalypsoMetaDocService beinhaltet relevante
      Einstellungen zu PSICompact. Mehr Details dazu finden Sie in der
      Konfigurationsdatei des Dienstes.</para>
    </section>

    <section>
      <title>Weitere Information</title>

      <informaltable>
        <tgroup cols="2">
          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="2*" />

          <thead>
            <row>
              <entry align="center">Dokument</entry>

              <entry align="center">Anlage</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>PSICompact.java</entry>

              <entry>anlage_sst_PSICompact.java</entry>
            </row>

            <row>
              <entry>Schnittstellenbeschreibung v1.08 von PSI</entry>

              <entry>anlage_sst_SchnittstellenbeschreibungLos2_0108.doc</entry>
            </row>

            <row>
              <entry>Telefonvermerke zum Thema Schnittstelle mit PSI vom
              25.05.2004 und 04.06.2004</entry>

              <entry>anlage_sst_20040525_fon_Schnittstelle mit PSI.doc
              anlage_sst_20040604_fon_Schnittstelle mit PSI v1.06.doc</entry>
            </row>

            <row>
              <entry>Dokument Ist-Zustand- und Bedarfsanalyse der
              Schnittstelle von PSI</entry>

              <entry>anlage_sst_Analyse Schnittstelle PSI_V2.doc</entry>
            </row>

            <row>
              <entry>Protokoll Installation der Kalypso-Server vom
              29.10.2004</entry>

              <entry>anlage_sst_20041029_Protokoll_Kalypso_Server.doc</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </section>
  </section>