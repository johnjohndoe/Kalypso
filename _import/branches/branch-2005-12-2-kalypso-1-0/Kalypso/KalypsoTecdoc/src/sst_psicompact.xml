<?xml version="1.0" encoding="UTF-8"?>
<section id="psicompact" vendor="sachsen">
  <title>Schnittstelle zu PSICompact</title>

  <indexterm>
    <primary>Schnittstellen</primary>

    <secondary>PSICompact</secondary>
  </indexterm>

  <para>Die Schnittstelle zwischen KALYPSO und PSICompact wird im Projekt
  <filename>KalypsoPSICompactAdapter</filename> implementiert, welches den
  Entwicklern den Zugriff auf das PSICompact-System ermöglicht: der Rechner
  muss der PSICompact-Umgebung bekannt sein (<emphasis>Im Leitstand
  aufgenommen</emphasis>). Der Zugriff ist lediglich innerhalb des Intranets
  möglich, ein Fernzugriff über Internet ist nicht möglich.</para>

  <section>
    <title>Überblick</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>Überblick</tertiary>
    </indexterm>

    <para>Die Schnittstelle wird in drei Bereichen von KALYPSO benutzt:</para>

    <informaltable>
      <tgroup cols="3">
        <colspec align="left" colwidth="9*" />

        <colspec align="left" colwidth="5*" />

        <colspec align="left" colwidth="6*" />

        <thead>
          <row>
            <entry align="center">PSICompact (Methode)</entry>

            <entry align="center">Einsatz in KALYPSO</entry>

            <entry align="center">Beschreibung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><methodname>getInfo</methodname>,
            <methodname>getArchiveData</methodname>,
            <methodname>setArchiveData</methodname>,
            <methodname>getWQParams</methodname>,
            <methodname>getObjectMetaData</methodname>,
            <methodname>getMeasureType</methodname></entry>

            <entry>Zeitreihen</entry>

            <entry>Zeitreihen inkl. Metadaten abfragen. Daten zurückschreiben
            (Vorhersage-Zeitreihe)</entry>
          </row>

          <row>
            <entry><methodname>getUserClasses</methodname>,
            <methodname>getUserRights</methodname>,
            <methodname>getUser</methodname></entry>

            <entry>Benutzerrechte</entry>

            <entry>Benutzerrechte abfragen</entry>
          </row>

          <row>
            <entry><methodname>copyanddistributeFile</methodname></entry>

            <entry>Dokumentenablage</entry>

            <entry>Dateiverteilung</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </section>

  <section id="sst_psicompact_code">
    <title>Quellcode</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>Quellcode</tertiary>
    </indexterm>

    <para>Die Implementierung in KALYPSO basiert auf dem IRepository-Framework
    (siehe Java-Interface
    <filename>org.kalypso.repository.IRepository</filename>). Die
    Schnittstelle wird nur serverseitig benutzt. Die Server müssen wie oben
    beschrieben in der PSICompact-Umgebung integriert sein, sonst ist kein
    Zugriff möglich.</para>

    <para>PSI hat das Java-Interface <filename>PSICompact.java</filename>
    (siehe <filename>de.psi.go.lhwz.PSICompact</filename>) zur Verfügung
    gestellt. Die Implementierungsklasse dieses Interface wird über
    Java-Reflection instantiiert. Diese Flexibilität wurde geschaffen, um
    andere mögliche Implementierungen des PSICompact-Interface integrieren zu
    können, wie dies <abbrev>z. B.</abbrev> mit der
    <filename>PSICompactImpl.java</filename> im Projekt
    <filename>KalypsoPSICompactImpl</filename> der Fall ist.</para>

    <para>In der Datei
    <filename>org/kalypso/psiadapter/resources/config.ini</filename> sind
    manche Einstellungen konfigurierbar, u.a. die Implementierungsklasse des
    <filename>PSICompact.java</filename> Interface - die Eigenschaft
    <emphasis>PSI_CLASS</emphasis> definiert, welche Klasse geladen werden
    soll: <programlisting>PSI_CLASS=de.psi.go.lhwz.PSICompactImpl</programlisting></para>

    <para>Die Einstellungen sind direkt in der Konfigurationsdatei
    beschrieben.</para>
  </section>

  <section>
    <title>Laufzeit</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>Laufzeit</tertiary>
    </indexterm>

    <para>Zur Laufzeit werden folgende Jars benötigt:</para>

    <itemizedlist>
      <listitem>
        <para><filename>PSICompact.jar</filename></para>
      </listitem>

      <listitem>
        <para><filename>OB.jar</filename> </para>
      </listitem>
    </itemizedlist>

    <para>Diese Jars sind im Projekt
    <filename>KalypsoAdapterPSICompact</filename> abgelegt. Da Tomcat im
    Sicherheitsmodus gestartet wird, sind entsprechende Einträge für die
    PSICompact-Codebase notwendig. Die Datei
    <filename>catalina.policy</filename> beinhaltet einen speziellen Bereich
    für PSICompact (siehe <filename>catalina.policy</filename> im
    <filename>conf</filename>-Verzeichnis von Tomcat).</para>
  </section>

  <section>
    <title>Zeitreihen</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>Zeitreihen</tertiary>
    </indexterm>

    <para>Zur Zeit werden alle Werte aus dem Archivtyp
    <emphasis>PSICompact.ARC_MIN15</emphasis> (15 Minuten-Archiv) geholt und
    zurück geschrieben. </para>

    <para>Beim Zurückschreiben wird zuerst der Zeitreihencontainer mit dem
    Wert -1 beschrieben, um eventuell vorhandene Werte zu löschen. Dies
    geschieht in der vollen 15min Auflösung für den zu schreibenden Zeitraum,
    erweitert um die in den Variablen OVERWRITE_AMOUNT_BEFORE und
    OVERWRITE_AMOUNT_AFTER angegebenen Werte.</para>

    <para>Danach wird der eigentlich zu schreibende Zeitraum in der
    vorliegenden Auflösung geschrieben. Eine eventuelle Anpassunge der zu
    schreibenden Werte (z.B. Rundung oder Änderung der Schrittweite) erfolgt
    durch Angabe von Filterausdrücken in den Ablageskripten.</para>

    <para>Dieses Vorgehen stellt die richtige Darstellung im Internet sicher
    (siehe <xref linkend="fig_overwrite_psicompact" />)). <figure
        id="fig_overwrite_psicompact">
        <title>Überschreibung der Werte</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="img/sst/sachsen/overwrite-psicompact.png"
                       scale="75" />
          </imageobject>
        </mediaobject>
      </figure></para>

    <para>Wie die Werte überschrieben werden, kann anhand der folgenden
    Eigenschaften aus der Konfigurationsdatei (siehe <xref
    linkend="sst_psicompact_code" />) des KalypsoAdapterPSICompact frei
    definiert werden: <glosslist>
        <glossentry>
          <glossterm>OVERWRITE_CALENDAR_FIELD</glossterm>

          <glossdef>
            <para>das Kalender-Feld im Sinne von
            <filename>java.util.Calendar</filename>, worauf AMOUNT_BEFORE und
            AMOUNT_AFTER sich beziehen</para>
          </glossdef>
        </glossentry>

        <glossentry>
          <glossterm>OVERWRITE_AMOUNT_BEFORE</glossterm>

          <glossdef>
            <para>Anzahl der Zeit-Einheiten, die vor dem Beginn einer
            Zeitreihe überschrieben werden, bevor die Zeitreihe nach
            PSICompact zurückgeschrieben wird</para>
          </glossdef>
        </glossentry>

        <glossentry>
          <glossterm>OVERWRITE_AMOUNT_AFTER</glossterm>

          <glossdef>
            <para>Anzahl der Zeit-Einheiten, die nach dem Ende einer Zeitreihe
            überschrieben werden, bevor die Zeitreihe nach PSICompact
            zurückgeschrieben wird</para>
          </glossdef>
        </glossentry>
      </glosslist>PSICompact liefert definierte Statuswerte zu den Werten
    einer Zeitreihe. Diese müssen auf die innerhalb von KALYPSO benutzten
    Stati abgebildet werden. Die Umwandlung der Status-Information erfolgt
    beim Abruf der Daten aus PSICompact in folgender Weise (siehe <xref
    linkend="tbl_psiStati" />):</para>

    <table id="tbl_psiStati">
      <title>Status-Tabelle</title>

      <tgroup align="left" cols="5" colsep="1" rowsep="1">
        <colspec colname="c1" colwidth="3*" />

        <colspec colname="c2" colwidth="5*" />

        <colspec colname="c3" colwidth="1*" />

        <colspec colname="c4" colwidth="1*" />

        <colspec colname="c5" colwidth="1*" />

        <thead>
          <row>
            <entry align="center" nameend="c2" namest="c1">PSICompact</entry>

            <entry align="center" nameend="c5"
            namest="c3">KALYPSO-Status</entry>
          </row>

          <row>
            <entry align="center" nameend="c2" namest="c1"></entry>

            <entry><emphasis>OK</emphasis></entry>

            <entry><emphasis>Wert auf Gültigkeit prüfen</emphasis></entry>

            <entry><emphasis>Vom Benutzer geändert</emphasis></entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>STATUS_AUTO</entry>

            <entry>Der Archivwert wurde durch eine automatische Nachberechnung
            gebildet. Der Wert kann für die Prognose verwendet werden</entry>

            <entry align="center">X</entry>

            <entry></entry>

            <entry></entry>
          </row>

          <row>
            <entry>STATUS_ERSALLG</entry>

            <entry>Mindestens ein Ersatzwert ist in die automatische
            Wertbildung eingeflossen, d.h. der Wert ist für die Prognose u.U.
            nicht verwendbar</entry>

            <entry></entry>

            <entry align="center">X</entry>

            <entry></entry>
          </row>

          <row>
            <entry>STATUS_MANKOR</entry>

            <entry>Der Archivwert ist manuell korrigiert worden, d.h. das
            Ergebnis der automatischen Verdichtung ist überschrieben worden.
            Der Wert kann für die Prognose verwendet werden</entry>

            <entry></entry>

            <entry></entry>

            <entry align="center">X</entry>
          </row>

          <row>
            <entry>STATUS_NACH</entry>

            <entry>Der Archivwert wurde automatisch nachgeführt. Die
            automatische Nachführung sorgt beim Start des Archivdienstes
            automatisch dafür, dass nicht vorhandene Archivwerte erzeugt
            werden. Wie die Archivwerte erzeugt werden, richtet sich nach der
            parametrierten Nachführstrategie dieses Objektes. Der Wert kann
            für die Prognose u.U. nicht verwendet werden</entry>

            <entry></entry>

            <entry align="center">X</entry>

            <entry></entry>
          </row>

          <row>
            <entry>STATUS_NORM</entry>

            <entry>Ein Archivwert wird als normiert bezeichnet, wenn er nicht
            existiert, d.h. nicht oder noch nicht geschrieben wurde. Der Wert
            kann für die Prognose nicht verwendet werden</entry>

            <entry></entry>

            <entry align="center">X</entry>

            <entry></entry>
          </row>

          <row>
            <entry>STATUS_NORMALLG</entry>

            <entry>Mindestens ein normierter Archivwert ist in die Wertbildung
            während der Verdichtung eingeflossen. Der Wert kann für die
            Prognose u.U. nicht verwendet werden</entry>

            <entry></entry>

            <entry align="center">X</entry>

            <entry></entry>
          </row>

          <row>
            <entry>STATUS_OK</entry>

            <entry>Status OK</entry>

            <entry align="center">X</entry>

            <entry></entry>

            <entry></entry>
          </row>

          <row>
            <entry>STATUS_UNDEF</entry>

            <entry>Status nicht definiert</entry>

            <entry></entry>

            <entry align="center">X</entry>

            <entry></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Wenn Prognose-Zeitreihen von KALYPSO nach PSICompact
    zurückgeschrieben werden, bekommen sie automatisch den Status
    PSICompact.STATUS_REKO.</para>
  </section>

  <section>
    <title>Benutzerrechte</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>Benutzerrechte</tertiary>
    </indexterm>

    <para>Es werden nur die Benutzerklassen eines Benutzers abgerufen. KALYPSO
    unterstützt folgende Zeichenketten von Benutzerklassen (siehe
    org.kalypso.services.user.UserServiceConstants.java):</para>

    <itemizedlist>
      <listitem>
        <para><emphasis>Vorhersage</emphasis></para>
      </listitem>

      <listitem>
        <para><emphasis>Experte</emphasis></para>
      </listitem>

      <listitem>
        <para><emphasis>Administration</emphasis></para>
      </listitem>
    </itemizedlist>

    <para>Weitere feingranulierte Benutzerrechte werden nicht benötigt. Die
    Client-Anwendung passt die Oberfläche automatisch an die Benutzerklassen
    eines Benutzers an.</para>

    <para>Die Konfiguration des <classname>KalypsoUserService</classname>
    bestimmt, welche Klasse aus dem
    <classname>KalypsoPSICompactAdapter</classname>-Projekt die
    Implementierung übernimmt: <programlisting>PROVIDER=org.kalypso.psiadapter.users.PSICompactRightsProvider</programlisting></para>
  </section>

  <section>
    <title>Dokumentablage</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>Dokumentablage</tertiary>
    </indexterm>

    <para>Dokumente werden durch eine XML-Metadata-Datei ergänzt und in das
    Verteilungsverzeichnis von PSICompact kopiert. Der Aufbau dieser XML-Datei
    ist von PSI vorgegeben. Es gibt dazu ein Schema im xdr-Format (siehe
    Anlage anlage_sst_LHWZDokRepImport.xdr).</para>

    <para>Die Konfiguration des <classname>KalypsoMetaDocService</classname>
    beinhaltet relevante Einstellungen zu PSICompact. Mehr Details dazu finden
    Sie in der Konfigurationsdatei des Dienstes.</para>
  </section>

  <section>
    <title>Weitere Information</title>

    <indexterm>
      <primary>Schnittstellen</primary>

      <secondary>PSICompact</secondary>

      <tertiary>weitere Information</tertiary>
    </indexterm>

    <informaltable>
      <tgroup cols="2">
        <colspec align="left" colwidth="1*" />

        <colspec align="left" colwidth="2*" />

        <thead>
          <row>
            <entry align="center">Dokument</entry>

            <entry align="center">Anlage</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><classname>PSICompact.java</classname></entry>

            <entry>anlage_sst_PSICompact.java</entry>
          </row>

          <row>
            <entry>Schnittstellenbeschreibung v1.08 von PSI</entry>

            <entry>anlage_sst_SchnittstellenbeschreibungLos2_0108.doc</entry>
          </row>

          <row>
            <entry>Telefonvermerke zum Thema Schnittstelle mit PSI vom
            25.05.2004 und 04.06.2004</entry>

            <entry>anlage_sst_20040525_fon_Schnittstelle mit PSI.doc
            anlage_sst_20040604_fon_Schnittstelle mit PSI v1.06.doc</entry>
          </row>

          <row>
            <entry>Dokument zum Ist-Zustand und der Bedarfsanalyse der
            Schnittstelle von PSI</entry>

            <entry>anlage_sst_Analyse Schnittstelle PSI_V2.doc</entry>
          </row>

          <row>
            <entry>Protokoll der Installation der KALYPSO-Server vom
            29.10.2004</entry>

            <entry>anlage_sst_20041029_Protokoll_Kalypso_Server.doc</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </section>
</section>