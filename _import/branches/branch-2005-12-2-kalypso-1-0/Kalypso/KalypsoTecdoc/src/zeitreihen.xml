<?xml version="1.0" encoding="UTF-8"?>
<chapter id="chapter_4_zeitreihen">
	<title>Zeitreihen Ablage</title>
	
	<section>
		<title>Grundprinzip</title>
		
		<para>Der Zeitreihenablage liegt eine hierarchische Struktur zugrunde. Die
			Java-Schnittstelle org.Kalypso.repository.IRepository ist der zentrale
			Punkt des Ablage-Frameworks von Kalypso. Ablagen können sowohl clientseitig
			als auch serverseitig in Kalypso eingebunden werden.</para>
		
		<para>Die Zeitreihenablage ist eine Spezialisierung des IRepository-Interface.
			Dabei sind die Knoten (IRepositoryItem) anpassbar (IAdaptable) und können
			eine Zeitreihe (IObservation) liefern.</para>
		
		<para>Der Eclipse-Erweiterungsmechanismus (Extension Point) unterstützt
			unterschiedliche Ablagearten über "org.Kalypso.repository.factories".
			Die Erweiterungen dieses Extension Points stellen dem Benutzer die Ablagen
			clientseitig zur Verfügung.</para>
		
		<para>Serverseitig wird die Ablage über die XML-Konfigurationsdatei vom Kalypso
			Observation Dienst genutzt. Das Schema dieser Datei ist identisch mit dem
			Schema des Erweiterungspunktes: es werden die Implementierungsklassen von
			IRepositoryFactory eingebunden (siehe schema/repfactories.exsd im
			KalypsoRepository Projekt).</para>
		
		<figure>
			<title>Übersicht IRepositoryFactory-Konzept, Unterscheidung Client und
				Server</title>
			
			<mediaobject>
				<imageobject>
					<imagedata fileref="img/kap4/irepositoryfactory.png"/>
				</imageobject>
			</mediaobject>
		</figure>
		
		<para>Der gleiche Code wird in Form einer Jar clientseitig und serverseitig
			benutzt. Die Konfigurationen der Repositories weichen jedoch voneinander ab,
			da serverseitig keine Eclipse Workbench-Umgebung zur Verfügung steht.
			Clientseitig erfolgt die Konfiguration über plugin.xml-Datei, serverseitig
			über die Datei rep_conf.xml.</para>
		
		<para>Mehr Information finden Sie in den jeweiligen Schematas und
			Klassendokumentationen.</para>
	</section>
	
	<section>
		<title>Dateiablage</title>
		
		<para>Die lokale Dateiablage (FileRepository) arbeitet direkt mit
			Verzeichnisstrukturen und den dort enthaltenen Dateien. Im Grunde ist die
			Verwaltung aller Dateitypen möglich, da das FileRepository nicht spezifisch
			für ZML (Zeitreihen Markup Language, dass in Kalypso speziell entwickelte XML
			"Serialisierung von Observations") implementiert ist. Auf Basis von
			ZmlObservationItem stehen folgende Factories zur Verfügung:</para>
		
		<orderedlist>
			<listitem>
				<para>die HeadlessZmlRepositoryFactory: wird serverseitig benutzt
					weil GUI-los (Headless).</para>
			</listitem>
			
			<listitem>
				<para>die SWTZmlRepositoryFactory: wird clientseitig benutzt und
					erlaubt dem Benutzer die Eingabe der Parameter über einen
					Dialog.</para>
			</listitem>
		</orderedlist>
	</section>
	
	<section vendor="sachsen-anhalt">
		<title>Die Ablage von WISKI</title>
		
		<para>Zeitreihen aus WISKI werden ebenfalls über den IRepository-Mechanismus
			geliefert. Die hierarchische Struktur ist in WISKI anhand des Gruppensystems
			vorgegeben. Diese Struktur wird Eins zu Eins als Repository in Kalypso dem
			Benutzer zur Verfügung gestellt. Die "kinderlosen" Knoten dieser Struktur
			sind Zeitreihen.</para>
		
		<para>Mehr Informationen finden Sie im <xref linkend="wiski"/>.</para>
	</section>
	
	<section>
		<title>Virtuelle Ablage</title>
		
		<para>Diese Art von Repository bietet fortgeschrittene Möglichkeiten. Eine
			XML-Konfigurationsdatei definiert dabei den Inhalt der Ablage. Anhand von
			Filtern und bestehenden Repositories (wie z.B. Datei-basiert oder aus der
			Zeitreihendatenbank) werden synthetische Zeitreihen generiert. Die
			hierarchische Struktur ist frei definierbar. Diese Art von Ablage wird z.Z.
			nicht eingesetzt.</para>
		
		<para>Die Gebietsniederschlags-Ablage ist eine virtuelle Ablage, die mit Filtern
			und Zeitreihen aus beliebiger Quelle arbeitet. Die Struktur ist durch
			Schachtelung in &lt;level/&gt; und &lt;item/&gt; Elemente frei definierbar.
			Mehr Informationen zum Thema Filter finden Sie weiter unten in diesem
			Kapitel.</para>
	</section>
	
	<section>
		<title>Zeitreihendienst</title>
		
		<para>Wie oben beschrieben ist die Konfiguration beliebig vieler client- und
			serverseitiger Repositories möglich.</para>
		
		<para>Kalypso unterstützt ein spezielles clientseitiges Repository (das
			Zeitreihendienst-Repository), dessen Inhalt der Kalypso Observation Dienst
			zur Verfügung stellt.</para>
		
		<para>Innerhalb dieses Repository sind die serverseitigen oder
			Remote-Repositories abgelegt. Die Remote-Repositories werden in der
			Konfigurationsdatei der Kalypso_ServiceObservation (siehe in
			webdav/srvconf/IobservationService/repconf_server.xml) definiert. Das
			Schema dieser XML-Datei finden Sie unter
			etc/xmlbinding/repository/repconf.xsd im KalypsoRepository
			Projekt.</para>
		
		<para>Der Kalypso Zeitreihendienst kapselt die Zugriffe über WebDienst zwischen
			Kalypso-Client und Server. Er liefert die serverseitigen Repositories (deren
			Anzahl ist unbegrenzt) in Form eines einzigen Repository, welches in die
			Kalypso Oberfläche eingebunden werden kann.</para>
		
		<para>Theoretisch können alle Repositories lokal eingebunden werden, die den
			Extension Point <filename>org.Kalypso.repository.factories</filename>
			erweitern. Dies hängt von den in Kalypso/Eclipse eingebundenen Plugins
			ab.</para>
		
		<figure>
			<title>Zeitreihen-Ablage zwischen Client und Server</title>
			
			<mediaobject>
				<imageobject>
					<imagedata fileref="img/kap4/obsService.png"/>
				</imageobject>
			</mediaobject>
		</figure>
		
		<para>Die serverseitigen Repositories erscheinen auf dem Client unterhalb des
			Zeitreihendienstes, potentiell neben anderen clientseitigen
			Repositories.</para>
	</section>
	
	<section>
		<title>Filter</title>
		
		<para>Um die Zeitreihen an die Anforderungen der Modelle anzupassen, wird ein sog.
			Filter-Mechanismus in Kalypso benutzt.</para>
		
		<para>Die Liste der Zurverfügung stehenden Filter ergibt sich aus der
			XML-Schema-Datei, die unter
			<filename>etc/schemas/zml/zmlFilters.xsd</filename> im
			KalypsoCore-Projekt zu finden ist. Das Java-Interface
			<filename>org.Kalypso.ogc.sensor.IObservationFilter</filename> bildet
			den Einstieg in die Filter-Welt. Das Filter-Interface erweitert das
			IObservation Interface, gefilterte Zeitreihen können also genauso wie andere
			Zeitreihen benutzt werden.</para>
	</section>
</chapter>
