<?xml version="1.0" encoding="UTF-8"?>
<chapter id="ansichtsvorlagen">
  <title>Ansichtsvorlagen</title>

  <indexterm>
    <primary>Ansichtsvorlagen</primary>
  </indexterm>

  <para>KALYPSO Enterprise ermöglicht eine Reihe verschiedener Ansichten auf
  die Daten eines Modells. Die Einstellungen einer Ansicht (welche Daten,
  Darstellung, usw.) werden in Dateien bestimmter Formate, sogenannten
  Ansichtsvorlagen, gespeichert.</para>

  <para>Alle Ansichtvorlagen sind Dateien im XML-Format, die jeweils durch ein
  XML-Schema spezifiziert sind. Die Schemata aller Ansichtsvorlagen befinden
  sich in den Programmquellen im Pfad
  <filename>/KalypsoCore/etc/schemas/template</filename>. Im gleichen
  Verzeichnis befindet sich für jede Vorlagenart eine Beispieldatei.</para>

  <para>Die Ansichtvorlagen entsprechen den verschiedenen möglichen Ansichten
  in KALYPSO-Enterprise. Folgende Ansichten und somit Ansichtsvorlagen werden
  unterstützt (<xref linkend="tbl_vorlagen_Typen" />):</para>

  <table id="tbl_vorlagen_Typen">
    <title>Ansichtstypen und ihre Vorlagen</title>

    <tgroup cols="3">
      <colspec align="left" colwidth="3*" />

      <colspec align="left" colwidth="1*" />

      <colspec align="left" colwidth="3*" />

      <thead>
        <row>
          <entry align="center">Ansicht</entry>

          <entry align="center">Dateiendung der Vorlage</entry>

          <entry align="center">XML-Schemadatei</entry>
        </row>
      </thead>

      <tbody>
        <row>
          <entry>GIS-Kartenansicht</entry>

          <entry>*.gmt</entry>

          <entry>gismapview.xsd</entry>
        </row>

        <row>
          <entry>GIS-Tabellenansicht</entry>

          <entry>*.gtt</entry>

          <entry>gistableview.xsd</entry>
        </row>

        <row>
          <entry>GIS-Formularansicht</entry>

          <entry>*.gft</entry>

          <entry>featureview.xsd</entry>
        </row>

        <row>
          <entry>GIS-Strukturansicht (Baum)</entry>

          <entry>*.gmv</entry>

          <entry>-</entry>
        </row>

        <row>
          <entry>Diagrammansicht Zeitreihen</entry>

          <entry>*.odt</entry>

          <entry>obsdiagview.xsd</entry>
        </row>

        <row>
          <entry>Tabellarische Zeitreihenansicht</entry>

          <entry>*.ott</entry>

          <entry>obstableview.xsd</entry>
        </row>
      </tbody>
    </tgroup>
  </table>

  <para>Allen Vorlagen ist gemein, dass in ihnen lediglich die Art der
  Darstellung gespeichert ist. Die eigentlichen Daten liegen in separaten
  Datendateien (<abbrev>z. B.</abbrev> .shp, .gml, .zml) und werden aus den
  Vorlagen über URL-Verknüpfungen referenziert. Bei der Referenzierung der
  Datendateien sind sowohl relative als auch absolute URL-Angaben möglich.
  Relative Pfad-Angaben beziehen sich stets auf den Ort der
  Vorlagendatei.</para>

  <para>Neben den üblichen URL-Protokollen wie <abbrev>z. B.</abbrev> file:
  und http: wurden für die Modellverwaltung eigene Protokolle definiert.
  Folgende Protokolle werden unterstützt:</para>

  <informaltable>
    <tgroup cols="3">
      <colspec align="left" colwidth="2*" />

      <colspec align="left" colwidth="3*" />

      <colspec align="left" colwidth="2*" />

      <thead>
        <row>
          <entry align="center">Protokoll</entry>

          <entry align="center">Beschreibung</entry>

          <entry align="center">Kommentar</entry>
        </row>
      </thead>

      <tbody>
        <row>
          <entry><filename>http</filename></entry>

          <entry>Übliches http-Protokoll</entry>

          <entry></entry>
        </row>

        <row>
          <entry><filename>file</filename></entry>

          <entry>Datei lokal oder im Netzwerk</entry>

          <entry></entry>
        </row>

        <row>
          <entry><filename>project</filename></entry>

          <entry>Pfad relativ zum aktuellen (KALYPSO-)Projekt</entry>

          <entry></entry>
        </row>

        <row>
          <entry><filename>calcCase</filename></entry>

          <entry>Pfad relativ zur aktuellen Rechenvariante (nur bei Vorlagen
          innerhalb einer Rechenvariante zu verwenden)</entry>

          <entry>Deprecated: es sind vorzugsweise relative Pfade zu
          verwenden.</entry>
        </row>

        <row>
          <entry><filename>platform:/resource/</filename></entry>

          <entry>Beliebiger Pfad innerhalb des Arbeitsbereichs</entry>

          <entry>Allgemeiner Mechanismus der Eclipse-Platform. Siehe
          Eclipse-Dokumentation.</entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>

  <section>
    <title>GIS-Kartenansicht</title>

    <indexterm>
      <primary>Ansichtsvorlagen</primary>

      <secondary>GIS-Kartenansicht</secondary>
    </indexterm>

    <para>Die GIS-Kartenansicht stellt GIS-Daten themenbasiert in einer Karte
    dar. Entsprechend besteht die Vorlage aus einer Themenliste (layern), die
    wiederum eine Liste von Darstellungsvorschriften (styles) enthalten
    kann.</para>

    <para>Die Referenzierung der eigentlichen Daten erfolgt über das
    <emphasis>href</emphasis>-Attribut jedes <emphasis>layer</emphasis>
    -Elements. Das <emphasis>linktpye</emphasis>-Attribut des Themas legt
    fest, in welchem Format die Datendatei geladen wird. Zur Zeit können die
    Formate GML (gml) und ESRI Shape (shape) geladen werden.</para>

    <para>Eine Besonderheit des Formates <emphasis>shape</emphasis> ist, dass
    in der Verknüpfung (<emphasis>href</emphasis>) des Themas zusätzlich das
    Geokoordinatensystem der Shape-Datei angegeben werden kann, <abbrev>z.
    B.</abbrev>: <programlisting>href="project:/Grunddaten/Shapes/gewässer#EPSG:31469"</programlisting></para>

    <para>Das Attribut <emphasis>featurePath</emphasis> des Themas beschreibt,
    welche Daten innerhalb der geladenen Datei angezeigt werden. Dabei
    bezeichnet der Feature-Pfad einen eindeutigen Pfad innerhalb der
    Datenstruktur der jeweils geladenen Datei. Um in der Karte dargestellt
    werden zu können, muss der Feature-Pfad auf eine Liste von GIS-Elementen
    (Feature Collection) verweisen.</para>

    <para>Im Falle einer Shape-Datei ist der Feature-Pfad stets eindeutig und
    muss auf die einzige vorhandene Liste von Elementen verweisen. Diese heißt
    stets <emphasis>featureCollection</emphasis>.</para>
  </section>

  <section>
    <title>GIS-Tabellenansicht</title>

    <indexterm>
      <primary>Ansichtsvorlagen</primary>

      <secondary>GIS-Tabellenansicht</secondary>
    </indexterm>

    <para>Im Gegensatz zur Kartenansicht wird in der Tabellenansicht nur
    <emphasis role="bold">eine</emphasis> Liste von GIS-Elementen tabellarisch
    dargestellt. Die Regeln zur Referenzierung dieser Liste sind die gleichen
    wie in der Kartenansicht. Es ist somit nur ein <emphasis>layer</emphasis>
    -Element zulässig.</para>

    <para>Innerhalb des einzigen Themas wird bei der Tabelle angegeben, welche
    Tabellenspalten angezeigt und nach welchem Attribut die GIS-Elemente
    sortiert werden sollen.</para>
  </section>

  <section>
    <title>GIS-Formularansicht</title>

    <indexterm>
      <primary>Ansichtsvorlagen</primary>

      <secondary>GIS-Formularansicht</secondary>
    </indexterm>

    <para>Die GIS-Formularansicht ist eine flexible Datenansicht eines
    GIS-Elements (Feature) in Form einer formularartigen Dialogmaske.</para>

    <para>Grundlegend werden dabei die Attribute des angezeigten Elements in
    Form von Beschriftungen (Name des Attributs) und Texteingaben (Wert des
    Attributs) dargestellt.</para>

    <para>Das anzuzeigende GIS-Element wird wie bei Karten- und
    Tabellenansicht über ein <emphasis>layer</emphasis>-Element des XML
    angegeben. Auch hier gelten die gleichen Regeln wie im Fall der Karten-
    und Tabellenvorlagen. Im Gegensatz zu Karten- und Tabellenansicht kann
    hier aber ein beliebiges GIS-Element und nicht nur Listen von Elementen
    (Feature-Collections) angegeben werden.</para>

    <para>In den folgenden <emphasis>view</emphasis>-Elementen der Vorlage
    kann genau spezifiziert werden, wie die Darstellung der Attribute des
    Elements erfolgen soll. Dabei bezieht sich ein
    <emphasis>view</emphasis>-Element stets auf den Datentyp (Feature-Type)
    des GIS-Elements. Fehlt für einen Feature-Type die View-Definition, wird
    automatisch eine Standardeinstellung generiert. Die Standardeinstellung
    stellt typischerweise alle Attribute des Elements in einer vertikal
    angeordneten Liste dar.</para>
  </section>

  <section>
    <title>GIS-Strukturansicht</title>

    <indexterm>
      <primary>Ansichtsvorlagen</primary>

      <secondary>GIS-Strukturansicht</secondary>
    </indexterm>

    <para>Die GIS-Strukturansicht stellt die Daten einer GIS-Datei in einer
    Baumansicht dar.</para>

    <para>Im Gegensatz zu den anderen Ansichtsvorlagen beruht das Datenformat
    dieser Vorlage nicht auf einem XML-Schema, sondern ist wie folgt
    aufgebaut:</para>

    <orderedlist>
      <listitem>
        <para>Zeile: Datenart (zur Zeit gml oder shape)</para>
      </listitem>

      <listitem>
        <para>Zeile: (Datei-)pfad zur Datendatei</para>
      </listitem>
    </orderedlist>

    <figure>
      <title>Beispiel</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/kap6/GIS_Strukturansicht.png" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Die GIS-Vorlagenansicht bietet neben dem Löschen und Anlegen von
    GIS-Elementen auch die Möglichkeit, ein GIS-Element zu bearbeiten. In
    diesem Fall öffnet sich eine automatisch generierte GIS-Formularansicht
    auf dem Element.</para>

    <para>Die GIS-Strukturansicht befindet sich zur Zeit noch in Bearbeitung
    und ist somit für den täglichen Gebrauch eventuell noch nicht anwendbar.
    Sie kann aber gerade beim Modellaufbau eine starke Hilfe bei der
    Dateneingabe darstellen.</para>
  </section>

  <section>
    <title>Tabellarische Zeitreihenansicht</title>

    <indexterm>
      <primary>Ansichtsvorlagen</primary>

      <secondary>Zeitreihen</secondary>

      <tertiary>Tabelle</tertiary>
    </indexterm>

    <para>Vorlagen dieser Art stellen eine oder mehrere Zeitreihen in einem
    tabellarischen Editor dar. Dabei können pro Zeitreihe eine oder mehrere
    Spalten dargestellt werden, je nachdem wie viele Werte-Achsen die
    Zeitreihendatei enthält.</para>

    <para>Die erste Spalte der Darstellung ist immer die Datumsachse. Die
    Sortierung erfolgt stets chronologisch, es kann also sein, dass es
    <quote>Löcher</quote> in den Daten einer Spalte gibt, wenn es für ein
    Datum keine Werte in der zugrunde liegenden Zeitreihe gibt.</para>

    <para>In der Vorlage werden Zeitreihenthemen gelistet. Jedes Thema
    entspricht dabei einer Zeitreihe. Innerhalb jedes Themas werden die
    Spalten angegeben, die angezeigt werden sollen. Eine Spalte wird jeweils
    mit einer Werteachse der Zeitreihe assoziiert.</para>

    <para>Wie in den GIS-Vorlagen referenziert ein Thema
    (<emphasis>observation</emphasis>-Element) eine Datendatei über das
    <emphasis>href</emphasis>-Attribut. Es können die gleichen URL-Protokolle
    wie dort verwendet werden. Als <emphasis>linktype</emphasis> ist zur Zeit
    ausschließlich <emphasis>zml</emphasis> zugelassen.</para>

    <para>Neben der Themenliste können auch sogenannte RenderingRules
    (Darstellungsregeln) eingetragen sein. Diese Darstellungsregeln definieren
    die Darstellung von Zusatzinformation wie <abbrev>z. B.</abbrev>
    <quote>Wert muss geprüft werden</quote> oder <quote>Wert vom Benutzer
    geändert</quote> in Form von Farbe, Bild, Tooltips und/oder
    Zeichen.</para>
  </section>

  <section>
    <title>Diagrammansicht Zeitreihen</title>

    <indexterm>
      <primary>Ansichtsvorlagen</primary>

      <secondary>Zeitreihen</secondary>

      <tertiary>Diagramm</tertiary>
    </indexterm>

    <para>In der Diagrammansicht werden Zeitreihendaten als Kurven oder als
    Blockdiagramm (Niederschlag) dargestellt.</para>

    <para>Der Aufbau der Vorlagendatei ähnelt stark dem Format der
    Tabellenvorlage. Statt Spalten (<emphasis>columns</emphasis>) beinhaltet
    ein Thema Kurven (<emphasis>curves</emphasis>) mit Ihren
    Darstellungsparametern (Farbe etc.).</para>

    <para>Zusätzlich muss im Fall des Diagramms angegeben werden, welche
    Diagrammachsen dargestellt werden sollen. Dies erfolgt über die
    <emphasis>axis</emphasis>-Elemente. Für jede Kurve kann nun einzeln
    angegeben werden, auf welchen Achsen ihre Daten dargestellt werden
    sollen.</para>
  </section>
</chapter>