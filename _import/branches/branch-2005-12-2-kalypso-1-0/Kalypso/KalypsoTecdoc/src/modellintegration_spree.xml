<?xml version="1.0" encoding="UTF-8"?>
<section id="modell-spree" vendor="sachsen">
  <title>Modellintegration Spree</title>

  <para>Das Hochwasservorhersagemodell der Spree beruht auf dem Programm
  HW_Spree, welches von der Firma WASY GmbH entwickelt wurde.</para>

  <para>Zur Integration des Spree-Modells in KALYPSO-Enterprise wurde das
  bestehende Programm durch die Firma WASY so angepasst, dass ein
  oberflächenloser Betrieb des Rechenkerns möglich ist.</para>

  <para>Dieser Rechenkern ist serverseitig als Modell-Plugin in KALYPSO
  integriert. Zur clientseitigen Integration wurde eine GML-basierte
  Modellspezifikation erstellt.</para>

  <para>Die zur Integration des Modells nötige Programmierung ist innerhalb
  der Programmquellen vollständig im Projekt
  <filename>KalypsoModelSpree</filename> zusammengefasst. Neben der
  Implementierung des Rechendienstes finden sich dort alle für die Berechnung
  benötigten weiteren Ressourcen wieder (ausführbares Programm hw_spree.exe,
  unveränderbare Parameterdateien sowie Testdatensätze).</para>

  <para>Alle Daten zur clientseitigen Modellierung, also Modellspezifikation,
  Modelldaten usw., befinden sich im Datenprojekt
  <filename>KalypsoSpree</filename> der Programmquellen. Das gleiche Projekt
  dient als Modellprojekt unter dem Namen <quote>Spree</quote> als
  Vorhersagemodell der eigentlichen Installation.</para>

  <section>
    <title>Modellspezifikation und Grunddaten</title>

    <para>Die Verzeichnisstruktur des Modellprojektes
    <filename>KalypsoSpree</filename> ist gemäß <xref linkend="abschn_5_1" />
    aufgebaut. Über die Standard-Struktur hinaus wurde das Verzeichnis
    <filename>.Rechenvarianten_test</filename> angelegt, welches
    Testdatensätze als fertige Rechenvarianten enthält.</para>

    <para>Die GML-Applikationsschemata wurden wie empfohlen in den
    Programmquellen des Modell-Plugins im Paket
    <filename>org/kalypso/lhwzsachsen/spree/schemata</filename>
    abgelegt.</para>

    <para>Das Grundmodell wurde unter dem Namen
    <filename>modell.gml</filename> im Hauptverzeichnis des Modellprojektes
    gespeichert. Durch Doppelklick auf die GML-Datei kann man sich einen
    Überblick über die Struktur der Modelldaten in Form einer Baumansicht
    verschaffen. Nach dem Öffnen der Ansicht erscheint eine (Baum-)
    Strukturansicht des Modells, welche unter anderem auch das Bearbeiten der
    einzelnen Modellelemente erlaubt (siehe <xref
    linkend="fig_modellintegration_spree_ueberblick" />).</para>

    <figure id="fig_modellintegration_spree_ueberblick">
      <title>Überblick Modelldaten Spree</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/modellintegration/sachsen/modellbaum.png"
                     scale="50" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Wie aus der Baumansicht hervorgeht, besteht das Spree-Modell aus
    vier Listen (Collections), welche unterhalb des Wurzelelements (root)
    angeordnet sind:</para>

    <itemizedlist>
      <listitem>
        <para>Die Liste der Pegel (PegelCollectionAssociation) enthält alle
        Pegel und deren Parameter. Innerhalb der Pegel wird zwischen
        Einzugsgebieten und Flusslaufmodellen unterschieden.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Talsperren (TalsperreCollectionAssociation)
        enthält die im Modell abgebildeten Speicherbauwerke und deren
        Parameter.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Vorgabe-Elemente (VorgabeCollectionAssociation)
        enthält die Abflusszu- und -abgaben (<quote>Flutungen</quote>) des
        Modells.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Ombrometer (Ombrometer-Liste) enthält die
        Niederschlagsmessstationen des Gebietsniederschlagsmodells.</para>
      </listitem>
    </itemizedlist>

    <para>Im Folgenden werden die einzelnen Modellparameter und Spalten der
    Modelltabellen erläutert. Die Eingabe der Parameter erfolgt entweder über
    die entsprechenden Ansichten im KALYPSO-Modeler (Expertenmodus) oder im
    Vorhersage-Assistenten.</para>

    <table>
      <title>Parameter der N-A-Modelle (Einzugsgebiete)</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Pegels</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage des Pegels</entry>
          </row>

          <row>
            <entry>Einzugsgebietgrenzen</entry>

            <entry>Polygon</entry>

            <entry>Grenzen der Einzugsgebiete</entry>
          </row>

          <row>
            <entry>BodenfeuchteMin</entry>

            <entry>[-]</entry>

            <entry>Bodenfeuchte (Minimalwert)</entry>
          </row>

          <row>
            <entry>Bodenfeuchte</entry>

            <entry>[-]</entry>

            <entry>Anfangsbodenfeuchte</entry>
          </row>

          <row>
            <entry>BodenfeuchteMax</entry>

            <entry>[-]</entry>

            <entry>Bodenfeuchte (Maximalwert)</entry>
          </row>

          <row>
            <entry>Vorhersagegenauigkeit</entry>

            <entry>cm/Tag</entry>

            <entry>Parameter zur Ermittlung der umhüllenden
            Vorhersageganglinien</entry>
          </row>

          <row>
            <entry>Gewichtung Ombrometer</entry>

            <entry>-</entry>

            <entry>Liste von Gewichtungselementen zur Zuordnung der
            Ombrometerstationen</entry>
          </row>

          <row>
            <entry>Niederschlag_rechnung</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung auf Gebietsniederschlag (Vergangenheit und
            Zukunft)</entry>
          </row>

          <row>
            <entry>Wasserstand_gemessen</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit gemessener Wasserstandsganglinie</entry>
          </row>

          <row>
            <entry>Wasserstand_gerechnet</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit berechneter Wasserstandsganglinie</entry>
          </row>

          <row>
            <entry>Wasserstand_vorhersage</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Wasserstandsvorhersage</entry>
          </row>

          <row>
            <entry>Wasserstand_vorhersage_unten</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Wasserstandsvorhersage, untere
            Umhüllende</entry>
          </row>

          <row>
            <entry>Wasserstand_vorhersage_oben</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Wasserstandsvorhersage, obere
            Umhüllende</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>Parameter der Flusslaufmodelle</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="5*" />

        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="5*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Pegels</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage des Pegels</entry>
          </row>

          <row>
            <entry>Korrektur_Faktor</entry>

            <entry>[-]</entry>

            <entry>Korrekturfaktor zur Erhöhung des Abflusses
            (multiplikativ)</entry>
          </row>

          <row>
            <entry>Korrektur_Niveau</entry>

            <entry>[-]</entry>

            <entry>Korrekturfakor zur Erhöhung des Abflusses (additiv)</entry>
          </row>

          <row>
            <entry>Korrektur_Laufzeit</entry>

            <entry>[h]</entry>

            <entry>Korrekturfaktor zur Änderung der Laufzeit (additiv)</entry>
          </row>

          <row>
            <entry>KorrekturEmpfehlungLaufzeit</entry>

            <entry>[h]</entry>

            <entry>Vorgabe für Korrektur_Laufzeit</entry>
          </row>

          <row>
            <entry>Vorhersagegenauigkeit</entry>

            <entry>cm/Tag</entry>

            <entry>Parameter zur Ermittlung der Umhüllenden
            Vorhersageganglinien</entry>
          </row>

          <row>
            <entry>Wasserstand_gemessen</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung auf gemessene Wasserstandsganglinie</entry>
          </row>

          <row>
            <entry>Wasserstand_gerechnet</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung auf berechnete Wasserstandsganglinie</entry>
          </row>

          <row>
            <entry>Wasserstand_vorhersage</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung der Wasserstandsvorhersage</entry>
          </row>

          <row>
            <entry>Wasserstand_vorhersage_unten</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung der Wasserstandsvorhersage, untere
            Umhüllende</entry>
          </row>

          <row>
            <entry>Wasserstand_vorhersage_oben</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung der Wasserstandsvorhersage, obere
            Umhüllende</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>Parameter der Talsperren</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="4*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Pegels</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage des Pegels</entry>
          </row>

          <row>
            <entry>Anfangsstauvolumen</entry>

            <entry>[hm<superscript>3</superscript>]</entry>

            <entry>Stauinhalt der Talsperren zu Beginn der Simulation</entry>
          </row>

          <row>
            <entry>Abgabe_Eingang</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Abgabezeitreihe auf dem Server</entry>
          </row>

          <row>
            <entry>Abgabe</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Abgabezeitreihe im Modell</entry>
          </row>

          <row>
            <entry>Abgabe_plausibilisiert</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der durch den Rechenkern plausibilisierten
            Abgabezeitreihe</entry>
          </row>

          <row>
            <entry>Stauinhalt</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit berechneter Zeitreihe der
            TS-Volumina</entry>
          </row>

          <row>
            <entry>Zufluss_berechnet</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit berechneter Zuflusszeitreihe</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>Parameter der Vorgabepegel</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="6*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Pegels</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage des Pegels</entry>
          </row>

          <row>
            <entry>Abfluss</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Vorgabezeitreihe im Modell</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table>
      <title>Parameter der Ombrometer</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="1*" />

        <colspec align="left" colwidth="1*" />

        <colspec align="left" colwidth="4*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Pegels</entry>
          </row>

          <row>
            <entry>location</entry>

            <entry>Punkt</entry>

            <entry>Lage des Ombrometers</entry>
          </row>

          <row>
            <entry>Nummer</entry>

            <entry>Text</entry>

            <entry>Messstellennummer</entry>
          </row>

          <row>
            <entry>Niederschlag</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung auf Niederschlagsmessung</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>

  <section>
    <title>Spezifikation der Rechenvarianten</title>

    <para>Die Rechenvarianten wurden gemäß <xref
    linkend="sec-modellintegration-allgemein" /> angelegt und konfiguriert.
    <xref linkend="tab-modellintegration-spree-rechenvariante" /> zeigt den
    konkreten Aufbau im Fall der Spree.</para>

    <table id="tab-modellintegration-spree-rechenvariante">
      <title>Aufbau einer Rechenvariante des Spree-Modells</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="2*" />

        <colspec align="left" colwidth="2*" />

        <thead>
          <row>
            <entry align="center">Pfade relativ zur Rechenvariante</entry>

            <entry align="center">Beschreibung</entry>

            <entry align="center">Entstehung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><filename>Steuerparameter.gft</filename></entry>

            <entry>Ansichtsvorlage für die Steuerparameter</entry>

            <entry>Kopie aus
            <filename>/KalypsoSpree/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Gesamtansicht.gmt</filename></entry>

            <entry>Karte des Gesamtgebiets mit allen Modellelementen</entry>

            <entry>Kopie aus
            <filename>/KalypsoSpree/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Bodenfeuchten.gtt</filename></entry>

            <entry>Tabelle der Einzugsgebiete (N-A Modell) zur Editierung der
            Anfangsbodenfeuchten</entry>

            <entry>Kopie aus
            <filename>/KalypsoSpree/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Anfangsvolumen.gtt</filename></entry>

            <entry>Tabelle der Talsperren zur Editierung der
            Anfangsvolumina</entry>

            <entry>Kopie aus
            <filename>/KalypsoSpree/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>Flusslaufparameter.gtt</filename></entry>

            <entry>Tabelle der Flusslaufmodelle zur Editierung ihrer
            Parameter</entry>

            <entry>Kopie aus
            <filename>/KalypsoSpree/.templates</filename></entry>
          </row>

          <row>
            <entry><filename>calcCase.log</filename></entry>

            <entry>Log-Datei zur Erstellung der Rechenvariante, insbesondere
            Meldungen zur Gültigkeit der Zeitreihenwerte</entry>

            <entry></entry>
          </row>

          <row>
            <entry><filename>.calculation</filename></entry>

            <entry>Steuerparameter der Berechnung</entry>

            <entry>Kopie der Datei
            <filename>/KalypsoSpree/.model/.calculation.template</filename>
            unter Ersetzung/Bearbeitung der Parameter.</entry>
          </row>

          <row>
            <entry><filename>calcCase.gml</filename></entry>

            <entry>GML-Datei der Modelldaten der Rechenvariante</entry>

            <entry>Kopie der Grunddaten des Modells
            (<filename>/KalypsoSpree/modell.gml</filename>)</entry>
          </row>

          <row>
            <entry><filename>Zeitreihen/*.zml</filename></entry>

            <entry>Eingangszeitreihen der Berechnung</entry>

            <entry>KALYPSO-Zeitreihendienst</entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/*</filename></entry>

            <entry>Ergebnisse einer Berechnung</entry>

            <entry>KALYPSO-Berechnungsdienst</entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/calcCase.gml</filename></entry>

            <entry>Eventuell durch die Berechnung geänderte Modelldaten
            (optimierte Anfangsbodenfeuchten)</entry>

            <entry></entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/spree.log</filename></entry>

            <entry>Log-Datei der Berechnung</entry>

            <entry></entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/.native</filename></entry>

            <entry>Modelldaten im Format des Rechenkerns (*.dbf), zu
            Prüfzwecken hier abgelegt</entry>

            <entry></entry>
          </row>

          <row>
            <entry><filename>Ergebnisse/Zeitreihen</filename></entry>

            <entry>Eigentliche Berechnungsergebnisse in Form von
            Zeitreihen</entry>

            <entry></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Die Benennung der Zeitreihendateien ist jeweils an die Benennung der
    Zeitreihendaten des ursprünglichen Modells angelehnt.</para>

    <section>
      <title>Launches und ANT-Skripte</title>

      <para>Die Modellstruktur wird mit Hilfe der in der Datei
      <filename>/KalypsoSpree/.model/launch/build.xml</filename> enthaltenen
      ANT-Targets erstellt.</para>

      <para>Die ANT-Targets sind entsprechend den in <xref
      linkend="sec-modellintegration-allgemein" /> beschrieben Launches in
      drei Gruppen (Erstellung der Rechenvariante, Aktualisierung der
      Rechenvariante und Aktualisierung der Rechenvariante nach einer
      Berechnung) aufgeteilt und wurden bei der Spree-Modellierung wie folgt
      verwendet:</para>

      <section>
        <title>Erstellen einer Rechenvariante
        (<filename>createCalcCase.launch</filename>)</title>

        <para>Es werden alle (Grund-)Daten der Rechenvariante erstellt
        (kopiert), d.h. alle Daten außer den Zeitreihendaten. Die Datei der
        Steuerparameter <filename>.calculation</filename> (siehe <xref
        linkend="sec_pktCalculation" />) wird mit Standardwerten belegt. Die
        eigentlichen Modelldaten befinden sich in der Datei
        <filename>calcCase.gml</filename> und stellen eine reine Kopie der
        Grunddaten (<filename>/KalypsoSpree/modell.gml</filename>) dar.</para>
      </section>

      <section>
        <title>Aktualisieren einer Rechenvariante
        (<filename>updateCalcCase.launch</filename>)</title>

        <para>Es werden alle Zeitreihendaten der Rechenvariante wie folgt
        zusammengestellt:</para>

        <informaltable>
          <tgroup cols="3">
            <colspec align="left" colwidth="4*" />

            <colspec align="left" colwidth="1*" />

            <colspec align="left" colwidth="6*" />

            <thead>
              <row>
                <entry align="center">Datenart</entry>

                <entry align="center">Datei</entry>

                <entry align="center">Herkunft</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>Gebietsniederschläge</entry>

                <entry>PA_*</entry>

                <entry>Berechnung via Gebietsniederschlagsmodell</entry>
              </row>

              <row>
                <entry>Wasserstände</entry>

                <entry>W_*</entry>

                <entry>PSICompact</entry>
              </row>

              <row>
                <entry>Abfluss (Flutung)</entry>

                <entry>QV_*</entry>

                <entry>KALYPSO-Server, dateibasiert</entry>
              </row>

              <row>
                <entry>Abfluss (Zugabe)</entry>

                <entry>QP_*</entry>

                <entry>KALYPSO-Server, dateibasiert</entry>
              </row>

              <row>
                <entry>Niederschlagsmessungen</entry>

                <entry>P_*</entry>

                <entry>PSICompact</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>

        <para>Zur Zeit sind lediglich die Wasserstände und die gemessenen bzw.
        vorhergesagten Niederschläge über PSICompact abrufbar. Die
        vorgegebenen Abflüsse sind im Modell mit auf dem KALYPSO-Server
        abgelegten Dateien (KALYPSO Datei-Repository im Pfad) verknüpft,
        welche die historischen Daten des Hochwasserereignisses vom April 2004
        enthalten. Wird ein anderer Zeitraum gewählt (Hochwasservorhersage)
        werden die benötigten Zeitreihen mit Nullwerten befüllt, die Daten
        können manuell eingegeben werden.</para>

        <para>Die Zuordnung zwischen Zeitreihen der Rechenvariante und
        Zeitreihen in PSICompact bzw. Zeitreihen in Dateien auf dem Server
        befindet sich in den Zuordnungsdateien (*.gml) im Verzeichnis
        <filename>/KalypsoSpree/.model/observationConf</filename>.</para>
      </section>

      <section>
        <title>Berechnung einer Rechenvariante
        (<filename>runCalculation.launch</filename>)</title>

        <para>Die vom Rechenkern benötigten Daten werden zusammengestellt und
        an den Berechnungsdienst gesandt. Die zurückgebenen Ergebnisse werden
        in die Rechenvariante übernommen, vorher werden ggf. bereits
        bestehende Ergebnisse gelöscht.</para>

        <para>Darüber hinaus werden Modelldaten der Rechenvariante
        (<filename>calcCase.gml</filename>) durch die von der Berechnung
        geänderten Modelldaten (optimierte Bodenfeuchten,
        <filename>Ergebnisse/calcCase.gml</filename>) ersetzt.</para>
      </section>

      <section>
        <title>Berechnung Gebietsniederschlag
        (<filename>gebietsniederschlag.launch</filename>)</title>

        <para>Die Umsetzung des Gebietsniederschlagsmodell findet sich in
        einem speziellen Target namens <quote>gebietsniederschlag</quote> des
        ANT-Skriptes, welches bei der Aktualisierung einer Rechenvarianten
        sowie bei expliziter Neuberechnung des Gebietsniederschlags in der
        ersten Seite des Vorhersageassistenten aufgerufen wird.</para>

        <para>Der Vorhersageteil des Gebietsniederschlags wird anhand der
        DWD-Rastervorhersagen des DWD ermittelt, wie in <xref
        linkend="dwd-vorhersage" /> beschrieben. Die benötigte
        Konfigurationsdatei zur Zuordnung der Rasterzellen zu den
        Modellzeitreihen liegt im Spree-Modell unter
        <filename>/KalypsoSpree/.model/dwd/dwdZmlConf.xml</filename>.</para>

        <para>Die Vergangenheitswerte werden über eine lineare Gewichtung aus
        den gemessenen Ombrometerwerten hergeleitet. Die Gewichtung wurde als
        Relation im GML-Applikationsschema modelliert und hängt als Parameter
        <quote>Gewichtungselement</quote> direkt an den
        Einzugsgebietselementen des Datenmodells
        (<filename>modell.gml</filename>).</para>
      </section>

      <section>
        <title>Ablage der Prognosezeitreihen
        (<filename>exportVorhersagen.launch</filename>)</title>

        <para>Entsprechend der Zuordnungen in den Dateien
        <filename>/KalypsoSpree/.model/observationConf/*Mapping.gml</filename>
        werden Prognosezeitreihen nach PSICompact geschrieben.</para>
      </section>
    </section>

    <section id="sec_pktCalculation">
      <title>Die Datei <filename>.calculation</filename></title>

      <para>Die Steuerdatei <filename>.calculation</filename> wird durch das
      Schema <filename>/KalypsoSpree/.model/schema/control.xsd</filename>
      spezifiziert und enthält neben dem Simulationszeitraum (Start der
      Simulation, Start der Vorhersage, Ende der Simulation) noch weitere
      Metadaten, um eine Rechenvariante ausführlich beschreiben zu können.
      Diese sind:</para>

      <itemizedlist>
        <listitem>
          <para>der Ersteller der Rechenvariante (Default-Wert ist der
          Login-Name)</para>
        </listitem>

        <listitem>
          <para>das Erstellungsdatum der Rechenvariante (Default-Wert ist die
          Systemzeit bei Anlegen der Rechenvariante)</para>
        </listitem>

        <listitem>
          <para>eine Kurzbeschreibung der Rechenvariante</para>
        </listitem>

        <listitem>
          <para>eine Langbeschreibung der Rechenvariante</para>
        </listitem>
      </itemizedlist>

      <para>Um eine ansprechende Darstellung der Steuerparameter und Metadaten
      im Dialog <guilabel>Rechenvariante Neu</guilabel> sowie im
      Vorhersage-Assistenten zu erhalten, wurde eine Ansichtvorlage für die
      Steuerdatei unter
      <filename>/KalypsoSpree/.model/.calculation.view</filename> abgelegt.
      Sie hat den gleichen Aufbau wie die Vorlagendatei
      <filename>Steuerparameter.gft</filename> im Verzeichnis der
      Rechenvariante.</para>

      <tip>
        <para>Zum Erstellen der Kopiervorlagen für die Ansichten der
        Rechenvariante (<abbrev>z. B.</abbrev> <filename>Steuerparameter.gft</filename> oder
        <filename>Bodenfeuchten.gtt</filename>) wurde im Verzeichnis
        <filename>/KalypsoSpree/.templates/calcCase/</filename> die Daten
        einer konkreten Rechenvariante abgelegt. Dadurch konnten die Vorlagen
        mit relativem Pfad auf diese Daten komfortabel erstellt werden und
        können ohne Anpassung in jede neue Rechenvariante kopiert
        werden.</para>
      </tip>
    </section>
  </section>

  <section>
    <title>Modell-Plugin</title>

    <para>Der Anstoss der serverseitigen Berechnung wird wie oben beschrieben
    über ein ANT-Skript (<filename>runCalculation.launch</filename>)
    bewerkstelligt. Im Fall des Spree-Modells werden alle Dateien der
    Rechenvariante bis auf die Vorlagen übertragen.</para>

    <para>Zur Berechnung wird der KALYPSO-Berechnungsdienst mit der Typ-ID des
    Spree-Modells (hier <quote>spree</quote>) angestoßen. Der Dienst aktiviert
    anhand der ID die entsprechende Implementierung des Interface
    <interfacename>org.Kalypso.services.calculation.job.ICalcJob</interfacename>,
    im Falle des Spree-Modells die Klasse
    <interfacename>org.kalypso.lhwzsachsen.spree.SpreeCalcJob</interfacename>
    im Projekt <filename>KalypsoModelSpree</filename> der Programmquellen. Wie
    oben bereits beschrieben wurde, sind alle Spree-spezifischen
    Programmierungen und die für das Anstoßen des Rechenkerns benötigten Daten
    in diesem Projekt zusammengefasst.</para>

    <para>Der implementierte Spree-Berechnungsdienst geht für jede Berechnung
    wie folgt vor:</para>

    <itemizedlist>
      <listitem>
        <para>Es wird ein temporäres Verzeichnis <quote>native</quote>
        angelegt.</para>
      </listitem>

      <listitem>
        <para>Es werden das ausführbare Programm nebst Programmbibliotheken
        sowie alle gleichbleibenden Parameterdaten in das temporäre
        Verzeichnis kopiert. Diese Daten finden sich gesammelt im Paket
        <filename>/KalypsoModelSpree/src/org/Kalypso/lhwzsachsen/spree/resources/exe</filename>.</para>
      </listitem>

      <listitem>
        <para>Die vom Client übergebenen Daten der Rechenvariante werden in
        die Formate des Rechenkerns konvertiert und im temporären Verzeichnis
        abgelegt.</para>
      </listitem>

      <listitem>
        <para>Die ausführbare Datei (<filename>spree.exe</filename>) wird
        gestartet.</para>
      </listitem>

      <listitem>
        <para>Die Ergebnisdaten der Berechnung, welche sich jetzt ebenfalls im
        temporären Verzeichnis befinden, werden in die vom Client benötigten
        Formate übertragen und können jetzt vom Client abgerufen
        werden.</para>
      </listitem>
    </itemizedlist>

    <para>Neben den konvertierten Daten (Zeitreihendaten, veränderte
    Modelldaten - Auflistung siehe oben) werden auch die nativen, vom
    Rechenkern verarbeiteten Daten zurück zum Client übertragen, was eine
    eventuelle Fehlersuche erleichtert. Insbesondere können diese direkt von
    der ursprünglichen Version des Rechenprogramms (mit Oberfläche)
    clientseitig verarbeitet und kontrolliert werden.</para>
  </section>

  <section>
    <title>Konfiguration des Vorhersage-Assistenten</title>

    <para>Die Konfiguration des Vorhersage-Assistenten des Spree-Modells
    befindet sich wie in <xref linkend="sec_konfigAssi" /> gefordert in der
    Datei <filename>/KalypsoSpree/.model/calcWizard.xml</filename>. Der Ablauf
    des Assistenten ist im Benutzerhandbuch zum Spree-Modell beschrieben und
    in der Konfigurationsdatei kommentiert.</para>

    <para>Die Konfigurationsdatei <filename>calcWizard.xml</filename> verweist
    ihrerseits auf eine Reihe von Ansichtsvorlagen zur Darstellung der
    Modelldaten innerhalb des Assistenten. Diese sind sämtlich im Verzeichnis
    <filename>/KalypsoSpree/.templates/calcCase</filename> abgelegt.</para>
  </section>
</section>