<?xml version="1.0" encoding="UTF-8"?>
<section id="robotron-ims" vendor="sachsen-anhalt">
  <title>Schnittstelle zum IMS: Dokumentenablage</title>

  <indexterm>
    <primary>Schnittstellen</primary>

    <secondary>IMS</secondary>
  </indexterm>

  <indexterm>
    <primary>Schnittstellen</primary>

    <secondary>Dokumentenablage</secondary>
  </indexterm>

  <para>Aus dem KALYPSO-Vorhersageassistenten heraus können Pegel- und
  Speichervorhersagen, Datenübersichten (<abbrev>z. B.</abbrev>
  Gebietsniederschlag), Längsschnitte und Scheitelwerte in Form von Tabellen
  (Textdateien mit Trennzeichen, <abbrev>z. B.</abbrev> im CSV-Format) und
  Diagramme (Abbildung in Form eines Bildes <abbrev>z. B.</abbrev> im
  PNG-Format) exportiert werden. Diese Dokumente werden strukturiert im IMS
  abgelegt (siehe Abbildungen <xref linkend="abb_ims_dok_bode" />, <xref
  linkend="abb_ims_dok_ilse" /> und <xref
  linkend="abb_ims_dok_saale" />).</para>

  <para><figure id="abb_ims_dok_bode">
      <title>Struktur der Dokumentenablage für die Bode</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/sst/sachsen-anhalt/ims_dok_bode.png"
                     format="PNG" scale="75" />
        </imageobject>
      </mediaobject>
    </figure> <figure id="abb_ims_dok_ilse">
      <title>Struktur der Dokumentenablage für die Ilse</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/sst/sachsen-anhalt/ims_dok_ilse.png"
                     format="PNG" scale="75" />
        </imageobject>
      </mediaobject>
    </figure> <figure id="abb_ims_dok_saale">
      <title>Struktur der Dokumentenablage für die Saale</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/sst/sachsen-anhalt/ims_dok_saale.png"
                     format="PNG" scale="75" />
        </imageobject>
      </mediaobject>
    </figure></para>

  <para>Die Schnittstelle basiert auf einem Webdienst-Methodenaufruf. Dazu
  wird Apache-Axis benutzt, im Gegensatz zu der in KALYPSO sonst üblichen und
  von Sun implementierten JAX-RPC Bibliothek.</para>

  <para>Dokumente werden durch eine XML-Metadata-Datei ergänzt und über das
  Ablageverzeichnis an das IMS weitergereicht. Der Aufbau dieser XML-Datei ist
  recht einfach. Hier folgt ein Beispiel:</para>

  <para><figure>
      <title>Beispiel Metadatendatei</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/sst/sachsen-anhalt/ims_dok_ablage.png"
                     scale="60" />
        </imageobject>
      </mediaobject>
    </figure> Die Bedeutung der Elemente wird in der folgenden Liste
  dargestellt: <glosslist>
      <glossentry>
        <glossterm>autor</glossterm>

        <glossdef>
          <para>Der Name des Autors der aktuellen Vorhersage. Der Name ist
          standardmäßig der Name des Benutzers, der sich am System angemeldet
          hat. Der Benutzer kann den Wert dieser Eigenschaft im
          Export-Assistenten ändern, bevor das Dokument exportiert
          wird.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>ersteller</glossterm>

        <glossdef>
          <para>Der Name der Institution, die für die Ausgabe der Dokumente
          zuständig ist. Standarmäßig ist es die <emphasis>HVZ</emphasis>. Der
          Benutzer kann den Wert dieser Eigenschaft im Export-Assistenten
          ändern, bevor das Dokument exportiert wird.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>erstelldat</glossterm>

        <glossdef>
          <para>Das Datum, an dem das Dokument erstellt wurde. Als
          Standardwert wird das aktuelle Datum gesetzt. Der Benutzer kann den
          Wert dieser Eigenschaft im Export-Assistenten ändern, bevor das
          Dokument exportiert wird.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>gueltigdat</glossterm>

        <glossdef>
          <para>Das Datum, bis zu dem das Dokument gültig ist. Als
          Standardwert wird das aktuelle Datum gesetzt. Der Benutzer kann den
          Wert dieser Eigenschaft im Export-Assistenten ändern, bevor das
          Dokument exportiert wird.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>doktyp</glossterm>

        <glossdef>
          <para>Der übergeordnete Typ des Dokuments, hier immer
          <emphasis>Vorhersage</emphasis>. Der Wert ist immer gleich und wird
          in der Konfigurationsdatei des Dokumentendienstes gesetzt. Diese
          Eigenschaft dient der Identizierung der Quelle des Dokuments.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>dokument</glossterm>

        <glossdef>
          <para>Der Name der aktuellen Vorhersage, wie er vom Benutzer beim
          Erstellen der Rechenvariante im Vorhersage-Assistenten eingegeben
          wurde. Diese Eigenschaft dient der Strukturierung im IMS.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>schluessel</glossterm>

        <glossdef>
          <para>Ein eindeutiger Schlüssel, welcher das Dokument identifiziert.
          Diese Eigenschaft dient dem Überschreiben im IMS gleicher Dokumente
          einer gleichen Vorhersage.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>typ</glossterm>

        <glossdef>
          <para>Die Information, worum es sich im Dokument handelt: bezieht
          sich das Dokument auf einen Speicher? einen Pegel? usw. Der Wert
          wird automatisch von KALYPSO gesetzt (entsprechend den Einstellungen
          in den <filename>calcWizard.xml</filename>-Dateien).</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>klasse</glossterm>

        <glossdef>
          <para>Die Klasse des Dokuments für die aktuelle Vorhersage. Der Wert
          wird automatisch von KALYPSO gesetzt (entsprechend den Einstellungen
          in den <filename>calcWizard.xml</filename>-Dateien). Diese
          Eigenschaft dient der Klassifizierung im IMS.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>description</glossterm>

        <glossdef>
          <para>Eine vom Benutzer angegebene Beschreibung. Standardmäßig wird
          die Beschreibung der Vorhersage übernommen, der Wert kann aber vom
          Benutzer im Vorhersage-Assistenten geändert werden.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>simulation</glossterm>

        <glossdef>
          <para>Die Information, ob es sich um eine simulierte Vorhersage
          handelt (Unterscheidung zwischen Regelbetrieb und
          Simulationsbetrieb).</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>gebiet</glossterm>

        <glossdef>
          <para>Der Name des Einzugsgebiets (Bode, Ilse, Saale usw.).</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>station_id</glossterm>

        <glossdef>
          <para>Die Stationskennziffer, wenn es sich um ein Dokument handelt,
          das nur einen Pegel oder Speicher betrifft. Wenn das Dokument eine
          Übersicht darstellt, ist diese Eigenschaft leer.</para>
        </glossdef>
      </glossentry>

      <glossentry>
        <glossterm>files bzw. file</glossterm>

        <glossdef>
          <para>Das Element <emphasis>files</emphasis> beinhaltet immer nur
          ein Element <emphasis>file</emphasis>, welches wiederum den
          Dateinamen des Dokuments beinhaltet.</para>
        </glossdef>
      </glossentry>
    </glosslist></para>

  <para>Der Metadokument-Webdienst wird anhand einer Konfigurationsdatei an
  die eigenen Bedürfnisse angepasst. Die Datei befindet sich im
  Konfigurationsverzeichnis des Dienstes. Der Standort ist:
  <filename>TOMCAT_HOME/webapps/webdav/srvconf/IMetaDocService</filename>.
  Hier folgt ein Beispiel:</para>

  <para><programlisting># classname of the document commiter
COMMITER=org.kalypso.robotronadapter.RobotronMetaDocCommiter

# Robotron Dokumentenablage
robotron.ws.endpoint=http://11.9.44.25:8080/IMS/KalypsoConnectorWS.jws

robotron.preset.autor=autor
robotron.preset.doktyp=Vorhersage
robotron.preset.ersteller=HVZ
robotron.preset.description=calcCaseDescription

robotron.md.scenario=currentScenarioId

# Depending on the scenario, the simulation-tag is either 0
# or 1. We list both possibilities here and the right
# one will be picked by RobotronMetaDocCommiter.
# Format of the key: Xml-Elementname_Scenario-Id
robotron.md.simulation_=0
robotron.md.simulation_test=1

# used for the metadataExtensions
robotron.md.station_id=Kennziffer
robotron.md.gebiet=projectName
robotron.md.dokument=calcCaseName</programlisting></para>
</section>