<?xml version="1.0" encoding="UTF-8"?>
<chapter id="extras">
  <title>Zusätzliche Information</title>

  <indexterm>
    <primary>Zusatzinformation</primary>
  </indexterm>

  <para>Hier werden spezielle Aspekte von KALYPSO beschrieben.</para>

  <section id="dwd-vorhersage">
    <title>Integration der DWD-Vorhersage</title>

    <indexterm>
      <primary>Zusatzinformation</primary>

      <secondary>DWD-Vorhersage</secondary>
    </indexterm>

    <para>Für die Hochwasservorhersage wird eine Niederschlagsvorhersage
    benötigt. Die hier verwendete Vorhersage des DWD wird in einer Datei
    (DWD-lm2-Format) geliefert. Es handelt sich um eine Datei mit mehreren
    Rastern, die eine Vorhersage über 48 Stunden beinhaltet.</para>

    <para>Folgende Raster werden zur Zeit geliefert: <orderedlist>
        <listitem>
          <para>Liste von Breitenkoordinate der Rasterzellen</para>
        </listitem>

        <listitem>
          <para>Liste von Längenkoordinate der Rasterzellen</para>
        </listitem>

        <listitem>
          <para>Liste von Höhenwerten der Rasterzellen</para>
        </listitem>

        <listitem>
          <para>Flüssiger Niederschlag stündlich (1 Liste je Stunde, &gt; 48
          Listen)</para>
        </listitem>

        <listitem>
          <para>Wasseräquivalent fester Niederschlag stündlich (1 Liste je
          Stunde, &gt; 48 Listen)</para>
        </listitem>
      </orderedlist></para>

    <para>Eine genaue Formatbeschreibung des DWD-lm2-Formats ist beim DWD
    erhältich.</para>

    <para>Die Implementierung zur Integration der Vorhersage ist im
    Quellcodeprojekt KalypsoDWD enthalten.</para>

    <section>
      <title>Allgemeiner Ablauf</title>

      <para>Der Ablauf allgemein:</para>

      <orderedlist>
        <listitem>
          <para>Die Vorhersagedateien werden nach Dateneingang vom DWD in
          einem Verzeichnis abgelegt.</para>
        </listitem>

        <listitem>
          <para>Die aktuellste Vorhersage wird durch der Serverdienst
          KalypsoDWDFileCopyServlet erkannt und im Verzeichnis
          <filename>webdav/dwd</filename> abgelegt.</para>
        </listitem>

        <listitem>
          <para>Von dort aus können die KALYPSO-Clients darauf zugreifen und
          bei Bedarf Gebietsniederschlagszeitreihen umrechnen.</para>
        </listitem>

        <listitem>
          <para>Die umgerechneten Gebietsniederschläge werden direkt im
          Vorhersagewizard angezeigt. Veraltete Vorhersagen werden stets
          überschrieben.</para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>Konfiguration</title>

      <para>Der Dienst wird über die für Servlets standardmäßig vorhandene
      <filename>web.xml</filename>-Datei konfiguriert. Folgendes Listing
      beinhaltet ein Beispiel mit entsprechenden Beschreibungen (siehe <xref
      linkend="abb_dwd_konfig" />).</para>

      <figure id="abb_dwd_konfig">
        <title>Darstellung</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="img/dwd/konfiguration.png" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Die Konfiguration umfasst folgende Informationen:</para>

      <orderedlist>
        <listitem>
          <para>Anzahl der Verzeichnisse, die für aktuelle DWD-Vorhersagen
          geprüft werden müssen (instances). Die Eingaben für alle anderen
          Parameter sind davon abhängig: sobald die Anzahl größer als eins
          ist, müssen mit Semikolon getrennte Angaben für die anderen
          Parameter gemacht werden.</para>
        </listitem>

        <listitem>
          <para>Dauer der Zeitperiode zwischen zwei Prüfzyklen
          (period).</para>
        </listitem>

        <listitem>
          <para>Verzeichnis, aus dem die aktuelle DWD-Vorhersage abgeholt wird
          (source).</para>
        </listitem>

        <listitem>
          <para>Dateiprefix der zu suchenden DWD-Vorhersage
          (source_prefix).</para>
        </listitem>

        <listitem>
          <para>Dateinamensformat der zu suchenden DWD-Vorhersage, damit das
          Datum daraus gefiltert werden kann. Das Datum wird ausgewertet, um
          die aktuelle Vorhersage anhand dieses Datums zu erschliessen
          (source_format).</para>
        </listitem>

        <listitem>
          <para>Ob die eingelesene DWD-Vorhersage, nachdem die Bearbeitung
          fertig ist, aus dem Quellverzeichnis (source) gelöscht werden muss
          (source_delete).</para>
        </listitem>

        <listitem>
          <para>Zieldateiname inkl. Pfad der zu erstellenden DWD-Vorhersage.
          Nach jedem Zyklus wird diese Datei durch die aktuelle Vorhersage
          ersetzt (dest).</para>
        </listitem>

        <listitem>
          <para>Gibt an, ob die Zieldatei überarbeitet werden muss, damit die
          Daten konsistent bleiben. Im Normalfall ist dies nicht erforderlich,
          da die Daten übereinstimmen. Aber im Katastrophentestszenario werden
          <abbrev>z. B.</abbrev> DWD-Vorhersagen der Vergangenheit als
          aktuelle Vorhersagen geliefert, dabei stimmt das Datum aus dem
          Dateinamen nicht mit dem Inhalt der Vorhersage überein: in der Datei
          sind noch die alten Daten zu sehen. Wenn dieser Parameter aktiviert
          wird (true), wird also die Datei überarbeitet und die darin
          enthaltenen Daten mit dem aktuellen Datum überschrieben
          (dest_update).</para>
        </listitem>
      </orderedlist>

      <para>Bei der Konfiguration des Tomcat-Servers (Datei
      <filename>conf/catalina.policy</filename>) ist darauf zu achten, dass
      der Dienst Schreib- und Leserechte für die verwendeten Verzeichnisse und
      Dateien benötigt.</para>
    </section>
  </section>

  <section id="url-erweiterung">
    <title>URL-Erweiterung</title>

    <indexterm>
      <primary>Zusatzinformation</primary>

      <secondary>URL-Erweiterung</secondary>
    </indexterm>

    <para>KALYPSO nutzt URLs, um Resourcen (Dokumente oder Dateien) zu
    referenzieren.</para>

    <para>Die Standardprotokolle sind:</para>

    <itemizedlist>
      <listitem>
        <para>file: absolute oder relative Pfadangabe im lokalen
        Filesystem</para>
      </listitem>

      <listitem>
        <para>http: HTTP-Adresse</para>
      </listitem>
    </itemizedlist>

    <para>Zusätzlich definiert KALYPSO die folgenden Protokolle:</para>

    <itemizedlist>
      <listitem>
        <para>project: der Pfad ist relativ zum Eclipse-Projekt</para>
      </listitem>

      <listitem>
        <para>workspace: der Pfad ist relativ zum Eclipse-Workspace</para>
      </listitem>

      <listitem>
        <para>Kalypso-ocs: der Pfad ist relativ zum
        KALYPSO-Zeitreihendienst</para>
      </listitem>

      <listitem>
        <para>calccase: der Pfad ist relativ zu einer Rechenvariante</para>
      </listitem>
    </itemizedlist>

    <para>Bei <emphasis>project</emphasis>, <emphasis>calccase</emphasis> und
    <emphasis>workspace</emphasis> ist der Pfad immer relativ, und zwar zum
    jeweils angegebenen Element: also Project, Workspace oder
    Rechenvariante.</para>

    <para>Bei <emphasis>file</emphasis> kann der Pfad relativ sein. In diesem
    Fall ist der Pfad (wie in RFC 2396) relativ zu einem Kontext, der von
    einer Basis-URL definiert wird. In KALYPSO ist diese Basis-URL des öfteren
    identisch mit der URL des besitzenden Dokumentes. Beispiel: ein
    ZML-Dokument hat einen Link auf externe Werte, welcher über eine relative
    URL definiert ist. Die Basis-URL ist in diesem Fall die URL des
    ZML-Dokuments.</para>
  </section>
</chapter>