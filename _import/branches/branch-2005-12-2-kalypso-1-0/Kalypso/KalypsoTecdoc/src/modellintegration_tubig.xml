<?xml version="1.0" encoding="UTF-8"?>
<section id="modell-tubig" vendor="sachsen-anhalt">
  <title>Modellintegration Bode/Ilse (Tubig)</title>

  <indexterm>
    <primary>Modellintegration</primary>

    <secondary>Bode/Ilse (Tubig)</secondary>
  </indexterm>

  <para>Die Hochwasservorhersagemodelle für die Einzugsgebiete von Bode bzw.
  Ilse beruhen auf dem Programm WinPRO der Thiele + Büttner
  Ingenieurgemeinschaft GbR (TUBIG). Für das Einzugsgebiet der Bode handelt es
  sich um ein kombiniertes Niederschlag-Abfluss-Modell und Wellenablaufmodell
  einschließlich Talsperrenberechnung bzw. -steuerung und für das Einzugsgbiet
  der Ilse um ein Niederschlag-Abfluss-Modell. Aufgrund der großen
  softwaretechnischen Übereinstimmung zwischen den Modellen, wird die
  Modellintegration für Bode und Ilse gemeinsam beschrieben. Auf Abweichungen
  voneinander wird jeweils gesondert eingegangen.</para>

  <para>Zur Integration der Modelle in KALYPSO-Enterprise wurde das bestehende
  Programm durch die Firma Thiele + Büttner IG so angepasst, dass ein
  oberflächenloser Betrieb des Rechenkerns möglich ist. Desweiteren wurde ein
  Fehler korrigiert und der Programmteil zur Talsperrensteuerung als
  32-Bit-Programm für Windows neu programmiert. Dadurch haben sich im
  Projektverlauf folgende neue oder geänderte EXE- bzw. BAT-Dateien für den
  Rechenkern ergeben:<variablelist>
      <varlistentry>
        <term>oberflächenloser Betrieb</term>

        <listitem>
          <para>m_abschl.exe, M_add.exe, M_COPY.EXE, M_Delete.exe,
          m_fehler.exe, M_Min.exe, M_mult.exe, M_pro.exe, m_spei2001.exe,
          M_SUM.EXE, M_trans.exe, M_wlm.exe, M_zg.exe, M_zgpar.exe</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Fehlerkorrektur</term>

        <listitem>
          <para>run3.bat</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>32-Bit-Programm zur Talsperrensteuerung</term>

        <listitem>
          <para>M_BODESTEU.EXE, run4.bat, run5.bat, wobei M_VorSt.exe
          entfällt.</para>
        </listitem>
      </varlistentry>
    </variablelist></para>

  <para>Dieser aktualisierte Rechenkern ist serverseitig als Modell-Plugin in
  KALYPSO integriert. Zur clientseitigen Integration wurde eine GML-basierte
  Modellspezifikation erstellt.</para>

  <para>Die zur Integration der Modelle nötige Programmierung ist innerhalb
  der Programmquellen vollständig im Projekt
  <filename>KalypsoModelTubig</filename> zusammengefasst. Neben der
  Implementierung des Rechendienstes befinden sich dort alle für die
  Berechnung benötigten weiteren Ressourcen (ausführbare Dateien m_*.exe,
  unveränderbare Parameterdateien, usw.).</para>

  <para>Alle Daten zur clientseitigen Modellierung, also Modellspezifikation,
  Modelldaten usw., befinden sich im Datenprojekt
  <filename>KalypsoBode</filename> bzw. <filename>KalypsoIlse</filename> der
  Programmquellen. Diese Projekte dienen jeweils als Modellprojekt unter dem
  Namen <quote>Bode</quote> bzw. <quote>Ilse</quote> als Vorhersagemodell der
  eigentlichen Installation.</para>

  <section id="sec_modelSpecTubig">
    <title>Modellspezifikation und Grunddaten</title>

    <indexterm>
      <primary>Modellspezifikation und Grunddaten</primary>

      <secondary>Bode/Ilse (Tubig)</secondary>
    </indexterm>

    <para>Die Verzeichnisstruktur der Modellprojekte
    <filename>KalypsoBode</filename> und <filename>KalypsoIlse</filename> ist
    gemäß <xref linkend="abschn_5_1" /> aufgebaut. Da zur
    Niederschlagsprognose keine DWD-Rasterdaten herangezogen werden, entfällt
    allerdings das Verzeichnis <filename>/.model/dwd</filename>.</para>

    <para>Die GML-Applikationsschemata wurden wie empfohlen in den
    Programmquellen des Modell-Plugins im Paket
    <filename>org/kalypso/lhwsachsenanhalt/tubig/schemata</filename>
    abgelegt.</para>

    <para>Das Grundmodell wurde unter dem Namen
    <filename>modell.gml</filename> im Hauptverzeichnis des jeweiligen
    Modellprojektes gespeichert. Durch Doppelklick auf die GML-Datei kann man
    sich einen Überblick über die Struktur der Modelldaten in Form einer
    Baumansicht verschaffen. Nach dem Öffnen der Ansicht erscheint eine
    (Baum-) Strukturansicht des Modells, welche unter anderem auch das
    Bearbeiten der einzelnen Modellelemente erlaubt (siehe <xref
    linkend="fig_modellintegration_bode_ueberblick" />).</para>

    <figure id="fig_modellintegration_bode_ueberblick">
      <title>Überblick Modelldaten Bode</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/modellintegration/sachsen-anhalt/modellbaum_bode.png"
                     scale="70" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Wie aus der Baumansicht hervorgeht, besteht das Bode-Modell aus drei
    Listen (Collections), welche unterhalb des Wurzelelements (root)
    angeordnet sind:</para>

    <itemizedlist>
      <listitem>
        <para>Die Liste der Pegel (PegelCollectionAssociation) enthält die im
        Modell abgebildeten Pegel und deren Parameter. Innerhalb der Pegel
        wird zwischen Wasserlaufmodellen, Niederschlagsgebieten und einfachen
        Pegeln unterschieden.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Ombrometer (OmbrometerCollectionAssociation)
        enthält die Niederschlagsmessstationen des
        Gebietsniederschlagsmodells.</para>
      </listitem>

      <listitem>
        <para>Die Liste der Speicher (SpeicherCollectionAssociation) enthält
        die im Modell abgebildeten Speicherbauwerke und deren
        Parameter.</para>
      </listitem>
    </itemizedlist>

    <para>Beim Ilse-Modell enthält die Liste der Pegel nur
    Niederschlagsgebiete und die Liste der Speicher ist leer.</para>

    <para>Im Folgenden werden die einzelnen Modellparameter und Spalten der
    Modelltabellen erläutert. Die Eingabe der Parameter erfolgt entweder über
    die entsprechenden Ansichten im KALYPSO-Modeler (Expertenmodus) oder im
    Vorhersage-Assistenten.</para>

    <para>Wasserlaufmodelle und Niederschlagsgebiete sind Erweiterungen zu den
    einfachen Pegeln. D. h. alle Parameter der einfachen Pegel (siehe <xref
    linkend="tbl_paramsPegelTubig" />) sind auch Parameter von
    Wasserlaufmodellen und Niederschlagsgebieten.</para>

    <table id="tbl_paramsPegelTubig">
      <title>Parameter der einfachen Pegel (Pegel) für Bode und Ilse</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Pegels</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage des Pegels</entry>
          </row>

          <row>
            <entry>Messstellennummer</entry>

            <entry>Text</entry>

            <entry>Messstellennummer</entry>
          </row>

          <row>
            <entry>Kurz_Name</entry>

            <entry>Text</entry>

            <entry>Kurz-Name des Pegels für den Rechenkern</entry>
          </row>

          <row>
            <entry>istEingabePegel</entry>

            <entry>Ja / Nein</entry>

            <entry>Gehen die gemessenen Wasserstandswerte als Eingangswerte in
            das Modell ein?</entry>
          </row>

          <row>
            <entry>istErgebnisPegel</entry>

            <entry>Ja / Nein</entry>

            <entry>Sind die berechneten Wasserstandswerte Ergebnisse des
            Modells für die Berichts- und Zeitreihenablage?</entry>
          </row>

          <row>
            <entry>Ganglinie_gemessen</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit gemessener Wasserstandsganglinie</entry>
          </row>

          <row>
            <entry>Ganglinie_gerechnet</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit berechneter Wasserstandsganglinie</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Aus den zusätzlichen Parametern für die Wasserlaufmodelle (siehe
    <xref linkend="tbl_paramsWLMTubig" />) wird beim Anstossen des Rechenkerns
    für den entsprechenden Pegel die Parameterdatei für das Wasserlaufmodell
    (<filename>wlm_&lt;Kurz_Name&gt;.par</filename>) generiert.</para>

    <table id="tbl_paramsWLMTubig">
      <title>zusätzliche Parameter der Wasserlaufmodelle (WasserlaufModell)
      für Bode und Ilse</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Kommentar</entry>

            <entry>Text</entry>

            <entry>Kommentar für die Parameterdatei
            (<filename>wlm_&lt;Kurz_Name&gt;.par</filename>) des
            Wasserlaufmodells</entry>
          </row>

          <row>
            <entry>Parameter Aufteilungsfunktion Flussbett/Vorland
            (XAW)</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Parameter Aufteilungsfunktion Flussbett/Vorland
            (XEW)</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Rückgangskoeffizient Flussbettbereich in h (FK1)</entry>

            <entry>[h]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Rückgangskoeffizient Ausuferungsbereich in h (FK2)</entry>

            <entry>[h]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Anzahl Linearspeicher Flussbereich (NN1)</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Anzahl Linearspeicher Ausuferungsbereich (NN2)</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Laufzeit</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Standard Laufzeit</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Parameter Funktion Anzahl Linearspeicher Flussbett
            (DM1)</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>

          <row>
            <entry>Parameter Funktion Anzahl Linearspeicher Vorland
            (DM2)</entry>

            <entry>[-]</entry>

            <entry>-</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Die zusätzlichen Parameter für die Niederschlagsgebiete (siehe <xref
    linkend="tbl_paramsNSGTubig" />) werden für die Berechnung des
    Gebietsniederschlagsmodells benötigt.</para>

    <table id="tbl_paramsNSGTubig">
      <title>zusätzliche Parameter der Niederschlagsgebiete
      (Niederschlagsgebiet) für Bode und Ilse</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Gebiet</entry>

            <entry>Polygon</entry>

            <entry>Grenze des Einzugsgebiets (wird zur Zeit nicht
            verwendet)</entry>
          </row>

          <row>
            <entry>Niederschlag</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit der Niederschlagsganglinie</entry>
          </row>

          <row>
            <entry>gewichtung</entry>

            <entry>-</entry>

            <entry>Liste von Gewichtungselementen zur Zuordnung der
            Niederschlagsstationen für das Gebietsniederschlagsmodell</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Die für das Gebietsniederschlagsmodell benötigten
    Niederschlagstationen werden über die Parameter in <xref
    linkend="tbl_paramsOmbroTubig" /> beschrieben.</para>

    <table id="tbl_paramsOmbroTubig">
      <title>Parameter der Niederschlagsstationen (Ombrometer) für Bode und
      Ilse</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name der Niederschlagsstation</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage der Niederschlagsstation</entry>
          </row>

          <row>
            <entry>Messstellennummer</entry>

            <entry>Text</entry>

            <entry>Nummer der Niederschlagsstation</entry>
          </row>

          <row>
            <entry>Kurz_Name</entry>

            <entry>Text</entry>

            <entry>Kurz-Name der Niederschlagsstation</entry>
          </row>

          <row>
            <entry>Niederschlag_gemessen</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit gemessener Niederschlagsganglinie</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Ähnlich wie bei den Pegeln, gibt es auch bei den Speicherbauwerken
    grundlegende und zusätzliche Parameter. Modellbedingt umfassen die
    Parameter zur Talsperre Königshütte (früher: Überleitungssperre Rappbode)
    nur einfachste Informationen (siehe <xref
    linkend="tbl_paramsUeberleitungTubig" />). Die zusätzlichen Parameter der
    restlichen Speicherbauwerke sind in <xref
    linkend="tbl_paramsSpeicherTubig" /> aufgeführt. Aus den zusätzlichen
    Parametern werden <abbrev>u. a.</abbrev> Parameterdateien zu den
    Speicherrechnungen generiert (*.lea, *.qma, *.qmi, *.sra, *.twa).</para>

    <table id="tbl_paramsUeberleitungTubig">
      <title>grundlegende Parameter der Speicherbauwerke (Überleitung) für
      Bode und Ilse</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Name</entry>

            <entry>Text</entry>

            <entry>Name des Speicherbauwerks</entry>
          </row>

          <row>
            <entry>Ort</entry>

            <entry>Punkt</entry>

            <entry>Lage des Speicherbauwerks</entry>
          </row>

          <row>
            <entry>Messstellennummer</entry>

            <entry>Text</entry>

            <entry>Messstellennummer</entry>
          </row>

          <row>
            <entry>Kurz_Name</entry>

            <entry>Text</entry>

            <entry>Kurz-Name des Speicherbauwerks für den Rechenkern</entry>
          </row>

          <row>
            <entry>Abgabe</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit (Speicher-) Abgabeganglinie</entry>
          </row>

          <row>
            <entry>Zufluss_gerechnet</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit berechneter Zuflussganglinie</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <table id="tbl_paramsSpeicherTubig">
      <title>zusätzliche Parameter der Speicherbauwerke (Speicher) für Bode
      und Ilse</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="7*" />

        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="7*" />

        <thead>
          <row>
            <entry align="center">Parameter</entry>

            <entry align="center">Einheit</entry>

            <entry align="center">Bedeutung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Ganglinie_gemessen</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit gemessener Volumenganglinie</entry>
          </row>

          <row>
            <entry>Ganglinie_gerechnet</entry>

            <entry>Zeitreihenlink</entry>

            <entry>Verknüpfung mit berechneter Volumenganglinie</entry>
          </row>

          <row>
            <entry>StauraumParameter</entry>

            <entry>[hm<superscript>3</superscript>]</entry>

            <entry>Stauraumaufteilung nach DIN 4048 (Totraum, Reserveraum,
            Betriebsraum nach Monaten und Stauraum)</entry>
          </row>

          <row>
            <entry>MindestabgabeParameter</entry>

            <entry>[m<superscript>3</superscript>/s]</entry>

            <entry>Mindestabgabe nach Monaten</entry>
          </row>

          <row>
            <entry>MaximalabgabeParameter</entry>

            <entry>[m<superscript>3</superscript>/s]</entry>

            <entry>Maximalabgabe nach Monaten</entry>
          </row>

          <row>
            <entry>TrinkwasserParameter</entry>

            <entry>[m<superscript>3</superscript>/s]</entry>

            <entry>Trinkwasserabgabe nach Monaten</entry>
          </row>

          <row>
            <entry>EACollectionAssociation</entry>

            <entry>-</entry>

            <entry>Tabelle zur Beschreibung der Stauinhaltslinie und
            charakteristischer Größen der Entlastungsanlagen (Höhe [müNN],
            Inhalt [hm<superscript>3</superscript>], Grundablass
            [m<superscript>3</superscript>/s], Überlauf
            [m<superscript>3</superscript>/s], Bemerkung)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>

  <section>
    <title>Spezifikation der Rechenvarianten</title>

    <indexterm>
      <primary>Spezifikation der Rechenvarianten</primary>

      <secondary>Bode/Ilse (Tubig)</secondary>
    </indexterm>

    <para>Die Rechenvarianten wurden gemäß <xref
    linkend="sec-modellintegration-allgemein" /> angelegt und konfiguriert.
    <xref linkend="tab-modellintegration-tubig-rechenvariante" /> zeigt den
    konkreten Aufbau für Bode und Ilse. Zur besseren Lesbarkeit wird in der
    Tabelle eine allgemeine Schreibweise für die Verzeichnisse
    <filename>/KalysoBode</filename> bzw. <filename>/KalypsoIlse</filename>
    gewählt: <filename>/KalypsoTubig</filename>.</para>

    <table id="tab-modellintegration-tubig-rechenvariante">
      <title>Aufbau einer Rechenvariante des Bode- bzw. Ilse-Modells</title>

      <tgroup cols="3">
        <colspec align="left" colwidth="3*" />

        <colspec align="left" colwidth="4*" />

        <colspec align="left" colwidth="5*" />

        <thead>
          <row>
            <entry align="center">Pfade relativ zur Rechenvariante</entry>

            <entry align="center">Beschreibung</entry>

            <entry align="center">Entstehung</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><filename>.calculation</filename></entry>

            <entry>Steuerparameter der Berechnung</entry>

            <entry>Kopie der Datei
            <filename>/KalypsoTubig/.model/.calculation.template</filename>
            unter Ersetzung/Bearbeitung der Parameter.</entry>
          </row>

          <row>
            <entry><filename>createCalcCase.log</filename></entry>

            <entry>Log-Datei des ANT-Launches zur Erstellung der
            Rechenvariante</entry>

            <entry>Nach Aktivieren des ANT-Launches
            <filename>createCalcCase.launch</filename></entry>
          </row>

          <row>
            <entry><filename>Info_Rechenvariante.gft</filename></entry>

            <entry>Ansichtsvorlage für die Steuerparameter</entry>

            <entry>Kopie der Datei
            <filename>/KalypsoTubig/.templates/Modell/Info_Rechenvariante.gft</filename></entry>
          </row>

          <row>
            <entry><filename>modell.gml</filename></entry>

            <entry>GML-Datei der Modelldaten der Rechenvariante</entry>

            <entry>Kopie der Grunddaten des Modells
            (<filename>/KalypsoTubig/modell.gml</filename>)</entry>
          </row>

          <row>
            <entry><filename>niederschlagsmodell.log</filename></entry>

            <entry>Log-Datei des ANT-Launches zur Ermittlung des
            Gebietsniederschlags</entry>

            <entry>Nach Aktivieren des ANT-Launches
            <filename>gebietsniederschlag.launch</filename></entry>
          </row>

          <row>
            <entry><filename>runCalculation.log</filename></entry>

            <entry>Log-Datei des ANT-Launches zum Ausführen der
            Berechnung</entry>

            <entry>Nach Aktivieren des ANT-Launches
            <filename>runCalculation.launch</filename></entry>
          </row>

          <row>
            <entry><filename>updateCalcCase.log</filename></entry>

            <entry>Log-Datei des ANT-Launches zum Abholen/Aktualisieren der
            Zeitreihen, insbesondere Meldungen zur Gültigkeit der
            Zeitreihenwerte</entry>

            <entry>Nach Aktivieren des ANT-Launches
            <filename>updateCalcCase.launch</filename></entry>
          </row>

          <row>
            <entry><filename>Karten/*.gmt</filename></entry>

            <entry>diverse Ansichtsvorlagen für Karten</entry>

            <entry>Kopie der Dateien
            <filename>/KalypsoTubig/.templates/Modell/Karten/*.gmt</filename></entry>
          </row>

          <row>
            <entry><filename>Log-Dateien/*.*</filename></entry>

            <entry>LOG-Dateien des Rechenkerns</entry>

            <entry>KALYPSO-Rechendienst</entry>
          </row>

          <row>
            <entry><filename>Parameter/*.gtt</filename></entry>

            <entry>diverse Ansichtsvorlagen für Tabellen. Diese Tabellen
            dienen der Information über Modellparameter bzw. zum Editieren
            derselben</entry>

            <entry>Kopie der Dateien
            <filename>/KalypsoTubig/.templates/Modell/Parameter/*.gtt</filename></entry>
          </row>

          <row>
            <entry><filename>Zeitreihen/*.ott</filename></entry>

            <entry>diverse Ansichtsvorlagen für Zeitreihentabellen</entry>

            <entry>Kopie der Dateien
            <filename>/KalypsoTubig/.templates/Modell/Zeitreihen/*.ott</filename></entry>
          </row>

          <row>
            <entry><filename>Zeitreihen/*/*.zml</filename> bzw.
            <filename>Zeitreihen/*/*/*.zml</filename></entry>

            <entry>Zeitreihen-Dateien (Eingangszeitreihen und
            Berechnungsergebnisse)</entry>

            <entry>KALYPSO-Zeitreihendienst und KALYPSO-Rechendienst</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <section>
      <title>Launches und ANT-Skripte</title>

      <para>Der Modellablauf wird mit Hilfe der in der Datei
      <filename>/KalypsoBode/.model/launch/build.xml</filename> bzw.
      <filename>/KalypsoIlse/.model/launch/build.xml</filename> enthaltenen
      ANT-Targets gesteuert.</para>

      <para>Die bereitgestellten ANT-Targets umfassen neben den in <xref
      linkend="sec-modellintegration-allgemein" /> beschriebenen vier Launches
      (Erstellen einer neuen Rechenvariante, Aktualisieren einer
      Rechenvariante, Berechnung einer Rechenvariante und Ablage der
      Prognosezeitreihen) noch einen Launch zur Berechnung des
      Gebietsniederschlagsmodells. Dieser wird aus dem jeweiligen
      Vorhersage-Assistenten aufgerufen.</para>

      <section>
        <title>Erstellen einer neuen Rechenvariante
        (<filename>createCalcCase.launch</filename>)</title>

        <para>Es werden alle (Grund-)Daten der Rechenvariante erstellt
        (kopiert), d.h. alle Daten außer den Zeitreihendaten. Die Datei der
        Steuerparameter <filename>.calculation</filename> (siehe <xref
        linkend="sec_pktCalculation" />) wird mit Standardwerten belegt. Die
        eigentlichen Modelldaten befinden sich in der Datei
        <filename>modell.gml</filename> und stellen eine reine Kopie der
        Grunddaten dar
        (<filename>/KalypsoBode/.templates/Modell/modell.gml</filename> bzw.
        <filename>/KalypsoIlse/.templates/Modell/modell.gml</filename>).</para>
      </section>

      <section>
        <title>Aktualisieren einer Rechenvariante
        (<filename>updateCalcCase.launch</filename>)</title>

        <para>Es werden alle Zeitreihendaten der Rechenvariante entsprechend
        der <xref linkend="tbl_ZeitreihenTubig" /> zusammengestellt.</para>

        <table id="tbl_ZeitreihenTubig">
          <title>Zusammenstellung von Zeitreihendaten für Bode und
          Ilse</title>

          <tgroup cols="3">
            <colspec align="left" colwidth="3*" />

            <colspec align="left" colwidth="5*" />

            <colspec align="left" colwidth="3*" />

            <thead>
              <row>
                <entry align="center">Datenart</entry>

                <entry align="center">Unterverzeichnis von
                <filename>Zeitreihen</filename></entry>

                <entry align="center">Herkunft</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>Gebietsniederschläge</entry>

                <entry><filename>Gebietsniederschlag</filename></entry>

                <entry>Berechnung via Gebietsniederschlagsmodell</entry>
              </row>

              <row>
                <entry>gemessene Niederschläge</entry>

                <entry><filename>Gebietsniederschlag/Messung_Stationen</filename></entry>

                <entry>WISKI</entry>
              </row>

              <row>
                <entry>gemessene Wasserstände</entry>

                <entry><filename>Pegel/Messung</filename></entry>

                <entry>WISKI (bzw. aus einer ZML-Vorlage)</entry>
              </row>

              <row>
                <entry>gemessene Speicherinhalte</entry>

                <entry><filename>Speicher/Messung</filename></entry>

                <entry>WISKI</entry>
              </row>

              <row>
                <entry>Speicherabgaben</entry>

                <entry><filename>Speicherabgaben</filename> (Zeitreihenbereich
                bis zum Start der Vorhersage)</entry>

                <entry>WISKI</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Die Zuordnungen zwischen Zeitreihen der Rechenvariante und
        Zeitreihen in WISKI bzw. dateibasierten ZML-Vorlagen befinden sich in
        den Zuordnungsdateien
        <filename>/KalypsoBode/.templates/.WISKI_Konfig/wiskiimport_*.gml</filename>
        bzw.
        <filename>/KalypsoIlse/.templates/.WISKI_Konfig/wiskiimport_*.gml</filename>.</para>
      </section>

      <section>
        <title>Berechnung einer Rechenvariante
        (<filename>runCalculation.launch</filename>)</title>

        <para>Die vom Rechenkern benötigten Daten werden zusammengestellt und
        an den Rechendienst gesandt. Die zurückgebenen Ergebnisse werden in
        die Rechenvariante übernommen, vorher werden ggf. bereits bestehende
        Ergebnisse gelöscht.</para>
      </section>

      <section>
        <title>Ablage der Prognosezeitreihen
        (<filename>exportVorhersagen.launch</filename>)</title>

        <para>Entsprechend der Zuordnungen in den Dateien
        <filename>/KalypsoBode/.templates/.WISKI_Konfig/wiskiexport_*.gml</filename>
        bzw.
        <filename>/KalypsoIlse/.templates/.WISKI_Konfig/wiskiexport_*.gml</filename>
        werden Prognosezeitreihen nach WISKI geschrieben.</para>
      </section>

      <section>
        <title>Berechnung Gebietsniederschlag
        (<filename>niederschlagsmodell.launch</filename>)</title>

        <para>Die Umsetzung des Gebietsniederschlagsmodell befindet sich in
        einem speziellen Target namens <quote>gebietsniederschlag</quote> des
        ANT-Skriptes, welches bei der Aktualisierung einer Rechenvarianten
        sowie bei expliziter Neuberechnung des Gebietsniederschlags auf der
        ersten Seite des Vorhersageassistenten aufgerufen wird.</para>

        <para>Die Vergangenheitswerte werden über eine lineare Gewichtung aus
        den gemessenen Niederschlägen hergeleitet. Die Gewichtung wurde als
        Relation im GML-Applikationsschema modelliert und hängt als Parameter
        <quote>gewichtung</quote> direkt an den Elementen
        <quote>Niederschlagsgebiet</quote> des Datenmodells
        (<filename>modell.gml</filename>).</para>
      </section>
    </section>

    <section id="sec_pktCalculation">
      <title>Die Datei <filename>.calculation</filename></title>

      <para>Die Steuerdatei <filename>.calculation</filename> wird durch das
      serverseitig abgelegte GML-Schema <filename>control.xsd</filename>
      (Speicherort siehe <xref linkend="sec_modelSpecTubig" />) spezifiziert
      und enthält neben Informationen zum Szenario der Rechenvariante und zu
      Steuerparametern (Start der Simulation, Start der Vorhersage, derzeit
      gewählte Berechnungsart) noch weitere Metadaten, um eine Rechenvariante
      ausführlich beschreiben zu können. Diese sind:</para>

      <itemizedlist>
        <listitem>
          <para>der Ersteller der Rechenvariante (Default-Wert ist der
          Login-Name)</para>
        </listitem>

        <listitem>
          <para>eine (Kurz-)Beschreibung der Rechenvariante</para>
        </listitem>

        <listitem>
          <para>ein Kommentar zur Rechenvariante</para>
        </listitem>

        <listitem>
          <para>das Erstellungsdatum der Rechenvariante (Default-Wert ist die
          Systemzeit bei Anlegen der Rechenvariante)</para>
        </listitem>
      </itemizedlist>

      <para>Um eine ansprechende Darstellung der Szenario-Information,
      Steuerparameter und Metadaten im Dialog <menuchoice>
          <guilabel>Rechenvariante</guilabel>

          <guimenuitem>Neu</guimenuitem>
        </menuchoice> sowie im Vorhersage-Assistenten zu erhalten, wurde eine
      Ansichtsvorlage für die Steuerdatei unter
      <filename>/KalypsoBode/.model/.calculation.view</filename> bzw.
      <filename>/KalypsoIlse/.model/.calculation.view</filename> abgelegt. Die
      Berechnungsart kann beim Anlegen einer Rechenvariante nicht ausgewählt
      werden und wird deshalb zu diesem Zeitpunkt auch nicht angezeigt. In
      jeder Rechenvariante befindet sich noch eine Vorlagendatei
      <filename>Info_Rechenvariante.gft</filename>, die ggf. noch zusätzlich
      die Berechnungsart anzeigt und auch deren Auswahl ermöglicht (betrifft
      nur das Bode-Modell).</para>
    </section>
  </section>

  <section>
    <title>Modell-Plugin</title>

    <indexterm>
      <primary>Modell-Plugin</primary>

      <secondary>Bode/Ilse (Tubig)</secondary>
    </indexterm>

    <para>Die serverseitige Berechnung wird wie oben beschrieben über ein
    ANT-Skript (<filename>runCalculation.launch</filename>) angestoßen. Es
    werden alle Dateien der Rechenvariante bis auf die Vorlagen
    übertragen.</para>

    <para>Zur Berechnung wird der KALYPSO-Rechendienst mit der Typ-ID des
    Modells (hier <quote>TubigV1.0</quote>) angestoßen. Der Dienst aktiviert
    anhand der ID die entsprechende Implementierung des Interface
    <interfacename>org.Kalypso.services.calculation.job.ICalcJob</interfacename>,
    im Falle des Bode- bzw. Ilse-Modells die Klasse
    <interfacename>org.kalypso.lhwzsachsen.tubig.TubigCalcJob</interfacename>
    im Projekt <filename>KalypsoModelTubig</filename> der Programmquellen. Wie
    oben bereits beschrieben wurde, sind alle modellspezifischen
    Programmierungen und die für das Anstoßen des Rechenkerns benötigten Daten
    in diesem Projekt zusammengefasst.</para>

    <para>Der implementierte Rechendienst geht für jede Berechnung wie folgt
    vor:</para>

    <itemizedlist>
      <listitem>
        <para>Es wird ein temporäres Verzeichnis <quote>calc</quote>
        angelegt.</para>
      </listitem>

      <listitem>
        <para>Es wird der Rechenkern (ausführbare Programme m_*.exe und
        unveränderbare Parameterdateien) in dieses Verzeichnis kopiert. Diese
        Daten finden sich gesammelt im Paket
        <filename>/KalypsoModelTubig/src/org/kalypso/lhwsachsenanhalt/tubig/resources/rechenkern</filename>.</para>
      </listitem>

      <listitem>
        <para>Die vom Client übergebenen Daten der Rechenvariante werden in
        die Formate des Rechenkerns konvertiert und auch im temporären
        Verzeichnis abgelegt.<!--Für die Überleitungssperre werden auch Umbenennungen vorgenommen, 
da das bestehende Modell nicht ganz konsewuent in seinen Benennungen ist (bceCpyIn_<bat>.bat).--></para>
      </listitem>

      <listitem>
        <para>Die zum Modell (Bode oder Ilse) und zur ggf. gewählten Rechenart
        gehörige Batch-Datei des Rechenkerns wird in einem Batch-Interpreter
        gestartet.</para>
      </listitem>

      <listitem>
        <para>Die Ergebnisdaten der Berechnung, welche sich jetzt ebenfalls im
        temporären Verzeichnis befinden, werden in die vom Client benötigten
        Formate übertragen und können jetzt vom Client abgerufen werden.<!--Hier werden auch erst noch Dateien per BAT-Datei kopiert / umbenannt (bceCpyErg_<bat>.bat).--></para>
      </listitem>
    </itemizedlist>

    <para>Neben den konvertierten Zeitreihendaten werden auch LOG-Dateien des
    Rechenkerns zurück zum Client übertragen, was eine eventuelle Fehlersuche
    erleichtert (Speicherort siehe <xref
    linkend="tab-modellintegration-tubig-rechenvariante" />).</para>
  </section>

  <section>
    <title>Konfiguration des Vorhersage-Assistenten</title>

    <indexterm>
      <primary>Vorhersage-Assistent</primary>

      <secondary>Konfiguration</secondary>

      <tertiary>Bode/Ilse (Tubig)</tertiary>
    </indexterm>

    <para>Die Konfiguration des Vorhersage-Assistenten für die Modelle Bode
    und Ilse befindet sich wie in <xref linkend="sec_konfigAssi" /> gefordert
    in der Datei <filename>/KalypsoBode/.model/calcWizard.xml</filename> bzw.
    <filename>/KalypsoIlse/.model/calcWizard.xml</filename>. Der Ablauf des
    jeweiligen Assistenten ist im Benutzerhandbuch beschrieben und in der
    Konfigurationsdatei kommentiert.</para>

    <para>Die Konfigurationsdatei <filename>calcWizard.xml</filename> verweist
    ihrerseits auf eine Reihe von Ansichtsvorlagen zur Darstellung der
    Modelldaten innerhalb des Assistenten. Diese sind sämtlich im Verzeichnis
    <filename>/KalypsoBode/.templates/.wizard</filename> bzw. <filename>
    /KalypsoIlse/.templates/.wizard</filename> abgelegt.</para>
  </section>
</section>