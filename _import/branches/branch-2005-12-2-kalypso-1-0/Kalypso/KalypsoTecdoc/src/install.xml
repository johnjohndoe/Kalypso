<?xml version="1.0" encoding="UTF-8"?>
<chapter id="chapter_3_installation">
  <title>Installation und Konfiguration</title>

  <para>Die Installation und Konfiguration von KALYPSO wird in zwei Teilen -
  Client und Server - beschrieben.</para>

  <section id="install-client">
    <title>Client</title>

    <section>
      <title>Systemvoraussetzungen</title>

      <para>Voraussetzung ist ein Ethernet-LAN.</para>

      <para>KALYPSO wurde in der Programmiersprache Java und unter Verwendung
      der Eclipse Plattform realisiert, so dass die Software prinzipiell auf
      allen Systemen unter einer Java Runtime Umgebung (ab Version. 1.4) und
      der Eclipse Plattform einsetzbar ist. Um allerdings die volle
      Funktionalität nutzen zu können (Anstossen des Grafikprogramms zum
      Editieren von Ergebnisdaten) ist der Einsatz der Software unter Windows
      NT/2000/XP zwingend.</para>
    </section>

    <section>
      <title>Installation</title>

      <para>Die Installation der Client-Anwendung besteht aus zwei
      Bausteinen:</para>

      <itemizedlist>
        <listitem>
          <para>der Rich-Client-Plattform von Eclipse
          (Eclipse-Plattform),</para>
        </listitem>

        <listitem>
          <para>den KALYPSO-Plugins und KALYPSO-Features.</para>
        </listitem>
      </itemizedlist>

      <para>Für eine durchgängig deutsche Benutzeroberfläche muss zusätzlich
      noch die Internationalisierung der Eclipse-Plattform (sog.
      Language-Packs) installiert werden.</para>

      <para>Alle benötigten Dateien liegen als ZIP-Archive vor. Die
      Installation erfordert lediglich das Entpacken der Archive. Hierzu wird
      die Eclipse-Plattform an einen beliebigen Ort (auch eine Installation in
      einem Netzwerkpfad ist möglich) entpackt und die beiden weiteren
      Bausteine in die entsprechenden Unterverzeichnisse kopiert.</para>

      <para>Da KALYPSO aus der Basis Eclipse-Plattform, zusätzlichen Features
      und Plugins für KALYPSO selbst und der Internationalisierung besteht,
      empfiehlt es sich, das Installationsverzeichnis zu unterteilen. Dies
      wird durch das sog. Links- und Extensionsverzeichnis von Eclipse
      unterstützt.</para>

      <para>Vorgehensweise: Verzeichnis 'links' im Verzeichnis 'eclipse'
      erstellen. Dort für jede Erweiterung (z.B. die Language-Packs, oder
      KALYPSO, usw.) eine Link-Datei erstellen mit Namen des entsprechenden
      Features (aber ohne ID-Teil '_X.Y.Z') und mit folgendem Aufbau:
      <programlisting>path=... (mit Forwardslashes '/' getrennt)</programlisting>der
      Pfad muss zu dem Verzeichnis führen, in dem die Features und Plugins zu
      finden sind. Allerdings ist zu beachten, dass in diesem Verzeichnis
      dieselbe Verzeichnisstruktur wie im ursprünglichen Eclipse-Verzeichnis
      erforderlich ist (features, plugins und .eclipseextension). Zusätzlich
      muss im Eclipse-Verzeichnis der Erweiterung eine Datei namens
      <filename>.eclipseextension</filename> erstellt werden. Der Inhalt
      dieser Datei ähnelt dem der Datei
      <filename>.eclipseproduct</filename>.</para>

      <para>Siehe hierzu auch die Eclipse-Onlinehilfe, unter:</para>

      <para><guilabel>Platform Plugin Dev Guide\Reference\Other reference
      information\How to write an Eclipse installer</guilabel></para>

      <para><guilabel><!--Folien zur Installation (Verzeichnisstruktur) aus der Schulung--></guilabel></para>

      <para vendor="sachsen-anhalt">Beispiel (in Magdeburg): <programlisting>\\smdhvzwapp\KalypsoClient\
        .eclipseproduct
        features
        plugins
        links\&lt;feature-name&gt;.link
        extensions\&lt;extension-name&gt;\eclipse
        extensions\&lt;extension-name&gt;\eclipse\.eclipseextension
        extensions\&lt;extension-name&gt;\eclipse\features
        extensions\&lt;extension-name&gt;\eclipse\plugins</programlisting> Wie
      aus dem Beispiel ersichtlich, kann die KALYPSO-Client Installation
      zentral vorgenommen werden. Dies ist der Fall in Magdeburg und in
      Halle.</para>

      <para>Auf jeden Client-Rechner muss nur noch das Datenverzeichnis (sog.
      Workspace) und die KALYPSO-Verknüpfung kopiert werden. Die Verknüpfung
      soll auf die .exe-Datei in der zentralen Installation verweisen,
      allerdings über den Pfad der Freigabe. Die Freigabe selbst muss
      angepasst werden, sodass nur Lese-Berechtigungen für
      <quote>Jede(r)</quote> erteilt werden.</para>

      <para>Die Verknüpfung hat folgenden Aufbau:</para>

      <programlisting>\\FREIGABE\...\eclipse.exe -data WORKSPACE -vmargs -Xmx512m</programlisting>

      <para><itemizedlist>
          <listitem>
            <para>FREIGABE ist durch die auf dem Server definierte Freigabe zu
            ersetzen.</para>
          </listitem>

          <listitem>
            <para>WORKSPACE ist durch den lokalen Pfad des Datenverzeichnisses
            zu ersetzen.</para>
          </listitem>
        </itemizedlist></para>

      <para>Zusätzlich zu dem Datenverzeichnis, erstellt KALYPSO automatisch
      temporäre Dateien im .eclipse-Verzeichnis im Homeverzeichnis des
      aktuellen Benutzers. Bei Start-Problemen von KALYPSO werden dort
      Log-Dateien abgelegt.</para>

      <informaltable vendor="sachsen-anhalt">
        <tgroup cols="4">
          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="2*" />

          <thead>
            <row>
              <entry align="center">Standort</entry>

              <entry align="center">Rechner</entry>

              <entry align="center">Installationspfad</entry>

              <entry align="center">Freigabe</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Magdeburg</entry>

              <entry>SMDHVZWAPP</entry>

              <entry><filename>D:/Programme/KalypsoClient</filename></entry>

              <entry><filename>//smdhvzwapp/KalypsoClient</filename></entry>
            </row>

            <row>
              <entry>Halle</entry>

              <entry>SHALHVZWAPP</entry>

              <entry><filename>D:/Programme/KalypsoClient</filename></entry>

              <entry><filename>//shalhvzwapp/KalypsoClient</filename></entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </section>

    <section>
      <title>Konfiguration</title>

      <para>Beim ersten Start von KALYPSO kann es sein, dass die Konfiguration
      noch nicht vollständig ist. Dies hängt vom Eintrag in den
      Benutzervorgaben ab. Mehr dazu im Laufe dieses Abschnitts.</para>

      <para>Wichtig für jeden Client ist der Speicherort der zentralen
      Konfigurationsdatei in Form einer oder mehrerer URLs. Pro Client kann
      eine Liste von alternativen Konfigurationsdateien eingestellt werden,
      die solange abgearbeitet wird, bis eine passende Konfigurationsdatei
      gefunden wurde. Jede Konfigurationsdatei entspricht dabei im Normalfall
      einem (physischen) Server.</para>

      <para>Die Konfigurationsdatei Kalypso-Client.ini liegt auf dem
      KALYPSO-Server in der WebDAV-Webapplikation. Diese Webapplikation wird
      standardmäßig mit Tomcat geliefert und bietet eine auf http basierende
      standardisierte Verzeichnisablage.</para>

      <informaltable vendor="sachsen-anhalt">
        <tgroup cols="2">
          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="3*" />

          <thead>
            <row>
              <entry align="center">Standort</entry>

              <entry align="center">URL</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Magdeburg</entry>

              <entry><filename><filename>http://smdhvzwapp:8088/webdav/Kalypso-client.ini</filename></filename></entry>
            </row>

            <row>
              <entry>Halle</entry>

              <entry><filename>http://shalhvzwapp:8088/webdav/Kalypso-client.ini</filename></entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Nach dem ersten Start muss KALYPSO konfiguriert werden, da die
      Konfigurations-URL in den Einstellungen fehlt. Um dies zu erreichen,
      muss die Konfiguration unter <menuchoice>
          <guimenu>Fenster</guimenu>

          <guisubmenu>Benutzervorgaben</guisubmenu>

          <guimenuitem>Kalypso</guimenuitem>
        </menuchoice> angepasst werden. Eine Umstellung zwischen beiden
      Standorten ist somit jederzeit möglich, es genügt, diese Einstellung
      anzupassen. Ein Neustart des KALYPSO-Clients ist dabei nicht
      erforderlich.</para>
    </section>
  </section>

  <section id="install-server">
    <title>Server</title>

    <para>Die vollständige Installation der Serveranwendung erfordert eine
    Reihe manueller Schritte. Einführend werden die Systemvoraussetzungen und
    die notwendige Verzeichnisstruktur auf dem Server behandelt.</para>

    <section>
      <title>Systemvoraussetzungen</title>

      <para>Die Serveranwendung ist bereits auf einem handelsüblichen PC (z.B.
      Pentium 4, 512 MB RAM, 40 GB HDD) einsatzfähig. Um jedoch die
      System-Antwortzeit erheblich zu verbessern, empfehlen wir folgende
      Konfiguration: Dual Pentium 4, 2 GB RAM, 130 GB HDD, eventuell mit
      replizierter Hardware für eine erhöhte Ausfallsicherheit.</para>

      <para>Aufgrund der Programmierung der KALYPSO-Dienste in der
      Programmiersprache Java ist die Software auf allen Systemen, die eine
      Java Runtime Umgebung (ab Version 1.4.2) unterstützen,
      einsetzbar.</para>

      <para>Die Modell-Plugins und deren Rechenkerne stellen ggf. spezielle
      Anforderungen an die Laufzeitumgebung (DOS-Programm o.ä.).</para>
    </section>

    <section>
      <title>Dateistruktur der Installation</title>

      <para>In <xref linkend="pic_install_Dateistruktur" /> ist die
      Verzeichnisstruktur einer Serverinstallation beispielhaft zu
      sehen.</para>

      <figure id="pic_install_Dateistruktur">
        <title>Abbildung Dateistruktur</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="img/kap3/Dateistruktur_Installation.png" />
          </imageobject>
        </mediaobject>
      </figure>

      <!--Aufzählung machen, nur von welchen der folgenden Punkten genau?-->

      <para>Im Verzeichnis j2sdk1.4.2_06 wird das JDK 1.4.2
      installiert.</para>

      <para>Tomcat 5.0.28 wird im Verzeichnis Tomcat5.0 installiert.</para>

      <para>Das bin-Verzeichnis beinhaltet u.a. die Startskripts um Tomcat zu
      starten (optional in Debugmodus). Normalerweise wird aber Tomcat als
      Betriebssystem Dienst konfiguriert und auch gestartet.</para>

      <para>Im webapps-Verzeichnis sind die KALYPSO Dienste und die mit Tomcat
      gelieferten Applikationen balancer, ROOT und webdav.</para>

      <para>Die WebDAV-Applikation stellt seinen Verzeichnis-basierten Inhalt
      über das http-Protokoll zur Verfügung.</para>

      <para>Das WebDAV-Verzeichnis wird von KALYPSO für verschiedene Zwecke
      benutzt:</para>

      <itemizedlist>
        <listitem>
          <para>prognose: beinhaltet die serverseitige Modellablage.</para>
        </listitem>

        <listitem>
          <para>schemata: beinhaltet spezielle Schemata, die vom
          KALYPSO-Client benutzt werden.</para>
        </listitem>

        <listitem>
          <para>srcvonf: beinhaltet die Konfigurationsdateien für die KALYPSO
          Webdienste.</para>
        </listitem>

        <listitem>
          <para>vorhersageconf: beinhaltet Konfigurationsdateien für die
          KALYPSO Vorhersageassistenten.</para>
        </listitem>
      </itemizedlist>

      <para>Wenn Tomcat und die KALYPSO-Dienste ausgeführt werden, entsteht im
      logs-Verzeichnis die Datei <filename>Kalypso.log</filename>, welche
      wichtige Information über den Ablauf beinhaltet. Daraus lassen sich u.a.
      Probleme mit der Software feststellen.</para>

      <para>Das temp-Verzeichnis sollte ab und zu geprüft und eventuell
      geleert werden. Dort werden temporäre Dateien wie z.B. Dienst
      spezifische Log-Dateien abgespeichert.</para>

      <para>Die anderen Verzeichnisse sind Tomcat-spezifisch, mehr
      Informationen dazu können in der Tomcat-Hilfe gefunden werden.</para>
    </section>

    <section>
      <title>Freigaben</title>

      <para>Der Systemadministrator muss folgende Dateifreigaben auf dem
      Server konfigurieren:</para>

      <table vendor="sachsen-anhalt">
        <title>Dateifreigabe</title>

        <tgroup cols="3">
          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="3*" />

          <colspec align="left" colwidth="3*" />

          <thead>
            <row>
              <entry align="center">Freigabe</entry>

              <entry align="center">Pfad (relativ zu )</entry>

              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Kalypso-modelle</entry>

              <entry><filename>D:/Programme/Kalypso/webapps/webdav/prognose</filename></entry>

              <entry>Lese- und Schreibrechte für <quote>Jeder</quote>.
              Modelldaten werden auf diese Art und Weise zwischen Clients und
              Server ausgetauscht.</entry>
            </row>

            <row>
              <entry>KalypsoClient</entry>

              <entry><filename>D:/Programme/KalypsoClient</filename></entry>

              <entry>Leserechte für <quote>Jeder</quote>. Ablage der zentralen
              Client-Installation.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

    <section>
      <title>Tomcat</title>

      <para>CATALINA_HOME bezeichnet das Installationsverzeichnis von
      Tomcat.</para>

      <!--Die folgende Aufzählung sieht in PDF nicht gut aus... (taucht im weiteren Verlauf des Dokumentes auch immer wieder auf)-->

      <formalpara>
        <title>Installation</title>

        <para>Tomcat (ab Version 5.0.28) installieren (Install-Programm
        benutzen oder Dateien direkt kopieren). Abhängigkeiten: Die libs
        (*.jar) aus dem KalypsoServiceCore Projekt in CATALINA_HOME/common/lib
        kopieren.</para>
      </formalpara>

      <formalpara>
        <title>manager.xml und admin.xml</title>

        <para>Diese Dateien (in
        <filename>CATALINA_HOME/conf/catalina/localhost</filename>) prüfen.
        Der Gesamtpfad von Tomcat ist dort angeben. Pfad prüfen und so
        anpassen, dass er mit dem tatsächlichen Pfad übereinstimmt. Dies ist
        besonders relevant, wenn Tomcat manuell installiert wurde.</para>
      </formalpara>

      <formalpara>
        <title>Sicherheitseinstellungen:</title>

        <para>Die Datei <filename>catalina.policy</filename> editieren und die
        Sicherheitseinstellungen anpassen (siehe das KalypsoConf-Projekt).
        Java Permissions richtig setzen, u.a. für das definierte
        Temp-Verzeichnis anpassen. Achtung: Groß- /Kleinschreibung (siehe
        Kommentar in Datei).</para>
      </formalpara>

      <formalpara>
        <title>Tomcat starten:</title>

        <para>Sie können Tomcat über zwei Mechanismen starten: entweder mit
        Batch-Dateien oder als Windows-Dienst. <itemizedlist>
            <listitem>
              <para>Mit Batch-Dateien: Die Batch-Dateien
              <filename>Kalypso_server_start.bat</filename> und
              <filename>Kalypso_server_stop.bat</filename> müssen mit dem Pfad
              (entspr. der Freigabe) vom Temp-Verzeichnis angepasst
              werden.</para>
            </listitem>

            <listitem>
              <para>Tomcat als Service einrichten und starten: Die Datei
              <filename>service.bat</filename> aus dem Verzeichnis
              <filename>CATALINA_HOME/bin</filename> ausführen. Die
              notwendigen Parameter mittels Registry-Editor oder tomcat5w.exe
              setzen. Um Zugriffe auf die UNC-Pfade zu erhalten, muss der
              Dienst unter einem Domainenbenutzer gestartet werden.</para>
            </listitem>
          </itemizedlist></para>
      </formalpara>
    </section>

    <section>
      <title>Deployment der Dienste</title>

      <para vendor="sachsen-anhalt">Um die KALYPSO Dienste deployen zu können,
      ist das Ant-Skript im Verzeichnis <quote>deployable-server-kunde</quote>
      im KalypsoConfSachsenAnhalt-Projekt erforderlich.</para>

      <para><filename>Kalypso-client.ini:</filename></para>

      <para>In <filename>webapps/webdav</filename> ist die Datei
      <filename>Kalypso-client.ini</filename> zwingend erforderlich. Sie wird
      normalerweise beim Deploy über das Ant-Skript angelegt. Eine Überprüfung
      des Dateiinhaltes ist ratsam, da die URLs mit den eingesetzten Services
      übereinstimmen müssen.</para>

      <para>Optional kann auch das KalypsoDWDFileCopyServlet aus dem
      KalypsoDWD Projekt installiert werden. Dieser Dienst kopiert immer die
      aktuelle DWD-Vorhersage aus dem IMS in das
      <filename>webdav/dwd</filename> Verzeichnis. Damit steht die
      DWD-Vorhersage für die KALYPSO-Clients zur Verfügung.</para>
    </section>

    <section id="install-server_services_config">
      <title>Konfiguration der KALYPSO-Server bzw. -Dienste</title>

      <para>Der Server wird zusätzlich über folgende System-Properties
      konfiguriert:</para>

      <itemizedlist>
        <listitem>
          <para>Kalypso.server.tempdir: Pfad des Temp-Verzeichnis,</para>
        </listitem>

        <listitem>
          <para>Kalypso.server.confdir: Pfad des
          Konfigurationsverzeichnis</para>
        </listitem>
      </itemizedlist>

      <para>Alle KALYPSO-Dienste benötigen die eben aufgelisteten
      System-Properties (Pfade auf die Datenverzeichnisse). Zusätzlich muss in
      der <filename>catalina.policy</filename> den entsprechenden Services
      Zugriff auf diese Pfade und Properties gewährt werden.</para>

      <para>Das Setzen der System-Properties geschieht über eine spezielle
      <filename>Kalypso_server_start.bat</filename>.</para>
    </section>
  </section>
</chapter>