<?xml version="1.0" encoding="UTF-8"?>
<chapter id="chapter_3_installation">
  <title>Installation und Konfiguration (suche client.ini)</title>

  <para>Die Installation und Konfiguration von Kalypso wird in zwei Teilen -
  Client und Server - beschrieben.</para>

  <section id="install-client">
    <title>Client</title>

    <section>
      <title>Systemvoraussetzungen</title>

      <para>Voraussetzung ist ein Ethernet-LAN.</para>

      <para>Kalypso wurde in der Programmiersprache Java und unter Verwendung
      der Eclipse Plattform realisiert, so dass die Software prinzipiell auf
      allen Systemen unter einer Java Runtime Umgebung (ab Version. 1.4) und
      der Eclipse Plattform einsetzbar ist. Um allerdings die volle
      Funktionalität nutzen zu können (Anstoß und Editierung der Diagramme mit
      dem Grafik-Tool) ist der Einsatz der Software unter Windows NT/2000/XP
      zwingend.</para>
    </section>

    <section>
      <title>Installation</title>

      <para>Die Installation der Client-Anwendung besteht aus zwei
      Bausteinen:</para>

      <itemizedlist>
        <listitem>
          <para>die Rich-Client-Plattform von Eclipse
          (Eclipse-Plattform),</para>
        </listitem>

        <listitem>
          <para>die Kalypso-Plugins und die Kalypso-Features.</para>
        </listitem>
      </itemizedlist>

      <para>Für eine durchgängig deutsche Benutzeroberfläche muss zusätzlich
      noch die Internationalisierung der Eclipse-Plattform (sog.
      Language-Packs) installiert werden.</para>

      <para>Alle benötigten Dateien liegen als ZIP-Archive vor. Die
      Installation erfordert lediglich das Entpacken der Archive. Hierzu wird
      die Eclipse-Plattform an einen beliebigen Ort (auch eine Installation in
      einem Netzwerkpfad ist möglich) entpackt und die beiden weiteren
      Bausteine in die entsprechenden Unterverzeichnisse kopiert.</para>

      <para>Da Kalypso aus der Basis Eclipse-Plattform und die zusätzlichen
      Features und Plugins für Kalypso selbst und die Internationalisierung,
      empfiehlt es sich das Installationsverzeichnis zu unterteilen. Dies wird
      durch das sog. Links- und Extensionsverzeichnis unterstützt.</para>

      <para>Vorgehensweise: Verzeichnis 'links' unter eclipse erstellen. Dort
      für jede Erweiterung (z.B. die Language-Packs, oder Kalypso, usw.) eine
      Link-Datei erstellen mit Namen des entsprechenden Features (aber ohne
      ID-Teil '_X.Y.Z') und mit folgendem Aufbau: <programlisting>path=... (mit Forwardslashes '/' getrennt)</programlisting>
      der Pfad muss zu dem Verzeichnis führen, wo die Features und Plugins zu
      finden sind. Allerdings ist zu beachten, dass auch in diesem Verzeichnis
      der gleiche Aufbau wie im original Eclipse-Verzeichnis zu
      berücksichtigen ist (features, plugins, und .eclipseextension).
      Zusätzlich muss im Eclipse-Verzeichnis der Erweiterung eine Datei namens
      '.eclipseextension' erstellt werden. Der Inhalt dieser Datei ähnelt dem
      der '.eclipseproduct'.</para>

      <para>Siehe auch in die Eclipse-Onlinehilfe, unter: <guilabel>Platform
      Plugin Dev Guide\Reference\Other reference information\How to write an
      Eclipse installer</guilabel></para>

      <para vendor="sachsen-anhalt">Beispiel (in Magdeburg): <programlisting>\\smdhvzwapp\KalypsoClient
        \\smdhvzwapp\KalypsoClient\.eclipseproduct
        \\smdhvzwapp\KalypsoClient\features
        \\smdhvzwapp\KalypsoClient\plugins
        \\smdhvzwapp\KalypsoClient\...
        \\smdhvzwapp\KalypsoClient\links
        \\smdhvzwapp\KalypsoClient\links\&lt;feature-name&gt;.link
        \\smdhvzwapp\KalypsoClient\extensions\&lt;extension-name&gt;\eclipse
        \\smdhvzwapp\KalypsoClient\extensions\&lt;extension-name&gt;\eclipse\.eclipseextension
        \\smdhvzwapp\KalypsoClient\extensions\&lt;extension-name&gt;\eclipse\features
        \\smdhvzwapp\KalypsoClient\extensions\&lt;extension-name&gt;\eclipse\plugins</programlisting>
      Wie aus dem Beispiel ersichtlich kann die Kalypso-Client Installation
      zentral vorgenommen werden. Dies ist der Fall in Magdeburg und in
      Halle.</para>

      <para>Auf jedem Client-Rechner muss nur noch das Datenverzeichnis (sog.
      Workspace) und die Kalypso-Verknüpfung kopiert werden. Die Verknüpfung
      soll auf die .exe-Datei in der zentrale Installation verweisen,
      allerdings über der Pfad der Freigabe. Die Freigabe selbst muss
      angepasst werden sodass nur Lese-Berechtigungen für Jede(r) erteilt
      werden.</para>

      <para>Die Verknüpfung hat folgender Aufbau:</para>

      <programlisting>
				\\FREIGABE\...\eclipse.exe -data WORKSPACE -vmargs -Xmx512m
			</programlisting>

      <para><itemizedlist>
          <listitem>
            <para>FREIGABE ist mit die auf dem Server definierte Freigabe zu
            ersetzen.</para>
          </listitem>

          <listitem>
            <para>WORKSPACE ist mit dem lokaler Pfad des Datenverzeichnis zu
            ersetzen.</para>
          </listitem>
        </itemizedlist></para>

      <para>Zusätzlich zu dem Datenverzeichnis, erstellt Kalypso automatisch
      temporäre Dateien im .eclipse-Verzeichnis im Homeverzeichnis des
      aktuellen Benutzer. Bei Start-Probleme von Kalypso werden dort
      Log-Dateien abgelegt.</para>

      <informaltable vendor="sachsen-anhalt">
        <tgroup cols="4">
          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="2*" />

          <thead>
            <row>
              <entry align="center">Standort</entry>

              <entry align="center">Rechner</entry>

              <entry align="center">Installationspfad</entry>

              <entry align="center">Freigabe</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Magdeburg</entry>

              <entry>SMDHVZWAPP</entry>

              <entry>D:\Programme\KalypsoClient</entry>

              <entry>\\smdhvzwapp\KalypsoClient</entry>
            </row>

            <row>
              <entry>Halle</entry>

              <entry>SHALHVZWAPP</entry>

              <entry>D:\Programme\KalypsoClient</entry>

              <entry>\\shalhvzwapp\KalypsoClient</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </section>

    <section>
      <title>Konfiguration</title>

      <para>Beim ersten Start von Kalypso kann es sein, dass die Konfiguration
      noch nicht vollständig ist. Dies hängt vom Eintrag in die
      Benutzervorgaben ab. Mehr dazu im Läufe dieses Abschnitt.</para>

      <para>Wichtig für jeden Client ist der Speicherort der zentralen
      Konfigurationsdatei in Form einer oder mehrerer URLs. Pro Client kann
      eine Liste von alternativen Konfigurationsdateien eingestellt werden,
      die solange abgearbeitet wird, bis eine passende Konfigurationsdatei
      gefunden wurde. Jede Konfigurationsdatei entspricht dabei im Normalfall
      einem (physischen) Server.</para>

      <para>Die Konfigurationsdatei Kalypso-Client.ini liegt auf dem
      Kalypso-Server in der WEBDAV-Webapplikation. Diese Webapplikation wird
      standardmäßig mit Tomcat geliefert und bietet eine über http basierte
      und standardisierte Verzeichnisablage.</para>

      <informaltable vendor="sachsen-anhalt">
        <tgroup cols="2">
          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="2*" />

          <thead>
            <row>
              <entry align="center">Standort</entry>

              <entry align="center">URL</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Magdeburg</entry>

              <entry>http://smdhvzwapp:8088/webdav/Kalypso-client.ini</entry>
            </row>

            <row>
              <entry>Halle</entry>

              <entry>http://shalhvzwapp:8088/webdav/Kalypso-client.ini</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Nach dem ersten Start muss Kalypso konfiguriert werden, da die
      Konfigurations-URL in den Einstellungen fehlt. Um dies zu erreichen,
      muss das Menü "Fenster/Benutzervorgaben/Kalypso" gewählt und die
      Konfiguration angepasst werden. Eine Umstellung zwischen beiden
      Standorten ist jederzeit möglich, es genügt diese Einstellungen
      anzupassen. Ein Neustart des Kalypso-Clients ist nicht
      erforderlich.</para>

      <para></para>

      <para>TODO</para>

      <para>config.ini</para>

      <para>Generelle Einstellungen</para>

      <para>kalypso.hwv.modellist.url=file:///C:\Eclipse\KalypsoHead332\KalypsoConfSachsen\deployable-server\webdav\vorhersageconf\modellist.xml</para>

      <para>kalypso.timezone=Europe/Berlin ## Zeitzone, in welchem alle
      Datumswerte im client angezeigt werden</para>

      <para>org.kalypso.service.wps.service=http://localhost/ogc</para>

      <para></para>

      <para>User-Service</para>

      <para>kalypso.hwv.user.service.id=hwvUserService1.0</para>

      <para>kalypso.hwv.user.askUserName=false # Benutzername ist immer der
      Windows-Login-Name</para>

      <para>kalypso.hwv.user.scenarioIdList=;test # gibt an welche Liste von
      Szenarien dem Benutzer zur Verfügung stehen sollen.</para>

      <para>kalypso.hwv.user.scenarioIniList=scenario_normal.ini;scenario_test.ini</para>

      <para>TODO ENDE</para>
    </section>
  </section>

  <section id="install-server">
    <title>Server</title>

    <para>Die vollständige Installation der Serveranwendung erfordert eine
    Reihe manueller Schritte. Einführend werden die Systemvoraussetzungen und
    die notwendige Verzeichnisstruktur auf dem Server behandelt.</para>

    <section>
      <title>Systemvoraussetzungen</title>

      <para>Die Serveranwendung ist bereits auf einem handelsüblichen PC (z.B.
      Pentium 4, 512 MB RAM, 40 GB HDD) einsatzfähig. Um jedoch die
      System-Antwortzeit erheblich zu verbessern, empfehlen wir folgende
      Konfiguration: Dual Pentium 4, 2 GB RAM, 130 GB HDD, eventuell mit
      replizierter Hardware für eine erhöhte Ausfallsicherheit.</para>

      <para>Aufgrund der Programmierung der Kalypso-Dienste in der
      Programmiersprache Java ist die Software auf allen Systemen, die eine
      Java Runtime Umgebung (ab Version 1.4.2) akzeptieren, einsetzbar.</para>

      <para>Die Modell-Plugins und deren Rechenkerne stellen spezielle
      Anforderungen an die Laufzeitumgebung (DOS-Programm o.ä.).</para>
    </section>

    <section>
      <title>Dateistruktur der Installation</title>

      <para>Im Verzeichnis j2sdk1.4.2_06 wird das JDK 1.4.2
      installiert.</para>

      <figure>
        <title>Abbildung Dateistruktur</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="img/kap3/Dateistruktur_Installation.png" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Tomcat 5.0.28 wird im Verzeichnis Tomcat5.0 installiert.</para>

      <para>Das bin-Verzeichnis beinhaltet u.a. die Startskripts um Tomcat zu
      starten (optional in Debugmodus). Normalerweise wird aber Tomcat als
      Betriebssystem Dienst konfiguriert und auch gestartet.</para>

      <para>Im webapps-Verzeichnis sind die Kalypso Dienste und die mit Tomcat
      gelieferten Applikationen balancer, ROOT und webdav.</para>

      <para>Die webdav-Applikation stellt seinen
      Verzeichnis-<filename>basierten Inhalt</filename> über das http
      Protokoll zur Verfügung.</para>

      <para>Das webdav-Verzeichnis wird von Kalypso für verschiedene Zwecke
      benutzt:</para>

      <itemizedlist>
        <listitem>
          <para>prognose: beinhaltet die serverseitige Modellablage.</para>
        </listitem>

        <listitem>
          <para>schemata: beinhaltet speziellen Schematas die vom
          Kalypso-Client benutzt werden.</para>
        </listitem>

        <listitem>
          <para>srcvonf: beinhaltet die Konfigurationsdateien für die Kalypso
          Webdienste.</para>
        </listitem>

        <listitem>
          <para>vorhersageconf: beinhaltet die Konfigurationsdateien für der
          Kalypso Vorhersagewizard.</para>
        </listitem>
      </itemizedlist>

      <para>Wenn Tomcat und die Kalypso-Dienste ausgeführt werden, entsteht im
      logs-Verzeichnis die Datei Kalypso.log welche wichtige Information über
      den Ablauf beinhaltet. Daraus lassen sich u.a. Probleme mit der Software
      feststellen.</para>

      <para>Das temp-Verzeichnis sollte ab und zu geprüft und eventuell
      geleert werden. Dort werden temporäre Dateien wie z.B. Dienst
      spezifische Log-Dateien abgespeichert.</para>

      <para>Die anderen Verzeichnisse sind Tomcat-spezifisch, mehr
      Informationen dazu können in der Tomcat-Hilfe gefunden werden.</para>
    </section>

    <section>
      <title>Freigaben</title>

      <para>Der Systemadministrator muss folgende Dateifreigaben auf dem
      Server konfigurieren:</para>

      <table vendor="sachsen-anhalt">
        <title>Dateifreigabe</title>

        <tgroup cols="3">
          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="3*" />

          <thead>
            <row>
              <entry align="center">Freigabe</entry>

              <entry align="center">Pfad (relativ zu )</entry>

              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Kalypso-modelle</entry>

              <entry>D:\Programme\Kalypso\webapps\webdav\prognose</entry>

              <entry>Lese- und Schreibrechte für "Jeder". Modelldaten werden
              auf diese Art und Weise zwischen Clients und Server
              ausgetauscht.</entry>
            </row>

            <row>
              <entry>KalypsoClient</entry>

              <entry>D:\Programme\KalypsoClient</entry>

              <entry>Leserechte für "Jeder". Eintrittspunkt der zentrale
              Client-Installation.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

    <section>
      <title>Tomcat</title>

      <para>CATALINA_HOME bezeichnet das Installationsverzeichnis von
      Tomcat.</para>

      <formalpara>
        <title>Installation</title>

        <para>Tomcat (ab Version 5.0.28) installieren (Install-Programm
        benutzen oder Dateien direkt kopieren). Abhängigkeiten: Die libs
        (*.jar) aus dem KalypsoServiceCore Projekt in CATALINA_HOME/common/lib
        kopieren.</para>
      </formalpara>

      <formalpara>
        <title>manager.xml und admin.xml</title>

        <para>Diese Dateien (in CATALINA_HOME/conf/catalina/localhost) prüfen.
        Der Gesamtpfad von Tomcat ist dort angeben. Pfad prüfen und so
        anpassen, dass er mit dem tatsächlichen Pfad übereinstimmt. Dies ist
        besonders relevant wenn Tomcat manuell installiert wurde.</para>
      </formalpara>

      <formalpara>
        <title>Sicherheitseinstellungen:</title>

        <para>Die Datei catalina.policy editieren und die
        Sicherheitseinstellungen anpassen (siehe das KalypsoConf-Projekt).
        Java Permissions richtig setzen, u.a. für das definierte
        Temp-Verzeichnis anpassen. Achtung: Groß- /Kleinschreibung (siehe
        Kommentar in Datei).</para>
      </formalpara>

      <formalpara>
        <title>Tomcat starten:</title>

        <para>Sie können Tomcat über zwei Mechanismen starten: entweder mit
        Batch-Dateien oder als Windows-Dienst. <itemizedlist>
            <listitem>
              <para>Mit Batch-Dateien: Die Batch-Dateien
              Kalypso_server_start.bat und Kalypso_server_stop.bat müssen mit
              dem Pfad (entspr. der Freigabe) vom Temp-Verzeichnis angepasst
              werden.</para>
            </listitem>

            <listitem>
              <para>Tomcat als Service einrichten und starten: Die service.bat
              Datei aus dem Verzeichnis CATALINA_HOME\bin ausführen. Die
              notwendigen Parameter mittels Registry-Editor oder tomcat5w.exe
              setzen. Um Zugriffe auf die UNC-Pfade zu erhalten, muss der
              Dienst unter einem Domainenbenutzer gestartet werden.</para>
            </listitem>
          </itemizedlist></para>
      </formalpara>
    </section>

    <section>
      <title>Deployement der Dienste</title>

      <para vendor="sachsen-anhalt">Um die Kalypso Dienste deployen zu können,
      ist das Ant-Skript im Verzeichnis "deployable-server-kunde" im
      KalypsoConfSachsenAnhalt-Projekt erforderlich.</para>

      <para><filename>Kalypso-client.ini:</filename></para>

      <para>In webapps/webdav ist die Kalypso-client.ini Datei zwingend
      erforderlich. Sie wird normalerweise beim Deploy über der Ant-Skript
      angelegt. Eine Überprüfung des Dateiinhaltes ist ratsam, da die URLs mit
      den eingesetzten Services übereinstimmen müssen.</para>

      <para>Optional kann auch das KalypsoDWDFileCopyServlet aus dem
      KalypsoDWD Projekt installiert werden. Dieser Dienst kopiert immer die
      aktuelle DWD-Vorhersage aus dem IMS in das webdav/dwd Verzeichnis. Damit
      stehen die DWD-Vorhersage für die Kalypso-Clients zur Verfügung.</para>
    </section>

    <section>
      <title>Konfiguration der Kalypso-Server bzw. Dienste</title>

      <para>Der Server wird zusätzlich über folgende System-Properties
      konfiguriert:</para>

      <itemizedlist>
        <listitem>
          <para>Kalypso.server.tempdir: Pfad des Temp-Verzeichnis,</para>
        </listitem>

        <listitem>
          <para>Kalypso.server.confdir: Pfad des
          Konfigurationsverzeichnis</para>
        </listitem>
      </itemizedlist>

      <para>Alle Kalypso-Dienste benötigen die eben aufgelisteten
      System-Properties (Pfade auf die Datenverzeichnisse). Zusätzlich muss in
      der catalina.policy der entsprechende Services Zugriff auf diese Pfade
      und Properties gewährt werden.</para>

      <para>Das Setzen der System-Properties geschieht zur Zeit über eine
      spezielle Kalypso_server_start.bat.</para>

      <para></para>

      <para>TODO</para>

      <para>config.ini</para>

      <para></para>

      <para>org.kalypso.service.wps.results=file:///C:/tmp/simus/results</para>

      <para></para>

      <para></para>

      <para>TODO ENDe</para>
    </section>
  </section>
</chapter>