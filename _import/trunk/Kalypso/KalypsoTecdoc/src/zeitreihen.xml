<?xml version="1.0" encoding="UTF-8"?>
<chapter id="chapter_4_zeitreihen">
  <title>Zeitreihenablage</title>

  <indexterm>
    <primary>Zeitreihenablage</primary>
  </indexterm>

  <section>
    <title>Grundprinzip</title>

    <indexterm>
      <primary>Zeitreihenablage</primary>

      <secondary>Grundprinzip</secondary>
    </indexterm>

    <para>Der Zeitreihenablage liegt eine hierarchische Struktur zugrunde. Die
    Java-Schnittstelle
    <interfacename>org.kalypso.repository.IRepository</interfacename> ist der
    zentrale Punkt des Ablage-Frameworks von KALYPSO. Ablagen können sowohl
    clientseitig als auch serverseitig in KALYPSO eingebunden werden.</para>

    <para>Die Zeitreihenablage ist eine Spezialisierung des
    IRepository-Interface. Dabei sind die Knoten (IRepositoryItem) anpassbar
    (IAdaptable) und können eine Zeitreihe (IObservation) liefern.</para>

    <para>Der Eclipse-Erweiterungsmechanismus (Extension Point) unterstützt
    unterschiedliche Ablagearten über
    <classname>org.kalypso.repository.factories</classname>. Die Erweiterungen
    dieses Extension Points stellen dem Benutzer die Ablagen clientseitig zur
    Verfügung.</para>

    <para>Serverseitig wird die Ablage über die XML-Konfigurationsdatei vom
    KALYPSO Observation Dienst genutzt. Das Schema dieser Datei ist identisch
    mit dem Schema des Erweiterungspunktes: es werden die
    Implementierungsklassen von IRepositoryFactory eingebunden (siehe
    <filename>schema/repfactories.exsd</filename> im KalypsoRepository
    Projekt).</para>

    <figure id="abb_IRepFac_Konzept">
      <title>Übersicht IRepositoryFactory-Konzept, Unterscheidung Client und
      Server</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/kap4/irepositoryfactory.png" scale="70" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Der gleiche Code wird in Form einer Jar clientseitig und
    serverseitig benutzt. Die Konfigurationen der Repositories weichen jedoch
    voneinander ab, da serverseitig keine Eclipse Workbench-Umgebung zur
    Verfügung steht. Clientseitig erfolgt die Konfiguration über die Datei
    <filename>plugin.xml</filename> und serverseitig über
    <filename>rep_conf.xml</filename> (siehe <xref
    linkend="abb_IRepFac_Konzept" />).</para>

    <para>Mehr Information finden Sie in den jeweiligen Schemata und
    Klassendokumentationen.</para>
  </section>

  <section>
    <title>Dateiablage</title>

    <indexterm>
      <primary>Zeitreihenablage</primary>

      <secondary>dateibasiert</secondary>
    </indexterm>

    <para>Die lokale Dateiablage (FileRepository) arbeitet direkt mit
    Verzeichnisstrukturen und den dort enthaltenen Dateien. Im Grunde ist die
    Verwaltung aller Dateitypen möglich, da das FileRepository nicht
    spezifisch für ZML (Zeitreihen Markup Language, der für KALYPSO speziell
    entwickelten XML <quote>Serialisierung von Observations</quote>)
    implementiert ist.</para>

    <para>Für das FileRepository stehen die folgenden Factories (siehe oben)
    zur Verfügung:</para>

    <orderedlist>
      <listitem>
        <para>die HeadlessZmlRepositoryFactory: wird serverseitig benutzt,
        weil GUI-los (Headless).</para>
      </listitem>

      <listitem>
        <para>die SWTZmlRepositoryFactory: wird clientseitig benutzt und
        erlaubt dem Benutzer die Eingabe der Parameter über einen
        Dialog.</para>
      </listitem>
    </orderedlist>
  </section>

  <!--PROFILING ANFANG sachsen-anhalt-->

  <section vendor="sachsen-anhalt">
    <title>WISKI-Zeitreihenablage</title>

    <indexterm>
      <primary>Zeitreihenablage</primary>

      <secondary>WISKI</secondary>
    </indexterm>

    <para>Zeitreihen aus WISKI werden ebenfalls über den
    IRepository-Mechanismus geliefert und zurückgeschrieben. Die hierarchische
    Struktur ist in WISKI anhand des Gruppensystems vorgegeben. Diese Struktur
    wird Eins zu Eins als Repository in KALYPSO dem Benutzer zur Verfügung
    gestellt. Die <quote>kinderlosen</quote> Knoten dieser Struktur sind
    Zeitreihen.</para>

    <para>Mehr Informationen finden Sie unter <xref linkend="wiski" />.</para>
  </section>

  <!--PROFILING ENDE sachsen-anhalt-->

  <section>
    <title>Virtuelle Ablage</title>

    <indexterm>
      <primary>Zeitreihenablage</primary>

      <secondary>virtuelle Ablage</secondary>
    </indexterm>

    <para>Diese Art von Repository (VirtualRepository) bietet fortgeschrittene
    Möglichkeiten, um synthetische Zeitreihen anhand anderer Zeitreihenablagen
    zu erzeugen. Eine XML - Konfigurationsdatei definiert den Inhalt der
    Ablage. Das Format der XML - Datei ergibt sich aus der XML -
    Schemadefinition
    <filename>etc/schemas/repository/virtualRepository.xsd</filename> im
    Projekt <code><filename>KalypsoCore</filename></code>.</para>

    <para>Anhand von Filtern und bestehenden Repositories (wie <abbrev>z.
    B.</abbrev> dateibasiert oder aus der Zeitreihendatenbank) werden die
    synthetischen Zeitreihen generiert. Die hierarchische Struktur ist frei
    definierbar.</para>

    <!--PROFILING ANFANG sachsen-anhalt,sachsen-->

    <para vendor="sachsen-anhalt;sachsen">Diese Art von Ablage wird im
    Hochwasservorhersagezentrum zur Zeit nicht eingesetzt.<!--PROFILING ENDE sachsen-anhalt, sachsen--></para>
  </section>

  <section>
    <title>Zeitreihendienst</title>

    <indexterm>
      <primary>Zeitreihendienst</primary>
    </indexterm>

    <para>Wie oben beschrieben ist die Konfiguration beliebig vieler client-
    und serverseitiger Repositories möglich.</para>

    <para>KALYPSO unterstützt ein spezielles clientseitiges Repository (das
    Zeitreihendienst-Repository), dessen Inhalt der KALYPSO Zeitreihendienst
    zur Verfügung stellt.</para>

    <para>Innerhalb dieses Repositories sind die serverseitigen oder
    Remote-Repositories abgelegt. Die Remote-Repositories werden in der
    Konfigurationsdatei
    <filename>webdav/srvconf/IObservationService/repconf_server.xml</filename>
    definiert. Das Schema dieser XML-Datei finden Sie unter
    <filename>etc/xmlbinding/repository/repconf.xsd</filename> im
    <code><filename>KalypsoRepository</filename></code> Projekt.</para>

    <para>Der KALYPSO Zeitreihendienst kapselt die Zugriffe über einen
    WebDienst zwischen KALYPSO-Client und -Server. Er liefert die
    serverseitigen Repositories (deren Anzahl ist unbegrenzt) in Form eines
    einzigen Repositories, welches in die KALYPSO Oberfläche eingebunden
    werden kann.</para>

    <para>Theoretisch können alle Repositories lokal eingebunden werden, die
    den Extension Point
    <classname>org.kalypso.repository.factories</classname> erweitern. Dies
    hängt von den in KALYPSO bzw. Eclipse eingebundenen Plugins ab.</para>

    <figure>
      <title>Zeitreihen-Ablage zwischen Client und Server</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="img/kap4/obsService.png" scale="70" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Die serverseitigen Repositories erscheinen auf dem Client unterhalb
    des Zeitreihendienstes, potentiell neben anderen clientseitigen
    Repositories.</para>
  </section>

  <section>
    <title>Filter</title>

    <indexterm>
      <primary>Zeitreihenfilter</primary>
    </indexterm>

    <para>Um die Zeitreihen an die Anforderungen der Modelle anzupassen, wird
    ein sogenannter Filter-Mechanismus in KALYPSO benutzt.</para>

    <para>Die Liste der zu Verfügung stehenden Filter ergibt sich aus der
    XML-Schema-Datei, die unter
    <filename>etc/schemas/zml/zmlFilters.xsd</filename> im KalypsoCore-Projekt
    zu finden ist. Das Java-Interface
    <interfacename>org.kalypso.ogc.sensor.IObservationFilter</interfacename>
    bildet den Einstieg in die Filter-Welt. Das Filter-Interface erweitert das
    IObservation Interface, gefilterte Zeitreihen können also genauso wie
    andere Zeitreihen benutzt werden.</para>
  </section>
</chapter>