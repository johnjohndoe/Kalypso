<?xml version="1.0" encoding="UTF-8"?>
<chapter id="chapter_2_entwicklung">
  <title>Software-Entwicklung</title>

  <indexterm>
    <primary>Software-Entwicklung</primary>
  </indexterm>

  <para>Die Programmoberfläche und die Serverkomponente von KALYPSO wurden
  vollständig in der Programmiersprache Java entwickelt.</para>

  <section id="ide">
    <title>Umgebung und Werkzeuge</title>

    <indexterm>
      <primary>Software-Entwicklung</primary>

      <secondary>Umgebung und Werkzeuge</secondary>
    </indexterm>

    <para>In diesem Kapitel werden die zur Erstellung der Software verwendeten
    Entwicklungswerkzeuge beschrieben (siehe <xref
    linkend="tbl_develop_Entwicklungsumgebung" />). 
    <table
        id="tbl_develop_Entwicklungsumgebung">
        <title>Entwicklungsumgebung</title>

        <tgroup cols="2">
          <colspec align="left" colwidth="1*" />
          <colspec align="left" colwidth="1*" />

          <thead>
            <row>
              <entry align="center">Umgebung/Werkzeug</entry>
              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Java SDK 1.6</entry>
              <entry>Entwicklungs-Kit</entry>
            </row>

            <row>
              <entry>Eclipse Platform 3.4.0</entry>
              <entry>Entwicklungsumgebung und Grundlage für den KALYPSO-Client</entry>
            </row>

            <row>
              <entry>Docbook - Xml 4.2 - Stylesheets 1.65.1</entry>
              <entry>XML-Anwendung für die Erstellung des
              Benutzerhandbuchs</entry>
            </row>

            <row>
              <entry>Tomcat 6.0.18</entry>
              <entry>J2EE Container für die Webdienste</entry>
            </row>

            <row>
              <entry>Miktex 2.2 und DB2Latex 0.8pre1</entry>
              <entry>Konvertierung von DocBook nach LaTeX und anschließend
              nach PDF</entry>
            </row>
          </tbody>
        </tgroup>
      </table></para>

    <para>Als Entwicklungsumgebung wird die frei erhältliche Eclipse
    Plattform verwendet. Die Entwicklungs des Prognosesystems basiert auf dem Open-Source Projekt KalypsoBASE,
    siehe <ulink url="http://kalypsobase.sourceforge.net">http://kalypsobase.sourceforge.net</ulink>.
    Die Konfiguration der Entwicklungsumgebung muss der KalypsoBASE Policy entsprechen.</para>

    <para>Das Erzeugen der verschiedenen Versionen des Anwenderhandbuchs
    (html, EclipseHelp, PDF) wird über in die Entwicklungsumgebung integrierte ANT-Skripte automatisiert. Es
    ist dabei dafür zu sorgen, dass sich das zur Umwandlung von LaTeX noch
    PDF benötigte Programm pdflatex.exe (im Umfang der Miktex-Distribution
    enthalten) im aktuellen Programmpfad befindet sowie dass alle von DB2Latex
    benötigten LaTeX-Packages in der Miktex-Installation eingebunden
    sind.</para>
  </section>

  <section>
    <title>Programmaufbau</title>

    <indexterm>
      <primary>Programmaufbau</primary>
    </indexterm>

    <para>Der Programmaufbau wird in den beiden Teilen - Client und Server -
    beschrieben.</para>

    <section>
      <title>KALYPSO-Client</title>

      <indexterm>
        <primary>Programmaufbau</primary>
        <secondary>Client</secondary>
      </indexterm>

      <para>Clientseitig baut KALYPSO auf der Eclipse Plattform API auf:
      KALYPSO besteht aus einem Eclipse-Feature und einer Reihe von
      Eclipse-Plugins.</para>

	  <para>Das Client-Program ist durch die Eclipse-Produktdefinition 
	  <filename vendor="sachsen">/KalypsoHwvProduct/hwv_sachsen.product</filename>
	  <filename vendor="sachsen-anhalt">/KalypsoHwvProduct/hwv_sachsen_anhalt.product</filename>
	  innerhalb der Programmquellen definiert. Das Produkt listet dabei unter anderem die im Client verwendeten Plug-ins auf.</para>

    </section>

    <section id="kalypso-server">
      <title>KALYPSO-Server</title>

      <indexterm>
        <primary>Programmaufbau</primary>
        <secondary>Server</secondary>
      </indexterm>

	  <para>Serverseitig baut KALYPSO auf der Eclipse Plattform API auf. Diese läuft über die sog. Equinox-Bridge
	  als J2EE-konforme Webapplikation in einem beliebigen J2EE-Container.</para>

	  <para>Über die Equinox-Bridge sind innerhalb der Server-Anwendung verschiedene Dienste angemeldet. Diese lassen sich wie folgt Gruppieren:</para>
      <table id="tbl_server_dienste">
        <title>Kalypso-Services, gruppiert nach logischen Einheiten</title>

        <tgroup cols="2">
          <colspec align="left" colwidth="1*" />
          <colspec align="left" colwidth="1*" />

          <thead>
            <row>
              <entry align="center">Name</entry>
              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>Observation-Service</entry>
              <entry>Zeitreihendienst zum Zugriff auf die Zeitreihendatenbank. Eigenständiges, JAX-WS basiertes Servlet innerhalb 
              der Equinox-Bridge.</entry>
            </row>

            <row>
              <entry>WebProcessingService</entry>
              <entry>WebProcessingService gemäss Spezifikation des OpenGeospatialConsortium (OGC). Eigenständiges Servlet
              innerhalb der Eqinox-Bridge. Dieser Dienst erlaubt die Einbindung
              von sog. Prozessen über eine festgelegt Schnittstelle. Sowohl die Einbindung der Prognosemodelle als auch 
              weitere Kalypso Dienste erfolgen über diese Schnittstelle.</entry>
            </row>

            <row>
              <entry>User-Service</entry>
             <entry>Benutzerdiesnt zum Abruf Prognosesystem-spezifischer Authentifikationsinformationen. Als WPS-Prozess eingebunden.</entry>
            </row>

            <row>
              <entry>Document-Service</entry>
             <entry>Berichtsablage-Dienst zur Ablage von Berichtsdokumenten in einem Informationsmanagementsystem. Als WPS-Prozess eingebunden.</entry>
            </row>

            <row>
              <entry>Raster-Service</entry>
              <entry>Bereitstellung von DWD-Rasterdaten über eine interne Schnittstelle (Abruf vorhandener Einträge, Anwenden Gebietsniederschlagsmodell).
              Als WPS-Prozesse eingebunden.</entry>
            </row>

            <row>
              <entry>Raster-Abruf</entry>
              <entry>Als Kalypso-Cron-Job eingebundener Dienst zum regelmässigen Abruf und Preprocessing von DWD-Rasterdaten.</entry>
            </row>

          </tbody>
        </tgroup>
      </table>	  

    </section>

    <section id="modelle-sst">
      <title>Modellplugins und Schnittstellenkomponenten</title>

      <indexterm>
        <primary>Programmaufbau</primary>
        <secondary>Plugins und Schnittstellen</secondary>
      </indexterm>

      <para><xref linkend="tbl_devlop_spez_Plugins" /> listet die sog.
      Modellplugins und die Schnittstellenkomponenten auf.</para>

      <!--PROFILING ANFANG-->

      <table id="tbl_devlop_spez_Plugins">
        <title>Spezielle Plugins</title>

        <tgroup cols="3">
          <colspec align="left" colwidth="2*" />

          <colspec align="left" colwidth="1*" />

          <colspec align="left" colwidth="3*" />

          <thead>
            <row>
              <entry align="center">Bundle</entry>
              <entry align="center">Typ</entry>
              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

          <tbody>
            <row vendor="sachsen-anhalt">
              <entry>KalypsoModelSaale</entry>
              <entry>Plug-in</entry>
              <entry>Integration des Saalemodells.</entry>
            </row>

            <row vendor="sachsen-anhalt">
              <entry>KalypsoModelTubig</entry>
              <entry>Plug-in</entry>
              <entry>Integration des Bode- und Ilsemodells.</entry>
            </row>

            <row vendor="sachsen-anhalt">
              <entry>KalypsoAdapterRobotron</entry>
              <entry>Plug-in</entry>
              <entry>Implementierung der Schnittstellenfunktionen zum
              IMS-Robotron.</entry>
            </row>

            <row vendor="sachsen-anhalt">
              <entry>KalypsoAdapterWiski</entry>
              <entry>Plug-in</entry>
              <entry>Implementierung der Schnittstellenfunktionen zum
              WiskiDataProvider.</entry>
            </row>

            <row vendor="sachsen">
              <entry>KalypsoModelElbePolte</entry>
              <entry>Plug-in</entry>
              <entry>Integration des Vorhersagemodells für die Elbe und das
              Berechnungsmodells für die Zwischengebietszuflüsse der Elbe.</entry>
            </row>

            <row vendor="sachsen">
              <entry>KalypsoModelWavos</entry>
              <entry>Plug-in</entry>
              <entry>Integration des Vorhersagemodells für die Elbe (WAVOS).</entry>
            </row>

            <row vendor="sachsen">
              <entry>KalypsoModelSpree</entry>
              <entry>Plug-in</entry>
              <entry>Integration der Vorhersagemodelle für die Spree und die
              Schwarze Elster.</entry>
            </row>

            <row vendor="sachsen">
              <entry>KalypsoModelNA</entry>
              <entry>Plug-in</entry>
              <entry>Integration des NA-Modells der TUHH.</entry>
            </row>

            <row vendor="sachsen">
              <entry>KalypsoOptimize</entry>
              <entry>Plug-in</entry>
              <entry>Plug-in zur Kapselung des Optimierungsalgorythmus für das
              Weiße-Elster Modell.</entry>
            </row>

            <row vendor="sachsen">
              <entry>KalypsoAdapterPSICompact</entry>
              <entry>Plug-in</entry>
              <entry>Implementierung der Schnittstellenfunktionen zu
              PSICompact.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <!--PROFILING ENDE-->
    </section>

    <section id="conf">
      <title>Konfigurationsmanagement</title>

      <indexterm>
        <primary>Programmaufbau</primary>
        <secondary>Konfigurationsmanagement</secondary>
      </indexterm>

      <para vendor="sachsen-anhalt">Neben allgemeinen Code Konfigurationen
      werden spezielle Konfigurationseinheiten für die Integration von KALYPSO
      in die Umgebung der Hochwasservorhersagezentrale Sachsen-Anhalt
      benötigt. <xref linkend="tbl_develop_Konfig_Plugins" /> listet diese
      Module auf.</para>

      <para vendor="sachsen">Neben allgemeinen Code Konfigurationen werden
      spezielle Konfigurationseinheiten für die Integration von KALYPSO in die
      Umgebung des Landeshochwasserzentrums Sachsen benötigt. <xref
      linkend="tbl_develop_Konfig_Plugins" /> listet diese Module auf.</para>

      <para><table id="tbl_develop_Konfig_Plugins">
          <title>Konfigurationsmanagement-Plugins</title>

          <tgroup cols="3">
            <colspec align="left" colwidth="2*" />
            <colspec align="left" colwidth="1*" />
            <colspec align="left" colwidth="3*" />

            <thead>
              <row>
                <entry align="center">Bundle</entry>
                <entry align="center">Typ</entry>
                <entry align="center">Beschreibung</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>KalypsoAnt</entry>
                <entry>Library</entry>
                <entry>Bereitstellung von ANT-Tasks für die Integration als
                Jar in KalypsoUI</entry>
              </row>

              <row>
                <entry>KalypsoBuild</entry>
                <entry>Resource</entry>
                <entry>Standard Buildframework von KALYPSO</entry>
              </row>

              <row vendor="sachsen">
                <entry>KalypsoHwvServiceSachsen</entry>
                <entry>Plug-in</entry>
                <entry>LWHZ spezifische Konfiguration des Prognosesystems</entry>
              </row>

              <row vendor="sachsen-anhalt">
                <entry>KalypsoHwvServiceSachsenAnhalt</entry>
                <entry>Resource</entry>
                <entry>HVZ spezifische Konfiguration des Prognosesystems</entry>
              </row>
            </tbody>
          </tgroup>
        </table></para>
    </section>
  </section>

  <section id="source">
    <title>Quellcode</title>

    <indexterm>
      <primary>Quellcode</primary>
      <secondary>Organisation</secondary>
      <tertiary>Lizensierung</tertiary>
    </indexterm>

    <para>Der Quellcode wird mit CVS verwaltet. Bei jedem Meilenstein wurde
    der Projektstand mittels eines CVS Tags gekennzeichnet.</para>

    <para>Der Quellcode ist in verschiedene Projekte unterteilt. Jedes Projekt
    deckt definierte Anforderungen bzw. Funktionen ab und ist mit einer
    Code-Lizenz ausgestattet. Projekte können von anderen Projekten abhängig
    sein und können über sog. Libraries (Code-Bibliotheken) verfügen, die
    jeweils ihre eigene Lizenz besitzen.</para>

    <para>Jedes Projekt enthält eine <filename>readme.txt</filename> Datei,
    welche eine kurze Projektbeschreibung beinhaltet.</para>
    
    <para>Die allgemeinen Teile des KALYPSO-Quellcodes sind unter der LGPL
    (Lesser Gnu Public Licence, siehe <ulink
    url="http://www.gnu.org">http://www.gnu.org</ulink>) freigegeben.</para>

    <para>Fremdbibliotheken wurden in jedem Projekt stets im Unterverzeichnis
    <filename>/lib</filename> abgelegt und sind dort mit der jeweiligen
    Lizenzierung versehen.</para>
    
  </section>

  <section id="compile">
    <title>Kompilation und Deployment</title>

    <indexterm>
      <primary>Kompilation</primary>
      <secondary>Deployment</secondary>
    </indexterm>

	<para>Zur Kompilation und zum Deployment (Zusammenstellung aller Resourcen für die Installation) wird ausschließlich die
	Entwicklungsumgebung Eclipse verwendet. Die ausgelieferten Programmquellen stellen einen Auszug des Arbeitsbereichs
	der Entwicklungsumgebung dar, welcher alle benötigten Daten enthält. Die Kompilierung der Quellen erfolgt nach
	Konfiguration aller KALYPSO-spezifischen Einstellungen gemäss Regeln der Plug-in-Entwickung von Eclipse.</para>

	<para>Das Deployment erfolgt nach erfolgreicher Kompilation wie folgt:</para>
    <itemizedlist>
      <listitem>
        <para>Client: Durch Export des Produkts
        <filename vendor="sachsen">/KalypsoHwvProduct/hwv_sachsen.product</filename>
        <filename vendor="sachsen-anhalt">/KalypsoHwvProduct/hwv_sachsen_anahlt.product</filename>
        wird durch die Entwicklungsumgebung das vollständige, lauffähige Programm erstellt 
        (entspricht <filename>client.zip</filename> und <filename>client_plugins.zip</filename>).</para>
      </listitem>

      <listitem>
        <para>Server: Durch Export des Features
         <filename vendor="sachsen">/KalypsoFeatureSachsen</filename>
         <filename vendor="sachsen-anhalt">KalypsoFeatureSachsenAnhalt</filename>
          werden die für den Betrieb des Servers benötigten Plug-ins zusammengestellt 
          (entspricht <filename>service_plugins.zip</filename>).</para>
      </listitem>
    </itemizedlist>

  </section>
</chapter>