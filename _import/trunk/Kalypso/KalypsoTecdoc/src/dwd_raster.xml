<?xml version="1.0" encoding="UTF-8"?>
<chapter id="rasterdb" vendor="sachsen">
  <title>DWD Rasterdaten</title>

  <indexterm>
    <primary>DWD</primary>
    <secondary>Rasterdaten</secondary>
    <tertiary>Vorhersage</tertiary>
  </indexterm>

   <para>Zur Berücksichtigung rasterbasierter Niederschlagsvorhersagen, wie sie z.B. vom Deutschen Wetterdienst 
   (DWD) zur Verfügung gestellt werden, steht in KALYPSO ein eigenes Modul zum Abruf, zur Aufbereitung und 
   zur Anwendung auf Teileinzugsgebiete zur Verfügung. 
   Darübr hinaus wird das Modul in Kürze um eine Visualisierungskomponente ergänzt werden.</para>
   
   <para>Die Verarbeitung der DWD-Rasterdaten lässt sich schematisch wie in 
   <xref linkend="abb_dwdraster_architecture"></xref> darstellen.</para>    
   
    <figure id="abb_dwdraster_architecture">
       <title>Schematische Darstellung der Komponenten zur Verarbeitung der DWD-Rasterformate</title>
       <mediaobject>
         <imageobject>
    	       <imagedata fileref="img/dwd/architecture.png" />
         </imageobject>
       </mediaobject>
    </figure>
   
   <para>Die gezeigten Komponenten arbeiten dabei wie folgt zusammen:
   		<itemizedlist>
        	<listitem><para>Datenabruf: Der Datenabruf prüft in regelmäßigen Abständen den Dateneingang
        	und Übergibt neu vorliegende Datendateien an den Dateneingang.</para>
        	</listitem>

			<listitem><para>Datenaufbereitung: Die Datenaufbereitung liest die eingegangenen Rasterdaten
			und übergibt diese in einem einheitlichen Datenformat an die Rasterdatenverwaltung.
			Die Rasterdaten werden dabei in ein OGC konformes GIS-Rasterformat (je eine Kachel pro Zeitschritt)
			 umgewandelt, welches sich direkt durch KALYPSO auslesen und darstellen lässt.</para></listitem>

			<listitem><para>Rasterdatenverwaltung: Die Rasterdatenverwaltung speichert die eingegangenen
			Daten nebst Metadaten. Die folgenden Daten werden gespeichert bzw. bereitgestellt:
				<itemizedlist>
					<listitem>Bezeichnung</listitem>
					<listitem>Typ</listitem>
					<listitem>Einheit </listitem>
					<listitem>Zeitraum, Schrittweite</listitem>
					<listitem>Dateneingang</listitem>
					<listitem>Gültigkeit der Daten (‚Verfallsdatum’)</listitem>
					<listitem>Originaldatei</listitem>
					<listitem>Rasterdaten</listitem>
					<listitem>Statusmeldung</listitem>
				</itemizedlist>
			</para></listitem>

			<listitem><para>Schnittstelle ‚Umrechnung Raster auf Gebiet’: Diese Komponente 
			übernimmt die eigentliche Umrechnung der Rasterdaten in teilgebietsbezogene Zeitreihen.
			Über diese Schnittstelle wird seitens KALYSO Client auf die tatsächlichen Daten zugegriffen. 
			Die Abfrage erfolgt über die Teilgebietsgeometrie, die Zuordnung erfolgt über die 
			Lage der einzelnen Rasterzellen zu dieser Geometrie. Der Rückgabewert der Schnittstelle 
			ist die Gebietszeitreihe. Die Schnittstelle wurde als WebProcessingService implementiert.
			</para></listitem>
 
 			<listitem><para>Schnittstelle ‚Visualisierung Rasterdaten’: geplant </para></listitem>
   		</itemizedlist>
   	</para>
   
   <para>Der Dateneingang sowie die Datenaufbereitung sind so modular implementiert, dass das Hinzufügen
   neuer Datenabrufe bzw. neuer Datenformate ohne weiteres möglich ist.</para>
   
   <para><xref linkend="tab_dwdraster_formate"/> zeigt die zur Zeit durch KALYPSO unterstützten Formate.</para>
   
   <table id="tab_dwdraster_formate">
        <title>Unterstützte Rasterformate</title>

        <tgroup cols="2">
          <colspec align="left" colwidth="1*" />
          <colspec align="right" colwidth="1*" />
          <colspec align="left" colwidth="2*" />

          <thead>
            <row>
              <entry align="center">Name</entry>
              <entry align="center">Vorhersagelänge</entry>
              <entry align="center">Bemerkung</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>LM2 (Cosmo-EU)</entry>
              <entry>72 h</entry>
              <entry></entry>
            </row>

            <row>
              <entry>LMK (Cosmo-DE)</entry>
              <entry>48 h</entry>
              <entry></entry>
            </row>

            <row>
              <entry>SNOW3D</entry>
              <entry>72 h</entry>
              <entry>Nur im Winter verfügbar</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
   <section>
     <title>Konfiguration</title>

     <para>Der Dienst wird über System-Properties in der zentralen Serverkonfiguration (config.ini) 
     konfiguriert. <xref linkend="tab_dwdraster_config"/> listet die Konfigurationsparameter auf </para>
     
 	<table id="tab_dwdraster_config">
        <title>Konfigurationsparameter - Rasterdaten</title>

        <tgroup cols="3">
          <colspec align="left" colwidth="1*" />
          <colspec align="left" colwidth="1*" />
          <colspec align="left" colwidth="3*" />

          <thead>
            <row>
              <entry align="center">Parameter</entry>
              <entry align="center">Typ</entry>
              <entry align="center">Beschreibung</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>kalypso.hwv.raster.database.location</entry>
              <entry>Verzeichnispfad (UNC möglich)</entry>
              <entry>Speichertort der prozessierten DWD-Rasterdaten (<quote>Rasterdatenbank</quote>)</entry>
            </row>
            <row>
              <entry>kalypso.hwv.dwd.interval</entry>
              <entry>Zeit (ms)</entry>
              <entry>Abrufintervall der DWD-Rasterdaten</entry>
            </row>
            <row>
              <entry>kalypso.hwv.dwd.source</entry>
              <entry>Verzeichnispfad (UNC möglich)</entry>
              <entry>Quellverzeichnis der DWD-Rasterdaten</entry>
            </row>
            <row>
              <entry>kalypso.hwv.dwd.lmk</entry>
              <entry>Dateimuster</entry>
              <entry>Dateimuster (regulärer Audruck) der LMK-Dateien</entry>
            </row>
            <row>
              <entry>kalypso.hwv.dwd.lm2</entry>
              <entry>Dateimuster</entry>
              <entry>Dateimuster (regulärer Audruck) der LM2-Dateien</entry>
            </row>
            <row>
              <entry>kalypso.hwv.dwd.snow</entry>
              <entry>Dateimuster</entry>
              <entry>Dateimuster (regulärer Audruck) der SNOW-Dateien</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

</chapter>