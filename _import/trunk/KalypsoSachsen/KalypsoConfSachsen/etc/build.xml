<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="KalypsoConfSachsen" default="build-war" basedir="..">

  <!-- Project full path -->
  <property name="project.path" value="${workspace}/KalypsoConfSachsen" />
  <property name="core.path" value="${workspace}/KalypsoCoreServices" />

  <property name="deployable.war" value="kalypso_conf.zip" />

  <property name="service.name" value="KalypsoConf"/>
  
  <property file="${core.path}/etc/ant/build.properties" />
  <property file="${core.path}/etc/ant/tomcat.properties" />
  
  <path id="ant.classpath">
  	<!-- Changes by Marc:
  		- no need for full.classpath
  		- just: CoreServices/lib/build and CoreServices/lib -->
    <!--path refid="full.classpath" /-->
    <fileset dir="${core.path}/lib" includes="*.jar" />
    <fileset dir="${core.path}/lib/build" includes="*.jar" />
  </path>

  <!-- 2. dann allgemeine eigenschaften -->
  <property file="${core.path}/etc/ant/build.properties" />
  <property file="${core.path}/etc/ant/tomcat.properties" />

  <target name="prepare" description="Creates the build directory">
    <echo message="Creating the required directories...." />
    <mkdir dir="${dist}" />
  </target>

  <target name="clean" description="Removes the build directories">
    <delete dir="${dist}" />
  </target>

  <!-- BUILD-WAR -->
  <target name="build-war"
          depends="prepare"
          description="Package everything into a war file"
  >
    <echo message="Packaging the WAR...." />

    <jar jarfile="${dist}/${deployable.war}">
      <fileset dir="${src}" includes="*/**" />
    </jar>
  </target>

  <!-- Build and (re-)deploy service -->
  <taskdef name="deploy"
           classname="org.apache.catalina.ant.DeployTask"
           classpathref="ant.classpath"
  />
  <taskdef name="undeploy"
           classname="org.apache.catalina.ant.UndeployTask"
           classpathref="ant.classpath"
  />
  <taskdef name="list"
           classname="org.apache.catalina.ant.ListTask"
           classpathref="ant.classpath"
  />
  <taskdef name="start"
           classname="org.apache.catalina.ant.StartTask"
           classpathref="ant.classpath"
  />
  <taskdef name="stop"
           classname="org.apache.catalina.ant.StopTask"
           classpathref="ant.classpath"
  />

  <taskdef name="reload"
           classname="org.apache.catalina.ant.ReloadTask"
           classpathref="ant.classpath"
  />
  <taskdef name="remove"
           classname="org.apache.catalina.ant.RemoveTask"
           classpathref="ant.classpath"
  />

  <target name="deploy" description="Deploys a Web application">

    <echo message="Deploying the web application..." />
    <echo message="URL: ${tomcat.manager.url}" />
    <echo message="UNAME: ${tomcat.username}" />
    <echo message="PWD: ${tomcat.password}" />
    <echo message="PATH: /${service.name}" />
    <echo message="WAR: ${war.path}" />

    <deploy url="${tomcat.manager.url}"
            username="${tomcat.username}"
            password="${tomcat.password}"
            path="/${service.name}"
            war="${war.path}"
    />
  </target>

  <target name="undeploy" description="Undeploys a Web application">

    <echo message="Undeploying the web application..." />

    <undeploy url="${tomcat.manager.url}"
              username="${tomcat.username}"
              password="${tomcat.password}"
              path="/${service.name}"
    />
  </target>

  <target name="redeploy" description="Undeploys and deploys a Web aplication">
    <antcall target="undeploy" />
    <antcall target="deploy" />
  </target>

  <target name="list" description="Lists Web applications">
    <echo message="Listing the applications...." />
    <list url="${tomcat.manager.url}"
          username="${tomcat.username}"
          password="${tomcat.password}"
    />
  </target>

  <target name="start" description="Starts a Web application">
    <echo message="Starting the application...." />
    <start url="${tomcat.manager.url}"
           username="${tomcat.username}"
           password="${tomcat.password}"
           path="/${service.name}"
    />
  </target>

  <target name="stop" description="Stops a Web application">
    <echo message="Stopping the application...." />
    <stop url="${tomcat.manager.url}"
          username="${tomcat.username}"
          password="${tomcat.password}"
          path="/${service.name}"
    />
  </target>

</project>
