<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="kalypso-tecdoc" default="all" basedir="..">

  <!-- Source properties -->
  <property name="base.dir" value="d:/user/schlienger/dev/kalypso/workspace/KalypsoConfSachsen/doc/tecdoc" />
  <property name="tecdoc.dir" value="${base.dir}" />
  <property name="build.dir" value="${base.dir}/build"/>
  <property name="build.doc.dir" value="${build.dir}/doc"/>
  <property name="build.pdf.dir" value="${build.dir}/pdf"/>
  <property name="build.html.dir" value="${build.dir}/html"/>
  <property name="build.tex.dir" value="${build.dir}/tex"/>
  <property name="doc.name" value="tecdoc.xml"/>
  <property name="image.dir" value="${tecdoc.dir}/img"/>
  <property name="css.dir" value="${tecdoc.dir}/css"/>
  <property name="xsl.dir" value="${tecdoc.dir}/xsl"/>

  <target name="init">
    <mkdir dir="${build.dir}" />
    <mkdir dir="${build.doc.dir}" />
    <mkdir dir="${build.pdf.dir}" />
    <mkdir dir="${build.html.dir}"/>
    <mkdir dir="${build.tex.dir}"/>
  </target>

  <target name="cleanup" description="cleans generated stuff except deployed stuff">
    <delete>
      <fileset dir="${build.dir}" includes="*/**" />
    </delete>
  </target>
  
  <target name="valid">

    <!--antcall target="xmlvalid">
      <param name="xmlvalid.xml" value="${tecdoc.dir}/${doc.name}"/>
    </antcall-->

  </target>

  <!-- MANUAL (html und pdf) -->
  <target name="html"
          depends="init,valid"
          description="Erzeugt das Handbuch - HTML-Version"
  >

    <antcall target="xslproc">
      <param name="xslproc.out.dir" value="${build.html.dir}" />
      <param name="xslproc.out.name" value="tecdoc.html" />
      <param name="xslproc.xsl" value="${xsl.dir}/manual-html.xsl" />
      <param name="xslproc.xml" value="${tecdoc.dir}/${doc.name}" />
    </antcall>
    
    <copy todir="${build.html.dir}">
      <fileset dir="${css.dir}" includes="*.*"/>
    </copy>

    <mkdir dir="${build.html.dir}/img"/>
    <copy todir="${build.html.dir}/img">
      <fileset dir="${image.dir}" includes="**/*"/>
    </copy>
  </target>

  <target name="pdf" description="Erstellt das Handbuch im PDF Format" depends="init,valid">
    <copy todir="${build.tex.dir}">
      <fileset dir="${tecdoc.dir}"
               casesensitive="no"
               includes="**/*.*"
               excludes="**/CVS/**"
      />
    </copy>

    <antcall target="pdfproc">
      <param name="pdfproc.out.dir" value="${build.pdf.dir}" />
      <param name="pdfproc.out.name" value="tecdoc" />
      <param name="pdfproc.xsl" value="${xsl.dir}/manual-tex.xsl" />
      <param name="pdfproc.xml" value="${tecdoc.dir}/${doc.name}" />
    </antcall>

  </target>

  <target name="xslproc" description="Transformiert ein XML mit einem XSL">
    <!-- Benötigte Parameter: 
  					'xslproc.out.name'  Name der Ausgabedatei
  					'xslproc.out.dir'  Ausgabeverzeichnis
  					'xslproc.xsl
  					'xslproc.xml'
  	-->
    <exec executable="xsltproc.bat" failonerror="true">
      <arg line="-o ${xslproc.out.dir}/${xslproc.out.name} ${xslproc.xsl} ${xslproc.xml}"/>
    </exec>
  </target>

  <target name="pdfproc" description="Erzeugt aus DocBook PDF">
    <!-- Benötigte Parameter: 
  					'pdfproc.out.name'  Name der Ausgabedatei
  					'pdfproc.out.dir'  Ausgabeverzeichnis
  					'pdfproc.xsl		DocBook XSL
  					'pdfproc.xml'		DocBook XML
  					'tex.tmp.dir'		Temporäres Verzeichnis fürs texen
  	-->

    <antcall target="xslproc">
      <param name="xslproc.out.name" value="${pdfproc.out.name}.tex" />
      <param name="xslproc.out.dir" value="${build.tex.dir}" />
      <param name="xslproc.xsl" value="${pdfproc.xsl}" />
      <param name="xslproc.xml" value="${pdfproc.xml}" />
    </antcall>

    <exec executable="pdflatex.exe" dir="${build.tex.dir}">
      <arg value="${pdfproc.out.name}.tex" />
    </exec>

    <exec executable="pdflatex.exe" dir="${build.tex.dir}">
      <arg value="${pdfproc.out.name}.tex" />
    </exec>

    <copy todir="${pdfproc.out.dir}"
          file="${build.tex.dir}/${pdfproc.out.name}.pdf"
    >
    </copy>
  </target>


  <target name="xmlvalid" description="xml validieren">
    <!-- Benötigte Parameter: 'xmlvalid.xml'  
  	-->
    <exec executable="xmllint.bat" failonerror="true">
      <arg line="--valid --postvalid ${xmlvalid.xml}" />
    </exec>
  </target>


  <target name="all" depends="html,pdf"/>
  
</project>