<project default="fake">

	<property name="modell.template.dir" value="${project.dir}/.templates/Modell" />

	<!-- - - - - - - - - - - - - - - - - - 
          target: fake                      nur damit das Projekt nicht schreit
         - - - - - - - - - - - - - - - - - -->
	<target name="fake" />

	<!-- 
		 ================================= 
          target: create			Rechenvariante erzeugen
         ================================= 
    -->
	<target name="create" description="Erzeugt eine Rechenvariante">
		<echo message="Rechenvariante anlegen: ${calc.dir}" />

		<copy file="${project.dir}/modell.gml" tofile="${calc.dir}/calcCase.gml"/>
		<copy file="${project.dir}/.templates/Steuerparameter.gft" tofile="${calc.dir}/Steuerparameter.gft"/>
		<copy file="${project.dir}/.templates/Anfangsvolumen.gtt" tofile="${calc.dir}/Anfangsvolumen.gtt"/>
		<copy file="${project.dir}/.templates/Bodenfeuchten.gtt" tofile="${calc.dir}/Bodenfeuchten.gtt"/>
		<copy file="${project.dir}/.templates/Flusslaufparameter.gtt" tofile="${calc.dir}/Flusslaufparameter.gtt"/>
		<copy file="${project.dir}/.templates/Gesamtansicht.gmt" tofile="${calc.dir}/Gesamtansicht.gmt"/>
	</target>
	
	<!-- 
		 ================================= 
          target: update			Zeitreihen aktualisieren
         ================================= 
    -->
	<target name="update" description="Aktualisiert eine Rechenvariante">
		<echo message="Zeitreihen aktualisieren: ${calc.dir}" />

		<kalypso.gmlProperty gmlURL="${calc.url}/.calculation">
			<property name="startsim" featurepath="" featureProperty="startsimulation" />
			<property name="startforecast" featurepath="" featureProperty="startforecast"/>
			<!-- stopsim = startforecast + 48h -->
			<property name="stopsim" featurepath="" featureProperty="startforecast" dateoffset="48" dateoffsetfield="11"/>

			<property name="scenarioId" featurepath="" featureProperty="scenarioId"/>
		</kalypso.gmlProperty>


		<kalypso.copyObservation gml="${project.url}/.model/observationConf/PegelMessungMapping.gml" featurePath="mappingMember" context="${calc.url}" targetObservation="outObservationLink" forecastFrom="${startforecast}" forecastTo="${stopsim}">
			<source property="inObservationLink" from="${startsim}" to="${startforecast}" filter="&lt;filter&gt;&lt;interpolationFilter xmlns=&quot;filters.zml.kalypso.org&quot; calendarField=&quot;HOUR_OF_DAY&quot; amount=&quot;3&quot; forceFill=&quot;true&quot; defaultValue=&quot;0.0&quot; defaultStatus=&quot;2&quot;/&gt;&lt;/filter&gt;"/>
			<metadata name="Szenario" value="${scenarioId}"/>
		</kalypso.copyObservation>
		
<!--
		<kalypso.copyObservation gml=".model/observationConf/" featurePath="mappingMember" context="${calc.url}" targetObservation="outObservationLink" forecastFrom="${startforecast}" forecastTo="${stopsim}">
			<source property="Niederschlag_gemessen" from="${startsim}" to="${startforecast}"/>
			<source property="Niederschlag_prognose" from="${startforecast}" to="${stopsim}"/>
			<metadata name="Szenario" value="${scenarioId}"/>
		</kalypso.copyObservation>

		<kalypso.copyObservation gml="${calc.url}/calcCase.gml" featurePath="TalsperreCollectionAssociation/TalsperreMember" context="${calc.url}" targetObservation="Abgabe" forecastFrom="${startforecast}" forecastTo="${stopsim}">
			<source property="Abgabe_eingang" from="${startsim}" to="${stopsim}"/>
			<metadata name="Szenario" value="${scenarioId}"/>
		</kalypso.copyObservation>
		
		<kalypso.copyObservation gml="${calc.url}/calcCase.gml" featurePath="VorgabeCollectionAssociation/VorgabeMember" context="${calc.url}" targetObservation="Abfluss" forecastFrom="${startforecast}" forecastTo="${stopsim}">
			<source property="Abfluss_eingang" from="${startsim}" to="${stopsim}"/>
			<metadata name="Szenario" value="${scenarioId}"/>
		</kalypso.copyObservation>
-->		
	</target>
	
	<target name="afterCalc" description="Kopiert die Modelldaten nach der Rechnnung">
		<copy file="${calc.dir}/Ergebnisse/calcCase.gml" tofile="${calc.dir}/calcCase.gml" overwrite="true"/>
	</target>
</project>