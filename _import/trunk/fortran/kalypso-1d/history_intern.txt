Version 273 xx.6.2004
---------------------
- Bordvollberechnung stationär-ungleichförmig: die Fehlerhafte Ausgabe der Längsschnitte bei
  Berechnungen von mehr als 53 Profilen wurde korrigiert

Version 274 20.7.2004
---------------------
- Bordvollberechnung stationär-ungleichförmig:
	- Eingabeparameter (qmax, qmin, qstep) werden beim Einlesen wieder auf die Konsole ausgegeben
	- die Dateien für die W/Q Beziehung bzw. die einzelnen WSP-Berechnungen werden jetzt mit
        ausreichend Stellen benamt, so dass
         a) Abflüsse > 1000 m3 möglich sind und
         b) keine Dateien mehr gleich benamt werden

Kalypso 0.9.2  28.07.2004
-------------------------
- Umwandlung des codes in FORTRAN90
- Test-Projekt Will_pad funktioniert noch einwandfrei!

Kalypso 0.9.3  28.07.2004
-------------------------
Behebung folgender Übergabefehler:
"P:\Software\KALYPSO-1D\Vers_0.9.2\source\AnWSP.f90", line 480: warning: anf-kopf:  the type of the argument 6 is different (dummy Character*1 actual Integer*4)
"P:\Software\KALYPSO-1D\Vers_0.9.2\source\intda.f90", line 509: warning: intdat-ju0chr:  the number of arguments is different (dummy arguments 8 actual arguments 7)
"P:\Software\KALYPSO-1D\Vers_0.9.2\source\SaWSP.f90", line 312: warning: select-ju0chr:  the rank of the argument 2 is different (dummy argument 1 actual argument 0)
"P:\Software\KALYPSO-1D\Vers_0.9.2\source\SaWSP.f90", line 312: warning: select-ju0chr:  the rank of the argument 6 is different (dummy argument 1 actual argument 0)
"P:\Software\KALYPSO-1D\Vers_0.9.2\source\SoWSP.f90", line 913: warning: sorprof-sortrc:  the rank of the argument 5 is different (dummy argument 2 actual argument 1)
"P:\Software\KALYPSO-1D\Vers_0.9.2\source\SoWSP.f90", line 913: warning: sorprof-sortrc:  the rank of the argument 7 is different (dummy argument 2 actual argument 1)

Behebung einer Reihe von FORTRAN-Standard Verletzungen mit Hilfe des Visual Analysers.



Kalypso 1.0  12.08.2004
-------------------------
Das Programm KALYPSO-1D und alle seine Subroutinen wurden unter die
GNU Lesser General Public License gestellt und sind damit offene Codes!

Aufgrund eines Problems mit einer Brückenberechnung (Scholz -> Polenz, km 6.188) wurden
folgende Subroutinen kontrolliert und in eine übersichtlichere Form gebracht:
- abfluss
- br_konv
- geomet
- normber
- wspber
- xverwsp1
- xverwsp2
Verschiedenen Testrechnungen zeigen, dass es nicht möglich ist, bei einer Brückenberechnung eine
Überströmung des Vorlandes mit zu berücksichtigen! Auch wenn im WSPWin-Editor der Wasserspiegel
über das gesamte Profil eingezeichnet wird, steht intern nur der Abschnitt der Brücke für den
Abfluss zur Verfügung.



Kalypso 1.0.1 19.10.2004
------------------------
Fehler beim Lesen der Kommentarzeile (Subroutine READCOMMENT in proep.f90)
in Profildateien wurde behoben. Fehler ist aufgetreten bei deutschen Sonderzeichen, 
die FORTRAN nicht lesen kann. Durch Verwendung von IOSTAT in READ-Befehl konnte
dieser abgefangen werden.
                                            Wolf Plöger 19.10.2004

Kalypso 1.0.2 13.01.2005
------------------------
Es trat ein Fehler auf, wenn ein Kreisprofil und gleichzeitig eine
Oberkante Brücke angegeben wurde, so wie in Dokumentation von WSPWin 8.0
für KNAUF-Kern beschrieben. PASCHE-Kern kann diese Kombination nicht!
Trotzdem wurde nocheinmal das Einlesen der Kreisprofile in SUB PROE_PRO
angepasst: In Zeile 536 wurde das Erhöhen von NN bei Sonderprofilen
gelöscht, da dies schon global in Zeile 518 passiert. Demnach sind die 
Änderungen von DK hier nicht sinnvoll!
Zusätzlich wurden der Code in einigen Subroutinen dem FORTRAN90-Standard
angepasst.

                                            Wolf Plöger 13.01.2005

Kalypso 1.0.3 02.02.2005
------------------------
Bisher konnten maximal 200 Profile mit Kalypso-1D gerechnet werden.

Im Code waren in verschiedenen Stellen diverse PARAMETER-Definitionen zu der
maximalen Profilzahl (MAXGER). Zusätzlich wurden weitere Parameter jeweils
in verschiedenen Subroutinen definiert, und auch mit sich widersprechenden
Namen versehen.

Jetzt Einführung von drei verschiedenen Modulen, die jeweils verschiedene
Parameter global verfügbar machen:

MODULE dim_variablen   (Dimensionierung von Arrays, wie max. Profilanzahl
                        und max. Abflussereignisse...)
MODULE konstanten      (globale Konstanten wie g, rho, nue,...)
MODULE bewuchs         (Parameter für die Berechnung von Bewuchs)

Diese Module sind in einer neuen FORTRAN90 Datei abgelegt: 
 
   source/globale_definitionen.f90

Falls nun weitere Änderungen an der Dimensionierung der Felder notwendig sind,
brauchen nur die entsprechenden Parameter in dieser Datei geändert werden!
In allen anderen SUBROUTINEN muss nichts mehr geändert werden!!!!

Im Zuge dieser Änderung wurde in diversen SUBROUTINEN je nach Notwendigkeit
der Aufruf

USE DIM_VARIABLEN
USE KONSTANTEN
USE BEWUCHS

noch vor den eigentlichen Variablendeklarationen eingefügt.

Aktuelle Werte in DIM_VARIABLEN:

INTEGER, parameter :: nch80 = 80       ! Max. Laenge von Zeichenketten, z.B. Dateinamen
INTEGER, parameter :: merg = 10        ! Max. Anzahl von Abflussereignissen
INTEGER, parameter :: maxkla = 200     ! Max. Anzahl von Punkten pro Profil
INTEGER, parameter :: maxger = 1000    ! Max. Anzahl von Profilen
INTEGER, parameter :: ipro = 16        ! Max. Anzahl von Bloecken in Profildatei (? WP)
INTEGER, parameter :: itmax = 99       ! Max. Anzahl von Iterationen in versch. Subroutinen
INTEGER, parameter :: maxw = 50        ! Max. Anzahl von Wehrfeldern
INTEGER, parameter :: mpts = 200       ! ?? WP wahrscheinlich = maxkla
INTEGER, parameter :: max2 = 10        ! ?? WP wird nur in wenigen SUBs verwendet
INTEGER, parameter :: min2 =100        ! ?? WP wird nur in wenigen SUBs verwendet

INTEGER, parameter :: idim = 200       ! ?? WP wird nur in wenigen SUBs verwendet
INTEGER, parameter :: idim4 = 20       ! ?? WP wird nur in wenigen SUBs verwendet
INTEGER, parameter :: idim2 = 16       ! ?? WP wird nur in wenigen SUBs verwendet


                                            Wolf Plöger 02.02.2005



Kalypso 1.0.4 28.02.2005
------------------------
Als Kennung fuer den Block mit den Rauhigkeitswerten ist jetzt neben
'RAUHIGKEIT' auch 'RAUHEIT' erlaubt. Aenderungen nur an zwei Stellen in
INTDAT.F90.
(Problem ist aufgetreten, weil der WSPWIN Mapper beim Einlesen des Triple-Formats
nur die Kennung 'RAUHEIT KS' erlaubt. Somit werden durch den Mapper teilweise
Profildateien erzeugt, die statt RAUHIGKEIT die Kennung RAUHEIT aufweisen.)

                                            Wolf Plöger 28.02.2005

Kalypso 1.0.5  April 2005
-------------------------
Einige Änderungen in der Programmstruktur:

1.) Anlegen von zwei MODULEN in "globale_definitionen.f90":
    - MODULE Zeit    (beinhaltet die Variablen für die aktuelle Zeit)
    - MODULE Version (beinhaltet die Versionsnummer, muss dann nur noch 
                      hier geändert werden)

2.) Anlegen einer neuen Datei für globale Funktionen "globale_funktionen.f90":
    - MODULE GET_LAMBDA (berechnet den Lambdabeiwert nach COLEBROOK-White)

3.) Überall wo im Code der Fließwiderstand LAMBDA berechnet wurde, wird nun die
    globale Funktion GET_LAMBDA aufgerufen! Änderungen an mehreren Stellen, insbesondere
    in "SoWSP.f90", "Abfluss.f90" und "lindy.f90".

4.) In der Subroutine WHEN in "when.f90" wird nun nur noch die Standard FORTRAN90-Routine
    DATE_AND_TIME verwendet. Hier werden die Variablen für das MODULE Zeit belegt.
    Andere Subroutinen zur Zeitbestimmung sind nicht mehr erforderlich.
    Subroutine ZU0SDT komplett gelöscht.

5.) Minimale Änderungen in Subroutine ERFOUD ("erfro.f90"). Anpassung an F90-Standard.

6.) In "X_wsp.f90" die Vergabe der Versionsnummer geändert (siehe Punkt 1.)

7.) Im gesamten Code wurde der Aufruf von NBLANK() durch die Standard F90 Routine LEN_TRIM()
    ersetzt.

8.) Erweiterung des Codes, so dass im DATH-Ordner die Datei "laengsschnitt.txt" erzeugt wird.
    Diese beinhaltet den gleichen Längsschnitt, wie die standardmäßig ausgegebenen WSPWin-Datei,
    allerdings in einer einfachen Tabellenform, die leicht in EXCEL importiert werden kann!
    
    - Erweiterung in "WSPbr.f90" so dass ein Pfad- und Dateiname bezogen auf den Projektordner
      für "laengsschnitt.txt" erzeugt wird.
    - Dieser wird in "lapro.f90" eingesetzt.
    - "QaWSP.f90", wo LAPRO1 aufgerufen wird, wird entsprechend geändert und Variable definiert.
    - "lapro.f90" wird entsprechend geändert, und der Aufruf von ZEILA geändert.
    - in "Z_WSP.f90" wird die Subroutine ZEILA erweitert, so dass die Datei "laengsschnitt.txt"
      als Tabellenausdruck ausgegeben wird.

9.) Weitere Änderung der Subroutine PROE_PRO (siehe Version 1.0.1). Jetzt können auch Kommentare 
    mit mehr als einer Zeile verarbeitet werden, wenn Sie nicht am Ende der Profildatei stehen.
    Entscheidend ist hierbei die Zeile nach den beiden Beschreibungstextzeilen BETE1 und BETE12. In
    dieser Zeile steht normalerweise 9 mal die Null. Nur wenn ein Sonderprofil vorliegt, variiert
    die letzte Zahl dieser Zeile (im Code NSYMB(j), z.B. NSYMB(j) = 7 für Kreisprofil oder
    NSYMB(j) = 17 für Kommentar). Für alle Sonderprofile muss offenbar der Beschreibungstext BETE12
    wiederholt eingelesen werden???? Bei dem Kommentarblock darf dies aber nicht geschehen!

10.) Die Übergabe der Variablen in Subroutine PASCHE wurde mit INTENT-Argumenten versehen, um
     die Wartbarkeit des Codes zu verbessern.

11.) In Subroutine SOHLEF wurden die Variablen L_TR(1) und L_TR(2) mit 0.0 initialisiert. Nun ist
     auch das Compilieren des Codes mit vollen Checks (-CHK und _STCHK) möglich!

12.) Einrückungen und Strukturverbesserungen in Subroutine LINDY, allerdings ohne Berechnungen
     zu verändern.

13.) Einrückungen und Strukturverbesserungen in Subroutine EB2KS, allerdings ohne Berechnungen
     zu verändern.

                                              Wolf Plöger, 21.04.2005



Kalypso 1.0.6  02.05.2005
-----------------------------
A C H T U N G:  In der Vorgängerversion 1.0.5 haben sich zwei kleine Bugs eingeschlichen, 
deshalb bitte ab sofort nur noch die Version 1.0.6 benutzen!

A C H T U N G:  Durch die erhöhte Genauigkeit kann die Berechnung teils deutlich
länger dauern. Auch die Ergebnisse können teilweise leicht von den Ergebnissen
der Vorgängerversionen abweichen!

Es wurden wiederum einige strategische Veränderungen vorgenommen. Insbesondere die
Abbildung von komplizierten oder iterativen Formeln in einzelne gekapselte Funktionen
wurde weiter vorangetrieben.


1.)  Nun liegen folgende Funktionen für globale Anwendung vor:
     - GET_LAMBDA   Je nach Reynoldszahl iterative Berechnung von lambda 
     - GET_CW_UN    Berechnung des CW-Wertes eine einzeln stehenden Zylinders
     - GET_A_NL     Berechnung der Nachlauflänge
     - GET_A_NB     Berechnung der Nachlaufbreite
     - GET_OMEGA    Berechnung des Bewuchsparameters
     - GET_CT       Berechnung des Bewuchsparameters
     - GET_REL_V_AN Berechnung der relativen Anströmgeschwindigkeit

     Durch die Anwendung dieser Funktionen wird der Code der Subroutinen PASCHE und LINDY
     deutlich übersichtlicher. Die iterativen Berechnungen haben nun eine höhere Genauigkeit.

2.)  Überarbeitung der Subroutine POSIT, da hier ein Fehler aufgetreten ist. Durch Anpassung an
     FORTRAN90-Standard wird dieser behoben.

3.)  Umbenennung der Kontrolldatei von "Kontroll" nach "Kontroll.log". Allerdings gilt das nur
     für die normale Berechnung. Bei BORDVOLL-Berechnungen wird eine weitere Kontrolldatei, die
     auch "Kontroll" heißt, angelegt. Es werden in WSP und QBORDV die gleichen UNIT-Bezeichner
     und Variablen verwendet. Das ganze ist sehr verwirrend, deshalb in QBORDV erstmal keine
     Änderung.

4.)  Änderung der Ausgabe in der MS-DOS Box. Statt der Uhrzeit, des Datums und der Versionsnummer
     erscheint nun das aktuell berechnete Profil.

5.)  Anpassung der Subroutine WSP_OPEN, da es hier zu einem Konflikt bei der Variablenübergabe
     zu WHEN gekommen ist.

6.)  In Subroutine ABFLUSS zur Berechnung des Brückenabflusses wurde der Anfangswert für den
     Fließwiderstand LAMBDA initialisiert und die iterative Berechnung von LAMBDA mit dem
     letzten berechneten Wert relaxiert. Dadurch verbesserte Konvergenzeigenschaften bei der
     Brückenberechnung.

7.)  Einige Dateinamen wurden geändert! Verwirrende und abgekürzte Bezeichnungen wurden nun 
     ersetzt durch den vollständigen Namen der in der Datei enthaltenen Subroutine(n).
     Die Subroutine MAEAND bekommt ebenso wie PROE_PRO eine eigene Datei.

                                                Wolf Plöger 02.05.2005


Kalypso 1.0.7  11.05.2005
-----------------------------
1.) Bei der Bordvollberechnung werden die beiden Dateien *.qb1 und *.qb2 wieder ausgegeben (dies
    war ein Bug seit Version 1.0.5).
    Problem war hierbei, dass der Ausgabedatei "laengsschnitt.txt" in ZEILA eine feste Fortran-Unit
    zugewiesen wurde und somit eventuell in Konflikt mit anderen Dateien stand. Diese UNIT-Nr. wird 
    nun über die Funktion JU0GFU bestimmt.

2.) Nochmalige deutliche Bereinigungsarbeiten im Code (und nimmt kein Ende...). Anpassungen diverser 
    Art an den FORTRAN90-Standard. Ich weiß, hier sollte etwas Detaillierteres stehen. Aber es sind
    sooooo viele Kleinigkeiten .....

3.) Explizite Definition aller Variablen in den COMMON-Blöcken in den Subroutinen:
    - ZEILA
    - LAPRO1
    - WSPBER
    - QBORDV

4.) Problem in POSIT umgangen. Bei der Brückenberechnung wird in verschiedenen geschachtelten Routinen
    zunächst ein Polygonzug zusammengebaut (z.B. linke Uferlinie über alle Sohlpunkte bis rechte Uferlinie
    und als Wasserspiegel wieder zurück). Dieser wird dann geprüft, ob weitere Punkte hinzugefügt werden
    sollen. Hierbei ist mir unklar, warum das überhaupt gemacht wird, vielleicht ein Relikt aus alten Zeiten?
    Auf jeden Fall gab es ein Problem, wenn der Wasserspiegel die Böschung so schneidet, dass der nächste
    definierte Sohlpunkt sehr nah war (Abstand < 1 mm). Dann wurde über die Subroutine HEREI versucht, dort
    ein Punkt einzufügen, wo die Punte ehe schon sehr dicht waren. Dieses Einfügen habe ich in POSIT komplett
    deaktiviert.

                                                Wolf Plöger 11.05.2005


Kalypso 1.0.8  Mai.05.2005
-----------------------------
1.)  Löschen des COMMON-Blocks / IMP / , da er nur im WSP-Hauptprogramm verwendet wird.

2.)  Deklarierung aller COMMON-Blöcke im Hauptprogramm WSP. Aufräumen von WSP.

3.)  Wenn KALYPSO-1D über WSPWin gestartet wird, wird in die Startdatei BAT.001 (die nach Ablauf
     des Programms wieder gelöscht wird) immer ein 'j' in die erste Zeile geschrieben. Dies soll
     markieren, dass die Eingabe über Masken erfolgt. Dies trifft immer zu! Eine andere Möglichkeit
     wird nicht weiter gepflegt. Deshalb kann im Hauptprogramm die Abfrage IF antwort=='j' entfallen
     und die Subroutine SELECT wird nie wieder aufgerufen. Auch die Subrotine SUN_BEF wird nie wieder
     erreicht und wird somit ebenfalls komplett gelöscht.
     Damit werden auch SORPROF und SORTRC überflüssig, da nur von SELECT aufgerufen.
     -> Subroutine SELECT gelöscht!
     -> Subroutine SUN_BEF gelöscht!
     -> Subroutine SORPROF gelöscht!
     -> Subroutine SORTRC gelöscht!

     SOHLEF bekommt damit eigene Datei mit dem Namen SOHLEF.F90.

4.)  Variable YMAX in allen COMMON-Blöcken / HEADER / wird gelöscht, da nie verwendet!

5.)  Löschen des COMMON-Blocks stoerpro1 und der dazu gehörenden Variablen. Wurde in PROE_PRO belegt,
     aber nie verwendet.

6.)  Löschen der Subroutine GENKEIT und der Datei genkeit.f90 -> Wurde nie verwendet!

7.)  Löschen des COMMON-Blocks verdacht in geomet, wurde außerhalb von geomet nie verwendet.

8.)  Löschen des COMMON-Blocks mae in pasche, wurde sowohl in als auch außerhalb von pasche 
     nie verwendet.

9.)  Löschen des COMMON-Blocks werte in proe_pro, wurde sowohl in als auch außerhalb von 
     proe_pro nie verwendet.

10.) Löschen des COMMON-Blocks bzh1 in proe_pro, wurde sowohl in als auch außerhalb von 
     proe_pro nie verwendet.

11.) In die Subroutine NEWTON wurde die Variable IKENN übergeben, dort aber nie verwendet! Deshalb
     wird IKENN aus der Übergabeliste in NEWTON entfernt.

12.) Löschen des COMMON-Blocks peg in newton, wurde hier nie verwendet.

13.) Anpassung der Subroutine NEWTON an den FORTRAN90-Standard.

14.) Löschen der Datei GETCWD.F90 inclusive der darin enthaltenen Subroutine. Wird nicht mehr benötigt!
     -> Subroutine GETCWD gelöscht!

15.) Änderung der Versionsausgabe im Hauptprogramm WSP. Deshalb werden XVERSWSP1 und 2 überflüssig.
     -> Datei X_WSP.F90 wird gelöscht.

16.) Löschen des COMMON-Blocks GRNZ_GEN, Übernahme der Variablen GRENZ_IT und GRNZ_SCH in Modul
     DIM_VARIABLEN in GLOBALE_DEFINITIONEN.F90. Änderung in LESDATIN.F90 und GRNZH.F90.

17.) Löschen von LESDATIN.F90. Keine Verwendung mehr. Alternative Dateineingabe wird nicht weiter verfolgt.
     -> Subroutine LESDATIN gelöscht!

18.) Neues Modul in GLOBALE_DEFINITIONEN.F90: STEUERUNG_BERECHNUNG. Dort wird eingetragen: GENAUDRU, ehemals
     im COMMON-Block GENAU. Löschen des COMMON-Blocks GENAU.

19.) Ersetzen der Fehlerdokumentation in WSPBER und LU0EOF, damit wird U0ERPR überflüssig und komplett
     gelöscht. Damit werden auch die Subroutinen LNBLNK, PERROR und ABORT überflüssig.
     -> Subroutine U0ERPR gelöscht!
     -> Subroutine LNBLNK gelöscht!
     -> Subroutine PERROR gelöscht!
     -> Subroutine ABORT gelöscht!

20.) Subroutine LU0EOF wird nicht mehr verwendet und wird komplett gelöscht.
     -> Subroutine LU0EOF gelöscht!

21.) Die Variable IMETH = 2 (im Hauptprogramm definiert) wurde an QBORDV und WSPBER weitergegeben, dort 
     allerdings nie verwendet! Deshalb wurde diese Variable aus WSP, QBORDV und WSPBER komplett gelöscht.

22.) Aufraeumen des Hauptprgramms WSP.

23.) Ersetzen der Funktion JU0NCH im gesamten Code durch die Standard F90-Routine LEN_TRIM.
     -> Subroutine JU0NCH gelöscht!

24.) Ersetzen der Bildschirmausgabe durch normale WRITE Befehle, damit wird die Subroutine U0TNOA
     überflüssig und wird komplett gelöscht!
     -> Subroutine U0TNOA gelöscht!

25.) Die Datei U_WSP.F90 wird aufgelöst und durch die Dateien UF.F90, UCASE.F90 und U0LJST.F90 ersetzt.
     Diese enthalten nun nur noch die entsprechenden Subroutinen.

26.) Die Subroutine U0LJST im gesamten Code durch die Standard F90-Funktion ADJUSTL() ersetzt und dann gelöscht.
     -> Subroutine U0LJST gelöscht!

Insgesamt wurden 15 Subroutinen und 1269 Codezeilen gelöscht!

                                                    Wolf Plöger, 25.05.2005


Kalypso 1.0.9  Mai.05.2005
-----------------------------
1.)  Deklarierung aller Charactervariablen mit einer Länge von 80 Zeichen über die Anweisung (LEN=nch80). 
     Die Variable nch80 wird im Modul DIM_VARIABLEN gesetzt. Somit steht  E I N E  globale Variable für
     die maximale Länge von Charactervariablen, die Pfadangaben bearbeiten, zur Verfügung.
     Die Variable wurde auf 250 gesetzt. Diese Erhöhung der maximalen Zeichenlänge funktioniert nun auf
     FORTRAN-Seite, allerdings kann die Oberfläche WSPWin 8.0.3 diese langen Dateinamen noch nicht bearbeiten.

2.)  Weitere Arbeiten am Code: Deklarierung von Common-Blöcken usw.

3.)  Lambda-Beiwert an Brücken wird wieder mit (4.4 / Re_br * lambda_br) statt mit standard lambda-Formel
     berechnet (Subroutine Abfluss).

                                                    Wolf Plöger, 30.05.2005

Kalypso 1.0.10   Juli 2005
--------------------------
1.)  Löschen der Dokumentationssubroutinen WSP_DOKU und WSP_OPEN. Dabei auch Löschen des COMMON-Blocks
     SUBVERJA und der darin definierten Variablen in den Routinen WSP, WSPANF, WSPBER, GRENZH.

2.)  Bug-Fix bei der Lambdawert Berechnung für kleine Wassertiefen in GET_LAMBDA.

3.)  Die Funktion "borda" wurde umbenannt nach GET_BORDA und in die Datei "globale_funktionen.f90"
     verschoben.

4.)  Einführung des Formbeiwertes nach MARCHI (BWK, Merkblatt 1, 1999, S. 20). Hierbei Erweiterung der 
     Common-Blöcke PROFHR ( formbeiwert(maxkla) ) und ERG ( fbwp(maxger, maxkla) ). Zuweisung des
     Formbeiwertes geschieht in UF über die Funktion GET_FORM (globale_funktionen.f90), wird dann 
     in EB2KS bzw. QKS an PASCHE bzw. SOHLEF direkt übergeben und schließlich in GET_LAMBDA verwendet.

5.)  Änderung des Formates der Tabellenausgabe. Formbeiwert wird mit ausgegeben.

6.)  Löschen des Parameters GENAUDRU und des Modules STEUERUNG_AUSGABE. In KOPF und DRUCKTAB wird
     nur noch ein (neues) Format unterstützt!

7.)  Die COMMON-Blöcke ZEI1 - ZEI5 werden nur in LAPRO1 und ZEILA verwendet. Sie werden ersetzt durch
     das globale Modul AUSGABE_LAENGS.

8.)  Das Modul AUSGABE_LAENGS bekommt alle Werte, die zur Ausgabe des Laengsschnittes notwendig sind.
     Zusätzlich zu den in ZEI1-ZEI5 definierten Variablen kommen noch die Variablen Fließgeschwindigkeit, 
     Querschnitt, Widerstandsbeiwert und Spiegelbreite für die Teilabschnitte hinzu. Auch die Stationierung,
     Bordvollhoehe (links, rechts, Minimum) und Sohlschubspannung (im Flussschlauch) werden mit aufgenommen.

9.)  In ZEILA wird zusätzlich die Sohlschubspannung für den Flussschlauch berechnet:

       tau = lambda_fl/8 * rho * v_fl^2

     Dieser Wert wird im Modul AUSGABE_LAENGS abgelegt und in Laengsschnitt.txt ausgegeben.

10.) Überarbeitung der Ausgabedatei LAENGSSCHNITT.TXT. 

                                                    Wolf Plöger, 13.07.2005

Kalypso 1.0.11  Juli 2005
-------------------------
1.)  Einführung einer Subroutine um einen außerplanmäßigen Programmabruch
     zu steuern bzw. um während der Programmausführung USER-Interaktion
     zu ermöglichen.
     Durch den Aufruf von STOP_PROGRAMM(zahl) wird in Abhängigkeit von Zahl
     über die Subroutine CHECK_DIALOG() eine Warnung in Form eines POP-Up 
     Fensters ausgegeben. Z.B. wird der Benutzer bei einer fehlerhaften Eingabe
     der Wehrgeometrie gefragt, ob das Programm beendet oder mit einer Annahme 
     (z.B. Wehre nicht mitrechnen) weiter ausgeführt werden sollen.
     Soll das Programm wirklich beendet werden, wird die Subroutine CLOSE_UNITS()
     aufgerufen, die alle offenen Units schließt und somit einen ordnungsgemäßen
     Programmabbruch vorbereitet.
     Erst nachdem diese Subroutine alle offenen Units geschlossen hat, wird
     über den STOP-Befehl das Programm beendet.

     => vier neue Dateien:   stop_programm.f90
                             check_dialog.f90
                             close_units.f90
                             winter.f90          (Source für WiSK)

     PS: Die Ausgabe des Pop-up Fensters wird über die Bilbliotheken des
         Winteracter Starter Kits von Lahey realisiert. Der Text der Fehlerausgabe
         wird in die Datei RESOURCE.RC eingegeben.

     PS: Durch die Benutzung des Winteracter Starter Kits haben sich auch die
         Compileroptionen in der AUTOMAKE.FIG geändert!

2.)  Überarbeitung der Subroutine WSPANF.

3.)  Überarbeitung der Subroutine INTDAT.

                                                    Wolf Plöger, 19.07.2005

Kalypso 1.0.12  August 2005
---------------------------
1.)  Überarbeitung der Subroutine GRNZH. Dabei Löschen des Übergabeparameters ifgrnz,
     da in nie verwendet.

2.)  Ändern der Funktionsaufrufe MAX0 und MIN0 in MAX und MIN im gesamten Code.

3.)  Überarbeitung der Subroutine SCHNPKT.

4.)  Überarbeitung der Subroutine BR_KONV. Löschen des Übergabeparameters STATN, 
     da nie verwendet.
     Es ist ein Problem aufgetreten, wenn es bei der Brückenberechnung Senken
     auf dem Vorland gibt.
     Am Anfang der Brückenberechnung wird einmal die Normalberechnung ohne Brücke
     an diesem Profl durchgeführt. Dabei wurden aber schon die Profilparameter
     x1(i), h1(i) und s(i) falsch verändert. Die Schnittpunkte der Wasserspiegellinie
     konnten deswegen in UF nicht richtig bestimmt werden. Daher kam es zu 
     unvorhergesehenen Programmabstürzen bei der Grenztiefenberechnung.
     -> Senken müssen entfernt werden.

     (getestet, aber nicht erfolgreich: Bevor jetzt in BR_KONV die Subroutine NORMBER 
     aufgerufen wird, werden zunächst die originalen Werte von x1(i), h1(i) 
     und s(i) zurückgeladen. Achtung: Es tritt weiterhinein Problem auf, wenn die 
     Senke ganz am linken äußeren Rand des Profils liegt. Diese Senke sollte 
     zunächst durch Anheben des Punktes entfernt werden. -> hier gibt es noch einiges ToDo!)

5.)  Überarbeitung der Subroutine PROBV1. Löschen der Übergabeparameter ST_O, ST_U
     und QVAR da nie verwendet.

6.)  Überarbeitung der Subroutine BOVOG1.

7.)  Löschen des Parameters ANTWORT aus den Übergabelisten an WSPBER und QBORV, da
     in WSP immer ANTWORT='n' gesetzt wurde. Andere Varianten werden nicht mehr
     unterstützt!
     -> Dadurch können eine Vielzahl von Codezeilen in QBORDV und WSPBER entfallen!
     -> Anpassungen in QBORDV, LAPRO, WSPBER und ZEILA.

8.)  Neuer COMMON-Block dateiname_prof, in der in einem Array alle absoluten
     Profildateinamen abgelegt werden. Wird in WSPBER belegt und in SCHREIB_ERG_STAT_UNGLF
     verwendet um die *.km Dateien zu erzeugen.

9.)  Neue Subroutine SCHREIB_ERG_STAT_UNGLF: Hier werden die berechneten Werte der
     stationär-ungleichförmigen Berechnung ausgegeben, wenn KM-Parameter berechnet
     werden sollen.
     Für jede Profildatei (*.prf im PROF-Ordner) wird eine entsprechende *.km-Datei
     erzeugt mit folgendem Syntax:

       0.0000  Station [km]
    NR         WSP          QQ        QVOR          FB        FVOR          BB        BVOR       I_WSP
     1       1.150      10.000       0.000      12.827       0.000      12.301       0.000  0.00050236
     2       1.451      15.000       0.000      16.617       0.000      12.902       0.000  0.00050199
    
     In der ersten Zeile steht die Station (F12.4) in Kilometer. Dann folgt eine 
     Tabelle mit einer W-Q Beziehung für dieses Profil. Es wird unterschieden 
     in Flussschlauch (zwischen den Trennflächen) und Vorland. Es werden ausgegeben:
     - Wasserspiegelhöhe (WSP)
     - Abfluss Hauptgerinne (QQ)
     - Abfluss Vorland (QVOR)
     - Fließquerschnitt Hauptgerinne (FB)
     - Fließquerschnitt Vorland (FVOR)
     - Breite des Wasserspiegels Hauptgerinne (BB)
     - Breite des Wasserspiegels Vorland (BVOR) 
     - Wasserspiegelgefälle (I_WSP)
     Hierbei wird das Gefaelle an einer Station aus dem Wasserspiegelunterschied
     zwischen aktuellem und unterwasserseitigem Profil berechnet. Nur beim ersten
     (Unterwasser-) Profil wird der Wasserstand des zweiten (oberwasserseitigen) 
     Profils verwendet.

                                                    Wolf Plöger, 02.09.2005

Kalypso 1.0.13  September 2005
------------------------------
1.)  Tabelle der KM-Ausgabedatei bekommt neuen und leichter verständlichen Kopf.

2.)  Bei der Berechnung von Sonderprofilen wird der Formbeiwert nicht mehr
     berücksichtigt. Formbeiwert wird in Subroutine UF für jeden Abflussquerschnitt
     (Vorland links, rechts und Flusschlauch) seperat bestimmt.

                                                    Wolf Plöger, 05.09.2005


Kalypso 1.0.14   Dezember 2005
------------------------------
Es wird eine Datei angelegt, in der die einzelnen berechneten Lambdawerte über die
Querschnitte ausgegeben werden.

1.)  Neuer COMMON-Block / ausgabelambda / in WSP angelegt. Darin enthalten sind
     die UNIT-Nummer (jw_lambdai), der Dateiname (LAMBDAI) und die einzelnen
     Widerstandsbeiwerte fuer die einzelnen Punkte des Profils.

2.)  Datei mit UNIT jw_lambdai und dem Namen lambda_i.txt wird im Ordner /DATH/ 
     angelegt.

3.)  Die Lambda-Werte im Flussschlauch ergeben sich aufgrund der Iteration nach
     Einstein. Auf dem Vorland bzw. außerhalb der Trennflächen werden die 
     gemittelten Werte ausgegeben.

4.)  Zusätzlich wird für die einzelnen Knoten die jeweilige mittlerer 
     Fließgeschwindigkeit des Abschnittes (Vorland links, rechts, Flussschlauch)
     ausgegeben.

5.)  Verbesserung der Fehlerausgabe in INTDAT, wenn keine Grundrauheit angegeben
     wurde (z.B. fehlerhafte Verschneidung im WSPWIN Mapper).

                                                    Wolf Plöger, 08.12.2005



Kalypso 1.0.15   Januar 2006
----------------------------
1.)  Bei einer sehr komplexen Brücke ist ein Problem aufgetreten. Durch die Anhebung der 
     Dimensions-Variablen MIN2=500 und MAX2=20 in globale_definitionen.f90 konnte das 
     Problem behoben werden.

                                                    Wolf Plöger, 17.01.2006



Kalypso 1.0.16   Februar 2006
-----------------------------
1.)  Änderung der Variablenbezeichnung von az zu ay in LINDY (konform den anderen
     Subroutinen).

2.)  Zusätzliche Prüfung der eingegebenen Bewuchsparameter. Bewuchs zwischen den
     Trennflächen wird direkt gelöscht, Inkonsistente Dateieneingabe, z.B.
     ax= 5.0,  ay = 5.0,  dp = 0.0 wird geprüft und dann Bewuchs an dieser Stelle
     entfernt. Warnhinweise werden in error2.log geschrieben.

3.)  Verbesserung der Iteration zur Bestimmung von V_TR in Sub PASCHE. Einführung 
     einer semi-adaptiven Unterrelaxation.

4.)  Deklarierung der Übergabevariablen in LINDY. Löschen der Variable ks_mi aus
     Übergabeliste, da nie verwendet! -> Änderungen in EB2KS und QKS_QKST.

                                                    Wolf Plöger, 02.02.2006

Kalypso 1.0.17   März 2006
--------------------------
1.)  Einführung eines neuen globalen Moduls IO_UNITS, das alle UNITs verwaltet.

2.)  Ersetzen aller UNIT-Variablen im Code (z.B. jw2, jw8 usw.) durch neue
     Variablen. Löschen aller alten Unit-Variablen aus Übergabeparametern von 
     Subroutinen. In allen Subroutinen, in denen Ausgaben produziert werden,
     muss ab sofort das Modul IO_UNITS eingebunden werden. Ausnahmen bleiben
     bis auf weiteres die Subroutinen KOPF und DRUCKTAB.

3.)  Löschen des COMMON-Blocks /FUNIT/, da überflüssig geworden.

4.)  Löschen aller alten UNIT-Variablen in den entsprechenden COMMON-Blöcken.

5.)  Löschen des Common-Blocks /AUSGABEART/, da nun überflüssig.

6.)  Entfernen aller Abfragen IF (lein==3) THEN, da Kontroll.log jetzt immer
     vorhanden ist. Hierbei Änderung in den folgenden Subroutinen:
      - anf
      - normber
      - br_konv
      - wspanf
      - w_ber
      - preo_pro
      - verluste
      - newton
      - pegasus
      - station
      - abfluss
      - geomet
      - g_wehr
      - eb2ks
      - eb2kst
      - qks
      - qkst
      - lindy
      - pasche
      - sohlef

7.)  Einführung eines neuen Moduls zur globalen Ergebnisspeicherung MOD_ERG.
     Hierin werden die TYPEn out_IND(prof,abfluss,1-3) und out_PROF(prof, abfluss)
     definiert. Diese neu definierten Varialen Typen sollen alle jemals
     berechneten Ergebnisse zentral speichern. Wurde vorher in Commonblock /ERG/
     und weiteren Blöcken sehr unübersichtlich vorgenommen. Insbesondere bei
     stationär-ungleichförmiger Berechnung sind Probleme durch Fehlzuweisungen
     aufgetreten.

8.)  Komplettes Reworking der Ausgabe der *.KM Dateien. Es hat sich gezeigt, dass
     bei der stat.-unglf. Berechnung bei unterschiedlichen Abflüssen eine
     unterschiedliche Anzahl von Profilen interpoliert werden (z.B. bei Brücken).
     Deshalb kam es in der Vergangenheit zu Verschiebungen bei der Ausgabe
     der Ergebnisse.
     Jetzt werden zunächst A L L E jemals erzeugten Berechnungsergebnisse in
     dem globalen Modul MOD_ERG abgelegt. Hierbei wird insbesondere auch die
     Information, ob ein Profil mit Nummer i bei Abfluss j interpoliert wurde,
     abgelegt.
     Für die Datenausgabe werden in einer neuen Subroutine die entsprechenden
     Rückverschiebungen durchgeführt:

     !---------------------------------------------------------------------------
     subroutine shift_left_array_out(nr_prof, j)
     !
     ! Beschreibung:
     ! -------------
     ! Aufgrund der Komplexitaet der verwendeten Berechnungsmethoden, werden
     ! in bestimmten Faellen (z.B. Bruecken) Profile interpoliert. Die Anzahl
     ! der interpolierten Profile haengt von dem jeweiligen Abflussereignis.
     !
     ! AbflussNr   Stat[km]  Stat[km]  Stat[km]  Stat[km] Stat[km]  Stat[km]  Stat[km]  Stat[km]
     !    1         1.000     1.500     1.520     1.600    1.980     2.000     2.020     2.500
     !    2         1.000     1.500     1.600     1.980    2.000     2.020     2.500
     !    3         1.000     1.500     1.600     2.000    2.500
     !    4         1.000     1.500     1.520     1.600    1.980     2.000     2.500
     !    5         1.000     1.500     1.600     1.980    2.000     2.500
     !
     ! In diesem Beispiel sind alle ungeraden Werte (1.520, 1.980, 2.020)
     ! interpolierte Profile. Die urspruenglich 5 Profile wurden bei Abfluss
     ! Nr. 1 auf 8 Profile erweitert.
     ! Fuer die Ausgabe von WQ-Beziehungen bzw. Tabellen fuer die Kalinin-Miljukow
     ! Berechnung muessen die interpolierten Werte entfernt werden und der
     ! Rest der Zeile nach links geschoben werden.
 

9.)  Neue verbesserte Fehlerausgabe, wenn bei Bordvollberechung kein Abfluss
     berechnet wurde.

                                                    Wolf Plöger, 13.03.2006

Kalypso 1.0.18   April 2006
---------------------------
1.)  Erhoehung der Anzahl der maximal möglichen Abflussänderungen in einem Flusslauf von 10 auf 50.

2.)  Auflösung der COMMON-Blöcke BRUECK2 und BRUECK3. Die enthaltenen Variablen werden zu BRUECK
     hinzugefügt.

3.)  Verwendung des Moduls MOD_ERG nun auch für "Normale" Berechnung und Längsschnittausgabe.

4.)  Erweiterung der Ausgabe in laengsschnitt.txt mit:
     - Profilkennung (n = Normal, i = interpoliert, k = Kreis, m = Maul, t = Trapez, e = Ei)
     - Wehroberkante
     - Brückenunterkante
     - Brückenoberkante
     - Brückenbreite
     - Durchmesser von Durchlässen

                                                    Wolf Plöger, 26.04.2006


Kalypso 1.1b   24. Mai 2006
---------------------------
1.)  Erweiterung des Codes um eine neue Möglichkeit der Dateneingabe für die neue
     KALYPSO-1D Oberfläche:

     - Einführung eines neuen Moduls MOD_INI, das alle Daten der neuen 
       Konfigurationsdatei (aus KALYPSO-Oberfläche) beinhaltet. Diese Datei
       ist im Windows INI-Format geschrieben und kann beliebige Kommentare (#)
       und Leerzeilen enthalten.

     - Neue Subroutine "read_config_file" zum Lesen der Konfigurationsdatei.
       Die gelesenen Werte werden in MOD_INI gespeichert.

2.)  Wenn die neue Konfigurationsdatei vorhanden ist, wird sie erkannt und der
     interne Modus (RUN_MODUS) auf Kalypso gesetzt. Die Popup Fenster bei bestimmten 
     Fehlermeldungen werden dann unterdrückt.

3.)  Komplette Umstrukturierung der IO-Operationen. Jede IO-Einheit bekommt einen 
     festen Namen (gespeichert im Modul IO_NAMES). Die Variablen unit1 und fnam1
     verlieren ihre Bedeutung.

4.)  Änderung des IO-Handlings bei stationär-ungleichförmiger Berechnung: Die 
     Subroutinen FSEEK und LU0TRF werden nicht mehr verwendet, dafür beim
     Öffnen der *.PRO dateien das Attribut POSITION = 'APPEND'. 

5.)  Änderung der Einleseroutine der Datei "teilg.001". 

6.)  In der Längsschnitt-Datei wird zusätzlich noch der Abfluss ausgegeben.

7.)  Löschen des Commonblocks /IPRINT/ da Inhalt nicht mehr verwendet.

8.)  Getestet bis jetzt mit "WSPWIN"-Oberfläche: Normale Wasserspiegelberechnung,
     Bordvollberechnung und stat-ungl. Berechnung.
     Getestet bis jetzt mit "KALYPSO"-Eingabe: Normale Wasserspiegelberechnung.

9.)  ToDo: Testen aller Berechnungsmöglichkeiten mit allen Optionen für 
     WSPWIN-Oberfläche und Testen der Bordvoll sowie stat.-ungl. Berechnung
     mit KALYPSO-Eingabe.

10.) ToDO: Aufräumen des Codes, insbesonderer:
     - Prüfen der CHARACTER-Variablen FLUSS und EREIGNIS, eventl auch in MOD_INI?
     - Verwendung der neuen Variablen für die Berechnungsoperationen in allen
       Subroutinen, insbesondere ifg =1/0, FLIESSGESETZ Pasche/Colebrook.
     - Löschen der Subroutinen FSEEK und LU0TRF.
     - Übergabefehler in MENGLA (siehe Visual Analyser)
     - Prüfen der Common-Blöcke:
       - w_a
       - bloed
       - nr_ausg
       - flg_typ
       - reib
       - dateiname_prof
       - ob_alpha
       - P1

                                                    Wolf Plöger, 28.05.2006


Kalypso 1.1b   02. Juni 2006
---------------------------
1.)  Löschen des COMMON-Blocks P1. Alle variablen stehen nun über
     MOD_INI zur Verfügung.

2.)  Löschen des COMMON-Blocks FLG_TYP. Fliessgesetz wird nun
     in MOD_INI durch die Variable FLIESSGESETZ definiert.

3.)  Löschen des COMMON-Blocks P4. ifg wurde komplett durch
     Fliessgesetzdefinition in MOD_INI ersetzt. BETTA wird nur
     in VERLUSTE verwendet und dort lokal definiert.

4.)  Löschen des COMMON-Blocks W_A. Iterationsart wird nun in
     MOD_INI gespeichert.

5.)  Löschen des COMMON-Blocks REIB. Art des Reibungsverlustes
     wird nun in MOD_INI gespeichert.

6.)  Löschen des COMMON-Blocks BLOED. Wurde nur in WSP verwendet.

                                                    Wolf Plöger, 02.06.2006

Kalypso 1.1c   03. Juni 2006
----------------------------
1.)  Analysieren des Übergabefehlers von MENGF-OVRLA und MENGL-PUNLA.

                                                    Wolf Plöger, 03.06.2006

Kalypso 1.1d   06. Juni 2006
----------------------------
1.)  Behebung des Übergabefehlers von MENGF-OVRLA und MENGL-PUNLA.

                                                    Wolf Plöger, 06.06.2006

Kalypso 1.1e   06. Juni 2006
----------------------------
1.)  Explizite Definition aller Variablen in WSPBER, dabei Behebung eines
     Fehlers beim Hochzaehlen der Blattnummer (NBLATT). Trotzdem immer
     BUG bei der Blattzahl bei WQ-Tabellen.

2.)  Bei Berechnung mit KALYPSO-Oberfläche wird die Ausgabe der 
     WQ-Tabellen und Ergebnislisten immer aktiviert.

3.)  Löschen der Datei "mitvor.f90" und Definition einer neuen REAL FUNCTION
     zur Berechnung der mitwirkenden Vorlandbreite GET_MITVOR in
     "globale_funktionen.f90". Aenderung beim Aufruf in PASCHE.

                                                    Wolf Plöger, 06.06.2006

Kalypso 1.1f   06. Juni 2006
----------------------------
1.)  BUG gefunden in PASCHE bei der Berechnung des 
     Trennflächenwiderstandes. Fehler: CTFAK kann nicht berechnet werden.
     Fehler tritt auf bei Kollau Projekt von Klütz & Collegen (Wagener)

                                                    Wolf Plöger, 06.06.2006
                                                    
Anmerkung zu CTFAK (1.) 
     Die Variable ctfak wird in der Subroutine für das Pasche-Verfahren 
     berechnet und beschreibt das Verhältnis des benetzten Umfanges auf 
     dem Vorland zum Widerstandsbeiwertes der Trennflächen inkl. 
     Fließwiderstand auf dem Vorland.
     ctfak(1)    = u_tr (i1) / l_ks (ik)
     = benetzten Umfang (linkes Vorland) / Widerstandsbeiwert (linkes Vorland)
     ctfak(2)    = u_tr (i1) / l_ks (ik) 
     = benetzten Umfang (rechtes Vorland) / Widerstandsbeiwert (rechtes Vorland)

     Wenn eine der Trennflächen direkt am äußersten Rand (Durchströmten Bereich)
     liegt, dann ist der Widerstandsbeiwert = 0 auf dem Vorland und 
     die Ausgabe 'Berechnung von ctfak nicht moeglich.'' erscheint. 
     Gleiches gilt auch für einen Widerstandsbeiwert auf dem Vorland links 
     oder rechts mit l_ks (ik) kleiner gleich 1.e-04 .
     Also heißt diese Meldung nur, dass Trennflächenwiderstand und die 
     mitwirkende Breite für das Vorland nicht berechnet werden konnten. 
     Da es ja eh kein Vorland gibt, geht es auch nicht in die hydraulische 
     Berechnung mit ein
                                                   Monika Donner, 04.04.2007              


2.)  BUG in Wehrberechnung behoben. Sind eventl. noch weitere drin.

                                     Monika Donner, Wolf Plöger, 01.08.2006

Kalypso 1.2 RC1   11. Dezember 2006
-----------------------------------
1.)  Neue Berechnungsmethode für den Verzögerungsverlust hinzugefügt.
     Dieser Verlust wurde bisher über die Verfahren DVWK, Björnsen oder DFG
     bestimmt. Hierbei wurde die Verlusthöhe teilweise deutlich überschätzt.
     Neues Verfahren wird nach BWK Merkblatt 1, 1999 (S.28f) implemetiert.
     Bei alter WSPWIN-Oberfläche wird bei Wahl der Option DFG intern nun
     nach BWK gerechnet! 
     Bei KALYPSO-Oberfläche wird DFG-Option durch BWK-Option ersetzt.

                                                    Wolf Plöger, 11.12.2006

Kalypso 1.3      14. Februar 2007
---------------------------------
1.)  Umstieg auf G95 Compiler und Photran in Eclipse.

2.)  Auskommentieren der WiSK Popup Dialoge, da nicht verfügbar in G95.

3.)  Kleinere Anpassungen im Code, keine Auswirkungen auf Berechnung.

                                                    Wolf Plöger, 14.02.2007

Kalypso 1.3.1      04. April 2007
-----------------------------------
1.)  Generierung der Längsschnitt.txt auch fuer die stat. ungleichförmige 
     Berechnung (=Abfluss-Steigergung): 
     Änderung in zeila:
     - Laengsschnitt wird auch fuer mark = 2 (stat. ungleichf. Berechnung) erzeugt
     - derzeit noch auskommentiert ist die Erzeugung einer Laengschnitt-Datei 
       über alle Abfluesse und Profile (die Endversion ist noch in Arbeit!)

2.)  Neue Ueberarbeitung der Wehrberechnung in w_ber, g_wehr, beiwert und wspow:
	
     Änderung in der Berechnung des Ueberfall-Beiwertes fuer Wehre (beiwert):
     - lineare Interpolation fuer Zwischenwerte am scharfkantigen Wehr
     - Korrektur der Hilfsfunktion: phi1 = LN (1/phi) fuer rundkronige Wehre
	 - Korrektur des Ueberfallbeiwert für rundkronige Wehre nach Knapp

     Änderung in der Berechnung des Wehrabflusse (w_ber):
     - bislang wurde die Energiehöhen-Iteration im Oberwasser immer mit
       der Energiehöhe im Unterwasser gestart, dies fuehrte zu Problemen: 
       Deswegen Start mit einer 10cm hoeheren Energiehöhe 
       (siehe erster Aufruf von wspow)
     - die Geometrie am Wehr und die Ueberfallhoehe wurde bislang immer
       fälschlicher Weise mit der Enenergiehoehe statt der Wasserhöhe 
       im Oberwasser berechnet (siehe alle Aufrufe von g_wehr)
     - die Iteration fuer den Abfluss uebers Wehr wurde auf Basis von
       drei Stuetzstellen (he_q, hea_q und heb_q )vorgenommen. Dadurch 
       sprang das Programm oft zwischen verschiedenen Abflussszuständen
       (z.B.: unvollk. und Uberstroemen). 
       Die neue Iteration berechnet nur zwei Stuetzstellen und guckt 
       vorher schon mal wo der Ziel Wert "q_wehr" liegt.
       (Details siehe DOC zur Wehrberechnung)
     - in den Formeln fuer die Wehrabfluss-Berechnung waren mehrere Fehler
     - vorzeitige Auswertung vor Abschluss der Iteration wurde entfernt
     - Fuer den Problemfall (nach wie vor!!) 
       "Engergiehoehe Unterwasser = Energiehoehe Oberwasser" und 
       "Zufluss aus dem OW kleiner Abfluss uebers Wehr" wird jetzt die 
       Impulsbilanz gelöst. Da sie Energiebilanz den Abfluss am Wehr
       manchmal ueberschätzt. Dies macht die Iteration stabiler; kann 
       aber im Grenzfall wieder zu einem Wechsel zwischen verschiedenen 
       Abflussszustaenden fuehren.
       --> genaue Beschreibung zur "neuen" Wehrberechnung siehe DOC  
	                                                  
 						Monika Donner, 04.04.2007


Kalypso 1.3.1.1      25. April 2007
-----------------------------------

1.)  Ueberarbeitung der Wehrberechnung in w_ber, beiwert und wspow für scharf- und rundkronige Wehre:
	
  A) Änderung in der Berechnung des Abminderungsfaktors des Ueberfall-Beiwertes
     rundkronige fuer Wehre (beiwert):
     - Korrektur der fünf Geraden-Gleichungen für cm auf stetige Übergänge
       (details siehe DOC zur WehrBerechnung)
     - Fehler für die UW-Hoehe korrigiert: h_uw_w = h_ow - Wehrkrone

  B) Änderung in der Berechnung des Wehrabflusse (w_ber):
     - Wenn die Energiehöhen-Iteration keine Konvergenz zeigt (= Schleife 1000)
       wird der "optimalste Wert" (=he_opt) mit einer Abweichung kleiner 0.0001 m
       während der ganzen iterativen Berechnung zur Bestimmung des Wehrabflusses 
       verwendet.
        - Dieser Wert he_opt wurde bislang nicht richtig an die Ergebnisberechnung 
          und an das Oberwasser-Profil übergeben.
        - Die Varainte, dass es keinen "optimalen Wert" gibt, wurde vergessen 
          und daher wurde die optimale Energiehöhe aus der letzten Berechnung
          (z.B. fürs ein geringeres Q) genommen. Wenn jetzt kein he_opt gefunden
          wird, schließt das Programm mit der letzten Iteration und gibt die
          Ergebnisse aus.     
      - Für rundkronige Wehre kann folgender Fall eintreten: Die Energiehöhen-
        iteration im Oberwasser führt nach den maximal 20 Schritten nicht zum Ziel.
        Falls dies eintritt, wird derzeit die Energiehöhe im OW gleich dem Wasserstand 
        im OW gesetzt und alle Werte einschließlich des Abflusses übers Wehr in der 
        Routinen wspanf und ff. berechnet.    
        Für diese Varainte, ist in der Wehrroutine (w-ber) die richtige Energiehöhe
        rückwirkend aus dem Wasserstand und Geschwindigkeitshoehe zu bestimmen. 
        Dies fehlte bisher.
      - Die Schätzung der neuen Energiehöhe im Oberwasser beeinflusst das Ergebnis im
        Oberwasser maßgeblich. Daher wird der Sohlhoehenanstieg zwischen UW und OW ermittelt,
        um ein annähernd richtiges "DELTA" für die die Energiehöhe im OW zu bestimmen. Der 
        minimale Antieg der Energiehöhe ist auf 0.1 m begrenzt.
        
   C) Änderung in der Berechnung des Energiehoehe, Wasserstand und Geschwindigkeits-
      hoehe im Oberwasser (wspow): 
      - Bei der Bestimmung der richtigen Wassertiefe zur Energiehöhe im OW wird zunächst 
        eine Tangente durch zwei berechete Wertepaare aus Energiehöhe und Wassertiefe 
        ermittelt. Ist die Steigung dieser Tangenten nahe null, so befindet man sich nahe
        dem Grenzzustand (Strömen <-> Schießen). Daher wurde die Steigung der Tangenten 
        begrenzt (0.001) und die aus der Steigung berechnete neue Eingangs-Wassertiefe (wsanf) 
        wird kontrolliert:
         - ob kleiner null
         - ob größer der gewünschten Energiehoehe
         - ob kleiner 2/3 der gewünschten Energiehoehe
        Trifft eines der Fälle zu, so wird als Wassertiefe korrigiert.
      - Für rundkronige Wehre ohne Konvergenz in der Energiehöhen-Iteration. Tritt meist
        genau dasselbe Problem im Oberwasser des Wehres auf: Bei der abschließenden 
        Energiehöheniteration wird wieder (Energiehöhe im OW = Wasserstand im OW) gesetzt.
        Daher ist die Energiehöhe im Wehr und mit der Wasserhöhe(!) im OW identisch, aber
        nicht die Abflüsse. 
       		
        --> genaue Beschreibung zur Wehrberechnung siehe DOC  
      

      BUG(??):
      ---------
      Die Berechnung ausgehend von der WSPOW sollte geprüft werden, Wertepaare sind oft unplausibel:
      Obwohl die Werte im Strömenden Bereich liegen, weisen sie negative Steigungen auf.
      Nach Theorie sollte die Steigung aber im strömenden Bereich zwischen 1 und 0 liegen!!
                                                 
 							Monika Donner, 25.04.2007
 							
 Kalypso 1.3.1.2      26. April 2007
-----------------------------------

1.)  Die Zeila Routine ist schon für die neue Berechnungsvarainte und wurde daher wieder zurückgesetzt
                            
                                                         Monika Donner, 26.04.2007


 Kalypso 2.0.0        04. Mai 2007
-----------------------------------

1.)  Eine neue 4.te Berechnungsvarainte mit der Vorgabe eines konstanten Reibungsgefälles ist möglich.
     Für die neue Berechnungsvarainte "KONSTANTES REIBUNGSGEFAELLE" wird nur der Anteil der Verlusthöhe infolge 
     Reibung entlang des Fließweges berücksichtigt. Alle anderen lokalen Verluste werden nicht mitberücksichtigt. 

     Ziel der neuen Berechnungsvariante ist die Generierung eines 1d-Stranges für eine instationäre
     Berechnung nach dem Rechenverfahren nach Teschke. In der neuen Berechnungsvariante werden unter der 
     Annahme eines konstanten REIBUNGSGEFÄLLES für JEDES Profil folgende Effekte berücksichtigt:
     - Kontinuierliche Verluste entlang des Fließweges infolge Reibung, Trennflächen und Bewuchs.
       (Alle Verluste die in lambda eingehen)
     - Ausbildung von Wasserstand-Abfluss_Beziehungen im OW und UW von Bauwerken: derzeit NUR für Wehre
     - An den Wehren erfolgt eine innere Abflusssteigerung, wobei der Unterwasserstand konstant gehalten wird
       und der Zufluss aus dem Oberwasser über das Wehr stetig von Qmin bis Qmax gesteigert wird. Die Energiehöhe 
       im Unterwasser wird entsprechend dem festen bekannten UW-WSP und dem neuen Abflussüber das Wehr ermittelt.
       Es gilt die Konti-Bedingung.
     - In den Wehren werden alle örtlichen Verluste mitberücksichtigt. Diese Verluste werden später bei der
       instationären Berechnung verdeckt durch eine How-Q-Huw Beziehung mitgeführt.
     - Für die spätere Erzeugung der w-Q-Polynome für die normalen Profil sollten alle Bauwerke deaktiviert werden.
     - Für die Berechnung der How-Q-Huw Beziehung am Wehr muss das Abfluss-Intervall ggf. verkleinert werden:


     Unberücksichtigt bleiben:
     - Alle örtlichen Verluste infolge Einschnürung, Aufweitung oder Formwiderstand in den normalen(!) Gewässerprofilen.
     - In dieser Version 2.0.0 sind sind noch keine Brücken berücksichtigt: Daher sind unbedingt die Brücken zu deaktiviern!

     Für die die neuen Berechnungsvariante müssen folgende wichtigen Vorgaben erfolgen:
     - Konstantes stationäres Gefälle = angenommenes Reibungsgefälle
     - Ein Abflussintervall mit Qmin, Qmax und dQ
     - KEIN Verlustbeiwert beta (infolge Einschnürung oder Aufweitung)
     - Fließwiderstand ausschließlich für Darcy-Weisbach ohne Formwiderstand (kein kst)
     - Brücken sind zu deaktiviern!

     Folgende Routinen haben Änderungen erfahren:
     - wsp / read_config_file / qbordv / wspber / wspanf (Uebergabe von wsanf) / 
       verluste / w_ber / zeila
     
     Alle Deatils zum Berechnungsablauf, Theorie und zur Umsetzung im Rechenkern kann im Dokument:
       <Konzeption_neue_WSPM-Berech-Variante.doc>
     
     WICHTIG:
     -------- 
     Diese neue Berechnungsvariante lässt sich NUR über die Oberfläche WSPM ansteuern.
     Wer auch in WspWin damit arbeiten möchte, kann sich an mich (MD) wenden.
 

2.) Umstellung der Abfrage nach der Berechnungsvarainte in der Routine zeila und lapro.
    Die Art der Berechnung wird nun nur noch über den Parameter "Berechnungsart" erfragt und nicht mehr 
    über den Integer "mark". Dies steuert in zeila die Ausgaben.
                          
                                                         Monika Donner, 04.05.2007
						
 Kalypso 2.0.1        27. Juni 2007
-----------------------------------

1.)  Anpassung der Ausgabe in den *.km-Dateien. In der ersten (Kopf-)Zeile
     wird nun zusätzlich die bordvolle Höhe ausgegeben. Dies dient der angepassten
     Berechnung der Kalinin-Miljukow-Parameter k und n.
     
                                                         Wolf Plöger, 27.06.2007     
                                                    
 Kalypso 2.0.2        03. Juli 2007
-----------------------------------

1.)  Bugfix: Bei der Stationär-ungleichförmigen Bordvollberechnung bei gleichzeitiger
     Ausgabe der W-Q-Dateien (*.pro) ist bei der Interpolation von Profilen im 
     Brückenbereich und Einsatz des G95-Compilers ein Fehler aufgetreten
     (Die Unit UNIT_OUT_PRO wurde in diesem Fall nicht ordnungsgemäß geschlossen).
     Fehlerbehebung in WSPBER.
                                                         Wolf Plöger, 03.07.2007

 Kalypso 2.0.3        04. Juli 2007
-----------------------------------

1.)  Bugfix: Der Impulsstrombeiwert (alpha_IW) und Energiestrombeiwert (alpha_EW) nahmen 
     bislang bei hohen Abflüssen unsinnige Werte von bis über 100 an. In der SubR eb2ks wurde
     daher folgende Einflüsse auf den Impuls- bzw. Energiestrombeiwert abgefangen:
     -  Teilen durch kleine lambdas oder lambda = 0
     -  die Berücksichtigung von Teil-Flächen kleiner 0.001 m² für den Impulsstrombeiwert
     -  die Berücksichtigung von benetzen Umfängen kleiner 0.001 m für den Impulsstrombeiwert

2.)  Bugfix: Der Fall, das sich das berechnete Energieliniegefälle "is" (in Subr eb2ks) grösser 
     eins oder kleiner Null wird wurde Abgefangen durch ein Zurücksetzen des Energieliniegefälle 
     auf 0.001 (= Anfangswert für die erste Iteration am ersten Profil). 
     Problem trat auf im Oberwasser eines Wehres bei der inneren Abflussschleife mit konstantem
     Reibungsgefälle bei Will-Pad da Energieliniegefälle = "Inf" wurde, also Unendlich. In Folge
     dieses Wertes wurden lambda (1 und 3) und alle Fließgeschwindigkeit zu "NaN".


3.)  Bugfix: Der Verlusthoehe infolge Reibung (hv) wurde bislang mit einer nicht nachvollziehbaren
     Gleichung berechnet. Korrektur dieser Gleichung auf Basis des BWK-Merkblattes S19 glch13 
     in der Subroutine eb2ks und qks. Diese Veränderung erzeugte eine deutliche Reduzierung der
     Ansätze mit Grenztiefe des Rechenkerns für hohe Abflusswerte.

4.)  Erzeugung einer neuen Ausgabedatei für alle Berechnungen unter einer Abflussstaffelung
     Es wird ein Längsschnitt mit allen Profilen und allen Abflüssen erzeugt. Zusätzlich sind 
     die Teilabflüsse Q, Impulsstrombeiwert (alpha_IW) und Energiestrombeiwert (alpha_EW) enthalten.
     Routinen: zeila, qbordv, lapro, wspber, globale definitionen

5.)  Bugfix: Der Trennflächen-Widerstandbeiwertes (Lambda) wurde in der SubR Pasche auf ein 
     Maximum von 2.00 begrenzt. Das Problem: Bei hohen Abflüssen greift der Rechenkern immer wieder
     auf die Grenztiefen zurück, da die Energiegefälle-Iteration kein konvergierendes Ergebnis. 
     Die Folge ist Lambda-Trennfläche geht gegen unendlich. 
     HINWEIS: Problem wurde noch nicht vollständig behoben
                                                       Monika Donner/ Wolf Plöger, 04.07.2007

 Kalypso 2.0.3.1      05. Juli 2007
-----------------------------------
1.)  Bugfix: Bei der stat.-unglf. Berechnung wurde die neue Datei "Q_LangSchnitt.txt" nicht
     richtig geschlossen.
                                                         Wolf Plöger, 05.07.2007  

Kalypso 2.0.3.2      05. Juli 2007
-----------------------------------
1.)  Einfuegen des Reibungsgefaelles in den Q-Laengsschnitt. Deswegen ist "gefaelle" jetzt 
     eine gobale Variable (siehe globale definitionen). 

2.)  Eroeffnen der Ausgabedatei 'Laengs_QWehre.txt' und 'HOW-Qwehr-HUW' auch von wspber 
     in qbordv verschoben
                                                         Monika Donner, 05.07.2007 


Kalypso 2.0.4        11. Juli 2007
-----------------------------------
1.)  Weiterentwicklung der neuen Berechnungsvariante unter konstantem Reibungsgefälle zur
     Generierung von Datentabellen für die instationäre Berechnung an Brückenprofilen.
     So wird in der Subroutinen wspber eine Schleife um jedes Brückenprofil mit einem 
     inneren Abflussintervall gelegt. Dabei werden an der Brücke auch alle lokalen Verluste
     berücksichtigt. Aus der äußeren Abflussschleife wird der Wasserstand im Unterwasser
     H_uw(Q_out) berechnete und dort festgehalten. Mit diesem festen Wasserstand wird dann die innere 
     Abflussschleife über die Brücke gestartet.
     Nach Abschluss des inneren Abflussintervalls wird, die Brückenberechnung noch 
     einmal mit dem äußeren Abfluss und dem zugehörigen Wasserstand im Unterwasser berechnet.  
     Der Wasserstand im Unterwasser-Profil (n) der Brücke ist unabhängig vom Bauwerk und kann daher
     auch Startprofil eines Gewässerstranges sein. Bei dieser Berechnungsvariante mit einem 
     schrittweise festen Unterwasserstand muss die Kontinuitätsbedingung an der Brücke eingehalten
     werden. Daher wird auf Basis des aktuellen Abflusses über die Brücke die Energiehöhe
     über eine zunehmende Fließgeschwindigkeit im Unterwasser erhöht.
      
     Anmerkung zur Rechenzeit:
     Die innere Abflussschleife verminderte die Berechnung um den Faktor des Q-Intervalls:
               Beispiel: Berechnung von 3-Q-intervallen (1, 2 und 3m³/s) 
               --> 9 Berechnungen je Bauwerk: Also dreimal so langsam
     Abflussintervalle sollte nicht zu groß gewählt werden (delta Q < 10 m3/s), da sonst keine 
     Konvergenz in der Berechnung erreicht wird.  

3.)  Für die die neuen Berechnungsvariante müssen folgende wichtigen Vorgaben erfolgen:
     - Konstantes stationäres Gefälle = angenommenes Reibungsgefälle
     - Ein Abflussintervall mit Qmin, Qmax und dQ
     - KEIN Verlustbeiwert beta (infolge Einschnürung oder Aufweitung)
     - Fließwiderstand ausschließlich für Darcy-Weisbach ohne Formwiderstand (kein kst)

     Folgende Routinen haben Änderungen bei der Einbindung der inneren Schleife um die Brücken 
     erfahren:
     - qbordv: Defintion der zwei neuen Ausgabe-Dateien: "HOW_QBreucke_HUW" und "Laengs_QBruecke"
     - wspber: Innere Schleife um die Brückenberechnung/ neue Ausgaben/ neue Variablen zur Sicherung
               der Ergebnisse im UW
     - br_konv: bugfix (siehe unten)
     - w_ber: nur Ausgabeformate fuer die innere Schleife ueber die Wehre angepasst
     
     Alle Deatils zum Berechnungsablauf, Theorie und zur Umsetzung im Rechenkern kann im Dokument:
     <Konzeption_neue_WSPM-Berech-Variante.doc>  

4.)  Bugfix in der br_konv:
     --> es fehlte ein "&" im letzten Block bei "CALL normber"

5.)  Eigenen Anmerkung: 
     -------------------
     Die Brückenberechnung verwendet NIE die Wehrberechnung (w_ber) sondern arbeitet 
     mit einer eigenen Impulsbilanz in "br_konv" für den vollkommenen Überfall. Fuer den 
     unvollk. Überfall (iwehr=iwehrb=1) wird die "wspow" in wspber aufgerufen. Diese berechnet 
     aber nur den Oberwasserstand am Wehr auf Basis eines bereits berechneten Wasserstandes
     und Abflusses im Wehr. Eine Wehrberechnung wird hier immer nur mittels Impulsbilanz 
     (wenn überhaupt) vorgenommen. Die Impulsbilanz überschätzt den Wasserstand häufig 
     (das hat sich bei den Wehren gezeigt), ist aber dafür stabiler.

                                                          Monika Donner, 11.07.2007 

Kalypso 2.0.4.1      31. Juli 2007
-----------------------------------
1.)  Bugfix Brückenverluste im Längsschnitt
     Behalten der Brückenprofile in der Laengsschnitt.txt und Q_LangSchnitt.txt. 
     Beim Erzeugen von interpolierten Profilen für die Brückenberechnung wurde
     bei einer Anzahl von 2 interpolierten Profilen im Unterwasser versehentlich
     auch die Brücke als "%interpol = .True." Profil gemerkt. Dadurch wurden die Ergebnisse an
     der Brücke dann bei der nachfolgenden Aufräumaktion in der SUBR Qbordv entsorgt und 
     tauchen nicht mehr im Laengsschnitt auf.
     Jetzt wird die Brücke 'b' nochmal in SUBR wspber bewußt als nichtinterpoliertes
     Profil gespeichert. 

                                                         Monika Donner, 31.07.2007 

Kalypso 2.0.4.2      03. August 2007
-----------------------------------
1.)  Bugfix innere Abflussschleife ueber die Brücken
     Schutz der Ergebnisse an der Brücke aus der äußeren Q-Schleife vor einem Überschreiben
     bei der Inneren Q-Schleife. Bei der inneren Q-Schleife werden neue Datenfelder belegt 
     und somit alle Ergebnisse seperat abgelegt (siehe drucktab).
     Betroffene SUBR: globale defintionen, br_konv, drucktab, wspber

2.)  Erweiterung der Laengsschnitt.txt um die Einträge der Teilabfluesse, Impuls- und 
     Energiestrombeiwert sowie Reibungsgefälle. Somit sind die Ausgaben mit der Q_LangSchnitt
     identisch.
     Betroffene SUBR: zeila
                                                         Monika Donner, 03.08.2007 



Kalypso 2.0.4.3      07. August 2007
-----------------------------------
1.)  Bugfix innere Abflussschleife ueber die Brücken:
     Fehler-Korrektur beim Zurückholen der alten Ergebnisse im UW der Brücke aus der äußeren 
     Q-Schleife. 
     Betroffene SUBR: wspber

2.)  Bugfix Energiehöhenberechnung (hen) bzw. Verlusthöhen-Berechnung (hv):
     Die Energiehöhe wurde bislang falsch aus der Wasserspiegelhöhe und dem Reibungsgefälle bzw. 
     Energieliniengefälle berechnet. Jetzt wird hen = wsp + v²/2g berechnet. Und hv = v²/2g. 
     Diese Korrektur wirkt sich auf alle Rechenvarianten und alle Ergebnisse aus!
     Betroffene SUBR: eb2ks, qks_qkst

3.)  Zur Verbessung der Performance an den Bauwerken:
     Verbesserung der Stabilität bei der inneren Abflussschleife bei der Berechnung. Dabei wird
     vor jeder Berechnung an der künstlichen Unterwasser-Randbedingung (h_uw, v_uw, hen_uw) geprüft
     ob, der Wasserstand größer gleich der Grenztiefe ist. Wenn dies nicht der Fall ist, so wird das
     nächste Innere-Q aufgerufen. Dies erzeugt eine stabilere Berechnung für größere Wertebereiche und 
     beschleunigt den Berechnungsprozess.
     Betroffene SUBR: w_ber, wspber

4.)  Reduzierungen der Ausgaben in der LOG-Datei für die Innere Abflussschleife:
     Betroffene SUBR: w_ber, wspber, br_konv


                                                       Monika Donner, 07.08.2007 

Kalypso 2.0.4.4      15. August 2007
-----------------------------------
1.)  Bugfix fuer Berechnung "konstantes Reibungsgefälle"
     Verwendung der richtigen Sohlhöhe für die Berechnung der Grenztiefe im UW der Wehre      
     Betroffene SUBR: w_ber

2.)  Aenderung der Ausgabe fuer die Huw_QBruecke_How unter der Berechnung "konstantes Reibungsgefälle":
     Betroffene SUBR: qbordv, wspber

3.)  Bugfix bei der automatischen ausserplanmaessigen Interpolation von Profilen
     (WSPBER, Zeile 2384), falsches Format bei der Ausgabe.
     
4.)  Bugfix: Bei der normalen Wasserspiegellagenberechnung wurde faelschlicherweise
     im MS-DOS Fenster der Header der UNIT_OUT_QLAENGS geschrieben.

                                               Monika Donner und Wolf Plöger, 15.08.2007 

Kalypso 2.0.5       17. August 2007
-----------------------------------
1.)  Erweiterung der Fließwiderstandsberechnung um extrem rauhes Regime. Verwendet
     wird die Formel nach Aguirre-Pe und Fuentes, wobei zwischen h=0,1*ks und h=0,3*ks
     eine lineare Übergangsfunktion zwischen Colebrook/White und Aguirre-Pe/Fuentes
     verwendet wird. (Theorie siehe BWK-Merkblatt 1, S. 25, alpha_t = 6,8, beta_w = 0,3)
     Es besteht nun keine Begrenzung mehr bei der Wahl des ks-Wertes bei niedrigen
     Wassertiefen! Das Verfahren nach Aguirre-Pe/Fuentes führt bei niederigen Abflüssen
     zu größeren Fließwiderständen und damit zu höheren Wasserspiegeln!
     In einigen Fällen wird die automatische Interpolation von Profilen durch das
     neue Verfahren unterbunden/überflüssig!
     Berechnung wird durch den LOGICAL USE_EXTREME_ROUGH in WSP aktiviert bzw. deaktiviert.
     Ist jetzt standardmäßig aktiviert, könnte in Zukunft durch Oberfläche gesteuert werden?
     Die Parameter alpha_t und beta_w liegen in einem neuen Modul.

                                                           Wolf Plöger, 17.08.2007 
                 
Kalypso 2.0.5.2      3. Dezember 2007
-------------------------------------
1.)  Korrekturen und Erneuerungen fuer die Wehrroutine: w_ber, beiwert, g_wehr 
    A.) Einheitliche Benennung für alle Wehrarten in allen betroffenen Routinen:
        wl = Wehrlänge (in Fließrichtung)
        wb = Wehrbreite (senkrecht zur Fließrichtung)
        wh = Wehrhöhe (Höhe in [m])
        Betrifft Übergabe an g_wehr von w_ber aus.
    B.) Bugfix fuer Sicherung der letzten Werte in w_ber bei "keiner Konvergenz in der Engergiehoehen
        Iteration": Werte h_v_opt und q_wehr_opt wurden nie belegt.
    C.) Veränderung fuer die neue Energiehoehenschaetzung im OW des Wehres mit:
        he = (he + hea_q + he_q)/ 3. 
    D.) Neue Berechnungsformel für Überströmen: Beim Überströmen wird ein sogenannter Anstroemverlust 
        ueber den Verlust-Beiwert K_verlust berücksichtigt.
        K_verlust = (benetzter Umfang OW² * angeströmte Wehrfläche im OW * cw) / (benetzte Gesamtfläche im OW)²
        So stellt sich ein glatterer Übergang zwischen vollkommenem bzw. unvollkommenem Überfall 
        und Überströmen ein. Wird der Verlust-Beiwert kleiner eins, wird die ursprüngliche Gleichung 
        ohne Verlust-Beiwert angesetzt.
        
2.)  Entkopplung der Berechnungsvarainte konstantes Reibungsgefälle zwischen den Profilen. Es werden keine
     Startwerte mehr aus dem Unterwasser vorgegeben.
     Betroffene Routinen: wspber, wspanf, station, verluste, eb2ks

                                                           Monika Donner, 03.12.2007  
Kalypso 2.0.6       13. Dezember 2007
-------------------------------------
1.)  Leicht Verbesserung in der Lesbarkeit des Codes. Explizite Definition einiger 
     Variablen, wenn gesehen.

2.)  Überarbeitung (deutliche Vereinfachung) der Subroutine SOHLEF. Korrektur der
     ks-Wert Übergaben an GET_LAMBDA.     
     
3.)  Fehlerbehebung bei der Berechnung der Trennflaechenrauhigkeit nach Pasche.
     In Subroutine PASCHE wird laut DVWK-Merkblatt 220, "Hydraulische Berechnung
     von Fließgewässern", Seite 31, Formel 4.14 ein Abflussanteil innerhalb der
     mitwirkenden Bewuchsbreite berücksichtigt.
     Im Code wurde nach Berechnung dieses Abflussanteils über das allgemeine
     Fließgesetz ( dQ/A = 1/wurzel(lambda) * wurzel(8*g*h*i) ) wiederum der
     Fließwiderstand lambda des Vorlandes angepasst. Das ist m.E. falsch, da der
     Fließwiderstand des Bewuchses und der Sohle nur von den geometrischen Parametern,
     der äquivalenten Sohlrauheit (und dem Gefälle bei Berechnung von cWR) abhängt!
     Ein Rückwärtsanpassung kann demnach nicht sinnvoll sein und führt auch in einigen 
     Fällen zu unplausiblen Werten bei schlechter Konvergenz.
     
4.)  Bugfix bei der Berechnung der Sohlrauhigkeit in Verbindung mit extremen 
     Rauhigkeiten. Hier: Anpassung des ks-Wertes bei geringen Wassertiefen,
     wenn extreme Rauhigkeiten N I C H T berücksichtigt werden sollen. 
     
5.)  Im Projekt-Ordner /PROF/ wird nach einer Datei mit dem Namen "Kalypso_add.cfg"
     gesucht. Hier können im INI-Format zusaetzliche oder abweichende Konfigurationen
     für die Berechnung festgelegt werden. Die Datei wird nur gelesen, wenn sie
     existiert und die WSPWIN-Oberfläche verwendet wird.
     

Kalypso 2.0.6.1       04. Januar 2008
-------------------------------------
     
1.)  Fehlerbehebung in Wehrberechnung fuer rundkronige und scharfkantige Wehre: Korrektur 
     des Ueberfallbeiwertes für rundkronige Wehre in "beiwert" nach Knapp, S. 232 unter 
     Ruecksicht auf die angesetzte Gleichung fuer Q(vollkommen): Division durch 2/3 und 
     wurzel(2g). (beiwert)
     Korrektur der Abgrenzungsgeraden tauo zwischen vollkommen und unvollkommenem Ueberfall
     (siehe tauu, taoo und taou in "w_ber")
     
2.)  Bereitstellen von zwei neuen Ergebnisdateien fuer RV "konstantes Reibungsgefaelle"
     zur Ausgabe der Energiehoehen-Abfluss-Beziehungen an Bruecken und Wehren EOW_QBreucke_EUW
     und EOW_QWehre_EUW (qbordv, wspber, w_ber)

3.)  Weiteres Abgrenzungskriterium fuer RV "konstantes Reibungsgefaelle" an den Wehren definiert:
     für sehr kleine Fließgeschwindigkeiten im Unterwasser (Geschwindigkeitshoehe = v²/2g < 0.0001m)
     wird keine Berechnung für den Abfluss vorgenommen, sondern direkt die nächst höherer Abfluss-
     berechnung angestoßen.
     Ammerkung: Geringe Geschwindigkeitshoehen (<0.0001m) im Unterwasser des Wehres führt zu 
     Problemen in der Energiehöheniteration fuer das Oberwasser. (w_ber)
     
                                                                   Monika Donner, 04.01.2008      

                                                           
Kalypso 2.0.6.2     09. Januar 2008
-------------------------------------                                                           

1.)  Zusätzliche Option in "Kalypso_add.cfg": Es kann nun auch der Parameter
     CALC_KM_INTERN auf "true" oder "false" gesetzt werden und so die interne
     Kalinin-Miljukow-Berechnung ausgeschaltet werden, da teilweise fehlerhaft.

2.)  Reduktion der maximalen Gerinneabschnitte auf 750. Maximalen Abflüsse
     sind weiter bei 100, könnten aber auch reduziert werden um signifikante 
     Reduktion der Speicherbelegung zu erreichen.
     
                                                           Wolf Plöger, 09.01.2008


                                                           
Kalypso 2.0.6.3     10. Januar 2008
-------------------------------------                                                           

1.)  Neue Option zum Anstossen des Rechenkerns mittels angehängter Argumente beim
     Aufruf der Kalypso1d.exe. Bei diesem Aufruf muss das erste Argument ein "n" sein fuer 
     den Modus Kalypso und das zweite Argument der Pfad der INI-datei:
         z.B.: "D:\FlussXX\Kalypso-1D.exe n D:\FlussXX\kalypso-1D.ini"

     Diese neue Option ist nur auf einen Start in der KalypsoWSPM Umgebung geeignet!
     Alle alten Projekte bzw. Oberflächen egal ob in KalypsoWSPM, WspWin oder Manuell
     können wie gehabt aufgrufen werden.
     (Betroffene Routinen: wsp)

2.)  Nicht relevante Meldungen und Hinweise wurden begonnen in die LOG-Datei zuschreiben 
     lediglich Fehlermeldungen, Hinweise vor einem Programmabbruch und Hinweise zum Status
     der Berechnungen verbleiben in der error2.log bzw. werden im Dos-Fenster (WspWin) bzw. 
     in der Konsole (WSPM) ausgegeben.
     (Betroffene Routinen: qbordv, w_ber, wspber, globale_funktion, AIWSP, geomet)

3.)  Die Ausgabe "die bedingungen fuer die berechnung der bruecken mit impuls sind nicht gegeben, 
     da die max. hoehe der brueckenuk groesser ist als das mininmum der bruecken-ok zwischen den 
     beiden widerlagern (--> gemischter abfluss !)  --> empfehlung: neustart des programms, 
     berechnung der bruecke nach hec" wurde ersetzt durch eine hilfreichere Aussage:
     " Bedingungen fuer Brueckenberechnung mit Impuls sind nicht gegeben,
       Maximale Hoehe der BrueckenUK > minimale Hoehe der BrueckenOK
       (--> gemischter Abfluss !)
       --> Empfehlungen:  
        1) Kontrolle des Brueckenprofils !
        2) Pruefen der BrueckenUK und der BrueckenOK ! 
        3) Senken neben der Bruecke entfernen ! "
     (Betroffene Routinen: geomet)

     
                                                           Monika Donner, 10.01.2008


Kalypso 2.0.6.4     22. Januar 2008
-------------------------------------                                                           

1.)  Verminderung der Iterationsprobleme bei der Berechnung der Wasserspiegellagen unter Abflussstaffelung. Dies
     führt häufig zu Rücksprüngen in der Wasserspiegellage unter zunehmenden Abfluss.
     Ursache der Problematik ist der unstetige Funktionsverlauf zwischen Reibungsgefälle und dem Wasserspiegel.
     So kommt es bei der Benetzung des Vorlandes ganz grundsätzlich zu einem sprunghaftem Anstieg des 
     Reibungsgefälles, der um so extremer ausfällt, wenn zusätzlich auf dem Vorland eine Senke zu füllen ist.
 
     Die Probleme bei der Berechnung eines Wasserspiegels wurden weiterstgehend behoben durch:
     - eine Optimierung der Schätzwertbildung während der Iteration
     - Erhöhung der maximale Anzahl der Konvergenzschritte (Kennzahl 50)
     - Behalten bester Werte unter allen Kennzahlen
     (Betroffene Routine: station)   
							
							 Edgar Nehlsen & Monika Donner, 21.01.2008 


Kalypso 2.0.6.6     07. Februar 2008
-------------------------------------                                                           

1.)  Einbau des "Debug-Modus" fuer Wehre in der inneren Abfluss-Schleife NUR fuer die 
     Berechnungsvariante "konstantes Reibungsgefaelle". Durch diese neue Option werden nicht
     konvergierende inneren Abfluesse (Schleife 2000) ausgelassen und der naechste Abflusswert
     (qw+1) nach der Ausgabe einer Warnung berechnet.
     (Betroffene Routine: w_ber) 
  
2.)  BUGFIX in der Brückenberechnung: Betrifft alle Berechnungsvarianten!!!
     Fehlerhafte Uebergabe von der Brueckenberechnung (br-konv) in die Abflussberechnung (abfluss). 
     Statt der Differenz h0 zwischen Energiehoehe (he1) in Profil 1 (OW-Bruecke) und WSP (hr3) 
     in Profil 3 (UW-Brücke) wurde die Differenz zwischen zwei Energiehoehen gebildet. Dadurch wurde 
     in ungünstigen Fällen (Druckabfluss) zunächst vd zu Null und später "negativ" bzw. Wurzel aus 
     einem negativen Wert gezogen. 
     --> Korrektur der uebergebenen Parameter aus br-konv nach abfluss

     Folgen fuer die Ergebnisse an Bruecken:
     ---------------------------------------
     Diese Aenderung fuehrte zu KEINEN Aenderungen in den Ergebnissen, verhindert jedoch den Programm-
     abbruch fuer den Abflusszustand: Druckabzufluss in der Bruecke ohne Wehrabfluss!
	  
     (Betroffene Routine: br-konv, abfluss)   
							
							          Monika Donner, 07.02.2008


Kalypso 2.1.0.0     19. Februar 2008
-------------------------------------                                                           

1.)  Neue Subroutine ROHRE zur Berechnung von Rohren/Durchlässen bei der Berechnungsvariante "konstantes Reibungsgefälle".  
     Im Verlaufe der Berechnng werden Rohrprofile (k,e,m,t) in der Subroutine WSPANF abgefangen und die Subroutine ROHRE 
     aufgerufen, während die übrigen Profile weiterhin in die Subroutine STATION übergeben werden. In der neuen Routine 
     erfolgt die Berechnung wasserstandsgesteuert und nicht wie sonst abflussgesteuert, wodurch Iterationsprobleme
     vermieden werden. Die Schrittzahl wurde jedoch von der äusseren Abflussschleife (QBORDV) übernommen, so dass die 
     Anzahl der berechneten Stützstellen gleichbleibt. 
     (Betroffene Routinen: Rohre, Wspanf, Verluste) 

2.)  Fehlerbehebung:
     Beim Einlesen der Daten (Lage, Geometrie, etc.) für Maulprofile aus der Profil- Datei, gesteuert über die Subroutine 
     INTDAT wurde als "Bezgugspunkt Breite" das Sohlgefälle und als "Bezugspunkt Höhe" der Bereitenwert eingelesen.
     (Betroffene Routine: Intdat)

3.)  Fehlerbehebung:
     Bei der Berechnung der Rohrgeometrie in der Subroutine UF wurde für Kreis-, Maul- und Eiprofile angenommen, dass die 
     Wasserspiegelbreite gleich dem benetzen Umfang ist.
     (Betroffene Routine: Uf)      
							
							 Edgar Nehlsen & Monika Donner, 19.02.2008 



Kalypso 2.1.1.0      26. Februar 2008
-------------------------------------                                                           

1.)  Bug-Fix:
     Beim Einlesen der INI-Datei fuer einen Start im Modus "Kalypso" (also nicht WspWin) wurden zwar alle Einstellungen
     in der read_config_file richtig eingelesen, aber beim Rückkehr in die HauptRoutine wsp mit Default Belegungen ueber-
     schrieben:
      - REIBUNGSVERLUST = 'TRAPEZ'
      - ITERATIONSART = 'SIMPLE'
     Daher wurden für alle Berechnungsarten die Einstellung REIBUNGSVERLUST = 'GEOMET' und ITERATIONSART = 'EXACT ' 
     bis dato falsch übernommen!
     (Betroffene Routine: wsp)
    							
							                Monika Donner, 26.02.2008 


Kalypso 2.1.1.1r      10. März 2008
-------------------------------------                                                           

1.)  Zurückholen der ursprünglichen Energiehöhenberechnung (hen) bzw. Verlusthöhen-Berechnung (hv):
     Die Energiehöhe wurde seit Version 2.0.4.3 (07. August 2007) mit einem vereinfachten Ansatz ueber
     hv = v²/2g aus Stabilitätsgründen berechnet. Durch weitere Stabilisierung des Energiehöhenberechnung
     wird nun der ursprüngliche Ansatz: hv = phion / phiun**3 * q * q / g / 2. nach BWK 1, S.15 zurückgeholt.

     Diese Korrektur wirkt sich minimal (im cm Bereich) auf alle Rechenvarianten und alle Ergebnisse aus!
     Betroffene SUBR: eb2ks
    							
2.)  Zurücksetzen der Korrektur vom 07. Februar2008 der uebergebenen Parameter aus br-konv: Energiehöhen waren richtig!
     (siehe Theorie zum Verlustbeiwert)
     Diese Aenderung fuehrte zu KEINEN Aenderungen in den Ergebnissen, verhindert jedoch den Programm-
     abbruch fuer den Abflusszustand: Druckabzufluss in der Bruecke ohne Wehrabfluss!
	   

							                Monika Donner, 10.03.2008 


Kalypso 2.1.2.1      07. Mai 2008
-------------------------------------    
Verbesserung der Brückenberechnung fuer Probleme bei reinem Druckabfluss

1)   Vermeidung geschätzter Energiehöhen (hea und heb) in Profil 1, die kleiner sind als die Energiehöhe
     im Unterwasser-Profil 3: Dies führte bislang zum Abbruch der Berechnung insbesondere unter reinem 
     Druckabfluss in der Brücke. Zugehörige Fehlerausgabe: 
         Differenz h0 zwischen Energiehoehe in Profil 1 (OW-Bruecke)
           und WSP in Profil 3 (UW-Brücke) ist NEGATIV
           --> Programmabbruch in ABFLUSS bei Brueckenberechnung

2)   Verbesserung der Anpassung der Energiehöhen hea und heb in Profil 1 für die nächste Iteration
     durch Annäherung beider Werte und Neuberechnung des Abflusses (qgesa für hea und qgesb für heb)
     bzw. Wasserstandes für beide Energiehöhen. Dabei wird die nähere geschätzte Energiehöhen am 
     gewünschten Abfluss (Q) beibehalten und die entferntere in Richtung gewünschten Abfluss Q verschoben.

3)   Kontrolle der kleineren geschätzter Energiehöhen heb, ob sie mindestens der Unterwasser 
     Energiehöhe im Profil 3 (he3) entspricht oder größer ist.

4)   Vermeiden einer Endlosschleife im Bereich der Energiehöheniteration und den Fall, dass die Abflüsse
     qgesa und qgesb der geschätzten Energiehöhen den Abfluss Q umgeben. Keine direkte Rückkehr 
     mehr in diesen Fall "Nullstelle" sonst vollständiges Prüfen der neuen Energiehöhen und 
     ihrer zugehörigen Abflüsse.

Details & Erläuterungen zur Brückenberechnung: 
     siehe --> CVS: ....\kalypso-1d\doc\handbuch\Bruecken-Berechnung.doc

Folgen der Aenderung:
     Zwischen Version 2.1.1.1r und 2.1.2.1 treten weder in der Energiehöhe im Oberwasser 
     noch im Wasserstand Abweichungen auf. Getestet wurde 3 einzelne Brücken und an der Kollau mit 
     20 Brücken ueber verschiedene Abflussintervalle. Abfluesse die zum Abbruch der Berechnung
     führten koennen mit der neuen Version 2.1.2.1 berechnet werden.

Noch bestehende Schwächen:
     - Inkonsistenz in den Verlustbeiwerten zwischen Impuls- und Energiebilanz an der Brücke
     - Impulsbilanz fängt nicht Energierückgang im Oberwasser ab
     - Pauschale Sohlerhöhung im Profil b zwischen Brücke und Oberwasserprofil um 5cm 
       etwas willkürlich.


5)  Zulassen der Steuerung fuer Extreme Rauheiten:
    Bislang wurden immer die Einstellungen in der SubR wsp zu:
    CALC_KM_INTERN = .true.
    USE_EXTREM_ROUGH = .false.
    Nun gilt diese Belegung nur noch, wenn der aufruf NICHT aus 'KALYPSO'(also WSPM oder Manueller Aufruf) erfolgt.

    --> Achtung: Wenn vorher die Einstellung in der INI mit "USE_EXTREM_ROUGH = true" gesetzt war, kommen nun
             andere Ergebnisse raus, da die extremen Rauheiten ab Version 2.1.2.1 wirklich mit berücksichtigt
             werden. 
    --> Bug: "USE_EXTREM_ROUGH = true" führte an der Bille zum plötzlichen Absacken des Wasserspiegels!!

							                Monika Donner, 07.05.2008 



Kalypso 2.1.3.0      09. Juli 2008
-------------------------------------    
1) Korrektur fuer Bauwerks-Berechnung fuer Berechnungsvariante "konstantes Reibungsgefälle". 
   Hierbei wurde bislang in der inneren Abflussschleife nicht die tatsächliche Rauheit, sondern 
   weiterhin das vorgegebene Reibungsgefälle verwendet. --> Bug
   Dies führte zu einer gerinfügigen Abweichung (cm-Bereich) beim Vergleich zwischen einer normalen
   Wasserspiegellinien-Berechnung an einer Brücke (oder an einem Wehr) und den Ergebnissen aus der
   Huw-Q-How oder Euw-Q-Eow. Diese Abweichung zeigte sich inbesondere bei niedrigen Abflüssen und sehr 
   kleinen vorgegebenen Reibungsgefällen.

   Grundsätzlich sollen jedoch in der inneren Abflussschleife alle Verluste (Einschnürungs-, Aufweitungs- 
   und auch der echte Sohlrauheitsverlust) berücksichtigt werden. Dementsprechend wurde zur
   Abfrage des BERECHNUNGSMODUS (hier nur für BERECHNUNGSMODUS == 'REIB_KONST') eine Abfrage nach der
   Kennung "Q_ABFRAGE" ergänzt. Diese Kennung "Q_Abfrage" lieferte fuer die Berechnung mit
   konstantem Reibungsgefaelle die Auskunft, ob die Berechnung in einer inneren Abflussschleife 
   einer Bruecke oder eines Bauwerkes befindet, wo örtlich und echte Reibungsverluste zu
   berücksichtigen sind oder in Berechnung eines Normalprofils bzw. der äußeren Abflussschleife, 
   bei der das vorgegebene Reibungsgefaelle genutzt werden soll. Die Kennung wird auch verwendetet,
   um in der inneren Abflussschleife an Bruecken und Wehren die Ausgaben schlank zuhalten.

   Folgende Werte kann diese Kennung annehmen:
   ------------------------------------------------------
   Default Wert (SubR wspber) :  Q_Abfrage = 'IN_SCHLEIFE'
   Q_Abfrage = 'BR_SCHLEIFE'  :  Innere Abflussschleife an der Bruecke (alle Verluste)
   Q_Abfrage = 'IN_SCHLEIFE'  :  Aueßere Abflussschleife am Bauwerke bzw. Berechnung
                                  mit vorgebenem Reibungsgefaelle am normalen Profil
   Q_Abfrage = 'WE_SCHLEIFE'  :  Innere Abflussschleife am Wehr (alle Verluste)
   Q_Abfrage = 'GR_SCHLEIFE'  :  Grenztiefe im UW des Wehres erreicht (aus w_ber)


   Die Korrektur des Rauheitsverlustes bewirkt eine leichte Veränderung der Ergebnisse fuer Berechnungsvariante 
   "konstantes Reibungsgefälle" an Brücken- und Wehr-Bauwerken (instationäre Bauwerkstabellen). 
   Keine Auswirkungen gibt es fuer alle anderen Berechnungsvarianten und normal Profile.


   Direkt betroffene Routinen (mit Korrekturen):
     - eb2ks, verluste 

   Indirekt betroffene Routinen durch Weiterleitung der Kennung Q_ABFRAGE:
     - wspber, anf, normber, netwon, grnzh, rohre, station, pegasus, wspow, wspanf


2) In Vorbereitung: 
   Ausgliederung der Brückenberechnung aus der wspber in eine eigene Subr Bruecke.
   Noch nicht aktiv!!


							                Monika Donner, 09.07.2008 



Kalypso 2.1.4.0      23. Juli 2008
-------------------------------------    
1) BUGFIX fuer Oberwasser-Berechnung fuer Bauwerke fuer alle Berechnungsvarianten

   Probleme/ Fehler an steile Gewässer und/ oder sehr hohen Fließgeschwindigkeiten: 
   WSP-Änderungen im Oberwasser der Brücken lagen zwischen Version 1.2RC vom 11.12.2006
   und Version 1.3.1.2 vom 27.04.2007 bei +80 cm. Diese Ergebnisse der Versionen 
   ab 1.3.1.2 bis heute sind identisch.

   Ursache: Korrektur der Übergabe des Wasserspiegels hr bzw. hrow in und aus der wspow.

   Hintergrund: Für den Zustand "Wehrüberfall & Druckabfluss" (nicht Überströmen!) an Brücken 
   war ein Fehler seit 27.04.2007 im Code. Dabei wurde der Wasserspiegelanstieg seit dem 27.04.2007
   überschätzt und kann bis zu 1m über dem WSP der Versionen vor dem 27.04.2007 liegen. 
   Mit zunehmendem Überströmen der Brücke gleichen sich die Wasserspiegel wieder an. 
   So waren die Wasserspiegellagen für Q < 300 m³/s und Q > 550 m³/s an der Weißeritz wieder gleich.
   Ab 350 m³/s tritt die größte Abweichung (1m) zwischen der Version vor dem 27.04.2007 und nach
   dem 27.04.2007 auf. Mit zunehmendem Abfluss nähern sich die Wasserspiegellagen wieder an.

   Die wspow wird für Wehre und für Brücken jeweils zur ersten Berechnung des Oberwasserstandes
   verwendet. Dabei wurde bis zum 27.04.2007 der berechnete Oberwasserstand nicht richtig übergeben.
   Dies führte zum Absacken des Wasserstandes im Oberwasser des Wehres. Daher wurde die Übergabe 
   des Parameters hr (Wasserstand) in der Version vom 27.04.2007 in der Routine wspow zur 
   Verbesserung der Wehrberechnung korrigiert. An dem Beispielgewässer Stör zeigten sich damals
   (wie heute) jedoch keine Veränderungen an der Brücke. 

   Für die Wehre war diese Korrektur richtig, für die Brücken jedoch nicht. Somit wurde nun die wspow
   soweit angepasst, dass und für Wehre die korrigierte Oberwasserberechnung (wie seit 27.04.2007)
   stattfindet und für Brücken die ursprüngliche Oberwasserberechnung zurückgeholt.

   Folgende Gewässer wurden in der Version 2.1.4.0 und 2.1.3.0 bzw. 2.1.2.0 untersucht:
    * Kollau (20 Brücken) Keine Änderung bei Q = 1, 2, 4, 5 m³/s ; bei Q = 3 m³/s an einer Brücke im 
      OW stellt sich eine maximale WSP-Änderung von -9 cm ein.
    * Krückau: Keine Änderung für HQ2002, HQ 1998 und NQ  (identische Ergebnisse)
    * Stör: Keine Änderung an der Brücke und keine an den Wehren  (Q = 10, 15, 20,...,50 m³/s)
    * Bille: (x Brücken) Keine Änderung bei Q = 5, 10, 15, 20, 30, 40, 50, 60, 70, ...., 150  m³/s
      (nur eine Abweichung von -2 cm bei Q = 90m³/s. Sie tritt an 2 aufeinander folgenden Brücken auf.
       Diese Modellierung (b auf b) ist jedoch nicht zulässig. Alle anderen Abweichungen < 0,001 m.
    * Weißeritz: Änderungen zwischen 1.2RC und 2.1.4.0 liegen bei Null bzw. eine Abweichung mit -1mm.

   Achtung:
   Der Wasserspiegelanstieg trat nur für steile Gewässer und/ oder sehr hohen Fließgeschwindigkeiten auf.
   Da unsere Testmodelle (Stör, Kollau, Krückau, Bille) aus Regionen mit geringem Sohlgefälle stammen, 
   ist daher beim Testen diese Divergenz nie eingetreten.

   Betroffene Routinen:
     - wspow
							                Monika Donner, 23.07.2008 
  
   Hinweis:
   -------------------------
   Der Rechenkern kann KEINE negativen Wasserspiegellage verarbeiten. Dies betrifft auch die Zwischen-
   iterationen zur Berechnung der Wasserspiegellagen. Negative WSPs führten zu Flächen, hydraulischen
   Radien und benetzten Umfängen mit "NaN". Das Programm bricht ab.
   Ausweg: Ein Anheben des gesamten Gewässers um dz!
							                Monika Donner, 04.11.2008

	


Kalypso 2.1.4.1      07. November 2008
-------------------------------------    
1) BUGFIX fuer Abfluss-Änderungen entlang eines Gewässers speziell im Oberwasser einer Brücke 
   (Wasserspiegellagen-Berechnung)

   Die Abfrage ob ein neuer Abfluss-Wert an einer Station vorhanden ist, findet an jedem neu
   berechneten Profil (n, w, b, t, k, usw.) statt. Innerhalb einer Brückenbereich mit Impulsbilanz 
   zwischen OW und UW kann (logischerweise) keine Abflussänderung angesetzt werden.
   Wurde ein Abflusswert genau zwischen dem Profil der Brücke b und dem interpolierten Profil im Oberwasser
   der Brücke (also Station(b)+0,006 km) definiert, so konnte bislang der Abflusswert mit seiner Abfluss-Station
   kein Referenzprofil mehr finden, da die Berechnung schon über das Abfluss-Profil hinausgelaufen ist.
   Nun wird eine Warnung ausgegeben und geprüft ob das zweit-zurückliegende Profil (nprof-2) eine Brücke war
   Die Abflussänderung wird dann im Oberwasser der Brücke angesetzt.

   Betroffene Routinen:
     - wspber

   Anmerkung: Abflussänderungen innerhalb von und an Bauwerken sind vom Anwender immer kritisch
   zu überdenken!

									Monika Donner, 07.11.2008



   
Kalypso 2.1.5.0      20. August 2009
-------------------------------------    
1) BUGFIX fuer negative Wasserspiegellagen bzw. negative GOK im Profil
   (alle Berechnungen: Wasserspiegellage bis Polynomberechnungen)

   Kontrolle und BUGFIX in allen normalen Berechnungsroutinen für negative WSP und/ oder negative
   Geländekanten im Profil. Nun ist auch ein Start mit einem negativen Wasserstand im Unterwasser
   Profil möglich. 
   
   Betroffene Routinen:
     - wspanf, eb2ks, newton, normber, uf


   Anmerkung: Negativer WSP geht nach wie vor nicht reibungslos in Wehren und Brücken! Eine negative
              Geometrie bei positivem Wasserspigel funktioniert jedoch. --> TODO

									Monika Donner, 20.08.2009










