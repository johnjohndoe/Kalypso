CIPK  NEW ROUTINE JUNE 28 2005
      SUBROUTINE INTIMES
      
	USE TSVAR
      USE BLK10MOD

	CHARACTER*8  IDC
	CHARACTER*72 DLINC
	INTEGER DAYON,DAYOF

	NTIMEMX=0
	NTIMSET=0
	CALL GINPT(INTIMS,IDC,DLINC)
	IF(IDC(1:2) .EQ. 'TI') THEN
  	  WRITE(*,*) 'Reading title on time series',DLINC
      ENDIF

  100 CONTINUE
	CALL GINPT(INTIMS,IDC,DLINC)
  120 CONTINUE
	NTIMES=0
      IF(IDC(1:3) .EQ. 'IDT') THEN
	  NTIMSET=NTIMSET+1
  150   CALL GINPT(INTIMS,IDC,DLINC)
	  IF(IDC(1:3) .EQ. 'NTV') THEN
	    NTIMES=NTIMES+1
	    GO TO 150
	  ELSEIF(IDC(1:7) .EQ. 'ENDDATA') THEN
	    IF(NTIMEMX .LT. NTIMES) NTIMEMX=NTIMES
	    GO TO 200 
	  ELSEIF(IDC(1:3) .EQ. 'IDT') THEN
	    IF(NTIMEMX .LT. NTIMES) NTIMEMX=NTIMES
          GO TO 120
        ENDIF
	ENDIF
	GO TO 100
	
  200 CONTINUE
      REWIND INTIMS
      CALL GINPT(INTIMS,IDC,DLINC)

	ALLOCATE (CTIMEON(NTIMSET,NTIMEMX),CTIMEOF(NTIMSET,NTIMEMX),
     +   HTIMEON(NTIMSET,NTIMEMX),HTIMEOF(NTIMSET,NTIMEMX))
CIPK DEC05 ADD HTIMEON,HTIMEOF
	DO K=1,NTIMSET
	  DO L=1,NTIMEMX
	    CTIMEON(K,L)=-9999.
	    CTIMEOF(K,L)=-9999.
	    HTIMEON(K,L)=1.
	    HTIMEOF(K,L)=1.
	  ENDDO
	ENDDO

	DO K=1,NTIMSET
  	  CALL GINPT(INTIMS,IDC,DLINC)
  250   READ(DLINC,'(2I8)') ID1,IYTIM
        NTMREF(ID1)=K

        DO L=1,NTIMEMX
     	    CALL GINPT(INTIMS,IDC,DLINC)
	    IF(IDC(1:3) .EQ.  'NTV') THEN
	      READ(DLINC,5010) DAYON,HRON,DAYOF,HROF,HSTART,HTOFF
	      CTIMEON(K,L) = (DAYON-1)*24.+HRON
	      CTIMEOF(K,L) = (DAYOF-1)*24.+HROF
	      HTIMEON(K,L)=CTIMEON(K,L)+HSTART
	      HTIMEOF(K,L)=CTIMEOF(K,L)-HTOFF
	    ELSEIF(IDC(1:7) .EQ. 'ENDDATA') THEN
            RETURN
          ELSE
            GO TO 250
	    ENDIF
	  ENDDO
	ENDDO	 
 5010 FORMAT(I8,F8.0,I8,3F8.0)
	RETURN
	END
