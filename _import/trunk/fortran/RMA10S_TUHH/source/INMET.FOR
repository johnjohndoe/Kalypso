CIPK  LAST UPDATE SEP 6 2004 add error file
CIPK  LAST UPDATE AUG 5 2003 EXPAND TO ADD WIND DIRECTION
CIPK  LAST UPDATE SEP27 2002 ADD SNOW DEPTH
CIPK  LAST UPDATE JULY01 2001 ADD DEWPOINT OPTION
CIPK  LAST UPDATED Dec 17 1997
cipk  last updated Nov 26 1997
CIPK  LAST UPDATED AUGUST 28 1995
      SUBROUTINE INMET(LOUT,NMETF,TET)
C
      USE BLKMETMOD
      USE BLK11MOD

      CHARACTER*8  ID
CIPK SEP02
      CHARACTER*88 DLIN10

C
C       Skip if no heat budget
C
      TOFDAY = TET
      IF(MMET .EQ. 0) RETURN
C
C-
C...... Initialize
C-
C      WRITE(*,*) 'IN GETMET IT,MMET',IT,MMET
      NMETF=0
      NSCRM=40
C-
C..... Read header from graph file
C-
cipk nov97      READ(IIQ,'(A8,A72)') ID,DLIN
CIPK SEP02
      call ginpt10(iiq,id,dlin10)
      READ(DLIN10(1:72),'(A72)') METITL
cipk nov97      READ(IIQ,'(A8,A72)') ID,DLIN
      call ginpt10(iiq,id,dlin10)
      READ(DLIN10,1026) ELEVAT,LAT,LONG,STANM,IYT,METRIC,EXTINC
     +,IHTMET,IWNDMET
CIPK AUG03 ADD SWITCHES
 1026 FORMAT(4F8.4,I8,8X,I8,F8.0,2I8)
      WRITE(LOUT,2036) ELEVAT,LAT,LONG,STANM,IYT,METRIC,EXTINC
     +,IHTMET,IWNDMET
 2036 FORMAT( /10x,'ELEVATION OF SITE',T40,F10.1/
     +         10X,'LATITUDE OF SITE',T40,F10.1/
     +         10X,'LONGITUDE OF SITE',T40,F10.1/
     +         10X,'STANDARD TIME AT SITE',T40,F10.1/
     +         10X,'STARTING YEAR FOR DATA',T40,I10/
     +         10X,'SWITCH FOR ATMOS DATA 0=ENG,1=MET',T46,I4/
     +         10X,'SOLAR EXTINCTION COEFFICIENT',T44,F6.3,' (1/M)'/
     +         10X,'MET DATA DEACTIVATE SWITCH',T44,I6/
     +         10X,'WIND STRESS SIMULATION SWITCH',T44,I6)
      IF(IHTMET .EQ. 1) MMET=0
CIPK AUG03 ADD HEAT AND WIND SWITCH AND TEST FOR ACTIVE HEAT
cipk nov97      READ(IIQ,'(A8,A72)') ID,DLIN
CIPK SEP02
      call ginpt10(iiq,id,dlin10)
      IJULD = DAYOFY
  200 CONTINUE
      IYS(NMETF+1)=IYT
CIPK SEP02
      READ(DLIN10(1:72),'(A72)') METITL
cipk nov97      READ(IIQ,'(A8,A72)') ID,DLIN
      call ginpt10(iiq,id,dlin10)
      IF(ID(1:2) .EQ. 'ET') THEN
        NSCRM=NSCRM+1
        OPEN(NSCRM,FORM='UNFORMATTED',STATUS='SCRATCH')
CIPK SEP02
        READ(DLIN10,'(9I8)') (METID(NMETF+1,J),J=1,9)
        WRITE(*,*) NMETF+1
C            WRITE(*,*) (METID(NMETF+1,J),J=1,9)
cipk nov97        READ(IIQ,'(A8,A72)') ID,DLIN
CIPK SEP02
        call ginpt10(iiq,id,dlin10)
        IF(ID(1:2) .EQ. 'EV') THEN
cipk dec97 add switch for solar radiation
          READ(DLIN10,'(2F8.6,2I8)') AETMP(NMETF+1),BETMP(NMETF+1)
     +                        ,ISOL(NMETF+1),IDPT(NMETF+1)
cipk jul01 add idpt switch to data

        ELSE
cipk sep04
          CLOSE(75)
          OPEN(75,FILE='ERROR.OUT')
          WRITE(*,*) 'ERROR --- NO EV DATA FOUND'
          WRITE(75,*) 'ERROR --- NO EV DATA FOUND'
          STOP
        ENDIF
  210   CONTINUE
cipk nov97        READ(IIQ,'(A8,A72)') ID,DLIN
CIPK SEP02
        call ginpt10(iiq,id,dlin10)
        IF(ID(1:2) .EQ. 'TI') GO TO 220
        IF(ID(1:7) .EQ. 'ENDDATA') THEN
          wdt1(1,1)=1.e20
CIPK DEC97 CHANGE LIMIT OT 9 TO ALLOW DIRECT SOLAR INPUT
CIPK AUG03 EXPAND TO ADD WIND DIRECTION
          WRITE(NSCRM) (WDT1(J,1),J=1,11)
          REWIND NSCRM
          NMETF=NMETF+1
          GO TO 230
        ENDIF
        IF(ID(1:3) .EQ. 'MET') THEN
          READ(ID(5:8),'(F4.0)') WDT1(1,1)
CIPK DEC97 CHANGE LIMIT OT 9 TO ALLOW DIRECT SOLAR INPUT
CIPK SEP02
CIPK AUG03 EXPAND TO ADD WIND DIRECTION
          READ(DLIN10,'(11F8.4)') (WDT1(J,1),J=2,11)
C          WRITE(*,*) 'WDT1',WDT1(1,1),NSCRM,WDT1(2,1)
CIPK DEC97 CHANGE LIMIT OT 9 TO ALLOW DIRECT SOLAR INPUT
CIPK AUG03 EXPAND TO ADD WIND DIRECTION
          WRITE(NSCRM) (WDT1(J,1),J=1,11)
          GO TO 210
        ELSE
cipk sep04
          CLOSE(75)
          OPEN(75,FILE='ERROR.OUT')
          WRITE(75,*) 'ERROR --- NO MET DATA FOUND'
          WRITE(*,*) 'ERROR --- NO MET DATA FOUND'
          STOP
        ENDIF
  220   CONTINUE
        wdt1(1,1)=1.e20
CIPK DEC97 CHANGE LIMIT OT 9 TO ALLOW DIRECT SOLAR INPUT
CIPK SEP02
CIPK AUG03 EXPAND TO ADD WIND DIRECTION
        WRITE(NSCRM) (WDT1(J,1),J=1,1)
        REWIND NSCRM
        NMETF=NMETF+1
        GO TO 200
      ELSE
        WRITE(*,*) 'ERROR --- NO ET DATA FOUND' 
      ENDIF
  230 CONTINUE

C
      RETURN
      END
