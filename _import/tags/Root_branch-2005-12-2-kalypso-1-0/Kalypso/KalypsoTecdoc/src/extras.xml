<?xml version="1.0" encoding="UTF-8"?>
<chapter id="extras">
	<title>Zusätzliche Information</title>
	
	<para>Hier werden speziellen Aspekte von Kalypso beschrieben.</para>
	
	<section id="dwd-vorhersage">
		<title>Integration der DWD-Vorhersage</title>
		
		<para>Für die Prognoserechnung wird eine Niederschlagsvorhersage benötigt. Die
			hier verwendete Vorhersage des DWD wird in einer Datei (DWD-lm2-Format)
			geliefert. Es handelt sich um eine Datei mit mehreren Rastern, die eine
			Vorhersage über 48 Stunden beinhaltet.</para>
		
		<para>Folgende Raster werden zur Zeit geliefert:
			
			<orderedlist>
				<listitem>
					<para>Liste von Rechtswerten der Rasterzellen</para>
				</listitem>
				<listitem>
					<para>Liste von Hochwerten der Rasterzellen</para>
				</listitem>
				<listitem>
					<para>Liste von Höhenwerten der Rasterzellen</para>
				</listitem>
				<listitem>
					<para>Flüssiger Niederschlag stündlich (1 Liste je Stunde, &gt; 48
						Listen)</para>
				</listitem>
				<listitem>
					<para>Wasseräquivalent fester Niederschlag stündlich (1 Liste je
						Stunde, &gt; 48 Listen)</para>
				</listitem>
			</orderedlist> </para>
		
		<para>Die Implementierung zur Integration der Vorhersage ist im Quellcodeprojekt
			KalypsoDWD enthalten.</para>
		
		<section>
			<title>Allgemeiner Ablauf</title>
			
			<para>Der Ablauf allgemein:</para>
			
			<orderedlist>
				<listitem>
					<para>Die Vorhersagedateien werden seitens der HVZ in einem
						Verzeichnis abgelegt.</para>
				</listitem>
				<listitem>
					<para>Die aktuellste Vorhersage wird durch der Serverdienst
						KalypsoDWDFileCopyServlet erkannt und im webdav/dwd
						Verzeichnis abgelegt.</para>
				</listitem>
				<listitem>
					<para>Von dort aus können die Kalypso-Clients darauf zugreifen und
						bei Bedarf Gebietsniederschlagszeitreihen umrechnen.</para>
				</listitem>
				<listitem>
					<para>Die umgerechneten Gebietsniederschläge werden direkt im
						Vorhersagewizard angezeigt. Veraltete Vorhersagen werden
						stets überschrieben.</para>
				</listitem>
			</orderedlist>
		</section>
		
		<section>
			<title>Konfiguration</title>
			
			<para>Der Dienst wird über die für Servlet standard vorhandene
				<filename>web.xml</filename>-Datei konfiguriert. Folgender Listing
				beinhaltet ein Beispiel mit entsprechende Beschreibungen.</para>
			
			<figure>
				<title>Darstellung</title>
				<mediaobject>
					<imageobject>
						<imagedata fileref="img/kap10/Konfiguration.png"/>
					</imageobject>
				</mediaobject>
			</figure>
			
			<para>Die Konfiguration umfasst folgende Informationen:</para>
			
			<orderedlist>
				<listitem>
					<para>Anzahl an Verzeichnisse die für aktuelle DWD-Vorhersagen
						geprüft werden müssen (instances). Die Eingaben für allen
						anderen Parameter sind davon abhängig: sobald der Anzahl größer
						als 1 ist, müsse semikolon getrennte Angaben für die anderen
						Parameter gemacht werden.</para>
				</listitem>
				<listitem>
					<para>Dauer der Zeitperiode zwischen zwei Prüfzyklen
						(period).</para>
				</listitem>
				<listitem>
					<para>Verzeichnis, in das die aktuelle DWD-Vorhersage abgeholt
						werden muss (source).</para>
				</listitem>
				<listitem>
					<para>Dateiprefix der zu suchende DWD-Vorhersage
						(source_prefix)</para>
				</listitem>
				<listitem>
					<para>Dateinamensformat der zu suchende DWD-Vorhersage, damit das
						Datum daraus gefiltert werden kann. Das Datum wird ausgewertet um
						die aktuelle Vorhersage anhand dieses Datum zu erschliessen.
						(source_format).</para>
				</listitem>
				<listitem>
					<para>Ob die eingelesene DWD-Vorhersage nachdem die Bearbeitung
						fertig ist gelöscht aus dem Quellverzeichnis (source) werden
						muss (source_delete).</para>
				</listitem>
				<listitem>
					<para>Zieldateiname inkl. Pfad der zu erstellende DWD-Vorhersage.
						Nach jedem Zyklus wird diese Datei mit der aktuelle Vorhersage
						ersetzt (dest).</para>
				</listitem>
				<listitem>
					<para>Gibt an ob die Zieldatei überarbeitet werden muss, damit die
						Daten konsistent bleiben. Im Normalfall ist dies nicht
						erforderlich, da die Daten übereinstimmen. Aber im
						Katastrophentestszenario z.B. werden DWD-Vorhersage der
						Vergangeheit als aktuelle Vorhersagen geliefert, dabei stimmt
						das Datum aus der Dateiname nicht mit dem Inhalt der Vorhersage
						überein: in der Datei sind noch die alte Daten zu sehen. Wenn dieser
						Parameter aktiviert wird (true), wird also die Datei
						überarbeitet und die darin enthaltene Daten mit dem aktuellen
						Datum überschrieben (dest_update).</para>
				</listitem>
			</orderedlist>
			
			<para>Es ist darauf zu achten, dass der Dienst Schreib- und Leserechte für die
				verwendeten Verzeichnisse und Dateien benötigt.</para>
		</section>
	</section>
	
	<section id="url-erweiterung">
		<title>URL-Erweiterung</title>
		
		<para>Kalypso nutzt URLs, um Resourcen (Dokumente oder Dateien) zu
			referenzieren.</para>
		
		<para>Die Standardprotokolle sind:</para>
		
		<itemizedlist>
			<listitem>
				<para>file: absolute oder relative Pfadangabe im lokale
					Filesystem</para>
			</listitem>
			<listitem>
				<para>http: HTTP-Adresse</para>
			</listitem>
		</itemizedlist>
		
		<para>Zusätzlich definiert Kalypso die folgenden Protokolle:</para>
		
		<itemizedlist>
			<listitem>
				<para>project: der Pfad ist relativ zum Eclipse-Projekt</para>
			</listitem>
			<listitem>
				<para>workspace: der Pfad ist relativ zum Eclipse-Workspace</para>
			</listitem>
			<listitem>
				<para>Kalypso-ocs: der Pfad ist relativ zum
					Kalypso-Zeitreihendienst</para>
			</listitem>
			<listitem>
				<para>calccase: der Pfad ist relativ zu einer Rechenvariante</para>
			</listitem>
		</itemizedlist>
		
		<para>Bei <emphasis>project</emphasis>, <emphasis>calccase</emphasis> und
			<emphasis>workspace</emphasis> ist der Pfad immer relativ, und zwar zum
			jeweiligen angegebenen Element: also Project, Workspace, oder
			Rechenvairante.</para>
		
		<para>Bei <emphasis>file</emphasis> kann der Pfad relativ sein. In diesem Fall ist
			der Pfad (wie in RFC 2396) relativ zu einem Kontext, was von einer Basis-URL
			definiert wird. In Kalypso ist diese Basis-URL des öfteren identisch mit der URL
			des besitzenden Dokumentes. Beispiel: ein ZML-Dokument hat einen Link auf
			externe Werte, welcher über eine relative URL definiert ist. Die Basis-URL ist
			in diesem Fall die URL des ZML-Dokuments.</para>
	</section>
</chapter>
