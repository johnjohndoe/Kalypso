<?xml version="1.0" encoding="UTF-8"?>
<section id="wiski" vendor="sachsen-anhalt">
	<title>Schnittstelle zu Wiski/WebDataProvider</title>
	
	<para>Die Schnittstelle zwischen Kalypso und Wiski/WebDataProvider (WDP) wird im
		Projekt KalypsoAdapterWiski implementiert. Damit werden Zeitreihen werden aus
		Wiski abgeholt und prognose Zeitreihen in Wiski zurück geschrieben.</para>
	
	<section>
		<title>Überblick</title>
		
		<para>Folgende Tabelle fasst die Anwendung der WDP Schnittstelle aus Kalypso Sicht
			zusammen. Die Aufrufe erfolgen über Java-RMI (Remote Method
			Invocation).</para>
		
		<table>
			<title>Benutzte Methoden der WDP-Schnittstelle</title>
			
			<tgroup cols="2">
				<colspec align="left" colwidth="1*"/>
				
				<colspec align="left" colwidth="2*"/>
				
				<thead>
					<row>
						<entry align="center">WISKI</entry>
						<entry align="center">Kalypso - Beschreibung</entry>
					</row>
				</thead>
				
				<tbody>
					<row>
						<entry>getSuperGroupList</entry>
						<entry>Liste der WISKI Gruppenarten ermitteln. Dient zum Aufbau
							der IRepository Struktur in Kalypso.</entry>
					</row>
					<row>
						<entry>getGroupList</entry>
						<entry>Liste der WISKI Gruppen ermitteln. Dient zum Aufbau der
							IRepository Struktur in Kalypso.</entry>
					</row>
					<row>
						<entry>getTsInfoList</entry>
						<entry>Liste der Zeitreihen ermitteln.</entry>
					</row>
					<row>
						<entry>getAlarmLevelList</entry>
						<entry>Alarmstufen abfragen.</entry>
					</row>
					<row>
						<entry>getRatingTables</entry>
						<entry>W/Q und W/V Beziehungen abfragen.</entry>
					</row>
					<row>
						<entry>getStationDetailList</entry>
						<entry>Metadaten abfragen.</entry>
					</row>
					<row>
						<entry>getTsData</entry>
						<entry>Zeitreihendaten abholen.</entry>
					</row>
					<row>
						<entry>IsTsWritable</entry>
						<entry>Prüfen ob Daten einer Zeitreihe zurückgeschrieben
							werden können.</entry>
					</row>
					<row>
						<entry>setTsData</entry>
						<entry>Zeitreihendaten zurückschreiben.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	
	<section>
		<title>Quellcode</title>
		
		<para>Die Implementierung in Kalypso basiert auf dem IRepository-Framework
			(siehe Java-Interface org.Kalypso.repository.IRepository). Die
			Schnittstelle wird nur serverseitig benutzt.</para>
		
		<para>Die Firma Kisters hat die Funktionen der WDP über eine Java-Bilbiothek zur
			Verfügung gestellt. Aus dem Namensraum
			<filename>de.kisters.wiski.webdataprovider</filename> sind alle WDP
			Klassen zu erreichen.</para>
	</section>
	
	<section>
		<title>Konfiguration</title>
		
		<para>Die Implementierung der Kalypso-WDP Schnittstelle ist über eine
			Konfigurationsdatei anpassbar (Siehe in
			org/Kalypso/wiskiadapter/resources/config.ini). Dort werden die mögliche
			Parameter gelistet und beschrieben. Siehe auch die nächste Abbildung:</para>
		
		<figure>
			<title>Konfiguration1</title>
			
			<mediaobject>
				<imageobject>
					<imagedata fileref="img/kap11/Konfiguration_1.png"/>
				</imageobject>
			</mediaobject>
		</figure>
		
		<figure>
			<title>Konfiguration2</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="img/kap11/Konfiguration_2.png"/>
				</imageobject>
			</mediaobject>
		</figure>
		
	</section>
	
	<section>
		<title>Besonderheiten</title>
		
		<para>Aus der Implementierung der Schnittstelle für die HVZ sind folgende
			Besonderheiten entstanden.</para>
		
		<section>
			<title>WDP-Login</title>
			
			<para>Die WDP-Schnittstelle von Kisters wurde speziell für‘s Web entwickelt
				wo eine Interaktion zwischen Benutzer/Browser Applikation und Wiski ein
				Login/Logout Mechanimus mit automatisches Logout nach einen bestimmten
				Zeit vorsieht. Die Anwendung dieser Schnittstelle in Kalypso steift aber
				eine andere Art von Interaktion zwischen beide Systemen dar Login/Logout,
				aber ohne Timeout. Die WDP-SST wird nämlich direkt vom Kalypso Observation
				Dienst benutzt, ohne unterschied zwischen den tatsächlichen
				angemeldeten Benutzer. Das heisst, der Kalypso Observation Dienst meldet
				sich beim Start an dem WDP an und meldet sich nur in bestimmten Fällen
				ab:</para>
			
			<itemizedlist>
				<listitem>
					<para>beim Stoppen der Dienst</para>
				</listitem>
				<listitem>
					<para>beim Stoppen der Server</para>
				</listitem>
			</itemizedlist>
			
			<para>und wann dies tatsächlich passiert ist nicht vorhersehbar Das bedeutet
				das ein automatisches Logout, durch den WDP vorangetrieben, nicht
				ausgeschlossen werden kann.</para>
			
			<para>Der Kalypso Observation Dienst wurde gegen einen solchen Art von Logout
				dementsprechend vorbereitet, indem er automatisch versucht, sich wieder
				einzuloggen. Dadurch ist die Verbindung zwischen Kalypso und WDP stets
				ohne Ausfall garantiert, vorrausgesetzt die Systemen stehen zur
				Verfügung.</para>
			
			<para>Dies wurde im Code durch das Anfrage orientierte Verwaltung der
				WDP-Aufrufe berücksichtigt (Siehe lWiskiCall und WiskiRepository.
				executeWiskiCall).</para>
		</section>
		
		<section>
			<title>Caching Mechanismus von W/Q-artigen Beziehungen</title>
			
			<para>Die aktuellen aus WISKI gelesenen W/Q oder W/V Beziehungen werden als
				Datei gespeichert. Sollte WISKI nicht mehr zur Verfügung stehen, wird die
				abgespeicherte Datei benutzt. Dies dient zu Datenverfügbarkeit im Falle
				eines Ausfall.</para>
			
			<para>Dazu wurde speziell die WiskiObservationManipulator Klasse erstellt.
				Es wird vom KalypsoObservationDienst benutzt, über Reflektion
				instanziert, und in die Konfigurationsdatei vom Observation Dienst
				konfiguriert. Konfigurationsausschnitt:</para>
			
			<figure>
				<title>Caching-Mechanismus von WQ-Beziehungen</title>
				
				<mediaobject>
					<imageobject>
						<imagedata fileref="img/kap11/Caching_Mechanismus.png"/>
					</imageobject>
				</mediaobject>
			</figure>
		</section>
		
		<section>
			<title>Zeitzonen-Problematik</title>
			
			<para>Damit die Zeitreihen einheitlich zwischen Wiski und Kalypso angezeigt
				werden, wurde die Einstellung der Zeitzone (auch eine Eigenschaft der
				Konfiguration vom Observation Dienst) auf GMT1 gesetzt. Wiski arbeitet
				immer in Winterzeit.</para>
		</section>
	</section>
	
	<section>
		<title>Laufzeit</title>
		
		<para>Zur Laufzeit wird die Java-Bibliothek kiwwebdp-externalclient.jar
			benötigt und ist Lib-Verzeichnis des Projekt KalypsoAdapterWiski abgelegft.
			Da RMI standardmäßig mit dem JDK geliefert wird werden hierzu keine spezielle
			Abhängigkeiten benötigt.</para>
		
		<para>Da Tomcat im Sicherheitsmodus gestartet wird, sind entsprechende Einträge
			für die WDP-Codebase notwendig. Die Datei catalina.policy beinhaltet einen
			speziellen Bereich für WDP (siehe catalina.policy im `conf’-Verzeichnis von
			Tomcat).</para>
	</section>
	
	<section>
		<title>Zeitreihen</title>
		
		<para>WISKI liefert definierte Statuswerte zu den Werten einer Zeitreihe. Diese
			müssen auf die innerhalb von Kalypso benutzten Stati abgebildet werden. Die
			Umwandlung der Status-Information erfolgt beim Abruf der Daten aus WISKI in
			folgender Weise:</para>
		
		<informaltable id="tbl_11_06_zeitreihen">
			<tgroup cols="2">
				<colspec align="left" colwidth="1*"/>
				
				<colspec align="left" colwidth="1*"/>
				
				<thead>
					<row>
						<entry align="center">WISKI</entry>
						
						<entry align="center">Kalypso</entry>
					</row>
				</thead>
				
				<tbody>
					<row>
						<entry>GOOD</entry>
						
						<entry>OK</entry>
					</row>
					
					<row>
						<entry>ESTIMATED</entry>
						
						<entry>Wert auf Gültigkeit prüfen</entry>
					</row>
					
					<row>
						<entry>SUSPECT</entry>
						
						<entry>Wert auf Gültigkeit prüfen</entry>
					</row>
					
					<row>
						<entry>UNCHECKED</entry>
						
						<entry>OK</entry>
					</row>
					
					<row>
						<entry>MISSING</entry>
						
						<entry>Wert auf Gültigkeit prüfen</entry>
					</row>
					
					<row>
						<entry>COMPLETE</entry>
						
						<entry>OK</entry>
					</row>
					
					<row>
						<entry>INCOMPLETE</entry>
						
						<entry>Wert auf Gültigkeit prüfen</entry>
					</row>
				</tbody>
			</tgroup>
		</informaltable>
		
		<para>Wenn Prognose-Zeitreihen von Kalypso nach WISKI zurückgeschrieben werden
			bekommen sie automatisch den Status GOOD.</para>
	</section>
</section>
