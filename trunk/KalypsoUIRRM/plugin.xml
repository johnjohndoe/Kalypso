<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.0"?>
<plugin>
   <extension
         point="org.kalypso.core.catalogContribution">
      <catalogContribution
            class="org.kalypso.ui.rrm.catalog.RRMFeatureTypeStyleCatalogContribution"
            name="RRM-Style-Catalog"/>
   </extension>
   
   <extension
         point="org.eclipse.ui.newWizards">
      <category
            id="org.kalypso.ui.newwizards.kalypso.rrm"
            name="%Category.name"
            parentCategory="org.kalypso.ui.newwizards.kalypso"/>
      <wizard
            category="org.kalypso.ui.newwizards.kalypso/org.kalypso.ui.newwizards.kalypso.rrm"
            class="org.kalypso.ui.rrm.internal.newproject.KalypsoNAProjectWizard"
            finalPerspective="org.kalypso.ui.perspectives.ModelerPerspectiveFactory"
            hasPages="true"
            icon="icons/kalypso16.gif"
            id="org.kalypso.ui.rrm.wizards.KalypsoNAProjectWizard"
            name="%NewWizard.name"
            project="true">
         <description>
            %org.kalypso.ui.rrm.wizards.KalypsoNAProjectWizard.description
         </description>
      </wizard>
   </extension>
   
   <extension point="org.kalypso.module.kalypsoModule">
      <module class="org.kalypso.ui.rrm.KalypsoModuleRRM"/>
   </extension>
   
  <!-- Commands for the map or map outline -->
	<extension point="org.eclipse.ui.commands">
	    <!-- Map -->
	    <command categoryId="org.kalypso.ogc.gml.map.category" id="org.kalypso.ogc.gml.map.EditRelationsCommand" name="%org.kalypso.ui.editor.mapeditor.actiondelegates.EditRelationsWidgetDelegate.label" description="%org.kalypso.ui.editor.mapeditor.actiondelegates.EditRelationsWidgetDelegate.tooltip"/>
	    
	    <!-- Map Outline -->
		<command categoryId="org.kalypso.ui.map.outline.category" id="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" name="%command.name.3"/>
		<!--
		<command categoryId="org.kalypso.ui.map.outline.category" id="org.kalypso.model.rrm.ui.map.outline.command.FixHydrotopes" name="Fix Hydrotopes" description="Fixes old hydrotope files (i.e. sets links to catchments)"/>
		-->
	</extension>

	 <extension  point="org.eclipse.ui.commandImages">
	    <image commandId="org.kalypso.ogc.gml.map.EditRelationsCommand" disabledIcon="icons/commands/edit_relation_gray.gif" icon="icons/commands/edit_relation.gif" />
	 
	    <image commandId="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" icon="icons/geologyImport.gif"/>
	 </extension>

	<extension point="org.eclipse.ui.handlers">
        <handler commandId="org.kalypso.ogc.gml.map.EditRelationsCommand">
            <class class="org.kalypso.ogc.gml.map.widgets.SelectWidgetHandler">
                <parameter name="org.kalypso.ogc.gml.map.widgets.SelectWidgetCommand.widget" value="org.kalypso.ui.rrm.internal.map.editRelation.EditRelationWidget" />
            </class>
            <enabledWhen>
                <with variable="activeMapPanel">
                    <or>
                        <test property="org.kalypso.ui.test.map.activeTheme.qname" value="{http://www.tuhh.de/kalypsoNA}Node" />
                        <test property="org.kalypso.ui.test.map.activeTheme.qname" value="{http://www.tuhh.de/kalypsoNA}_Channel" />
                        <test property="org.kalypso.ui.test.map.activeTheme.qname" value="{http://www.tuhh.de/kalypsoNA}Catchment" />
                    </or>
                </with>
            </enabledWhen>
        </handler>
	
		<handler commandId="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" class="org.kalypso.ui.rrm.internal.hydrotops.RRMCreateHydrotopsHandler">
			<activeWhen>
				<reference definitionId="org.kalypso.ui.rrm.definition.onlyRRMThemesSelected"/>
			</activeWhen>
		</handler>
		<!--
		<handler commandId="org.kalypso.model.rrm.ui.map.outline.command.FixHydrotopes" class="org.kalypso.ui.rrm.action.FixHydrotopesHandler">
			<activeWhen>
				<reference definitionId="org.kalypso.ui.rrm.definition.oneHydrotopeThemeSelected"/>
			</activeWhen>
		</handler>
		-->
	</extension>

	<extension point="org.eclipse.ui.menus">
   		<menuContribution locationURI="popup:org.eclipse.ui.popup.any?after=additions">
			<command commandId="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" style="push">
				<visibleWhen checkEnabled="false">
					<reference definitionId="org.kalypso.ui.rrm.definition.onlyRRMThemesSelected"/>
				</visibleWhen>
			</command>
			<!--
			<command commandId="org.kalypso.model.rrm.ui.map.outline.command.FixHydrotopes" style="push">
				<visibleWhen checkEnabled="true"/>
			</command>
			-->
		</menuContribution>
	</extension>

	<extension point="org.eclipse.core.expressions.definitions">
		<definition id="org.kalypso.ui.rrm.definition.oneLanduseThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
					    <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
						  <test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/landuse}Landuse"/>
					    </adapt>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.onePedologyThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
                        <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
						      <test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/pedologie}Soiltype"/>
                        </adapt>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.oneGeologyThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
                        <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
						  <test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/geologie}Geologie"/>
                        </adapt>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.oneHydrotopeThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
                        <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
						  <test property="org.kalypso.ui.test.theme.qname" value="{http://www.tuhh.de/hydrotop}Hydrotop"/>
                        </adapt>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.onlyRRMThemesSelected">
			<with variable="selection">
				<and>
					<count value="+"/>
					<or>
						<iterate ifEmpty="false" operator="or">
                            <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
    							<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/geologie}Geologie"/>
                            </adapt>
						</iterate>
						<iterate ifEmpty="false" operator="or">
                            <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
    							<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/pedologie}Soiltype"/>
                            </adapt>
						</iterate>
						<iterate ifEmpty="false" operator="or">
                            <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
    							<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/landuse}Landuse"/>					
                            </adapt>
						</iterate>
						<iterate ifEmpty="false" operator="or">
                            <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
    							<test property="org.kalypso.ui.test.theme.qname" value="{http://www.tuhh.de/hydrotop}Hydrotop"/>					
                            </adapt>
						</iterate>
						<iterate ifEmpty="false" operator="or">
                            <adapt type="org.kalypso.ogc.gml.IKalypsoTheme">
    							<test property="org.kalypso.ui.test.theme.qname" value="{http://www.tuhh.de/kalypsoNA}Catchment"/>					
                            </adapt>
						</iterate>
					</or>
				</and>
			</with>
		</definition>
	</extension>


 <extension
       point="org.eclipse.ui.commands">
    <category
          description="%org.kalypso.ui.rrm.commandCategory.description"
          id="org.kalypso.ui.rrm.commandCategory"
          name="%org.kalypso.ui.rrm.commandCategory.name">
    </category>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.ui.rrm.command.calccase.runCalcCase.label"
               description="%org.kalypso.ui.rrm.command.calccase.runCalcCase.tooltip"
               id="org.kalypso.ui.rrm.command.calccase.runCalcCase">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.ui.rrm.command.calccase.updateCalcCaseTimeseries.label"
               description="%org.kalypso.ui.rrm.command.calccase.updateCalcCaseTimeseries.tooltip"
               id="org.kalypso.ui.rrm.command.calccase.updateCalcCaseTimeseries">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.ui.rrm.command.calccase.copyCalcCase.label"
               description="%org.kalypso.ui.rrm.command.calccase.copyCalcCase.tooltip"
               id="org.kalypso.ui.rrm.command.calccase.copyCalcCase">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.ui.rrm.command.calccase.newCalcCase.label"
               description="%org.kalypso.ui.rrm.command.calccase.newCalcCase.tooltip"
               id="org.kalypso.ui.rrm.command.calccase.newCalcCase">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.ui.rrm.command.calccase.setBasicModel.label"
               description="%org.kalypso.ui.rrm.command.calccase.setBasicModel.tooltip"
               id="org.kalypso.ui.rrm.command.calccase.setBasicModel">
         </command>
 </extension>
 <extension
       point="org.eclipse.ui.commandImages">
         <image icon="icons/commands/startCalculation.gif" commandId="org.kalypso.ui.rrm.command.calccase.runCalcCase"/>
         <image icon="icons/commands/refreshCalcCase.gif" commandId="org.kalypso.ui.rrm.command.calccase.updateCalcCaseTimeseries"/>
         <image icon="icons/commands/copyCalcCase.gif" commandId="org.kalypso.ui.rrm.command.calccase.copyCalcCase"/>
         <image icon="icons/commands/createCalcCase.gif" commandId="org.kalypso.ui.rrm.command.calccase.newCalcCase"/>
         <image icon="icons/commands/export-simple-template.gif" commandId="org.kalypso.ui.rrm.command.calccase.setBasicModel"/>
         
         <image icon="icons/timeseries/timeseriesManagementView.gif" commandId="org.kalypso.model.rrm.timeseriesManagement"/>
 </extension>
 <extension
       point="org.eclipse.ui.handlers">
         <handler class="org.kalypso.ui.rrm.internal.calccase.StartCalculationActionDelegate" commandId="org.kalypso.ui.rrm.command.calccase.runCalcCase"/>
         <handler class="org.kalypso.ui.rrm.internal.calccase.UpdateCalcCaseTimeseries" commandId="org.kalypso.ui.rrm.command.calccase.updateCalcCaseTimeseries"/>
         <handler class="org.kalypso.ui.rrm.internal.calccase.CopyCalcCaseDelegate" commandId="org.kalypso.ui.rrm.command.calccase.copyCalcCase"/>
         <handler class="org.kalypso.ui.rrm.internal.calccase.NewCalcCaseAction" commandId="org.kalypso.ui.rrm.command.calccase.newCalcCase"/>
         <handler class="org.kalypso.ui.rrm.internal.calccase.SetBasicModelDelegate" commandId="org.kalypso.ui.rrm.command.calccase.setBasicModel"/>
 </extension>
 <extension
       point="org.eclipse.ui.menus">
    <menuContribution
          locationURI="menu:org.eclipse.ui.main.menu?after=edit">
       <menu label="%org.kalypso.simulation.ui.menu.calcCase.label" mnemonic="%org.kalypso.simulation.ui.menu.calcCase.mnemonic">
          <separator name="calcCaseStart" visible="false"/>
          <command commandId="org.kalypso.ui.rrm.command.calccase.newCalcCase" style="push"/>
          <command commandId="org.kalypso.ui.rrm.command.calccase.copyCalcCase" style="push"/>
          <command commandId="org.kalypso.ui.rrm.command.calccase.updateCalcCaseTimeseries" style="push"/>
          <command commandId="org.kalypso.ui.rrm.command.calccase.setBasicModel" style="push"/>
          <command commandId="org.kalypso.ui.rrm.command.calccase.runCalcCase" style="push"/>
          <separator name="additions" visible="false"/>
          <visibleWhen checkEnabled="false">
             <with variable="activeWorkbenchWindow.activePerspective">
                <equals value="org.kalypso.ui.perspectives.ModelerPerspectiveFactory"/>
             </with>
          </visibleWhen>
       </menu>
    </menuContribution>
 </extension>
 
 <extension
         point="org.eclipse.ui.views">
      <view
            category="org.kalypso.ui.kalypso"
            class="org.kalypso.ui.rrm.logviewer.LogViewer"
            icon="icons/logview/problems_view.gif"
            id="org.kalypso.ui.rrm.logviewer.LogViewer"
            name="%org.kalypso.ui.rrm.logviewer.LogViewer.name"/>
      <view
            category="org.kalypso.ui.kalypso"
            class="org.kalypso.ui.rrm.internal.timeseries.view.TimeseriesManagementView"
            icon="icons/timeseries/timeseriesManagementView.gif"
            id="org.kalypso.ui.rrm.internal.timeseries.view.TimeseriesManagementView"
            name="Timeseries Management"
            restorable="true">
      </view>
      <view
            category="org.kalypso.ui.kalypso"
            class="org.kalypso.ui.rrm.internal.cm.view.CatchmentModelsView"
            icon="icons/cm/catchmentModelsView.png"
            id="org.kalypso.ui.rrm.internal.cm.view.CatchmentModelsView"
            name="Catchment Models"
            restorable="true">
      </view>
      <view
            category="org.kalypso.ui.kalypso"
            class="org.kalypso.ui.rrm.internal.utils.featureTree.TreePropertiesView"
            icon="icons/timeseries/propertiesView.gif"
            id="org.kalypso.ui.rrm.internal.utils.featureTree.TreePropertiesView"
            name="Properties"
            restorable="false">
      </view>
      <view
            category="org.kalypso.ui.kalypso"
            class="org.kalypso.ui.rrm.internal.diagram.RrmDiagramView"
            icon="icons/timeseries/table.gif"
            id="org.kalypso.ui.rrm.internal.diagram.RrmDiagramView"
            name="Zeitreihen-Diagramm"
            restorable="false">
      </view>
   </extension>
   
  <extension point="org.kalypso.module.conversion">
    <projectconversion module="KalypsRrmModel" class="org.kalypso.ui.rrm.internal.conversion.RrmProjectConverterFactory"/>
   </extension> 

   <extension point="org.kalypso.ui.typeHandlers">
        <typeHandler factory="org.kalypso.ui.rrm.internal.gml.GuiTypeHandlerFactory"/>
   </extension>

   <extension point="org.eclipse.ui.menus">
        <menuContribution locationURI="menu:org.kalypso.ui.menus.mapMenu?before=widgetAdditions">
            <command commandId="org.kalypso.ogc.gml.map.EditRelationsCommand" style="radio"/>
        </menuContribution>
        <menuContribution locationURI="toolbar:org.kalypso.ui.menus.mapToolbar?before=widgetAdditions">
            <command commandId="org.kalypso.ogc.gml.map.EditRelationsCommand" style="radio">
                <visibleWhen checkEnabled="false">
                    <with variable="activeEditorId">
                        <equals value="org.kalypso.ui.editor.mapeditor.GisMapEditor" />
                    </with>
                </visibleWhen>
            </command>
        </menuContribution>
   </extension>
   <extension point="org.kalypso.ui.importWizards">
      <wizard
            class="org.kalypso.ui.rrm.internal.hydrotops.ImportLanduseWizard"
            id="org.kalypso.ui.rrm.wizards.importLanduse.ImportLanduseWizard"
            name="%command.name.0">
      </wizard>
      <wizard
            class="org.kalypso.ui.rrm.internal.hydrotops.ImportPedologyWizard"
            id="org.kalypso.ui.rrm.wizards.importPedologyData.ImportPedologyWizard"
            name="%command.name.1">
      </wizard>
      <wizard
            class="org.kalypso.ui.rrm.internal.hydrotops.ImportGeologyWizard"
            id="org.kalypso.ui.rrm.wizards.importGeologyData.ImportGeologyWizard"
            name="%command.name.2">
      </wizard>
   </extension>
   <extension point="org.kalypso.contribs.eclipsercp.wizardEnablement">
      <wizardEnablement
            wizardID="org.kalypso.ui.rrm.wizards.importLanduse.ImportLanduseWizard">
         <enablement>
            <reference definitionId="org.kalypso.ui.rrm.definition.oneLanduseThemeSelected">
            </reference>
         </enablement>
      </wizardEnablement>
      <wizardEnablement
            wizardID="org.kalypso.ui.rrm.wizards.importPedologyData.ImportPedologyWizard">
         <enablement>
            <reference definitionId="org.kalypso.ui.rrm.definition.onePedologyThemeSelected">
            </reference>
         </enablement>
      </wizardEnablement>
      <wizardEnablement
            wizardID="org.kalypso.ui.rrm.wizards.importGeologyData.ImportGeologyWizard">
         <enablement>
            <reference definitionId="org.kalypso.ui.rrm.definition.oneGeologyThemeSelected">
            </reference>
         </enablement>
      </wizardEnablement>
   </extension>
   <extension
         point="org.kalypso.ui.featureViewExtensionControl">
      <extensionControl
            class="org.kalypso.ui.rrm.internal.gml.StorageChannelValidateControlFactory"
            id=".StorageChannelValidateFeatureControl">
      </extensionControl>
   </extension>
   <extension
         point="de.renew.workflow.model.workflowSystem">
      <workflowSystem
            definition="etc/workflow.xml"
            id="org.kalypso.model.rrm.workflow"
            name="KalypsoHydrology Workflow">
      </workflowSystem>
   </extension>
   <extension
         point="org.eclipse.ui.perspectiveExtensions">
      <perspectiveExtension
            targetID="org.kalypso.kalypso1d2d.pjt.perspective.Perspective">
         <view
               moveable="false"
               closeable="false"
               id="org.kalypso.ui.rrm.internal.timeseries.view.TimeseriesManagementView"
               relationship="stack"
               relative="org.kalypso.ui.views.mapView"
               visible="false">
         </view>
         <view
               moveable="false"
               closeable="false"
               id="org.kalypso.ui.rrm.internal.cm.view.CatchmentModelsView"
               relationship="stack"
               relative="org.kalypso.ui.views.mapView"
               visible="false">
         </view>
         <view
               id="org.kalypso.ui.rrm.internal.utils.featureTree.TreePropertiesView"
               moveable="false"
               closeable="false"
               ratio="0.33"
               relationship="right"
               relative="org.kalypso.ui.rrm.internal.timeseries.view.TimeseriesManagementView"
               visible="false">
         </view>
         <view
         	   id="org.kalypso.ui.rrm.internal.diagram.RrmDiagramView"
               moveable="false"
               closeable="false"
               ratio="0.20"
               relationship="bottom"
               relative="org.kalypso.ui.rrm.internal.utils.featureTree.TreePropertiesView"
               visible="false">
         </view>
      </perspectiveExtension>
   </extension>
   <extension
         point="org.kalypso.afgui.scenarioData">
      <dataSet id="org.kalypso.model.rrm.scenarioDataScope">
         <scenarioDatum classKey="org.kalypso.model.hydrology.timeseries.binding.IStationCollection" id="stations" modelPath="project://.model/timeseries/stations.gml"/>
         <scenarioDatum classKey="org.kalypso.model.hydrology.cm.binding.ICatchmentModel" id="catchmentModels" modelPath=".models/catchmentModels.gml"/>
         <scenarioDatum classKey="org.kalypso.model.hydrology.binding.model.NaModell" id="model" modelPath=".models/modell.gml"/>
      </dataSet>
   </extension>
   
   <!-- Handler for workflow -->
   <extension point="org.eclipse.ui.commands">
            <command id="org.kalypso.model.rrm.timeseriesManagement" name="Timeseries Management" />
            <command id="org.kalypso.model.rrm.catchmentModels" name="Catchment Models" />
            <command id="org.kalypso.model.rrm.simulationManagement" name="Simulation Management"/>
   </extension>
   <extension point="org.eclipse.ui.commandImages">
            <image commandId="org.kalypso.model.rrm.timeseriesManagement" icon="icons/timeseries/timeseriesManagementView.gif"/>
            <image commandId="org.kalypso.model.rrm.catchmentModels" icon="icons/cm/catchmentModelsView.png"/>
   </extension>
   
   <extension point="org.eclipse.ui.handlers">
      <handler
            class="org.kalypso.ui.rrm.internal.timeseries.view.TimeseriesManagementTaskHandler"
            commandId="org.kalypso.model.rrm.timeseriesManagement">
      </handler>    
      <handler
            class="org.kalypso.ui.rrm.internal.cm.view.CatchmentModelsTaskHandler"
            commandId="org.kalypso.model.rrm.catchmentModels">
      </handler>
      <handler
            class="org.kalypso.ui.rrm.internal.simulations.SimulationManagementTaskHandler"
            commandId="org.kalypso.model.rrm.simulationManagement">
      </handler>
   </extension>
</plugin>
