<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.0"?>
<plugin>
   <extension
         id="KalypsoUIRRMPopupManu"
         name="KalypsoUIRRMPopupManu"
         point="org.eclipse.ui.popupMenus">
      <objectContribution
            adaptable="false"
            id="KalypsoUIRRM.kmContribution"
            objectClass="org.kalypsodeegree.model.feature.Feature">
         <filter
               name="featureType"
               value="http://www.tuhh.de/kalypsoNA#KMChannel"/>
         <action
               class="org.kalypso.ui.rrm.action.KMUpdateAction"
               icon="icons/kmStrang.gif"
               id="KalypsoUIRRM.updateKMParameter"
               label="%KalypsoUIRRM.updateKMParameter.label"
               style="push"
               tooltip="%KalypsoUIRRM.updateKMParameter.tooltip"/>
      </objectContribution>
   </extension>
   <extension
         point="org.kalypso.core.catalogContribution">
      <catalogContribution
            class="org.kalypso.ui.rrm.catalog.RRMFeatureTypeStyleCatalogContribution"
            name="RRM-Style-Catalog"/>
   </extension>
   
   <extension
         point="org.eclipse.ui.newWizards">
      <category
            id="org.kalypso.ui.newwizards.kalypso.rrm"
            name="%Category.name"
            parentCategory="org.kalypso.ui.newwizards.kalypso"/>
      <wizard
            category="org.kalypso.ui.newwizards.kalypso/org.kalypso.ui.newwizards.kalypso.rrm"
            class="org.kalypso.ui.rrm.wizards.KalypsoNAProjectWizard"
            finalPerspective="org.kalypso.ui.perspectives.ModelerPerspectiveFactory"
            hasPages="true"
            icon="icons/kalypso16.gif"
            id="org.kalypso.ui.rrm.wizards.KalypsoNAProjectWizard"
            name="%NewWizard.name"
            project="true">
         <description>
            %org.kalypso.ui.rrm.wizards.KalypsoNAProjectWizard.description
         </description>
      </wizard>
      <wizard
            canFinishEarly="false"
            category="org.kalypso.ui.newwizards.kalypso/org.kalypso.ui.newwizards.kalypso.rrm"
            class="org.kalypso.ui.rrm.wizards.NewNAAsciiProjectWizard"
            finalPerspective="org.kalypso.ui.perspectives.ModelerPerspectiveFactory"
            hasPages="true"
            icon="icons/kmStrang.gif"
            id="org.kalypso.ui.rrm.wizards.NewProjectImportAsciiWizard"
            name="%wizard.name.0"
            project="true"/>
   </extension>
   <extension
         point="org.kalypso.project.database.client.kalypsoModule">
    <module
            module="org.kalypso.ui.rrm.extension.KalypsoModuleRRM">
      </module>
   </extension>
   
   
  <!-- Commands for the map outline -->
	<extension point="org.eclipse.ui.commands">
		<command categoryId="org.kalypso.ui.map.outline.category" id="org.kalypso.ui.map.outline.command.RRMImportLanduse" name="%command.name.0"/>
		<command categoryId="org.kalypso.ui.map.outline.category" id="org.kalypso.ui.map.outline.command.RRMImportPedology" name="%command.name.1"/>
		<command categoryId="org.kalypso.ui.map.outline.category" id="org.kalypso.ui.map.outline.command.RRMImportGeology" name="%command.name.2"/>
		<command categoryId="org.kalypso.ui.map.outline.category" id="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" name="%command.name.3"/>
	</extension>

	 <extension  point="org.eclipse.ui.commandImages">
	    <image commandId="org.kalypso.ui.map.outline.command.RRMImportLanduse" icon="icons/landuseImport.gif"/>
	    <image commandId="org.kalypso.ui.map.outline.command.RRMImportPedology" icon="icons/pedologyImport.gif"/>
	    <image commandId="org.kalypso.ui.map.outline.command.RRMImportGeology" icon="icons/geologyImport.gif"/>
	    <image commandId="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" icon="icons/geologyImport.gif"/>
	 </extension>

	<extension point="org.eclipse.ui.handlers">
		<handler commandId="org.kalypso.ui.map.outline.command.RRMImportLanduse" class="org.kalypso.ui.rrm.action.RRMImportLanduseHandler">
			<activeWhen>
				<reference definitionId="org.kalypso.ui.rrm.definition.oneLanduseThemeSelected"/>
			</activeWhen>
		</handler>
		<handler commandId="org.kalypso.ui.map.outline.command.RRMImportPedology" class="org.kalypso.ui.rrm.action.RRMImportPedologyHandler">
			<activeWhen>
				<reference definitionId="org.kalypso.ui.rrm.definition.onePedologyThemeSelected"/>
			</activeWhen>
		</handler>
		<handler commandId="org.kalypso.ui.map.outline.command.RRMImportGeology" class="org.kalypso.ui.rrm.action.RRMImportGeologyHandler">
			<activeWhen>
				<reference definitionId="org.kalypso.ui.rrm.definition.oneGeologyThemeSelected"/>
			</activeWhen>
		</handler>
		<handler commandId="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" class="org.kalypso.ui.rrm.action.RRMCreateHydrotopsHandler">
			<activeWhen>
				<reference definitionId="org.kalypso.ui.rrm.definition.onlyRRMThemesSelected"/>
			</activeWhen>
		</handler>
	</extension>

	<extension point="org.eclipse.ui.menus">
   		<menuContribution locationURI="popup:org.kalypso.map.outline.GisMapEditor?after=additions">
			<command commandId="org.kalypso.ui.map.outline.command.RRMImportLanduse" style="push">
				<visibleWhen checkEnabled="false">
					<reference definitionId="org.kalypso.ui.rrm.definition.oneLanduseThemeSelected"/>
				</visibleWhen>
			</command>
			<command commandId="org.kalypso.ui.map.outline.command.RRMImportPedology" style="push">
				<visibleWhen checkEnabled="false">
					<reference definitionId="org.kalypso.ui.rrm.definition.onePedologyThemeSelected"/>
				</visibleWhen>
			</command>
			<command commandId="org.kalypso.ui.map.outline.command.RRMImportGeology" style="push">
				<visibleWhen checkEnabled="false">
					<reference definitionId="org.kalypso.ui.rrm.definition.oneGeologyThemeSelected"/>
				</visibleWhen>
			</command>
			<command commandId="org.kalypso.ui.map.outline.command.RRMCreateHydrotops" style="push">
				<visibleWhen checkEnabled="false">
					<reference definitionId="org.kalypso.ui.rrm.definition.onlyRRMThemesSelected"/>
				</visibleWhen>
			</command>
		</menuContribution>
	</extension>

	<extension point="org.eclipse.core.expressions.definitions">
		<definition id="org.kalypso.ui.rrm.definition.oneLanduseThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
						<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/landuse}Landuse"/>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.onePedologyThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
						<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/pedologie}Soiltype"/>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.oneGeologyThemeSelected">
			<with variable="selection">
				<and>
					<count value="1"/>
					<iterate ifEmpty="false" operator="and">
						<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/geologie}Geologie"/>
					</iterate>
				</and>
			</with>
		</definition>
		<definition id="org.kalypso.ui.rrm.definition.onlyRRMThemesSelected">
			<with variable="selection">
				<and>
					<count value="+"/>
					<or>
						<iterate ifEmpty="false" operator="or">
							<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/geologie}Geologie"/>
						</iterate>
						<iterate ifEmpty="false" operator="or">
							<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/pedologie}Soiltype"/>
						</iterate>
						<iterate ifEmpty="false" operator="or">
							<test property="org.kalypso.ui.test.theme.qname" value="{http://sourceforge.kalypso.org/schemata/hydrology/landuse}Landuse"/>					
						</iterate>
						<iterate ifEmpty="false" operator="or">
							<test property="org.kalypso.ui.test.theme.qname" value="{http://www.tuhh.de/hydrotop}Hydrotop"/>					
						</iterate>
						<iterate ifEmpty="false" operator="or">
							<test property="org.kalypso.ui.test.theme.qname" value="{http://www.tuhh.de/kalypsoNA}Catchment"/>					
						</iterate>
					</or>
				</and>
			</with>
		</definition>
	</extension>


 <extension
       point="org.eclipse.ui.commands">
    <category
          description="%org.kalypso.ui.rrm.commandCategory.description"
          id="org.kalypso.ui.rrm.commandCategory"
          name="%org.kalypso.ui.rrm.commandCategory.name">
    </category>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.action.model.runCalcCase.label"
               description="%org.kalypso.action.model.runCalcCase.tooltip"
               id="org.kalypso.action.model.runCalcCase">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.action.model.updateCalcCaseTimeseries.label"
               description="%org.kalypso.action.model.updateCalcCaseTimeseries.tooltip"
               id="org.kalypso.action.model.updateCalcCaseTimeseries">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.action.model.copyCalcCase.label"
               description="%org.kalypso.action.model.copyCalcCase.tooltip"
               id="org.kalypso.action.model.copyCalcCase">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.action.model.newCalcCase.label"
               description="%org.kalypso.action.model.newCalcCase.tooltip"
               id="org.kalypso.action.model.newCalcCase">
         </command>
         <command
		       categoryId="org.kalypso.ui.rrm.commandCategory"
               name="%org.kalypso.action.model.setBasicModel.label"
               description="%org.kalypso.action.model.setBasicModel.tooltip"
               id="org.kalypso.action.model.setBasicModel">
         </command>
 </extension>
 <extension
       point="org.eclipse.ui.commandImages">
         <image icon="icons/commands/startCalculation.gif" commandId="org.kalypso.action.model.runCalcCase"/>
         <image icon="icons/commands/refreshCalcCase.gif" commandId="org.kalypso.action.model.updateCalcCaseTimeseries"/>
         <image icon="icons/commands/copyCalcCase.gif" commandId="org.kalypso.action.model.copyCalcCase"/>
         <image icon="icons/commands/createCalcCase.gif" commandId="org.kalypso.action.model.newCalcCase"/>
         <image icon="icons/commands/export-simple-template.gif" commandId="org.kalypso.action.model.setBasicModel"/>
 </extension>
 <extension
       point="org.eclipse.ui.handlers">
         <handler class="org.kalypso.simulation.ui.actions.StartCalculationActionDelegate" commandId="org.kalypso.action.model.runCalcCase"/>
         <handler class="org.kalypso.simulation.ui.actions.UpdateCalcCaseTimeseries" commandId="org.kalypso.action.model.updateCalcCaseTimeseries"/>
         <handler class="org.kalypso.simulation.ui.actions.CopyCalcCaseDelegate" commandId="org.kalypso.action.model.copyCalcCase"/>
         <handler class="org.kalypso.simulation.ui.actions.NewCalcCaseAction" commandId="org.kalypso.action.model.newCalcCase"/>
         <handler class="org.kalypso.ui.rrm.action.SetBasicModelDelegate" commandId="org.kalypso.action.model.setBasicModel"/>
 </extension>
 <extension
       point="org.eclipse.ui.menus">
    <menuContribution
          locationURI="menu:org.eclipse.ui.main.menu?after=additions">
       <menu label="%org.kalypso.simulation.ui.menu.calcCase.label" mnemonic="%org.kalypso.simulation.ui.menu.calcCase.mnemonic">
          <separator name="calcCaseStart" visible="false"/>
          <command commandId="org.kalypso.action.model.newCalcCase" style="push"/>
          <command commandId="org.kalypso.action.model.copyCalcCase" style="push"/>
          <command commandId="org.kalypso.action.model.updateCalcCaseTimeseries" style="push"/>
          <command commandId="org.kalypso.action.model.setBasicModel" style="push"/>
          <command commandId="org.kalypso.action.model.runCalcCase" style="push"/>
          <separator name="additions" visible="false"/>
       </menu>
    </menuContribution>
 </extension>
 
 <extension
         point="org.eclipse.ui.views">
      <view
            category="org.kalypso.ui.kalypso"
            class="org.kalypso.ui.rrm.logviewer.LogViewer"
            icon="icons/logview/problems_view.gif"
            id="org.kalypso.ui.rrm.logviewer.LogViewer"
            name="%org.kalypso.ui.rrm.logviewer.LogViewer.name"/>
   </extension> 
</plugin>
