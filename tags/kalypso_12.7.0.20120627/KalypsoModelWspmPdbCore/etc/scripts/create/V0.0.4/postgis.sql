-- V0.0.1


-- 03_create_tables
-- Generated by Oracle SQL Developer Data Modeler 3.0.0.665
--   at:        2011-06-07 13:15:59 MESZ
--   site:      Oracle Database 10g
--   type:      Oracle Database 10g

CREATE SCHEMA pdb AUTHORIZATION pdb;

CREATE TABLE Cross_Section
    (
     ID Numeric (20)  NOT NULL ,
     Name Varchar (50)  NOT NULL ,
     Line Geometry,
     Station Numeric (8,1)  NOT NULL ,
     Creation_Date TIMESTAMP (0)  NOT NULL ,
     Editing_Date TIMESTAMP (0)  NOT NULL ,
     Editing_User Varchar (50)  NOT NULL ,
     Measurement_Date TIMESTAMP (0) ,
     Description Varchar (255) ,
     Water_Body Numeric (20)  NOT NULL ,
     State Numeric (20)  NOT NULL 
    )
WITH (
  OIDS=TRUE
);


CREATE UNIQUE INDEX "Cross_Section PKX" ON Cross_Section
    (
     ID ASC
    )
;
CREATE UNIQUE INDEX "Cross_Section Name UKX" ON Cross_Section
    (
     Name ASC ,
     State ASC
    )
;
CREATE INDEX State__CSX ON Cross_Section
    (
     State ASC
    )
;
CREATE INDEX Water_Body__CSX ON Cross_Section
    (
     Water_Body ASC
    )
;

ALTER TABLE Cross_Section
    ADD CONSTRAINT "Cross_Section PK" PRIMARY KEY ( ID ) ;

ALTER TABLE Cross_Section
    ADD CONSTRAINT "Cross_Section Name UK" UNIQUE ( Name , State ) ;


CREATE TABLE Cross_Section_Part
    (
     ID Numeric (20)  NOT NULL ,
     Name Varchar (50)  NOT NULL ,
     Line Geometry,
     Category Varchar (50)  NOT NULL ,
     Description Varchar (255) ,
     Cross_Section Numeric (20)  NOT NULL
    )
WITH (
  OIDS=TRUE
);


CREATE UNIQUE INDEX "Cross_Section_Part PKX" ON Cross_Section_Part
    (
     ID ASC
    )
;
CREATE UNIQUE INDEX "Cross_Section_Part Name UKX" ON Cross_Section_Part
    (
     Name ASC ,
     Cross_Section ASC
    )
;
CREATE INDEX CS__CS_PartX ON Cross_Section_Part
    (
     Cross_Section ASC
    )
;

ALTER TABLE Cross_Section_Part
    ADD CONSTRAINT "Cross_Section_Part PK" PRIMARY KEY ( ID ) ;

ALTER TABLE Cross_Section_Part
    ADD CONSTRAINT "Cross_Section_Part Name UK" UNIQUE ( Name , Cross_Section ) ;


CREATE TABLE Event
    (
     ID Numeric (20)  NOT NULL ,
     Name Varchar (100)  NOT NULL ,
     Creation_Date TIMESTAMP (0)  NOT NULL ,
     Editing_Date TIMESTAMP (0)  NOT NULL ,
     Editing_User Varchar (50)  NOT NULL ,
     Measurement_Date TIMESTAMP (0) ,
     Source Varchar (255) ,
     Type Varchar (50) DEFAULT 'Measurement' CHECK ( Type IN ('Measurement', 'Other', 'Simulation')) ,
     Description Varchar (255) ,
     Water_Body Numeric (20)  NOT NULL
    )
;


CREATE UNIQUE INDEX "Event PKX" ON Event
    (
     ID ASC
    )
;
CREATE UNIQUE INDEX "Event Name UKX" ON Event
    (
     Name ASC
    )
;
CREATE INDEX Water_Body__EventX ON Event
    (
     Water_Body ASC
    )
;

ALTER TABLE Event
    ADD CONSTRAINT "Event PK" PRIMARY KEY ( ID ) ;

ALTER TABLE Event
    ADD CONSTRAINT "Event Name UK" UNIQUE ( Name ) ;


CREATE TABLE Info
    (
     Key Varchar (50)  NOT NULL ,
     Value Varchar (255)
    )
;


CREATE UNIQUE INDEX "Info PKX" ON Info
    (
     Key ASC
    )
;

ALTER TABLE Info
    ADD CONSTRAINT "Info PK" PRIMARY KEY ( Key ) ;

    -- Version setzen auf "creating" oder "updateing"
INSERT INTO info("key", "value") VALUES ('Version', 'creating 0.0.1');

CREATE TABLE Point
    (
     ID Numeric (20)  NOT NULL ,
     Name Varchar (50)  NOT NULL ,
     Location Geometry,
     Consecutive_Num Numeric (11)  NOT NULL ,
     Code Varchar (50) ,
     HyK Varchar (50) ,
     Width Numeric (8,4) ,
     Height Numeric (8,4) ,
     Roughness_Point_Kind Varchar (50) ,
     Roughness_K_Value Numeric (10,3) ,
     Roughness_Kst_Value Numeric (8,1) ,
     Vegetation_Dp Numeric (8,3) ,
     Vegetation_Ax Numeric (8,3) ,
     Vegetation_Ay Numeric (8,3) ,
     Description Varchar (255) ,
     Vegetation_Point_Kind Varchar (50) ,
     Vegetation Varchar (50) ,
     Roughness Varchar (50) ,
     Cross_Section_Part Numeric (20)  NOT NULL
    )
WITH (
  OIDS=TRUE
);


CREATE UNIQUE INDEX "Point PKX" ON Point
    (
     ID ASC
    )
;
CREATE INDEX CS_Part__PointX ON Point
    (
     Cross_Section_Part ASC
    )
;
CREATE INDEX Roughness__PointX ON Point
    (
     Roughness_Point_Kind ASC ,
     Roughness ASC
    )
;
CREATE INDEX Vegetation__PointX ON Point
    (
     Vegetation_Point_Kind ASC ,
     Vegetation ASC
    )
;

ALTER TABLE Point
    ADD CONSTRAINT "Point PK" PRIMARY KEY ( ID ) ;


CREATE TABLE Point_Kind
    (
     Name Varchar (50)  NOT NULL ,
     Label Varchar (100)  NOT NULL ,
     Description Varchar (255)
    )
;


CREATE UNIQUE INDEX "Point_Kind PKX" ON Point_Kind
    (
     Name ASC
    )
;

ALTER TABLE Point_Kind
    ADD CONSTRAINT "Point_Kind PK" PRIMARY KEY ( Name ) ;


CREATE TABLE Roughness
    (
     Name Varchar (50)  NOT NULL ,
     K_Value Numeric (10,3) ,
     Kst_Value Numeric (8,1) ,
     Label Varchar (100) ,
     Source Varchar (255) ,
     Validity Varchar (255) ,
     Description Varchar (255) ,
     Point_Kind Varchar (50)  NOT NULL
    )
;


CREATE UNIQUE INDEX "Roughness PKX" ON Roughness
    (
     Point_Kind ASC ,
     Name ASC
    )
;
CREATE INDEX Point_Kind__RoughnessX ON Roughness
    (
     Point_Kind ASC
    )
;

ALTER TABLE Roughness
    ADD CONSTRAINT "Roughness PK" PRIMARY KEY ( Point_Kind, Name ) ;


CREATE TABLE State
    (
     ID Numeric (20)  NOT NULL ,
     Name Varchar (100)  NOT NULL ,
     IsStateZero CHAR (1) DEFAULT 'F'  NOT NULL ,
     Creation_Date TIMESTAMP (0)  NOT NULL ,
     Editing_Date TIMESTAMP (0)  NOT NULL ,
     Editing_User Varchar (50)  NOT NULL ,
     Measurement_Date TIMESTAMP (0) ,
     Source Varchar (255) ,
     Description Varchar (255)
    )
;


CREATE UNIQUE INDEX "State PKX" ON State
    (
     ID ASC
    )
;
CREATE UNIQUE INDEX "State Name UKX" ON State
    (
     Name ASC
    )
;

ALTER TABLE State
    ADD CONSTRAINT "State PK" PRIMARY KEY ( ID ) ;

ALTER TABLE State
    ADD CONSTRAINT "State Name UK" UNIQUE ( Name ) ;


CREATE TABLE Vegetation
    (
     Name Varchar (50)  NOT NULL ,
     Dp Numeric (8,3)  NOT NULL ,
     Ax Numeric (8,3)  NOT NULL ,
     Ay Numeric (8,3)  NOT NULL ,
     Label Varchar (100) ,
     Source Varchar (255) ,
     Description Varchar (255) ,
     Point_Kind Varchar (50)  NOT NULL
    )
;


CREATE UNIQUE INDEX "Vegetation PKX" ON Vegetation
    (
     Point_Kind ASC ,
     Name ASC
    )
;
CREATE INDEX Point_Kind__VegetationX ON Vegetation
    (
     Point_Kind ASC
    )
;

ALTER TABLE Vegetation
    ADD CONSTRAINT "Vegetation PK" PRIMARY KEY ( Point_Kind, Name ) ;


CREATE TABLE Water_Body
    (
     ID Numeric (20)  NOT NULL ,
     Name Varchar (100)  NOT NULL ,
     Riverline Geometry,
     Label Varchar (100)  NOT NULL ,
     Direction_of_Stationing Varchar (20) DEFAULT 'upstream'  NOT NULL CHECK ( Direction_of_Stationing IN ('downstream', 'upstream')) ,
     Rank INTEGER DEFAULT -1 ,
     Description Varchar (255)
    )
WITH (
  OIDS=TRUE
);



COMMENT ON COLUMN Water_Body.Name IS 'Gewaesserkennziffer (GKZ)'
;
CREATE UNIQUE INDEX "Water_Body Name UKX" ON Water_Body
    (
     Name ASC
    )
;
CREATE UNIQUE INDEX "Water_Body PKX" ON Water_Body
    (
     ID ASC
    )
;

ALTER TABLE Water_Body
    ADD CONSTRAINT "Water_Body PK" PRIMARY KEY ( ID ) ;

ALTER TABLE Water_Body
    ADD CONSTRAINT "Water_Body Name UK" UNIQUE ( Name ) ;


CREATE TABLE Waterlevel_Fixation
    (
     ID Numeric (20)  NOT NULL ,
     Station Numeric (8,1)  NOT NULL ,
     Location Geometry,
     Creation_Date TIMESTAMP (0)  NOT NULL ,
     Editing_Date TIMESTAMP (0)  NOT NULL ,
     Editing_User Varchar (50)  NOT NULL ,
     Measurement_Date TIMESTAMP (0) ,
     Waterlevel Numeric (8,3) ,
     Discharge Numeric (8,3) ,
     Description Varchar (255) ,
     Event Numeric (20)  NOT NULL
    )
WITH (
  OIDS=TRUE
);


CREATE UNIQUE INDEX "Waterlevel_Fixation PKX" ON Waterlevel_Fixation
    (
     ID ASC
    )
;
CREATE INDEX Event__Waterlevel_FixationX ON Waterlevel_Fixation
    (
     Event ASC
    )
;

ALTER TABLE Waterlevel_Fixation
    ADD CONSTRAINT "Waterlevel_Fixation PK" PRIMARY KEY ( ID ) ;



ALTER TABLE Point
    ADD CONSTRAINT CS_Part__Point FOREIGN KEY
    (
     Cross_Section_Part
    )
    REFERENCES Cross_Section_Part
    (
     ID
    )
    ON DELETE CASCADE
;


ALTER TABLE Cross_Section_Part
    ADD CONSTRAINT CS__CS_Part FOREIGN KEY
    (
     Cross_Section
    )
    REFERENCES Cross_Section
    (
     ID
    )
    ON DELETE CASCADE
;


ALTER TABLE Waterlevel_Fixation
    ADD CONSTRAINT Event__Waterlevel_Fixation FOREIGN KEY
    (
     Event
    )
    REFERENCES Event
    (
     ID
    )
    ON DELETE CASCADE
;


ALTER TABLE Roughness
    ADD CONSTRAINT Point_Kind__Roughness FOREIGN KEY
    (
     Point_Kind
    )
    REFERENCES Point_Kind
    (
     Name
    )
    ON DELETE CASCADE
;


ALTER TABLE Vegetation
    ADD CONSTRAINT Point_Kind__Vegetation FOREIGN KEY
    (
     Point_Kind
    )
    REFERENCES Point_Kind
    (
     Name
    )
    ON DELETE CASCADE
;


ALTER TABLE Point
    ADD CONSTRAINT Roughness__Point FOREIGN KEY
    (
     Roughness_Point_Kind,
     Roughness
    )
    REFERENCES Roughness
    (
     Point_Kind,
     Name
    )
    ON DELETE SET NULL
;


ALTER TABLE Cross_Section
    ADD CONSTRAINT State__CS FOREIGN KEY
    (
     State
    )
    REFERENCES State
    (
     ID
    )
    ON DELETE CASCADE
;


ALTER TABLE Point
    ADD CONSTRAINT Vegetation__Point FOREIGN KEY
    (
     Vegetation_Point_Kind,
     Vegetation
    )
    REFERENCES Vegetation
    (
     Point_Kind,
     Name
    )
    ON DELETE SET NULL
;


ALTER TABLE Cross_Section
    ADD CONSTRAINT Water_Body__CS FOREIGN KEY
    (
     Water_Body
    )
    REFERENCES Water_Body
    (
     ID
    )
    ON DELETE CASCADE
;


ALTER TABLE Event
    ADD CONSTRAINT Water_Body__Event FOREIGN KEY
    (
     Water_Body
    )
    REFERENCES Water_Body
    (
     ID
    )
    ON DELETE CASCADE
;














-- Oracle SQL Developer Data Modeler Summary Report:
--
-- CREATE TABLE                            11
-- CREATE INDEX                            26
-- ALTER TABLE                             26
-- CREATE VIEW                              0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- CREATE STRUCTURED TYPE                   0
-- CREATE COLLECTION TYPE                   0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
--
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
--
-- ERRORS                                   0
-- WARNINGS                                 0

-- 04_create_sequence
CREATE SEQUENCE seq_pdb
   INCREMENT 1
   START 1;
ALTER TABLE seq_pdb OWNER TO pdb;
-- 05_register_geometries
INSERT INTO geometry_columns(f_table_catalog, f_table_schema, f_table_name, f_geometry_column, coord_dimension, srid, "type")
VALUES ( '', 'pdb', 'cross_section', 'line', 3, ${SRID}, 'LINESTRING' );

INSERT INTO geometry_columns(f_table_catalog, f_table_schema, f_table_name, f_geometry_column, coord_dimension, srid, "type")
VALUES ( '', 'pdb', 'cross_section_part', 'line', 3, ${SRID}, 'LINESTRING' );

INSERT INTO geometry_columns(f_table_catalog, f_table_schema, f_table_name, f_geometry_column, coord_dimension, srid, "type")
VALUES ( '', 'pdb', 'point', 'location', 3, ${SRID}, 'POINT' );

INSERT INTO geometry_columns(f_table_catalog, f_table_schema, f_table_name, f_geometry_column, coord_dimension, srid, "type")
VALUES ( '', 'pdb', 'water_body', 'riverline', 3, ${SRID}, 'LINESTRING' );

INSERT INTO geometry_columns(f_table_catalog, f_table_schema, f_table_name, f_geometry_column, coord_dimension, srid, "type")
VALUES ( '', 'pdb', 'waterlevel_fixation', 'location', 3, ${SRID}, 'POINT' );

-- 06_prefill_table_info
INSERT INTO info("key", "value") VALUES ('SRID', '${SRID}');
-- 07_prefill_table__point_kind
INSERT INTO point_kind (name, label, description) VALUES ('GAF', 'GAF', 'GAF');


-- 08_prefill_table__roughness
INSERT INTO roughness (name, label, description, point_kind) VALUES ('-1', 'unknown', 'unknown','GAF');
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('1', 'glatt', 'glatt', 'GAF',0.001, 80);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('2', 'Feinsand, Schlamm', 'Feinsand, Schlamm', 'GAF',0.03, 55);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('3', 'Sand oder Feinkies', 'Sand oder Feinkies', 'GAF',0.05, 53);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('4', 'Feinkies', 'Feinkies', 'GAF',0.05, 50);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('5', 'mittlerer Kies', 'mittlerer Kies', 'GAF',0.08, 40);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('6', 'Schotter, mittlerer Grobkies, verkrautete Erdkanäle', 'Schotter, mittlerer Grobkies, verkrautete Erdkanäle', 'GAF',0.082, 35);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('7', 'Lehm, Wasserpflanzen', 'Lehm, Wasserpflanzen', 'GAF',0.1, 33);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('8', 'Steinschüttung,stark geschiebeführender Fluss,Wurzeln', 'Steinschüttung,stark geschiebeführender Fluss,Wurzeln', 'GAF',0.15, 30);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('9', 'Kiesanlandung, Wurzelgeflecht', 'Kiesanlandung, Wurzelgeflecht', 'GAF',0.2, 28);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('10', 'grobe Steine, Geröllanlandung', 'grobe Steine, Geröllanlandung', 'GAF',0.3, 25);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('11', 'Gebirgsflüsse mit grobem Geröll, verkrautete Erdkanäle', 'Gebirgsflüsse mit grobem Geröll, verkrautete Erdkanäle', 'GAF',0.45, 22.5);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('12', 'Fels', 'Fels', 'GAF',0.6, 20);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('13', 'Wildbach', 'Wildbach', 'GAF',0.9, 15);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('14', 'Wildbach mit starkem Geschiebetrieb, roher Felsausbruch', 'Wildbach mit starkem Geschiebetrieb, roher Felsausbruch', 'GAF',2, 12);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('20', 'Stahl, Zementputz geglättet, Beton aus Vakuumschalung', 'Stahl, Zementputz geglättet, Beton aus Vakuumschalung', 'GAF',0.001, 95);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('21', 'Holz, ungehobelt', 'Holz, ungehobelt', 'GAF',0.002, 90);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('22', 'Beton, glatt, Asphaltbeton, Klinker, sorgfältig verfugt', 'Beton, glatt, Asphaltbeton, Klinker, sorgfältig verfugt', 'GAF',0.003, 75);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('23', 'Ziegelmauerwerk, Rauputz, Verbundpflaster', 'Ziegelmauerwerk, Rauputz, Verbundpflaster', 'GAF',0.005, 70);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('24', 'Beton rauh, glatte Bruchsteine', 'Beton rauh, glatte Bruchsteine', 'GAF',0.015, 60);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('25', 'Pflaster, ARMCO-Profile', 'Pflaster, ARMCO-Profile', 'GAF',0.04, 50);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('26', 'Beton mit Fugen, grobes Bruchsteinmauerwerk', 'Beton mit Fugen, grobes Bruchsteinmauerwerk', 'GAF',0.02, 48);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('27', 'Natursteine, rauh', 'Natursteine, rauh', 'GAF',0.09, 40);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('28', 'Spundwände', 'Spundwände', 'GAF',0.06, 35);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('29', 'Schotter, Steinschüttung, Rasengittersteine', 'Schotter, Steinschüttung, Rasengittersteine', 'GAF',0.2, 30);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('30', 'grobe Steinschüttung', 'grobe Steinschüttung', 'GAF',0.4, 25);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('31', 'Steinschüttung mit Krautbewuchs', 'Steinschüttung mit Krautbewuchs', 'GAF',0.5, 23.5);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('32', 'Rauhe Sohlrampe', 'Rauhe Sohlrampe', 'GAF',1.5, 15);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('50', 'Rasen', 'Rasen', 'GAF',0.06, 40);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('51', 'Gras, Acker ohne Bewuchs', 'Gras, Acker ohne Bewuchs', 'GAF',0.2, 30);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('52', 'Waldboden', 'Waldboden', 'GAF',0.24, 27);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('53', 'Wiese, felsiger Waldboden', 'Wiese, felsiger Waldboden', 'GAF',0.25, 25);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('54', 'Gras mit Stauden', 'Gras mit Stauden', 'GAF',0.3, 24);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('55', 'Krautiger Bewuchs', 'Krautiger Bewuchs', 'GAF',0.4, 22);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('56', 'Acker mit Kulturen', 'Acker mit Kulturen', 'GAF',0.6, 21);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('57', 'unregelmäßiges Vorland', 'unregelmäßiges Vorland', 'GAF',0.8, 15);
INSERT INTO roughness (name, label, description, point_kind, k_value, kst_value) VALUES ('58', 'sehr unregelmäßiges Vorland mit Verbauungen', 'sehr unregelmäßiges Vorland mit Verbauungen', 'GAF',1, 12);

-- 09_prefill_table__vegetation

INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('-1', 'unknown', 'unknown','GAF',0,0,0);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('1', 'Röhricht, licht', 'Röhricht, licht', 'GAF',0.003, 0.03, 0.03);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('2', 'Röhricht, dicht', 'Röhricht, dicht', 'GAF',0.005, 0.02, 0.02);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('3', 'Sträucher, licht', 'Sträucher, licht', 'GAF',0.03, 0.35, 0.35);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('4', 'Sträucher, mittel', 'Sträucher, mittel', 'GAF',0.045, 0.25, 0.25);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('5', 'Sträucher, dicht', 'Sträucher, dicht', 'GAF',0.06, 0.15, 0.15);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('6', 'Bäume, licht', 'Bäume, licht', 'GAF',0.05, 5, 5);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('7', 'Bäume, mittel', 'Bäume, mittel', 'GAF',0.2, 10, 10);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('8', 'Bäume, dicht', 'Bäume, dicht', 'GAF',1, 5, 5);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('11', 'Büsche, einjährig', 'Büsche, einjährig', 'GAF',0.5, 10, 10);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('12', 'Büsche, mehrjährig', 'Büsche, mehrjährig', 'GAF',3.5, 10, 10);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('13', 'Bäume, einjährig', 'Bäume, einjährig', 'GAF',0.05, 20, 20);
INSERT INTO vegetation(name, label, description, point_kind, dp, ax, ay) VALUES ('14', 'Bäume, mehrjährig', 'Bäume, mehrjährig', 'GAF',1, 20, 20);

-- 99_create_spatial_indexes
CREATE INDEX IX_POINT__LOCATION ON POINT USING GIST ( LOCATION );
CREATE INDEX IX_CROSS_SECTION_PART__LINE ON CROSS_SECTION_PART USING GIST ( LINE );
CREATE INDEX IX_CROSS_SECTION__LINE ON CROSS_SECTION USING GIST ( LINE );
CREATE INDEX IX_WATER_BODY__RIVERLINE ON WATER_BODY USING GIST ( RIVERLINE );
CREATE INDEX IX_WL_FIX__LOCATION ON WATERLEVEL_FIXATION USING GIST ( LOCATION );

-- Version endgültig setzen
UPDATE INFO set value='0.0.1'  where key ='Version';
commit;

-- V0.0.2
-- Version setzen auf "creating" oder "updateing"
UPDATE INFO set value='updating 0.0.1 to 0.0.2'  where key ='Version';

-- Generated by Oracle SQL Developer Data Modeler 3.0.0.665
--   at:        2011-07-13 16:56:15 MESZ
--   site:      Oracle Database 10g
--   type:      Oracle Database 10g




CREATE TABLE Document
    (
     ID numeric (20)  NOT NULL ,
     Name varchar (100)  NOT NULL ,
     Location Geometry ,
     FileName varchar (2048)  NOT NULL ,
     MimeType varchar (50) , 
     Creation_Date TIMESTAMP (0)  NOT NULL , 
     Editing_Date TIMESTAMP (0)  NOT NULL , 
     Editing_User varchar (50)  NOT NULL , 
     Measurement_Date TIMESTAMP (0) ,

--  [°] - Aufnahmerichtung (0-360)
 ShotDirection numeric (8,3) CHECK ( ShotDirection BETWEEN 0 AND 360) ,

--  [°] - Öffnungswinkel (0-360)
 ViewAngle numeric (8,3) CHECK ( ViewAngle BETWEEN 0 AND 360) , 
     Description varchar (255) , 
     Cross_Section_ID numeric (20) ,
     Water_Body_ID numeric (20) ,
     State_ID numeric (20)
    ) 
;



COMMENT ON COLUMN Document.ShotDirection IS '[°] - Aufnahmerichtung (0-360)'
;

COMMENT ON COLUMN Document.ViewAngle IS '[°] - Öffnungswinkel (0-360)'
;

ALTER TABLE Document
    ADD CONSTRAINT "Document PK" PRIMARY KEY ( ID  ) ;

ALTER TABLE Document 
    ADD CONSTRAINT "Document Name UK" UNIQUE ( FileName ) ;




COMMENT ON COLUMN Cross_Section.Station IS '[m]'
;


COMMENT ON COLUMN Event.Type IS 'Art des Ereignisses: Messung, Simulation'
;


COMMENT ON COLUMN Point.Code IS '(GAF-) Kennzeichnung'
;


COMMENT ON COLUMN Point.Width IS '[m]'
;


COMMENT ON COLUMN Point.Height IS '[m NN]'
;


COMMENT ON COLUMN Point.Roughness_K_Value IS '[m]'
;


COMMENT ON COLUMN Point.Roughness_Kst_Value IS '[m^.33/s]'
;


COMMENT ON COLUMN Point.Vegetation_Dp IS '[m]'
;


COMMENT ON COLUMN Point.Vegetation_Ax IS '[m]'
;


COMMENT ON COLUMN Point.Vegetation_Ay IS '[m]'
;


COMMENT ON COLUMN Point_Kind.Name IS 'Quelle für Import: GAF, WPROF, ...'
;


COMMENT ON COLUMN Roughness.K_Value IS '[m]'
;


COMMENT ON COLUMN Roughness.Kst_Value IS '[m^.33/s]'
;


COMMENT ON COLUMN Roughness.Source IS 'Angabe einer Literaturstelle'
;


COMMENT ON COLUMN State.IsStateZero IS 'Handelt es sich bei diesem Zustand um einen Ur-Zustand (d.h. einen Erstimport)?'
;


COMMENT ON COLUMN State.Source IS 'data source (e.g. file name)'
;


COMMENT ON COLUMN Vegetation.Dp IS '[m]'
;


COMMENT ON COLUMN Vegetation.Ax IS '[m]'
;


COMMENT ON COLUMN Vegetation.Ay IS '[m]'
;


COMMENT ON COLUMN Vegetation.Source IS 'Angabe einer Literaturstelle'
;


COMMENT ON COLUMN Water_Body.Rank IS 'Gewässerordnung (ggf. zur Darstellung)'
;


COMMENT ON COLUMN Waterlevel_Fixation.Station IS '[m]'
;


COMMENT ON COLUMN Waterlevel_Fixation.Waterlevel IS '[m NN]'
;

COMMENT ON COLUMN Waterlevel_Fixation.Discharge IS '[m³/s]'
;

ALTER TABLE Event DROP CONSTRAINT "Event Name UK" CASCADE
;

DROP INDEX "Event Name UKX"
;
CREATE UNIQUE INDEX "Event Name UKX" ON Event
    (
     Name,
     Water_Body ASC
    )
;

ALTER TABLE Event ADD
    CONSTRAINT "Event Name UK" UNIQUE (
    Name ,
     Water_Body
    ) ;



ALTER TABLE Document
    ADD CONSTRAINT CS_Document FOREIGN KEY
    (
     Cross_Section_ID
    )
    REFERENCES Cross_Section
    (
     ID
    )
    ON DELETE SET NULL
    NOT DEFERRABLE
;


ALTER TABLE Document
    ADD CONSTRAINT State_Document FOREIGN KEY
    (
     State_ID
    )
    REFERENCES State
    (
     ID
    )
    ON DELETE SET NULL
    NOT DEFERRABLE
;


ALTER TABLE Document
    ADD CONSTRAINT WB_Document FOREIGN KEY
    (
     Water_Body_ID
    )
    REFERENCES Water_Body
    (
     ID
    )
    ON DELETE SET NULL
    NOT DEFERRABLE
;


-- Oracle SQL Developer Data Modeler Summary Report:
--
-- CREATE TABLE                             1
-- CREATE INDEX                             0
-- CREATE VIEW                              0
-- ALTER TABLE                              8
-- DROP TABLE                               0
-- DROP INDEX                               0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- ALTER SEQUENCE                           0
-- ALTER MATERIALIZED VIEW                  0
-- DROP VIEW                                0

--
-- ERRORS                                   0
-- WARNINGS                                 0

-- 05_register_geometries
INSERT INTO geometry_columns(f_table_catalog, f_table_schema, f_table_name, f_geometry_column, coord_dimension, srid, "type")
VALUES ( '', 'pdb', 'document', 'location', 3, ${SRID}, 'POINT' );

-- 06_prefill_table_info
INSERT INTO info("key", "value") VALUES ('DocumentServer', '${DocumentServer}');

-- 99_create_spatial_indexes
CREATE INDEX IX_DOCUMENT__LOCATION ON DOCUMENT USING GIST ( LOCATION );
-- Version endgültig setzen
UPDATE INFO set value='0.0.2'  where key ='Version';
commit;


-- Version 0.0.3
-- Version setzen auf "creating" oder "updateing"
UPDATE INFO set value='updating 0.0.2 to 0.0.3'  where key ='Version';

GRANT SELECT ON TABLE pdb.cross_section TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.cross_section_part TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb."document" TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.event TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.info TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.point TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.point_kind TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.roughness TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.state TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.vegetation TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.water_body TO GROUP pdb_user;
GRANT SELECT ON TABLE pdb.waterlevel_fixation TO GROUP pdb_user;

GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.cross_section TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.cross_section_part TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb."document" TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.event TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.info TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.point TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.point_kind TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.roughness TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.state TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.vegetation TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.water_body TO GROUP pdb_admin;
GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE pdb.waterlevel_fixation TO GROUP pdb_admin;

GRANT SELECT ON TABLE pdb.seq_pdb TO GROUP pdb_admin;


INSERT INTO INFO("key", "value") VALUES ('srsXName', '${srsXName}');
INSERT INTO INFO("key", "value") VALUES ('srsMinX', '${srsMinX}');
INSERT INTO INFO("key", "value") VALUES ('srsMaxX', '${srsMaxX}');
INSERT INTO INFO("key", "value") VALUES ('srsTolX', '${srsTolX}');

INSERT INTO INFO("key", "value") VALUES ('srsYName', '${srsYName}');
INSERT INTO INFO("key", "value") VALUES ('srsMinY', '${srsMinY}');
INSERT INTO INFO("key", "value") VALUES ('srsMaxY', '${srsMaxY}');
INSERT INTO INFO("key", "value") VALUES ('srsTolY', '${srsTolY}');

INSERT INTO INFO("key", "value") VALUES ('srsZName', '${srsZName}');
INSERT INTO INFO("key", "value") VALUES ('srsMinZ', '${srsMinZ}');
INSERT INTO INFO("key", "value") VALUES ('srsMaxZ', '${srsMaxZ}');
INSERT INTO INFO("key", "value") VALUES ('srsTolZ', '${srsTolZ}');

-- Version endgültig setzen
UPDATE INFO set value='0.0.3' where key ='Version';
commit;

-- Version setzen auf "creating" oder "updateing"
UPDATE INFO set value='updating 0.0.3 to 0.0.4'  where key ='Version';

-- add missing rights
GRANT USAGE ON SCHEMA pdb TO pdb_user;
GRANT SELECT, UPDATE ON TABLE pdb.seq_pdb TO pdb_admin;

-- 
ALTER TABLE "document" DROP CONSTRAINT "Document Name UK";

ALTER TABLE "document" DROP CONSTRAINT cs_document;
ALTER TABLE "document"
  ADD CONSTRAINT cs_document FOREIGN KEY (cross_section_id)
      REFERENCES cross_section (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE "document" DROP CONSTRAINT state_document;
ALTER TABLE "document"
  ADD CONSTRAINT state_document FOREIGN KEY (state_id)
      REFERENCES state (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE "document" DROP CONSTRAINT wb_document;
ALTER TABLE "document"
  ADD CONSTRAINT wb_document FOREIGN KEY (water_body_id)
      REFERENCES water_body (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE CASCADE;



ALTER TABLE Point ADD COLUMN Roughness_Factor numeric (8,5);
COMMENT ON COLUMN Point.Roughness_Factor IS 'factor to apply to roughness value';

ALTER TABLE Roughness ADD COLUMN Color character varying(10);
COMMENT ON COLUMN Roughness.Color IS 'color (hex)';

ALTER TABLE Vegetation ADD COLUMN Color character varying(10);
COMMENT ON COLUMN Vegetation.Color IS 'color (hex)';

-- Daten

-- update tables roughness and vegetation to overcome encoding problems
 update roughness set label='Schotter, mittlerer Grobkies, verkrautete Erdkanäle', description='Schotter, mittlerer Grobkies, verkrautete Erdkanäle' where name ='6';
 update roughness set label='Steinschüttung, stark geschiebeführender Fluss, Wurzeln', description='Steinschüttung, stark geschiebeführender Fluss, Wurzeln' where name ='8';
 update roughness set label='grobe Steine, Geröllanlandung', description='grobe Steine, Geröllanlandung' where name ='10';
 update roughness set label='Gebirgsflüsse mit grobem Geröll, verkrautete Erdkanäle', description='Gebirgsflüsse mit grobem Geröll, verkrautete Erdkanäle' where name ='11';
 update roughness set label='Spundwände', description='Spundwände' where name ='28';
 update roughness set label='Schotter, Steinschüttung, Rasengittersteine', description='Schotter, Steinschüttung, Rasengittersteine' where name ='29';
 update roughness set label='grobe Steinschüttung', description='grobe Steinschüttung', point_kind='GAF' where name ='30';
 update roughness set label='Steinschüttung mit Krautbewuchs', description='Steinschüttung mit Krautbewuchs' where name ='31';
 update roughness set label='unregelmäßiges Vorland', description='unregelmäßiges Vorland' where name ='57';
 update roughness set label='sehr unregelmäßiges Vorland mit Verbauungen', description='sehr unregelmäßiges Vorland mit Verbauungen' where name ='58';


-- 09_prefill_table__vegetation
 update vegetation set label= 'Röhricht, licht', description='Röhricht, licht' where name ='1';
 update vegetation set label= 'Röhricht, dicht', description='Röhricht, dicht' where name ='2';
 update vegetation set label= 'Sträucher, licht', description='Sträucher, licht' where name ='3';
 update vegetation set label= 'Sträucher, mittel', description='Sträucher, mittel' where name ='4';
 update vegetation set label= 'Sträucher, dicht', description='Sträucher, dicht' where name ='5';
 update vegetation set label= 'Bäume, licht', description='Bäume, licht' where name ='6';
 update vegetation set label= 'Bäume, mittel', description='Bäume, mittel' where name ='7';
 update vegetation set label= 'Bäume, dicht', description='Bäume, dicht' where name ='8';
 update vegetation set label= 'Büsche, einjährig', description='Büsche, einjährig' where name ='11';
 update vegetation set label= 'Büsche, mehrjährig', description='Büsche, mehrjährig' where name ='12';
 update vegetation set label= 'Bäume, einjährig', description='Bäume, einjährig' where name ='13';
 update vegetation set label= 'Bäume, mehrjährig', description='Bäume, mehrjährig' where name ='14';


-- set default colors for vegetation and roughness
update vegetation set color='#FF0000' where name ='-1';
update vegetation set color='#00FFFF' where name ='1';
update vegetation set color='#00CED1' where name ='2';
update vegetation set color='#FFE1FF' where name ='3';
update vegetation set color='#EE7AE9' where name ='4';
update vegetation set color='#B452CD' where name ='5';
update vegetation set color='#8FBC8F' where name ='6';
update vegetation set color='#3CB357' where name ='7';
update vegetation set color='#006400' where name ='8';
update vegetation set color='#7CFC00' where name ='11';
update vegetation set color='#00CD00' where name ='12';
update vegetation set color='#CCCC00' where name ='13';
update vegetation set color='#999900' where name ='14';

-- natürl. Gewässer
update roughness set color='#FF0000' where name ='-1';
update roughness set color='#FFB90F' where name ='1';
update roughness set color='#FF8247' where name ='2';
update roughness set color='#EEE685' where name ='3';
update roughness set color='#EEEE00' where name ='4';
update roughness set color='#EEAD0E' where name ='5';
update roughness set color='#EE7942' where name ='6';
update roughness set color='#CDC673' where name ='7';
update roughness set color='#CDCD00' where name ='8';
update roughness set color='#CD950C' where name ='9';
update roughness set color='#CD6839' where name ='10';
update roughness set color='#8B864E' where name ='11';
update roughness set color='#8B8B00' where name ='12';
update roughness set color='#8B670B' where name ='13';
update roughness set color='#8B4726' where name ='14';
-- 
update roughness set color='#FCFCFC' where name ='20';
update roughness set color='#EAEAEA' where name ='21';
update roughness set color='#D8D8D8' where name ='22';
update roughness set color='#C6C6C6' where name ='23';
update roughness set color='#B4B4B4' where name ='24';
update roughness set color='#A2A2A2' where name ='25';
update roughness set color='#909090' where name ='26';
update roughness set color='#7E7E7E' where name ='27';
update roughness set color='#6C6C6C' where name ='28';
update roughness set color='#5A5A5A' where name ='29';
update roughness set color='#484848' where name ='30';
update roughness set color='#363636' where name ='31';
update roughness set color='#242424' where name ='32';
-- Vorländer
update roughness set color='#CCFF99' where name ='50';
update roughness set color='#98FB98' where name ='51';
update roughness set color='#00FF7F' where name ='52';
update roughness set color='#7FFF00' where name ='53';
update roughness set color='#32CD32' where name ='54';
update roughness set color='#00FA9A' where name ='55';
update roughness set color='#9ACD32' where name ='56';
update roughness set color='#228B22' where name ='57';
update roughness set color='#006400' where name ='58';


-- Version endgültig setzen
UPDATE INFO set value='0.0.4'  where key ='Version';
commit;
