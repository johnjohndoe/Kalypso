<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="KalypsoServiceObservation-Services" default="build-all" basedir=".">
	<property name="project-name" value="KalypsoServiceObs" />
	<property name="project" value="${workspace}/${project-name}" />
	<property name="projectClient" value="${workspace}/${project-name}Client" />
	<property file="service.properties" />

	<property file="service-build.properties" />
	<property name="wsgen.tmp" value="${java.io.tmpdir}/wsgentmp" />

	<path id="jaxws.classpath">
		<pathelement location="${java.home}/../lib/tools.jar" />
		<fileset dir="${workspace}/KalypsoServiceObs/lib" includes="**/*.jar" />
	</path>

	<taskdef name="wsgen" classname="com.sun.tools.ws.ant.WsGen">
		<classpath refid="jaxws.classpath" />
	</taskdef>

	<taskdef name="wsimport" classname="com.sun.tools.ws.ant.WsImport">
		<classpath refid="jaxws.classpath" />
	</taskdef>

	<target name="prepare">
		<echo message="Project: ${project.name}" />

		<mkdir dir="${wsgen.tmp}" />
	</target>

	<target name="clean">
		<echo message="Cleaning ${project-name}..." />
		<delete includeemptydirs="true" failonerror="false">
			<fileset dir="${project.srcservice}" includes="**/*" />
			<fileset dir="${project.srcclient}" includes="**/*" />
			<include name="${wsgen.tmp}" />
		</delete>
	</target>

	<!-- REMARK: We only need to build the 'server-side' with wsgen, in reality only the necessary binding classes for the requests/responses
				of the service are built. These can be used equally for the client side here. Nice side effect is, that we hence can
				use the same sei for the client. The plug-in containing the sei and the generated binding-classes must
				be present on server and client side.
	-->
	<target name="build-all" depends="prepare">
		<echo message="Building necessary artefacts for observation service: ${service.endpoint.interface}" />

		<wsgen description="Wsgenning" sei="${service.endpoint.interface}" destdir="${wsgen.tmp}" resourcedestdir="${project.srcservice}" sourcedestdir="${project.srcservice}" keep="true" verbose="true" genwsdl="true">
			<classpath>
				<pathelement location="${workspace}/KalypsoServiceObs/build/bin" />
				<pathelement location="${workspace}/KalypsoRepository/build/bin" />
				<pathelement location="${workspace}/KalypsoCore/build/bin" />
				<fileset dir="${eclipse.home}/plugins" includes="org.eclipse.equinox.common*.jar" />
				<fileset dir="${eclipse.home}/plugins" includes="org.eclipse.core.jobs*.jar" />
			</classpath>
		</wsgen>

		<!-- The generated classes will be put into a tmp dir an deleted afterwards
		because we want eclipse to compile the stuff. Sadly, ther is no nocompile-flag for wsgen -->
		<delete includeemptydirs="true" failonerror="false" dir="${wsgen.tmp}" />

	</target>

</project>
