<project default="fake">

	<!-- ================================= 
          target: fake                      nur damit das Projekt nicht schreit
          ================================= -->
	<target name="fake" />

	<!-- ================================= 
          target: calculationProperties                      Initializes properties from .calculation
         ================================= -->
	<target name="calculationProperties">
	</target>

	<!-- ================================= 
          target: runCalculation              
         ================================= -->
	<target name="runCalculation" description="FÃ¼hrt die Berechnung durch">

		<echo message="Result path: ${result.path}"/>
		<echo message="Calc XPath: ${calc.xpath}"/>
		
		<property name="result.dir" value="${calc.dir}/${result.path}"/>

		<!-- der Result path ist immer relativ zum Modellverzeichnis -->
		<property name="result.path.aktuell" value="${result.path}/#aktuell" />
		<property name="result.dir.aktuell" value="${result.dir}/#aktuell" />

		<kalypso.runCalculation typeID="WspmTuhhV1.0" calcCaseFolder="${calc.path}">
			<!-- Dateien relativ zur Rechenvariante (.../input/calc/) -->
			<input id="MODELL_GML" path="wspmTuhhModel.gml" relativeToCalcCase="true" />
			<input id="CALC_PATH" path="${calc.xpath}" />
			<input id="PROFILES" path="Profile" relativeToCalcCase="true" />

			<output id="SimulationLog" path="${result.path.aktuell}/simulation.log" relativeToCalcCase="true" />
			<output id="KernelLog" path="${result.path.aktuell}/kernel.log" relativeToCalcCase="true" />
			<!--
			<output id="Ergebnisse" path="${result.path.aktuell}" relativeToCalcCase="true" />
			<output id="bv_Ergebnisse" />
			<output id="WQ_Tabellen" />
			<output id="ControlFile" />
			<output id="TabularResult" />
			<output id="LengthSection" />
			<output id="BeiwerteAus" />
			-->

			<!-- Verzeichnis wird geleert, bevor die neuen Ergebnisse geholt werden -->
			<clearAfterCalc path="${result.path.aktuell}" relativeToCalcCase="true" />
		</kalypso.runCalculation>

		<!-- copy results to timestamped dir-->
		<tstamp>
			<format property="now" pattern="yyyy.MM.dd#HH_mm_ss" />
		</tstamp>
		<property name="result.dir.time" value="${result.dir}/${now}" />
		<copy todir="${result.dir.time}">
			<fileset dir="${result.dir.aktuell}" includes="**/*" />
		</copy>
	</target>
</project>