<project default="fake">

	<!-- ================================= 
          target: fake                      nur damit das Projekt nicht schreit
          ================================= -->
	<target name="fake" />

	<!-- ================================= 
          target: calculationProperties                      Initializes properties from .calculation
         ================================= -->
	<target name="calculationProperties">
	</target>

	<!-- ================================= 
          target: runCalculation              
         ================================= -->
	<target name="runCalculation" description="FÃ¼hrt die Berechnung durch">
		
		<property name="eps.thinning" value="0.05" />

		<echo message="Result path: ${result.path}" />
		<echo message="Calc XPath: ${calc.xpath}" />
		<echo message="Eps for breakline thinning: ${eps.thinning}" />

		<property name="result.dir" value="${calc.dir}/${result.path}" />

		<!-- der Result path ist immer relativ zum Modellverzeichnis -->
		<property name="result.path.aktuell" value="${result.path}/#aktuell" />
		<property name="result.path.aktuell.logs" value="${result.path.aktuell}/Log-Dateien" />
		<property name="result.dir.aktuell" value="${result.dir}/#aktuell" />

		<kalypso.runCalculation typeID="WspmTuhhV1.0" calcCaseFolder="${calc.path}">
			<!-- Dateien relativ zur Rechenvariante (.../input/calc/) -->
			<input id="MODELL_GML" path="wspmTuhhModel.gml" relativeToCalcCase="true" />
			<input id="CALC_PATH" path="${calc.xpath}" />
			<input id="EPS_THINNING" path="${eps.thinning}" />
			
		    <!-- 
		    Output des Rechenkerns/CalcJobs -->
			<output id="SimulationLog" path="${result.path.aktuell.logs}/simulation.log" relativeToCalcCase="true" />
			<output id="KernelLog" path="${result.path.aktuell.logs}/kernel.log" relativeToCalcCase="true" />
			<output id="KernelErr" path="${result.path.aktuell.logs}/kernel.err" relativeToCalcCase="true" />

		    <!-- 
		    results for all modi -->
			<output id="ControlFile" path="${result.path.aktuell.logs}/Kontroll.log" relativeToCalcCase="true" />
			<output id="BeiwerteAus" path="${result.path.aktuell}/Beiwerte.aus" relativeToCalcCase="true" />
			<output id="LambdaI" path="${result.path.aktuell}/lambda_i.txt" relativeToCalcCase="true" />

			<!-- 
			results for WATERLEVEL mode -->
			<output id="LengthSection" path="${result.path.aktuell}/laengsschnitt.txt" relativeToCalcCase="true" />
			<output id="LengthSectionGml" path="${result.path.aktuell}/laengsschnitt.gml" relativeToCalcCase="true" />
			<output id="Bruchkanten" path="${result.path.aktuell}/bruchkanten.gml" relativeToCalcCase="true" />
			
			<!-- 
			results for WATERLEVEL and BANKFUL UNIFORM mode -->
			<output id="resultList" path="${result.path.aktuell}/Ergebnis.list" relativeToCalcCase="true" />
			
			<!-- 
			results for BANKFUL UNIFORM mode -->
			<output id="bfLengthSection" path="${result.path.aktuell}/result.qb1" relativeToCalcCase="true" />

			<!-- 
			results for BANKFUL NONUNIFORM mode -->
			<output id="wqKalMil" path="${result.path.aktuell}/WQ_Tabelle.km" relativeToCalcCase="true" />
			<output id="wqProProfil" path="${result.path.aktuell}/WQTabs" relativeToCalcCase="true" />
			<output id="resultListsNonUni" path="${result.path.aktuell}/resultLists" relativeToCalcCase="true" />

			<!-- Verzeichnis wird geleert, bevor die neuen Ergebnisse geholt werden -->
			<clearAfterCalc path="${result.path.aktuell}" relativeToCalcCase="true" />
		</kalypso.runCalculation>

		<!-- copy results to timestamped dir-->
		<tstamp>
			<format property="now" pattern="yyyy.MM.dd#HH_mm_ss" />
		</tstamp>
		<property name="result.dir.time" value="${result.dir}/${now}" />
		<copy todir="${result.dir.time}">
			<fileset dir="${result.dir.aktuell}" includes="**/*" />
		</copy>
	</target>
</project>