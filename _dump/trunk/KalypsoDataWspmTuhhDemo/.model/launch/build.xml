<project default="fake">

	<!-- ================================= 
          target: fake                      nur damit das Projekt nicht schreit
          ================================= -->
	<target name="fake" />

	<!-- ================================= 
          target: calculationProperties                      Initializes properties from .calculation
         ================================= -->
	<target name="calculationProperties">
	</target>

	<!-- ================================= 
          target: runCalculation              
         ================================= -->
	<target name="runCalculation" description="FÃ¼hrt die Berechnung durch">

		<echo message="Result path: ${result.path}" />
		<echo message="Calc XPath: ${calc.xpath}" />

		<property name="result.dir" value="${calc.dir}/${result.path}" />

		<!-- der Result path ist immer relativ zum Modellverzeichnis -->
		<property name="result.path.aktuell" value="${result.path}/#aktuell" />
		<property name="result.path.aktuell.logs" value="${result.path.aktuell}/Log-Dateien" />
		<property name="result.dir.aktuell" value="${result.dir}/#aktuell" />

		<kalypso.runCalculation typeID="WspmTuhhV1.0" calcCaseFolder="${calc.path}">
			<!-- Dateien relativ zur Rechenvariante (.../input/calc/) -->
			<input id="MODELL_GML" path="wspmTuhhModel.gml" relativeToCalcCase="true" />
			<input id="CALC_PATH" path="${calc.xpath}" />

			<output id="SimulationLog" path="${result.path.aktuell.logs}/simulation.log" relativeToCalcCase="true" />
			<output id="KernelLog" path="${result.path.aktuell.logs}/kernel.log" relativeToCalcCase="true" />
			<output id="KernelErr" path="${result.path.aktuell.logs}/kernel.err" relativeToCalcCase="true" />

			<output id="ControlFile" path="${result.path.aktuell.logs}/Kontroll.log" relativeToCalcCase="true" />
			<output id="BeiwerteAus" path="${result.path.aktuell}/Beiwerte.aus" relativeToCalcCase="true" />
			<output id="LambdaI" path="${result.path.aktuell}/lambda_i.txt" relativeToCalcCase="true" />
			
			<!-- results for WATERLEVEL mode -->
			<output id="LengthSection" path="${result.path.aktuell}/laengsschnitt.txt" relativeToCalcCase="true" />
			<output id="LengthSectionObs" path="${result.path.aktuell}/laengsschnitt.gml" relativeToCalcCase="true" />
			<output id="resultList" path="${result.path.aktuell}/Ergebnis.list" relativeToCalcCase="true" />
			<output id="Bruchkanten" path="${result.path.aktuell}/bruchkanten.gml" relativeToCalcCase="true" />
			<!-- results for BANKFUL NONUNIFORM mode -->
			<output id="bfLengthSection" path="${result.path.aktuell}/test.qb1" relativeToCalcCase="true" />

			<!-- results for BANKFUL UNIFORM mode -->

			<!-- noch unsortiert 
			<output id="Ergebnisse" path="${result.path.aktuell}" relativeToCalcCase="true" />
			<output id="TabularResult" />
			<output id="bv_Ergebnisse" />
			<output id="WQ_Tabellen" />
			-->

			<!-- Verzeichnis wird geleert, bevor die neuen Ergebnisse geholt werden -->
			<clearAfterCalc path="${result.path.aktuell}" relativeToCalcCase="true" />
		</kalypso.runCalculation>

		<!-- copy results to timestamped dir-->
		<tstamp>
			<format property="now" pattern="yyyy.MM.dd#HH_mm_ss" />
		</tstamp>
		<property name="result.dir.time" value="${result.dir}/${now}" />
		<copy todir="${result.dir.time}">
			<fileset dir="${result.dir.aktuell}" includes="**/*" />
		</copy>
	</target>
</project>